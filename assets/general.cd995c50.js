import{Q as be,b as ve,a as Re}from"./QTabPanels.b9ad1004.js";import{Q as Le}from"./QTabs.c2494432.js";import{Q as Ee}from"./QToolbar.e3e89c52.js";import{Q as qe}from"./QPage.1078672d.js";import{u as H}from"./use-quasar.1a2013e3.js";import{l as Q,_ as F,A as m,B as A,d as s,bi as n,cz as se,cw as te,D as c,cx as S,ab as j,cy as ce,bO as k,bF as le,y as he,r as P,c as R,aZ as M,ao as q,an as C,cA as Se,G as K,F as Y,aY as Z,bM as oe,au as de,bN as Pe,w as Oe}from"./index.9762efb3.js";import{q as y,u as je}from"./quickbase.0330480d.js";import{dayjs as De}from"./dayjs.b06c0c0b.js";import{a as U,c as L,b as ne,u as V}from"./array.97318880.js";import{a as G,b as re}from"./useQuerySaver.4199d87d.js";import{u as ae}from"./dataStore.13d3cdd5.js";import{Q as me}from"./QSelect.4c250828.js";import{Q as ie}from"./QForm.b01fba36.js";import{s as Ce}from"./states.03e3d448.js";import{Q as ye}from"./QInnerLoading.9f020a3c.js";import{Q as _,a as ge}from"./QTable.0077212c.js";import{Q as x}from"./QTr.d46e16b6.js";import{Q as Xe}from"./QTooltip.31d5b5c3.js";import{Q as ee}from"./QTd.337029ba.js";import{u as Ue}from"./project.37490f11.js";import{d as X}from"./decode.593c6ccc.js";import"./use-panel.77030442.js";import"./touch.60582172.js";import"./selection.2be80553.js";import"./QResizeObserver.ae660eeb.js";import"./rtl.cf9bbe47.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.591f4db3.js";import"./i18n.d2983beb.js";import"./api.5a7b34fc.js";import"./QChip.deeb90cb.js";import"./QItemLabel.a7bd6a61.js";import"./QMenu.6d936437.js";import"./position-engine.e9001b32.js";import"./QList.eefd78b8.js";import"./QMarkupTable.1f939997.js";import"./use-fullscreen.7c1ef657.js";const Te=Q({emits:["cancelAdd","addComplete"],props:{},setup(e,{emit:t}){const u=H(),{capitalize:p}=he,v=D=>{const O=D.split(" ");let E="";return O.forEach((J,z)=>{E+=z>0?` ${p(J.toLowerCase())}`:p(J.toLowerCase())}),E},w=U({name:L().required().label("Location Name"),street1:L().required().label("Street Address 1"),street2:L(),city:L().required().label("City"),state:L().required().label("State"),postal:L().required().label("Postal Code"),owner:L().required().label("Owner")}),{meta:l,errors:o,handleSubmit:i,handleReset:h}=ne({validationSchema:w}),{value:a}=V("name"),{value:r}=V("street1"),{value:d}=V("street2"),{value:g}=V("city"),{value:f}=V("state"),{value:b}=V("postal"),{value:$}=V("owner"),T=i(async D=>{const O={6:{value:v(D.name)},10:{value:v(D.street1)},11:{value:D.street2?v(D.street2):""},12:{value:v(D.city)},13:{value:D.state},14:{value:D.postal},15:{value:"United States"},16:{value:v(D.owner)}};try{const{data:E}=await y.upsertRecordsXML({to:"bpzpwz24c",data:[O],fieldsToReturn:[47],formatObject:47});t("addComplete",E[0][47]),h()}catch(E){console.log(E),u.notify({type:"negative",message:"Something went wrong!"})}});return{formErrors:o,formMeta:l,submit:T,name:a,street1:r,street2:d,city:g,state:f,postal:b,states:Ce,owner:$}}}),Me={class:"row"},Qe={class:"col-12 col-md-6 q-px-xs"},Fe={class:"text-caption"},Je={class:"col-12 col-md-6 q-px-xs"},ze={class:"text-caption"},Ie={class:"row"},We={class:"col-12 col-md-6 q-px-xs"},Be={class:"text-caption"},Ge={class:"col-12 col-md-6 q-px-xs"},He={class:"text-caption"},Ye={class:"row"},Ze={class:"col-12 col-md-4 q-px-xs"},Ke={class:"text-caption"},_e={class:"col-12 col-md-4 q-px-xs"},xe={class:"col-12 col-md-4 q-px-xs"},et={class:"text-caption"};function tt(e,t,u,p,v,w){return m(),A("div",null,[s(ie,{onSubmit:le(e.submit,["prevent"])},{default:n(()=>[s(se,null,{default:n(()=>[s(te,null,{default:n(()=>[c("div",Me,[c("div",Qe,[s(S,{label:"Location Name",dense:"",modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.name=l),error:!!e.formErrors.name,"bottom-slots":""},{error:n(()=>[c("div",Fe,j(e.formErrors.name),1)]),_:1},8,["modelValue","error"])]),c("div",Je,[s(S,{label:"Location Owner",dense:"",modelValue:e.owner,"onUpdate:modelValue":t[1]||(t[1]=l=>e.owner=l),error:!!e.formErrors.owner,"bottom-slots":""},{error:n(()=>[c("div",ze,j(e.formErrors.owner),1)]),_:1},8,["modelValue","error"])])]),c("div",Ie,[c("div",We,[s(S,{label:"Street Address 1",dense:"",modelValue:e.street1,"onUpdate:modelValue":t[2]||(t[2]=l=>e.street1=l),error:!!e.formErrors.street1,"bottom-slots":""},{error:n(()=>[c("div",Be,j(e.formErrors.street1),1)]),_:1},8,["modelValue","error"])]),c("div",Ge,[s(S,{label:"Street Address 2",dense:"",modelValue:e.street2,"onUpdate:modelValue":t[3]||(t[3]=l=>e.street2=l),error:!!e.formErrors.street2,"bottom-slots":""},{error:n(()=>[c("div",He,j(e.formErrors.street2),1)]),_:1},8,["modelValue","error"])])]),c("div",Ye,[c("div",Ze,[s(S,{label:"City",dense:"",modelValue:e.city,"onUpdate:modelValue":t[4]||(t[4]=l=>e.city=l),error:!!e.formErrors.city,"bottom-slots":""},{error:n(()=>[c("div",Ke,j(e.formErrors.city),1)]),_:1},8,["modelValue","error"])]),c("div",_e,[s(me,{dense:"",label:"State","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.state,"onUpdate:modelValue":t[5]||(t[5]=l=>e.state=l),options:e.states,"bottom-slots":""},null,8,["modelValue","options"])]),c("div",xe,[s(S,{label:"Postal Code",dense:"",modelValue:e.postal,"onUpdate:modelValue":t[6]||(t[6]=l=>e.postal=l),error:!!e.formErrors.postal,"bottom-slots":""},{error:n(()=>[c("div",et,j(e.formErrors.postal),1)]),_:1},8,["modelValue","error"])])])]),_:1}),s(ce,{align:"right"},{default:n(()=>[s(k,{color:"secondary",label:"Cancel",onClick:t[7]||(t[7]=l=>e.$emit("cancelAdd"))}),s(k,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var ot=F(Te,[["render",tt]]);const at=Q({emits:["cancelAdd","addComplete"],props:{},setup(e,{emit:t}){const u=H(),{capitalize:p}=he,v=d=>{const g=d.split(" ");let f="";return g.forEach((b,$)=>{f+=$>0?` ${p(b.toLowerCase())}`:p(b.toLowerCase())}),f},w=U({name:L().required().label("Customer Name")}),{meta:l,errors:o,handleSubmit:i,handleReset:h}=ne({validationSchema:w}),{value:a}=V("name"),r=i(async d=>{const g={6:{value:v(d.name)}};try{const{data:f}=await y.upsertRecordsXML({to:"bpzpw2rbz",data:[g],fieldsToReturn:[10],formatObject:10});t("addComplete",f[0][10]),h()}catch(f){console.log(f),u.notify({type:"negative",message:"Something went wrong!"})}});return{formErrors:o,formMeta:l,submit:r,name:a}}}),rt={class:"text-caption"};function st(e,t,u,p,v,w){return m(),A("div",null,[s(ie,{onSubmit:le(e.submit,["prevent"])},{default:n(()=>[s(se,null,{default:n(()=>[s(te,null,{default:n(()=>[s(S,{label:"Customer Name",dense:"",modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.name=l),error:!!e.formErrors.name,"bottom-slots":""},{error:n(()=>[c("div",rt,j(e.formErrors.name),1)]),_:1},8,["modelValue","error"])]),_:1}),s(ce,{align:"right"},{default:n(()=>[s(k,{color:"secondary",label:"Cancel",onClick:t[1]||(t[1]=l=>e.$emit("cancelAdd"))}),s(k,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var lt=F(at,[["render",st]]);const nt=Q({emits:["cancelEdit"],components:{AddProjectLocationForm:ot,AddCustomerForm:lt},props:{config:Object},setup(e,{emit:t}){const u=P(null),p=P(null),v=P(!1),w=async()=>{const{type:f,initialValue:b}=e.config;if(f==="options"){const{getter:$}=e.config;p.value=await $(),u.value=p.value,a.value=b(u.value)}else a.value=b},l=R(()=>U({entry:e.config.formRules})),{meta:o,errors:i,handleSubmit:h}=ne({validationSchema:l}),{value:a}=V("entry"),r=(f,b)=>{const{filter:$}=e.config;f===""&&b(()=>{u.value=p.value}),b(()=>{const T=f.toLowerCase();u.value=$(p.value,T)})},d=f=>{v.value=!1,p.value.push(f),u.value.push(f),a.value=f},g=h(async f=>{const{setter:b}=e.config;await b(f.entry),t("cancelEdit")});return w(),{rawOptions:p,options:u,entry:a,formErrors:i,formMeta:o,submit:g,filterOptions:r,addNew:v,newOptionAdded:d}}}),it={key:0,class:"q-pr-xl"},ut={class:"text-caption"},dt={key:0,class:"text-center bg-info"},ct={key:0,class:"text-center bg-info"},mt={key:1,class:"q-pr-xl"},pt={class:"text-caption"};function ft(e,t,u,p,v,w){const l=M("add-project-location-form"),o=M("add-customer-form");return m(),A("div",null,[s(ie,{onSubmit:le(e.submit,["prevent"])},{default:n(()=>[e.config.type==="options"?(m(),A("div",it,[s(me,{class:"q-mb-sm",dense:"",label:`Select a ${e.config.fieldLabel}`,"transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":t[3]||(t[3]=i=>e.entry=i),options:e.options,"option-label":e.config.optionLabel,"display-value":`${e.entry?e.entry[e.config.displayValue]:""}`,"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":"","use-input":"","input-debounce":"0",onFilter:e.filterOptions,clearable:"",loading:!e.rawOptions,disable:!e.rawOptions},{error:n(()=>[c("div",ut,j(e.formErrors.entry),1)]),after:n(()=>[s(k,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),s(k,{color:"dark",icon:"close",dense:"",onClick:t[0]||(t[0]=i=>e.$emit("cancelEdit"))})]),"after-options":n(()=>[e.config.allowNew&&e.options&&e.options.length>0?(m(),A("div",dt,[s(k,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[1]||(t[1]=i=>e.addNew=!0)},null,8,["label"])])):q("",!0)]),"no-option":n(()=>[e.config.allowNew?(m(),A("div",ct,[s(k,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[2]||(t[2]=i=>e.addNew=!0)},null,8,["label"])])):q("",!0)]),_:1},8,["label","modelValue","options","option-label","display-value","error","onFilter","loading","disable"])])):q("",!0),e.config.type==="input"?(m(),A("div",mt,[s(S,{class:"q-mb-sm",dense:"",label:e.config.fieldLabel,modelValue:e.entry,"onUpdate:modelValue":t[5]||(t[5]=i=>e.entry=i),"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":""},{error:n(()=>[c("div",pt,j(e.formErrors.entry),1)]),after:n(()=>[s(k,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),s(k,{color:"dark",icon:"close",dense:"",onClick:t[4]||(t[4]=i=>e.$emit("cancelEdit"))})]),_:1},8,["label","modelValue","error"])])):q("",!0)]),_:1},8,["onSubmit"]),s(Se,{modelValue:e.addNew,"onUpdate:modelValue":t[8]||(t[8]=i=>e.addNew=i)},{default:n(()=>[e.config.newType==="location"?(m(),C(l,{key:0,onCancelAdd:t[6]||(t[6]=i=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):q("",!0),e.config.newType==="customer"?(m(),C(o,{key:1,onCancelAdd:t[7]||(t[7]=i=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):q("",!0)]),_:1},8,["modelValue"])])}var bt=F(nt,[["render",ft]]);const vt=Q({emits:[],props:{item:Object},components:{EditDetailsForm:bt},setup(e,{emit:t}){const u=P(!1),p=R(()=>{const{permission:v}=e.item.editable&&e.item.config?e.item.config:{action:null,subject:null};return v});return{edit:u,permission:p}}}),yt={key:0,class:"row"},gt={class:"col-12 col-md-4"},wt={class:"col-12 col-md-8"};function $t(e,t,u,p,v,w){const l=M("edit-details-form");return m(),C(te,{class:"q-py-sm"},{default:n(()=>[e.edit?(m(),C(l,{key:1,type:e.item.label,config:e.item.config,onCancelEdit:t[1]||(t[1]=o=>e.edit=!1)},null,8,["type","config"])):(m(),A("div",yt,[c("div",gt,[c("div",null,[c("span",{class:K(e.$q.screen.gt.lg?"text-body2":"text-caption")},j(e.item.label),3)])]),c("div",wt,[c("div",null,[c("span",{class:K(["text-weight-light",e.$q.screen.gt.lg?"text-body2":"text-caption"])},j(e.item.value),3),e.item.editable&&e.$can(e.permission.action,e.permission.subject)?(m(),C(k,{key:0,color:"accent",flat:"",dense:"",round:"",icon:"edit",size:"sm",onClick:t[0]||(t[0]=o=>e.edit=!0)})):q("",!0)])])]))]),_:1})}var ht=F(vt,[["render",$t]]);const jt=Q({props:{title:String,details:Array},components:{DetailsSection:ht}}),Ct={class:"text-body1 text-white"};function Nt(e,t,u,p,v,w){const l=M("details-section");return m(),A("div",null,[s(se,{class:"text-dark q-pb-sm"},{default:n(()=>[e.title&&e.title!==""?(m(),C(te,{key:0,class:"bg-info q-py-sm"},{default:n(()=>[c("div",Ct,j(e.title.toUpperCase()),1)]),_:1})):q("",!0),(m(!0),A(Y,null,Z(e.details,o=>(m(),C(l,{key:o,item:o},null,8,["item"]))),128))]),_:1})])}var kt=F(jt,[["render",Nt]]);const At=Q({props:{project:Object},setup(e,t){const u=H(),p=oe(),{getViewedProjects:v,updateViewedProjects:w}=ae(),l=R(()=>p.params.id?p.params.id:e.project[3]?e.project[3]:null),o=R(()=>l.value?v(l.value):null),i=R(()=>o.value&&o.value.crafts?o.value.crafts:[]),h=async()=>{if(l.value&&i.value.length===0){const{data:O}=await y.fetchFromProjectsApp({fields:[G({type:"projectCrafts",query:`{'7'.EX.'${l.value}'}`})]});w({id:l.value,dataset:"crafts",data:O})}},a=U({jobNumber:L().required().label("Job Number"),craft:U(),description:L()}),{meta:r,errors:d,handleSubmit:g,handleReset:f}=ne({validationSchema:a}),{value:b}=V("jobNumber"),{value:$}=V("craft"),{value:T}=V("description"),D=g(async O=>{const E={6:{value:l.value},11:{value:O.jobNumber}};O.craft&&Object.assign(E,{14:{value:O.craft[3]}}),O.description&&Object.assign(E,{20:{value:O.description}});try{const{data:J}=await y.upsertRecordsXML({to:"bpzpwr2eh",data:[E],fieldsToReturn:[35],formatObject:35}),z=o.value.jobNumbers;z.push(J[0][35]),w({id:l.value,dataset:"jobNumbers",data:z}),u.notify({type:"positive",message:`Job Number ${J[0][35][11]} successfully added`})}catch(J){console.log(J),u.notify({type:"negative",message:"Something went wrong!"})}t.emit("jobNumberAdded"),f()});return h(),{jobNumber:b,craft:$,description:T,formErrors:d,formMeta:r,submit:D,crafts:i}}}),Vt={class:"row"},Rt={class:"col-12 col-md-4 q-pr-sm"},Lt={class:"text-caption"},Et={class:"col-12 col-md-4 q-pr-sm"},qt={class:"col-12 col-md-4"};function St(e,t,u,p,v,w){return m(),A("div",null,[s(ie,{onSubmit:le(e.submit,["prevent"])},{default:n(()=>[s(se,null,{default:n(()=>[s(te,null,{default:n(()=>[c("div",Vt,[c("div",Rt,[s(S,{label:"Job Number",dense:"",modelValue:e.jobNumber,"onUpdate:modelValue":t[0]||(t[0]=l=>e.jobNumber=l),error:!!e.formErrors.jobNumber,"bottom-slots":""},{error:n(()=>[c("div",Lt,j(e.formErrors.jobNumber),1)]),_:1},8,["modelValue","error"])]),c("div",Et,[s(me,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craft,"onUpdate:modelValue":t[1]||(t[1]=l=>e.craft=l),options:e.crafts,"option-label":"10","display-value":`${e.craft?e.craft[10]:""}`},null,8,["modelValue","options","display-value"])]),c("div",qt,[s(S,{label:"Description",dense:"",modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=l=>e.description=l)},null,8,["modelValue"])])])]),_:1}),s(ce,{align:"right"},{default:n(()=>[s(k,{color:"secondary",label:"Cancel",onClick:t[3]||(t[3]=l=>e.$emit("cancelAddJobNumber"))}),s(k,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Ne=F(At,[["render",St]]);const Pt=[{name:0,label:"Job Number",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Craft",align:"left",field:e=>e[15],format:e=>`${e}`,sortable:!0,required:!0}],Ot=Q({components:{AddJobNumber:Ne},props:{project:String},setup(e){const t=H(),u=oe(),p=P(!0),v=P(!1),{getViewedProjects:w,updateViewedProjects:l}=ae(),o=R(()=>u.params.id?u.params.id:e.project),i=R(()=>w(o.value)),h=R(()=>{const g=i.value&&i.value.jobNumbers?i.value.jobNumbers:[];return g.length>0?g.sort((f,b)=>f[1].$d>b[1].$d?1:-1):g}),a=async g=>{if(p.value=!0,h.value.length===0||g){const{data:f}=await y.fetchFromProjectsApp({fields:[G({type:"jobNumbers",query:`{'6'.EX.'${o.value}'}AND{'29'.EX.'Active'}`})]});l({id:o.value,dataset:"jobNumbers",data:f})}p.value=!1};function r(g){console.log(g),t.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${g[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{d(g)})}async function d(g){try{const{data:f}=await y.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:g[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35}),b=h.value.filter($=>$[3]!==f[0][35][3]);l({id:o.value,dataset:"jobNumbers",data:b}),t.notify({type:"positive",message:"Job Number Removed"})}catch(f){console.log(f),t.notify({type:"negative",message:"Something went wrong"})}}return a(),{projectData:i,jobNumberColumns:Pt,rows:h,initialPagination:{rowsPerPage:P(10)},showAddJobNumber:v,removeRow:r,loadData:a,loading:p}}}),Dt={class:"text-caption"};function Xt(e,t,u,p,v,w){const l=M("add-job-number");return m(),A("div",null,[e.showAddJobNumber?q("",!0):(m(),C(ge,{key:0,dense:"",title:"Job Numbers","title-class":"text-primary",style:{},columns:e.jobNumberColumns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ye,{label:"Loading...","label-class":"text-info"})]),"top-left":n(()=>[e.$can("create","projectJobNumbers")||e.$can("manage","projects")?(m(),C(k,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=o=>e.showAddJobNumber=!0)})):q("",!0)]),"top-right":n(()=>[s(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(m(!0),A(Y,null,Z(o.cols,i=>(m(),C(_,{class:"text-left",key:i.name},{default:n(()=>[de(j(i.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[s(Xe,{anchor:"top middle",self:"top middle"},{default:n(()=>[de("Description: "+j(o.row[20]),1)]),_:2},1024),(m(!0),A(Y,null,Z(o.cols,i=>(m(),C(ee,{key:i.name,props:o},{default:n(()=>[c("span",Dt,j(i.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(m(),C(k,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:i=>e.removeRow(o.row)},null,8,["onClick"])):q("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJobNumber?(m(),C(l,{key:1,project:e.projectData,onJobNumberAdded:t[2]||(t[2]=o=>e.showAddJobNumber=!1),onCancelAddJobNumber:t[3]||(t[3]=o=>e.showAddJobNumber=!1)},null,8,["project"])):q("",!0)])}var Ut=F(Ot,[["render",Xt]]);const Tt=[{name:0,label:"Rule",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Miles",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0,required:!0},{name:2,label:"Amount",align:"left",field:e=>e[10],format:e=>e?`$ ${e.toFixed(2)}`:"",sortable:!0,required:!0}],Mt=Q({components:{AddJobNumber:Ne},props:{project:String},setup(e){const t=H(),u=oe(),p=P(!0),{getViewedProjects:v,updateViewedProjects:w}=ae(),l=R(()=>u.params.id?u.params.id:e.project),o=R(()=>v(l.value)),i=R(()=>(o.value&&o.value.perDiem?o.value.perDiem:[]).sort((b,$)=>b[1].$d>$[1].$d?1:-1)),h=async f=>{if(p.value=!0,i.value.length===0||f){const{data:b}=await y.fetchFromProjectsApp({fields:[G({type:"perDiemSpecs",query:`{'12'.EX.'${l.value}'}AND{'38'.EX.'Active'}`})]});w({id:l.value,dataset:"perDiem",data:b})}p.value=!1},a=P(!1),{removeObject:r}=Ue();R(()=>(o.value&&o.value.jobNumbers?o.value.jobNumbers:[]).sort((b,$)=>b[1].$d>$[1].$d?1:-1));function d(f){console.log(f),t.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${f[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{g(f)})}async function g(f){try{const{data:b}=await y.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:f[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35});r({array:"jobNumbers",object:b[0][35]})}catch(b){console.log(b),t.notify({type:"negative",message:"Something went wrong"})}}return h(),{projectData:o,columns:Tt,rows:i,initialPagination:{rowsPerPage:P(8)},showAddJobNumber:a,removeRow:d,loadData:h,loading:p}}}),Qt={class:"text-caption"};function Ft(e,t,u,p,v,w){const l=M("add-job-number");return m(),A("div",null,[e.showAddJobNumber?q("",!0):(m(),C(ge,{key:0,dense:"",title:"Per-Diem","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ye,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","projectPerDiem")||e.$can("manage","projects")?(m(),C(k,{key:0,disable:"",dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=o=>e.showAddJobNumber=!0)})):q("",!0)]),"top-right":n(()=>[s(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(m(!0),A(Y,null,Z(o.cols,i=>(m(),C(_,{class:"text-left",key:i.name},{default:n(()=>[de(j(i.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[(m(!0),A(Y,null,Z(o.cols,i=>(m(),C(ee,{key:i.name,props:o},{default:n(()=>[c("span",Qt,j(i.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(m(),C(k,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:i=>e.removeRow(o.row)},null,8,["onClick"])):q("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJobNumber?(m(),C(l,{key:1,onJobNumberAdded:t[2]||(t[2]=o=>e.showAddJobNumber=!1),onCancelAddJobNumber:t[3]||(t[3]=o=>e.showAddJobNumber=!1)})):q("",!0)])}var Jt=F(Mt,[["render",Ft]]);const zt=Q({emits:["cancelAdd","addComplete"],props:{project:Object},setup(e,{emit:t}){const u=H(),p=oe(),{getViewedProjects:v,updateViewedProjects:w}=ae(),l=R(()=>p.params.id?p.params.id:e.project[3]?e.project[3]:null),o=R(()=>l.value?v(l.value):null),i=U({name:L().required().label("Location Name"),street1:L().required().label("Street Address 1"),street2:L(),city:L().required().label("City"),state:L().required().label("State"),postal:L().required().label("Postal Code")}),{meta:h,errors:a,handleSubmit:r,handleReset:d}=ne({validationSchema:i}),{value:g}=V("name"),{value:f}=V("street1"),{value:b}=V("street2"),{value:$}=V("city"),{value:T}=V("state"),{value:D}=V("postal"),O=r(async E=>{const J={6:{value:E.name},8:{value:E.street1},9:{value:E.street2?E.street2:""},10:{value:E.city},11:{value:E.state},12:{value:E.postal},13:{value:"United States"}};o.value[8]&&Object.assign(J,{15:{value:o.value[8]}});try{const{data:z}=await y.upsertRecordsXML({to:"bp5d2twyj",data:[J],fieldsToReturn:[22],formatObject:22}),pe=o.value.meetingLocations;pe.push(z[0][22]),w({id:l.value,dataset:"meetingLocations",data:pe}),u.notify({type:"positive",message:`Meeting location ${z[0][22][6]} successfully added`}),t("addComplete"),d()}catch(z){console.log(z),u.notify({type:"negative",message:"Something went wrong!"})}});return{projectObject:o,formErrors:a,formMeta:h,submit:O,name:g,street1:f,street2:b,city:$,state:T,postal:D,states:Ce}}}),It={class:"row"},Wt={class:"col-6 col-md-12"},Bt={class:"text-caption"},Gt={class:"text-caption"},Ht={class:"text-caption"},Yt={class:"text-caption"},Zt={class:"text-caption"};function Kt(e,t,u,p,v,w){return m(),A("div",null,[s(ie,{onSubmit:le(e.submit,["prevent"])},{default:n(()=>[s(se,null,{default:n(()=>[s(te,null,{default:n(()=>[c("div",It,[c("div",Wt,[s(S,{label:"Location Name",dense:"",modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=l=>e.name=l),error:!!e.formErrors.name,"bottom-slots":""},{error:n(()=>[c("div",Bt,j(e.formErrors.name),1)]),_:1},8,["modelValue","error"]),s(S,{label:"Street Address 1",dense:"",modelValue:e.street1,"onUpdate:modelValue":t[1]||(t[1]=l=>e.street1=l),error:!!e.formErrors.street1,"bottom-slots":""},{error:n(()=>[c("div",Gt,j(e.formErrors.street1),1)]),_:1},8,["modelValue","error"]),s(S,{label:"Street Address 2",dense:"",modelValue:e.street2,"onUpdate:modelValue":t[2]||(t[2]=l=>e.street2=l),error:!!e.formErrors.street2,"bottom-slots":""},{error:n(()=>[c("div",Ht,j(e.formErrors.street2),1)]),_:1},8,["modelValue","error"]),s(S,{label:"City",dense:"",modelValue:e.city,"onUpdate:modelValue":t[3]||(t[3]=l=>e.city=l),error:!!e.formErrors.city,"bottom-slots":""},{error:n(()=>[c("div",Yt,j(e.formErrors.city),1)]),_:1},8,["modelValue","error"]),s(me,{dense:"",label:"State","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.state,"onUpdate:modelValue":t[4]||(t[4]=l=>e.state=l),options:e.states,"bottom-slots":""},null,8,["modelValue","options"]),s(S,{label:"Postal Code",dense:"",modelValue:e.postal,"onUpdate:modelValue":t[5]||(t[5]=l=>e.postal=l),error:!!e.formErrors.postal,"bottom-slots":""},{error:n(()=>[c("div",Zt,j(e.formErrors.postal),1)]),_:1},8,["modelValue","error"])])])]),_:1}),s(ce,{align:"right"},{default:n(()=>[s(k,{color:"secondary",label:"Cancel",onClick:t[6]||(t[6]=l=>e.$emit("cancelAdd"))}),s(k,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var _t=F(zt,[["render",Kt]]);const xt=[{name:0,label:"Location Name",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0},{name:1,label:"Address",align:"left",field:e=>e[8],format:e=>`${e}`,sortable:!1,required:!0}],eo=Q({components:{AddMeetingLocation:_t},props:{project:String},setup(e){const t=H(),u=oe(),p=P(!0),v=P(!1),{getViewedProjects:w,updateViewedProjects:l}=ae(),o=R(()=>u.params.id?u.params.id:e.project),i=R(()=>w(o.value)),h=R(()=>i.value&&i.value.meetingLocations?i.value.meetingLocations:[]),a=async g=>{if(p.value=!0,(h.value.length===0||g)&&i.value){const{data:f}=await y.fetchFromStructureApp({fields:[re({type:"meetingLocations",query:`{'15'.EX.'${i.value[8]}'}AND{'14'.EX.'Active'}`})]});l({id:o.value,dataset:"meetingLocations",data:f})}p.value=!1};function r(g){console.log(g),t.dialog({title:"Confirm",message:`Are you sure you want to remove location ${g[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{d(g)})}async function d(g){try{const{data:f}=await y.upsertRecordsXML({to:"bp5d2twyj",data:[{3:{value:g[3]},14:{value:"Inactive"}}],fieldsToReturn:[22],formatObject:22}),b=h.value.filter($=>$[3]!==f[0][22][3]);l({id:o.value,dataset:"meetingLocations",data:b}),t.notify({type:"positive",message:"Meeting Location Removed"})}catch(f){console.log(f),t.notify({type:"negative",message:"Something went wrong"})}}return a(),{projectData:i,columns:xt,rows:h,initialPagination:{rowsPerPage:P(8)},showAdd:v,removeRow:r,loadData:a,loading:p}}}),to={class:"text-caption"};function oo(e,t,u,p,v,w){const l=M("add-meeting-location");return m(),A("div",null,[e.showAdd?q("",!0):(m(),C(ge,{key:0,dense:"",title:"Meeting Locations","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ye,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[s(k,{dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=o=>e.showAdd=!0)})]),"top-right":n(()=>[s(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(m(!0),A(Y,null,Z(o.cols,i=>(m(),C(_,{class:"text-left",key:i.name},{default:n(()=>[de(j(i.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[(m(!0),A(Y,null,Z(o.cols,i=>(m(),C(ee,{key:i.name,props:o},{default:n(()=>[c("span",to,j(i.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[s(k,{color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:i=>e.removeRow(o.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(m(),C(l,{key:1,onAddComplete:t[2]||(t[2]=o=>e.showAdd=!1),onCancelAdd:t[3]||(t[3]=o=>e.showAdd=!1)})):q("",!0)])}var ao=F(eo,[["render",oo]]);const ro=Q({components:{},props:{project:Object},setup(e,t){const u=H(),p=P(10),v=P(null),{getUser:w}=Pe(je()),l=P(null),o=R(()=>{const N=new RegExp("^[0-9]{"+p.value+"}","g");return U({firstName:L().required().label("First Name"),lastName:L().required().label("Last Name"),email:L().email().required().label("Email"),phoneNumber:L().matches(N,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),role:U().required().nullable().label("Role"),workdayId:L().required().label("Workday ID")})}),{meta:i,errors:h,handleSubmit:a,handleReset:r}=ne({validationSchema:o}),{value:d}=V("firstName"),{value:g}=V("lastName"),{value:f}=V("email"),{value:b}=V("phoneNumber"),{value:$}=V("role"),{value:T}=V("workdayId");async function D({accessID:N}){const{data:I}=await y.upsertRecordsXML({to:"br598isx6",data:[{3:{value:N},20:{value:!0}}],fieldsToReturn:[28],formatObject:28});t.emit("userAdded",{user:I[0][28]}),u.loading.hide(),r()}async function O(N,I){y.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:N},10:{value:"Active"},11:{value:I}}]});const{data:ue}=await y.fetchFromStructureApp({fields:[{6:{value:"br598isx6"},7:{value:"Table Query"},8:{value:`{'6'.EX.${N}}`},9:{value:1},14:{value:24}}]});if(new Set(ue.filter(B=>B[7]==="Project").map(B=>B[9])).has(e.project[3])){const B=ue.find(we=>we[9]===e.project[3]);D({accessID:B[3]})}else return!1}async function E(N){const I=`{'6'.EX.'${N.email}'}AND{'8'.EX.'${N.phoneNumber}'}AND{'32'.EX.'${N.userType}'}`,ue=[{7:{value:"User Request"},8:{value:I},9:{value:1},14:{value:77}}],{data:W}=await y.fetchFromStructureApp({fields:ue});if(W.length<1)return null;if(!await O(W[0][3],N.role))return W}const J=a(async N=>{u.loading.show();const I={userType:"Project User",phoneNumber:`+${v.value?v.value.dialCode:"1"}${N.phoneNumber}`,email:N.email,role:N.role[3]};if(e.project.users.filter(W=>W[6]===I.email||W[8]===I.phoneNumber).length>0)u.dialog({title:"Alert",message:"Your project already has a user with that phone or email."}).onOk(()=>{t.emit("userCanceled")});else{const W=await E(I);if(console.log(W),W){const{data:B}=await y.upsertRecordsXML({to:"br598isx6",data:[{6:{value:W[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});B.length>0&&t.emit("userAdded",{user:B[0][28]})}else{const B=f.value.match(/^([^@]*)@/)[1],we=Object.assign({phoneNumber:b.value},v.value),{data:$e}=await y.upsertRecordsXML({to:"br4pxrbs6",data:[{6:{value:N.email},7:{value:"temp"},8:{value:`+${v.value?v.value.dialCode:"1"}${N.phoneNumber}`},9:{value:JSON.stringify(we)},10:{value:"Active"},11:{value:N.role[3]},17:{value:!0},23:{value:w.value[3]},24:{value:w.value[3]},25:{value:new Date},26:{value:new Date},32:{value:"Project User"},33:{value:B},35:{value:d.value},37:{value:g.value},49:{value:!0},50:{value:!0},70:{value:N.workdayId}}],fieldsToReturn:[3,96],formatObject:96});if($e[0]!==void 0){const fe=await y.upsertRecordsXML({to:"br598isx6",data:[{6:{value:$e[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});fe.data[0]!==void 0&&u.dialog({title:"Confirm",message:"User successfully added. Would you like to send them an invite?",cancel:!0,persistent:!0}).onOk(async()=>{(await y.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:fe.data[0][28][3]},93:{value:new Date}}],fieldsToReturn:[3]})).data[0]!==void 0&&(u.notify({type:"positive",message:"User invite submitted"}),t.emit("userAdded",{user:fe.data[0][28]}))}).onCancel(()=>{t.emit("userAdded",{user:fe.data[0][28]})})}}}r(),u.loading.hide()}),z=R(()=>{const N=e.project.users.map(I=>I[9].phoneNumber);return new Set(N)});Oe(b,N=>{z.value.has(N)&&u.notify({type:"negative",message:"Phone Number is already in use!",timeout:1e4,position:u.screen.lt.md?"top":"center"})});const pe=N=>{v.value=N},ke=N=>{p.value=N};function Ae(){r(),t.emit("userCanceled")}async function Ve(){u.loading.show();const{data:N}=await y.fetchFromStructureApp({fields:[{6:{value:"br5v4in72"},7:{value:"Table Query"},8:{value:"{'7'.EX.'Projects'}AND{'15'.EX.'Active'}AND{'17'.EX.true}"},9:{value:1},14:{value:18}}]});l.value=N,u.loading.hide()}return Ve(),{updateCountry:pe,updatePhoneMaxLength:ke,firstName:d,lastName:g,email:f,phoneNumber:b,role:$,workdayId:T,formMeta:i,formErrors:h,submitUser:J,roleOptions:l,cancel:Ae}}}),so=c("div",{class:"text-primary text-h6"},"Add a New User",-1),lo=c("div",{class:"text-accent text-body2 text-italic q-mb-md"},"All info is required.",-1),no={class:"row justify-between"},io={class:"row justify-between"},uo={class:"text-caption"},co={class:"row justify-between"},mo={class:"text-caption"},po={class:"text-caption"};function fo(e,t,u,p,v,w){return m(),A("div",null,[s(se,null,{default:n(()=>[s(ie,{onSubmit:le(e.submitUser,["prevent"])},{default:n(()=>[s(te,null,{default:n(()=>[so,lo,c("div",no,[c("div",{class:K(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(S,{dense:"",outlined:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=l=>e.firstName=l),error:!!e.formErrors.firstName},null,8,["modelValue","error"])],2),c("div",{class:K(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(S,{dense:"",outlined:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=l=>e.lastName=l),error:!!e.formErrors.lastName},null,8,["modelValue","error"])],2)]),c("div",io,[c("div",{class:K(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(S,{dense:"",outlined:"",label:"Workday ID",modelValue:e.workdayId,"onUpdate:modelValue":t[2]||(t[2]=l=>e.workdayId=l),error:!!e.formErrors.workdayId},null,8,["modelValue","error"])],2),c("div",{class:K(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(S,{dense:"",outlined:"",label:"Phone Number",modelValue:e.phoneNumber,"onUpdate:modelValue":t[3]||(t[3]=l=>e.phoneNumber=l),error:!!e.formErrors.phoneNumber,"bottom-slots":""},{error:n(()=>[c("div",uo,j(e.formErrors.phoneNumber),1)]),_:1},8,["modelValue","error"])],2)]),c("div",co,[c("div",{class:K(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(S,{dense:"",outlined:"",label:"Email","bottom-slots":"",modelValue:e.email,"onUpdate:modelValue":t[4]||(t[4]=l=>e.email=l),error:!!e.formErrors.email},{error:n(()=>[c("div",mo,j(e.formErrors.email),1)]),_:1},8,["modelValue","error"])],2),c("div",{class:K(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(me,{dense:"",outlined:"",label:"Role","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.role,"onUpdate:modelValue":t[5]||(t[5]=l=>e.role=l),options:e.roleOptions,"option-label":"6","display-value":`${e.role?e.role[6]:""}`,"bottom-slots":"",error:!!e.formErrors.role},{error:n(()=>[c("div",po,j(e.formErrors.role),1)]),_:1},8,["modelValue","options","display-value","error"])],2)])]),_:1}),s(ce,{align:"right"},{default:n(()=>[s(k,{color:"secondary",onClick:e.cancel,label:"Cancel"},null,8,["onClick"]),s(k,{color:"primary",type:"submit",label:"Submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])}var bo=F(ro,[["render",fo]]);const vo=[{name:1,label:"Name",align:"left",field:e=>e[35],format:(e,t)=>`${e} ${t[37]}`,sortable:!0},{name:2,label:"Role",align:"left",field:e=>e[44],format:e=>`${e}`,sortable:!0}],yo=Q({components:{AddUser:bo},props:{project:String},setup(e){const t=H(),u=oe(),p=P(!0),v=P(!1),{getViewedProjects:w,updateViewedProjects:l}=ae(),{userData:o}=je(),i=R(()=>u.params.id?u.params.id:e.project),h=R(()=>w(i.value)),a=R(()=>(h.value&&h.value.users?h.value.users:[]).filter($=>$[3]!==o[3]).sort(($,T)=>$[1].$d>T[1].$d?1:-1)),r=async b=>{if(p.value=!0,a.value.length===0||b){const{data:$}=await y.fetchFromStructureApp({fields:[re({type:"userAccess",query:`{'9'.EX.'${i.value}'}AND{'20'.EX.true}`})]});l({id:i.value,dataset:"users",data:$})}p.value=!1};function d(b){console.log(b),t.dialog({title:"Confirm",message:`Are you sure you want to remove user ${b[35]} ${b[37]}?`,cancel:!0,persistent:!0}).onOk(()=>{f(b)})}function g({user:b}){t.notify({type:"positive",message:"User successfully added!"}),v.value=!1;const $=h.value.users;$.push(b),l({id:i.value,dataset:"users",data:$})}async function f(b){const{data:$}=await y.fetchFromStructureApp({fields:[re({type:"userAccessObject",query:`{'6'.EX.'${b[3]}'}AND{'7'.EX.'Project'}AND{'9'.EX.'${i.value}'}`})]}),T=[];$.forEach(O=>{const E={3:{value:O[3]},20:{value:!1},38:{value:!1},39:{value:!1},40:{value:!1},41:{value:!1}};T.push(E)}),y.upsertRecordsXML({to:"br598isx6",data:T,fieldsToReturn:[3]});const D=a.value.filter(O=>O[3]!==b[3]);l({id:i.value,dataset:"users",data:D}),t.notify({type:"positive",message:"User Removed"})}return r(),{projectData:h,columns:vo,rows:a,initialPagination:{rowsPerPage:P(8)},showAdd:v,removeRow:d,loadData:r,loading:p,userAdded:g}}}),go={class:"text-caption"};function wo(e,t,u,p,v,w){const l=M("add-user");return m(),A("div",null,[e.showAdd?q("",!0):(m(),C(ge,{key:0,dense:"",title:"Users","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ye,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","users")?(m(),C(k,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=o=>e.showAdd=!0)})):q("",!0)]),"top-right":n(()=>[s(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(m(!0),A(Y,null,Z(o.cols,i=>(m(),C(_,{class:"text-left",key:i.name},{default:n(()=>[de(j(i.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[(m(!0),A(Y,null,Z(o.cols,i=>(m(),C(ee,{key:i.name,props:o},{default:n(()=>[c("span",go,j(i.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","users")?(m(),C(k,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:i=>e.removeRow(o.row)},null,8,["onClick"])):q("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(m(),C(l,{key:1,onUserAdded:e.userAdded,onUserCanceled:t[2]||(t[2]=o=>e.showAdd=!1),project:e.projectData},null,8,["onUserAdded","project"])):q("",!0)])}var $o=F(yo,[["render",wo]]);const ho=Q({components:{DetailsCard:kt,JobNumbers:Ut,PerDiem:Jt,MeetingLocations:ao,Users:$o},setup(e,{emit:t}){const u=H(),p=P(0),v=oe(),{getViewedProjects:w,updateViewedProjects:l}=ae(),o=R(()=>w(v.params.id)),i=a=>{const r=[];for(const[d,g]of Object.entries(a)){const f={fid:d,value:g};r.push(f)}l({id:o.value[3],props:r})};return{details:R(()=>o.value?[{label:"Date Created",value:De(o.value[1].$d).format("MM/DD/YYYY hh:mm:ss a"),editable:!1},{label:"Project Name",value:o.value[20],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:o.value[20],formRules:L().required().label("Project Name"),fieldLabel:"Enter the Project Name",getter:null,setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},20:{value:a}}],fieldsToReturn:[20,43]});i(r[0]),u.notify({type:"positive",message:"Project Name successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Project Name"})}}}},{label:"Project Alias",value:o.value[44],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:o.value[44],formRules:L().required().label("Project Alias"),fieldLabel:"Enter the Project Alias",getter:null,setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},44:{value:a}}],fieldsToReturn:[44]});i(r[0]),u.notify({type:"positive",message:"Project Alias successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Project Alias"})}}}},{label:"Customer",value:o.value[25],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"customer",initialValue:a=>a.find(r=>r[3]===o.value[9]),formRules:U().required().label("Customer").nullable(),fieldLabel:"Customer",optionLabel:"6",displayValue:6,getter:async()=>{const{data:a}=await y.fetchFromStructureApp({fields:[re({type:"projectCustomers",query:"{'7'.EX.'Active'}"})]});return a.sort((r,d)=>r[6]>d[6]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},9:{value:a[3]}}],fieldsToReturn:[9,25]});i(r[0]),u.notify({type:"positive",message:"Customer successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Customer"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1)}},{label:"Job Site",value:o.value[24],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"location",initialValue:a=>a.find(r=>r[3]===o.value[8]),formRules:U().required().label("Job Site").nullable(),fieldLabel:"Job Site",optionLabel:"6",displayValue:6,getter:async()=>{const{data:a}=await y.fetchFromStructureApp({fields:[re({type:"projectLocations",query:"{'51'.EX.true}"})]});return a.sort((r,d)=>r[6]>d[6]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},8:{value:a[3]}}],fieldsToReturn:[8,24,43,67,69,136]});i(r[0]),u.notify({type:"positive",message:"Job Site successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Job Site"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1)}},{label:"Address",value:o.value[67]},{label:"Sup Org Manager",value:o.value[245]},{label:"Primary Hiring Center",value:o.value[76],editable:!0,config:{permission:{action:"manage",subject:"hiringCenters"},type:"options",allowNew:!1,initialValue:a=>a.find(r=>r[3]===o.value[12]),formRules:U().required().label("Primary Hiring Center").nullable(),fieldLabel:"Hiring Center",optionLabel:"60",displayValue:60,getter:async()=>{const{data:a}=await y.fetchFromStructureApp({fields:[re({type:"hiringCenters",query:"{'51'.EX.'Active'}"})]});return a.sort((r,d)=>r[60]>d[60]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},12:{value:a[3]}}],fieldsToReturn:[12,26,76]});i(r[0]),u.notify({type:"positive",message:"Hiring Center successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Hiring Center"})}},filter:(a,r)=>a.filter(d=>d[60].toLowerCase().indexOf(r)>-1)}},{label:"Workday Location",value:`${o.value[241]} (${o.value[242]})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:a=>a.find(r=>r[3]===o.value[240]),formRules:U().required().label("Workday Location").nullable(),fieldLabel:"Workday Location",optionLabel:a=>`${a[6]} (${a[7]})`,displayValue:6,getter:async()=>{const{data:a}=await y.fetchFromProjectsApp({fields:[G({type:"workdayLocations",query:`{'14'.EX.true}AND{'45'.EX.'${o.value[136]}'}`})]});return a.sort((r,d)=>r[6]>d[6]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},240:{value:a[40]}}],fieldsToReturn:[240,241,242,257,258]});return i(r[0]),u.notify({type:"positive",message:"Workday Location successfully updated"}),!0}catch{u.notify({type:"negative",message:"Error updating Workday Location"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1||d[7].toLowerCase().indexOf(r)>-1)}},{label:"Supervisory Org",value:`${X(o.value[259])} (${X(o.value[244])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:a=>a.find(r=>r[3]===o.value[243]),formRules:U().required().label("Supervisory Organization").nullable(),fieldLabel:"Supervisory Organization",optionLabel:a=>`${a[42]} (${a[6]}) - ${X(a[26])}`,displayValue:42,getter:async()=>{const{data:a}=await y.fetchFromProjectsApp({fields:[G({type:"supOrgs",query:`{'32'.EX.'Active'}AND{'44'.EX.'${o.value[272]}'}`})]});return a.sort((r,d)=>r[42]>d[42]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},243:{value:a[16]}}],fieldsToReturn:[243,244,245,259]});i(r[0]),u.notify({type:"positive",message:"Supervisory Organization successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Supervisory Organization"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1||d[26].toLowerCase().indexOf(r)>-1||d[41].toLowerCase().indexOf(r)>-1||d[42].toLowerCase().indexOf(r)>-1)}},{label:"Company",value:`${X(o.value[286])} (${X(o.value[287])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:a=>a.find(r=>r[3]===o.value[285]),formRules:U().required().label("Company").nullable(),fieldLabel:"Company",optionLabel:a=>`${X(a[6])} (${a[7]})`,displayValue:6,getter:async()=>{const{data:a}=await y.fetchFromProjectsApp({fields:[G({type:"companies",query:`{'8'.EX.true}AND{'14'.EX.'${o.value[136]}'}`})]});return a.sort((r,d)=>r[6]>d[6]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},285:{value:a[10]}}],fieldsToReturn:[285,286,287]});i(r[0]),u.notify({type:"positive",message:"Company successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Company"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1||d[7].toLowerCase().indexOf(r)>-1)}},{label:"Workday Region",value:`${X(o.value[283])} (${X(o.value[284])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:a=>a.find(r=>r[3]===o.value[282]),formRules:U().required().label("Workday Region").nullable(),fieldLabel:"Workday Region",optionLabel:a=>`${X(a[6])} (${a[7]})`,displayValue:6,getter:async()=>{const{data:a}=await y.fetchFromProjectsApp({fields:[G({type:"workdayRegions",query:"{'8'.EX.true}"})]});return a.sort((r,d)=>r[6]>d[6]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},282:{value:a[9]}}],fieldsToReturn:[282,283,284]});i(r[0]),u.notify({type:"positive",message:"Region successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Region"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1||d[7].toLowerCase().indexOf(r)>-1)}},{label:"Workday Branch",value:`${X(o.value[289])} (${X(o.value[290])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:a=>a.find(r=>r[3]===o.value[288]),formRules:U().required().label("Workday Branch").nullable(),fieldLabel:"Workday Branch",optionLabel:a=>`${X(a[6])} (${a[7]})`,displayValue:6,getter:async()=>{const{data:a}=await y.fetchFromProjectsApp({fields:[G({type:"workdayBranches",query:`{'8'.EX.true}AND{'9'.EX.'${o.value[264]}'}AND{'16'.EX.'${o.value[136]}'}`})]});return a.sort((r,d)=>r[6]>d[6]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},288:{value:a[12]}}],fieldsToReturn:[288,289,290]});i(r[0]),u.notify({type:"positive",message:"Branch successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Branch"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1||d[7].toLowerCase().indexOf(r)>-1)}},{label:"Pay Group",value:`${X(o.value[261])} (${X(o.value[262])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:a=>a.find(r=>r[3]===o.value[260]),formRules:U().required().label("Workday Pay Group").nullable(),fieldLabel:"Workday Pay Group",optionLabel:a=>`${X(a[6])} (${a[7]})`,displayValue:6,getter:async()=>{const{data:a}=await y.fetchFromProjectsApp({fields:[G({type:"workdayPayGroups",query:`{'8'.EX.'TRUE'}AND{'11'.EX.'Weekly'}AND{'21'.EX.'${o.value[136]}'}`})]});return a.sort((r,d)=>r[6]>d[6]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},260:{value:a[16]}}],fieldsToReturn:[260,261,262,263,264,272]});i(r[0]),u.notify({type:"positive",message:"Pay Group successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Pay Group"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1||d[7].toLowerCase().indexOf(r)>-1)}},{label:"Cost Center",value:`${X(o.value[276])} (${X(o.value[275])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:a=>a.find(r=>r[3]===o.value[274]),formRules:U().required().label("Workday Cost Center").nullable(),fieldLabel:"Workday Cost Center",optionLabel:a=>`${X(a[6])} (${a[7]})`,displayValue:6,getter:async()=>{const{data:a}=await y.fetchFromProjectsApp({fields:[G({type:"workdayCostCenters",query:`{'8'.EX.true}AND{'11'.EX.'${o.value[287]}'}`})]});return a.sort((r,d)=>r[6]>d[6]?1:-1)},setter:async a=>{try{const{data:r}=await y.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:o.value[3]},274:{value:a[22]}}],fieldsToReturn:[274,275,276]});i(r[0]),u.notify({type:"positive",message:"Cost Center successfully updated"})}catch{u.notify({type:"negative",message:"Error updating Cost Center"})}},filter:(a,r)=>a.filter(d=>d[6].toLowerCase().indexOf(r)>-1||d[7].toLowerCase().indexOf(r)>-1)}}]:[]),tab:p,project:o}}}),jo={class:"q-pa-sm"},Co={class:"row"},No={class:"col-12 col-sm-7 q-px-xs"},ko={class:"col-12 col-sm-5 q-px-xs"};function Ao(e,t,u,p,v,w){const l=M("details-card"),o=M("job-numbers"),i=M("per-diem"),h=M("meeting-locations"),a=M("users");return m(),C(qe,{style:{"max-width":"100vw"}},{default:n(()=>[c("div",jo,[c("div",Co,[c("div",No,[s(l,{details:e.details,title:"Details"},null,8,["details"])]),c("div",ko,[s(Ee,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[s(Le,{align:"left",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=r=>e.tab=r),dense:"","indicator-color":"accent"},{default:n(()=>[s(be,{name:0,label:"Job Numbers"}),s(be,{name:1,label:"Per Diem"}),s(be,{name:2,label:"Locations"}),s(be,{name:3,label:"Users"})]),_:1},8,["modelValue"])]),_:1}),s(Re,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=r=>e.tab=r),animated:"",class:"q-px-none"},{default:n(()=>[s(ve,{class:"q-px-xs",name:0},{default:n(()=>[s(o)]),_:1}),s(ve,{class:"q-px-xs",name:1},{default:n(()=>[s(i)]),_:1}),s(ve,{class:"q-px-xs",name:2},{default:n(()=>[s(h)]),_:1}),s(ve,{class:"q-px-xs",name:3},{default:n(()=>[s(a)]),_:1})]),_:1},8,["modelValue"])])])])]),_:1})}var ma=F(ho,[["render",Ao]]);export{ma as default};
