import{l as O,_ as W,bV as z,r as G,A as H,aq as X,br as r,d as l,bO as J,cT as h,bS as K,D as o,ac as u,cU as p,bQ as Y,ax as Z,cV as x,bW as F,cS as ee,cy as oe}from"./index.9dd15430.js";import{a as E}from"./QSelect.b771c9d2.js";import{Q as te}from"./QTooltip.6f5bc820.js";import{Q as se}from"./QFile.734a4f96.js";import{Q as ae}from"./QForm.685a561c.js";import{a as le,u as i}from"./vee-validate.esm.73d552b4.js";import{a as P,c as d}from"./array.f318e1cc.js";import{u as re,b as ie,q as ne}from"./app.727217bc.js";import{u as de}from"./use-quasar.07d34863.js";const ce=O({setup(){const e=de(),a=re(),{userData:c,fullName:f}=z(a),{userType:y}=ie(),q=c.value&&c.value[8]?c.value[8]:"",s=c.value&&c.value[6]?c.value[6]:"",S=[...s===""?["Personal Login Issues"]:[],"General Help","Data Updates & System Maintenance","Reporting","Security","Integration Maintenance/Failure","Bug",...s!==""?["Personal Login Issues"]:[]],_=["Worksite Management Portal","Craft Employee Management"],v=G(null),w=P({type:d().required().label("Type"),category:d().required().label("Category"),subject:d().required().label("Subject"),details:d().required().label("Details"),supportingFile:P().nullable().label("Supporting File"),requestedFor:d().required().label("Requested For"),contactPhone:d().matches(/^[+()0-9 .-]+$/,{excludeEmptyString:!0,message:"Valid Phone Number Only!"}).required().label("Contact Phone"),contactEmail:d().email().required().label("Contact Email"),additionalPeople:d().nullable().label("Additional People Affected")}),{meta:C,errors:k,handleSubmit:Q,handleReset:T}=le({validationSchema:w,initialValues:{type:"",category:y==="QuickBase User"?"Craft Employee Management":"Worksite Management Portal",requestedFor:f.value?f.value.includes("undefined")?"":f.value:"",contactPhone:q,contactEmail:s}}),{value:U}=i("type"),{value:D}=i("category"),{value:j}=i("subject"),{value:A}=i("details"),{value:R}=i("supportingFile"),{value:M}=i("requestedFor"),{value:$}=i("contactPhone"),{value:B}=i("contactEmail"),{value:I}=i("additionalPeople"),N=t=>new Promise((b,g)=>{const m=new FileReader;m.readAsDataURL(t),m.onload=()=>b(m.result.replace(/^data:.+;base64,/,"")),m.onerror=n=>g(n)}),L=Q(async t=>{try{t.details=t.details?t.details.replace(/(\r\n|\n|\r)/gm," "):null,t.additionalPeople=t.additionalPeople?t.additionalPeople.replace(/(\r\n|\n|\r)/gm," "):null;const b=t.supportingFile&&t.supportingFile[0]?await N(t.supportingFile[0]):null,g=t.supportingFile&&t.supportingFile[0]?t.supportingFile[0].name:null;console.log(t);const m=[{7:{value:t.type},8:{value:t.category},6:{value:t.subject},10:{value:t.details},11:{value:b,filename:g},19:{value:t.requestedFor},21:{value:t.contactPhone},22:{value:t.contactEmail},23:{value:t.additionalPeople?t.additionalPeople:""}}],{data:n}=await ne.upsertRecordsXML({to:"btb8bh2ki",fieldsToReturn:[32],data:m,formatObject:32});if(console.log(n),n&&n[0]&&n[0][32]&&n[0][32][3])e.notify({position:"top-right",type:"positive",message:`Support Request ${n[0][32][3]} successfully added`});else throw"Error in adding support request";V()}catch(b){console.log(b),e.notify({position:"top-right",type:"negative",message:"There was a problem submitting request!"})}}),V=()=>{T(),v.value.hide()};return{types:S,categories:_,type:U,category:D,subject:j,details:A,supportingFile:R,requestedFor:M,contactPhone:$,contactEmail:B,additionalPeople:I,formMeta:C,formErrors:k,submitTicket:L,closeAddTicket:V,addTicketDialog:v}}}),ue=o("div",{class:"text-h6 text-weight-bold"},"Request Support",-1),me=o("div",{class:"text-primary text-h6 q-mb-sm"},"Support Details",-1),pe={class:"row"},be={class:"col-12 col-md-6 q-pr-sm"},fe={class:"text-caption"},ge={class:"col-12 col-md-6 q-pr-sm"},he={class:"text-caption"},ye={class:"row"},qe={class:"col-12 q-pr-sm"},ve={class:"text-caption q-pt-none"},Ve={class:"row"},Fe={class:"col-12 q-pr-sm"},Ee={class:"text-caption"},Pe={class:"row"},Se={class:"col-12 col-md-8 q-pr-sm"},_e=o("div",{class:"text-primary text-h6 q-mb-sm"},"Contact Information",-1),we={class:"row"},Ce={class:"col-12 col-md-8 q-pr-sm"},ke={class:"text-caption"},Qe={class:"row"},Te={class:"col-12 col-md-6 q-pr-sm"},Ue={class:"text-caption"},De={class:"col-12 col-md-6 q-pr-sm"},je={class:"text-caption"},Ae={class:"row"},Re={class:"col-12 q-pr-sm"};function Me(e,a,c,f,y,q){return H(),X(oe,{ref:"addTicketDialog"},{default:r(()=>[l(ee,{style:{width:"700px","max-width":"80vw"}},{default:r(()=>[l(ae,{onSubmit:J(e.submitTicket,["prevent"])},{default:r(()=>[l(h,{class:"q-pb-xs"},{default:r(()=>[ue]),_:1}),l(K,{color:"primary",class:"q-mb-sm"}),l(h,{class:"q-pt-none"},{default:r(()=>[me,o("div",pe,[o("div",be,[l(E,{class:"q-mb-md",dense:"",outlined:"",label:"Type","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.type,"onUpdate:modelValue":a[0]||(a[0]=s=>e.type=s),options:e.types,"bottom-slots":"",error:!!e.formErrors.type},{error:r(()=>[o("div",fe,u(e.formErrors.type),1)]),_:1},8,["modelValue","options","error"])]),o("div",ge,[l(E,{class:"q-mb-md",dense:"",outlined:"",label:"App","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":a[1]||(a[1]=s=>e.category=s),options:e.categories,"bottom-slots":"",error:!!e.formErrors.category},{error:r(()=>[o("div",he,u(e.formErrors.category),1)]),_:1},8,["modelValue","options","error"])])]),o("div",ye,[o("div",qe,[l(p,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Subject",modelValue:e.subject,"onUpdate:modelValue":a[2]||(a[2]=s=>e.subject=s),"bottom-slots":"",error:!!e.formErrors.subject},{error:r(()=>[o("div",ve,u(e.formErrors.subject),1)]),_:1},8,["modelValue","error"])])]),o("div",Ve,[o("div",Fe,[l(p,{class:"q-mb-md",dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e.details,"onUpdate:modelValue":a[3]||(a[3]=s=>e.details=s),label:"Details","bottom-slots":"",error:!!e.formErrors.details},{error:r(()=>[o("div",Ee,u(e.formErrors.details),1)]),_:1},8,["modelValue","error"])])]),o("div",Pe,[o("div",Se,[l(se,{dense:"",outlined:"","bottom-slots":"",modelValue:e.supportingFile,"onUpdate:modelValue":a[4]||(a[4]=s=>e.supportingFile=s),multiple:"",append:"","max-files":"1","use-chips":"",label:"Supporting File"},{prepend:r(()=>[l(Y,{name:"attach_file"},{default:r(()=>[l(te,null,{default:r(()=>[Z("Click in the box to add supporting file")]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1}),l(h,{class:"q-pt-none"},{default:r(()=>[_e,o("div",we,[o("div",Ce,[l(p,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Requested For",modelValue:e.requestedFor,"onUpdate:modelValue":a[5]||(a[5]=s=>e.requestedFor=s),error:!!e.formErrors.requestedFor,"bottom-slots":""},{error:r(()=>[o("div",ke,u(e.formErrors.requestedFor),1)]),_:1},8,["modelValue","error"])])]),o("div",Qe,[o("div",Te,[l(p,{class:"q-mb-md",dense:"",outlined:"",maxlength:"15",label:"Contact Phone",modelValue:e.contactPhone,"onUpdate:modelValue":a[6]||(a[6]=s=>e.contactPhone=s),error:!!e.formErrors.contactPhone,"bottom-slots":""},{error:r(()=>[o("div",Ue,u(e.formErrors.contactPhone),1)]),_:1},8,["modelValue","error"])]),o("div",De,[l(p,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Contact Email",modelValue:e.contactEmail,"onUpdate:modelValue":a[7]||(a[7]=s=>e.contactEmail=s),error:!!e.formErrors.contactEmail,"bottom-slots":""},{error:r(()=>[o("div",je,u(e.formErrors.contactEmail),1)]),_:1},8,["modelValue","error"])])]),o("div",Ae,[o("div",Re,[l(p,{dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e.additionalPeople,"onUpdate:modelValue":a[8]||(a[8]=s=>e.additionalPeople=s),label:"Additional People Affected"},null,8,["modelValue"])])])]),_:1}),l(x,{align:"right"},{default:r(()=>[l(F,{color:"primary",label:"Save & Close",type:"submit"}),l(F,{color:"secondary",label:"Cancel",onClick:e.closeAddTicket},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},512)}var He=W(ce,[["render",Me]]);export{He as h};
