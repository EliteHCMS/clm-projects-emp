import{Q as q,a as L,b as v}from"./QTabPanels.20287a25.js";import{Q as U}from"./QTabs.80f66e4e.js";import{Q as z}from"./QToolbar.8bdd3a1d.js";import{Q as H}from"./QPage.8b35320d.js";import{l as X,r as Q,c as N,_ as V,aZ as D,A as u,B as p,d as a,ao as c,y as M,bM as G,an as C,bi as n,D as K}from"./index.226bbe9e.js";import{u as Z,q as j}from"./quickbase.aae604ff.js";import{a as b,u as I}from"./useQuerySaver.ae1b8d62.js";import{dayjs as J}from"./dayjs.61ba8b06.js";import{u as A}from"./dataStore.67299c24.js";import{u as W}from"./use-quasar.e37fb258.js";import{u as Y}from"./dataStore.6104af90.js";import{R as x}from"./requestData.419e556a.js";import{N as ee}from"./nameRequestData.f66ee488.js";import"./use-panel.4921cae5.js";import"./touch.60582172.js";import"./selection.e3cea41b.js";import"./QResizeObserver.a399e20c.js";import"./rtl.cf9bbe47.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.2f4a21a3.js";import"./api.1ce17484.js";import"./i18n.df17a73c.js";import"./QTable.ae80641c.js";import"./QList.1943e8e4.js";import"./QMarkupTable.c37a3647.js";import"./QSelect.5f4edeef.js";import"./QChip.5521b37c.js";import"./QItemLabel.d7e00488.js";import"./QMenu.0ed2d0c1.js";import"./position-engine.283f53ba.js";import"./use-fullscreen.199cb342.js";import"./QTr.01b0c941.js";import"./QTd.d82945b5.js";import"./QTooltip.d9dcbf65.js";import"./workday.8116a750.js";import"./syncEmployeeWithWorkday.28277b2b.js";import"./workdayAPI.885ebaaa.js";const te=X({props:{type:String,project:Number,dataset:String},components:{RequestDataTable:x,NameRequestDataTable:ee},setup(e){const t=W(),{capitalize:i}=M,{getOpenRequest:f,getPendingRequest:m,getClosedRequest:$,getNameRequest:r,setNameRequest:l,setOpenRequest:g,setPendingRequest:de,setClosedRequest:pe,removeData:k}=Y(),{userData:h}=Z(),R=Q(!0),{getViewedProjects:E,updateViewedProjects:F}=A(),w=N(()=>E(e.project)),d=N(()=>w.value?w.value[e.dataset]?w.value[e.dataset]:[]:[]),P=s=>{R.value=!0;let o;e.type==="open"?(d.value.length===0||s)&&(o=[b({type:"requests",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'3'}`})],y(o)):e.type==="pending"?(d.value.length===0||s)&&(o=[b({type:"requests",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'2'}`})],y(o)):e.type==="closed"?(d.value.length===0||s)&&(o=[b({type:"requests",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'5'}`})],y(o)):e.type==="named"&&(d.value.length===0||s)&&(o=[I({type:"names",query:`{'38'.EX.'${e.project}'}AND{'31'.XEX.'Cancelled'}AND{'31'.XEX.'Closed'}AND{'11'.XEX.true}`})],y(o))},y=async s=>{const{data:o}=e.type==="named"?await j.fetchFromHiringApp({fields:s}):await j.fetchFromProjectsApp({fields:s}),_=o.length>0?o.sort((O,B)=>O[1].$d>B[1].$d?-1:1):[];F({id:e.project,dataset:e.dataset,data:_}),R.value=!1};function T(s){return`${i(s[6].toLowerCase())} ${i(s[7].toLowerCase())}`}async function S(s){t.dialog({title:"Confirm",message:`Are you sure you want to remove ${T(s)} from request# ${s[18]}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:o}=await j.upsertRecordsXML({to:"bsg4yb4wa",data:[{3:{value:s[3]},11:{value:!0},12:{value:J().tz("America/Chicago")},13:{value:`${h[35]} ${h[37]}`}}],fieldsToReturn:[15],formatObject:15});k({type:"nameRequest",key:o[0][15][38],item:o[0][15],storageKey:"storageNameRequest"})}catch(o){t.notify({type:"negative",message:"Cannot remove name request"}),console.log(o)}})}return P(),{configureFetch:P,removeName:S,loading:R,rows:d}}}),ae={key:0},oe={key:1},se={key:2},re={key:3};function ne(e,t,i,f,m,$){const r=D("request-data-table"),l=D("name-request-data-table");return u(),p("div",null,[e.type==="open"?(u(),p("div",ae,[a(r,{loading:e.loading,requests:e.rows,status:"Open",onRefreshData:t[0]||(t[0]=g=>e.configureFetch(!0))},null,8,["loading","requests"])])):c("",!0),e.type==="pending"?(u(),p("div",oe,[a(r,{loading:e.loading,requests:e.rows,status:"Pending",onRefreshData:t[1]||(t[1]=g=>e.configureFetch(!0))},null,8,["loading","requests"])])):c("",!0),e.type==="closed"?(u(),p("div",se,[a(r,{loading:e.loading,requests:e.rows,status:"Closed",onRefreshData:t[2]||(t[2]=g=>e.configureFetch(!0))},null,8,["loading","requests"])])):c("",!0),e.type==="named"?(u(),p("div",re,[a(l,{loading:e.loading,requests:e.rows,status:"Named",onRemoveName:e.removeName,onRefreshData:t[3]||(t[3]=g=>e.configureFetch(!0))},null,8,["loading","requests","onRemoveName"])])):c("",!0)])}var ue=V(te,[["render",ne]]);const ie=X({components:{RequestPanel:ue},setup(){const e=Q(0),t=G(),{getViewedProjects:i,setViewedProjects:f}=A(),m=N(()=>i(t.params.id));return(async()=>{if(!m.value){const{data:r}=await j.fetchFromProjectsApp({fields:[b({type:"projects",id:t.params.id})]});f({id:t.params.id,data:r})}})(),{tab:e,project:m}}}),le={class:"q-pa-sm"};function me(e,t,i,f,m,$){const r=D("request-panel");return u(),C(H,{style:{"max-width":"100vw"}},{default:n(()=>[K("div",le,[a(z,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[a(U,{align:"left",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=l=>e.tab=l),dense:"","indicator-color":"accent"},{default:n(()=>[a(q,{name:0,label:"Open"}),a(q,{name:1,label:"Names"}),a(q,{name:2,label:"Pending"}),a(q,{name:3,label:"Complete"})]),_:1},8,["modelValue"])]),_:1}),e.project?(u(),C(L,{key:0,modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=l=>e.tab=l),animated:""},{default:n(()=>[a(v,{name:0},{default:n(()=>[a(r,{project:e.project[3],type:"open",dataset:"openRequests"},null,8,["project"])]),_:1}),a(v,{name:1},{default:n(()=>[a(r,{project:e.project[3],type:"named",dataset:"namedRequests"},null,8,["project"])]),_:1}),a(v,{name:2},{default:n(()=>[a(r,{project:e.project[3],type:"pending",dataset:"pendingRequests"},null,8,["project"])]),_:1}),a(v,{name:3},{default:n(()=>[a(r,{project:e.project[3],type:"closed",dataset:"closedRequests"},null,8,["project"])]),_:1})]),_:1},8,["modelValue"])):c("",!0)])]),_:1})}var We=V(ie,[["render",me]]);export{We as default};
