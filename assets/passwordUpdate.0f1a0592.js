import{Q as z}from"./QImg.09c5bdfb.js";import{_ as A,c5 as j,c4 as F,r as x,c as O,aY as T,z as l,am as m,bh as s,a6 as t,A as X,d as e,an as w,C as r,c2 as f,bE as Z,cx as V,b as M,bX as y,cy as H,c6 as K,c3 as Y,aU as G,aS as J,at as k}from"./index.b1be7a27.js";import{Q as W}from"./QForm.e5141ef7.js";import{Q as ee}from"./QPage.5ae674b9.js";import{u as se}from"./use-quasar.32f188d9.js";import{a as ae,e as te,c as R,d as oe,b as re,u as b}from"./array.e7d3a061.js";import{q as C,K as P}from"./quickbase.5dabc90e.js";import{c as le}from"./carousel.15438e22.js";import"./_commonjsHelpers.dfee5925.js";import"./dayjs.a4eb83b7.js";import"./localForage.44bfdce0.js";import"./index.7dbe61ef.js";import"./i18n.5effcec9.js";import"./api.37dc23fd.js";import"./use-panel.f292a912.js";import"./touch.52aa58ff.js";import"./selection.ae194bbe.js";import"./use-fullscreen.9f1d00e4.js";const de=d=>(G("data-v-24eb4a9c"),d=d(),J(),d),ie={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ne={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ue=de(()=>r("p",{class:"text-dark"},"Update Password",-1)),ce={class:"row"},pe={class:"row"},me={class:"text-grey-6"},we=k("Return to Login"),fe={class:"text-grey-6"},_e=k("Need an account? "),ge=k("Register"),ve={__name:"passwordUpdate",setup(d){const _=se(),Q=j(),g=F(),v=x("update-password"),i=x(!1),$=O(()=>ae({userRID:te().required(),password:R().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:"Must Contain at least 8 Characters, at least 1 Uppercase, 1 Lowercase, and 1 Number"}).nullable(),passwordConfirmation:R().oneOf([oe("password"),null],"Passwords must match")})),{errors:he,meta:D}=re({validationSchema:$,initialValues:{password:"",passwordConfirmation:""}}),{value:n}=b("userRID"),{value:u,errorMessage:q,meta:L}=b("password"),{value:h,errorMessage:I,meta:N}=b("passwordConfirmation"),c=x(!0);Q.query.rid?(n.value=Q.query.rid,g.replace({query:{}})):g.push("/");const B=async()=>{if(!n.value||n.value==="")return!1;i.value=!0;const S=await C.isUserLoggedIn(),a=await P.genSalt(10),p=P.hashSync(u.value,a),o=new Date,U={3:{value:n.value},7:{value:p},26:{value:o}};try{S?await C.updateUserData({fields:U}):(await C.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[U],formatObject:76}),_.notify({position:"top-right",type:"info",message:"Login with new password!"})),i.value=!1,g.push("/")}catch(E){i.value=!1,_.notify({position:"top-right",type:"negative",message:E.message||"Error updating password"})}};return(S,a)=>{const p=T("router-link");return l(),m(ee,{class:"window-height window-width row"},{default:s(()=>[t(_).screen.lt.md?w("",!0):(l(),X("div",ie,[e(le)])),r("div",ne,[e(Y,{class:"auth-card",flat:""},{default:s(()=>[e(f,{style:{"padding-left":"30px","padding-right":"30px"}},{default:s(()=>[e(z,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),e(f,{class:"text-center auth-description"},{default:s(()=>[ue]),_:1}),e(f,null,{default:s(()=>[e(W,{class:"q-px-sm q-pt-sm",onSubmit:a[3]||(a[3]=Z(()=>{},["prevent"]))},{default:s(()=>[r("div",ce,[v.value==="update-password"?(l(),m(V,{key:0,class:"col-xs-12",outlined:"",modelValue:t(u),"onUpdate:modelValue":a[1]||(a[1]=o=>M(u)?u.value=o:null),type:c.value?"password":"text",autocomplete:"current-password",label:"Password",tabindex:"1",error:!!(t(q)&&t(L).validated),"error-message":t(q)},{append:s(()=>[e(y,{name:c.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:a[0]||(a[0]=o=>c.value=!c.value)},null,8,["name"])]),prepend:s(()=>[e(y,{name:"lock"})]),_:1},8,["modelValue","type","error","error-message"])):w("",!0)]),r("div",pe,[v.value==="update-password"?(l(),m(V,{key:0,class:"col-xs-12",outlined:"",modelValue:t(h),"onUpdate:modelValue":a[2]||(a[2]=o=>M(h)?h.value=o:null),type:"password",autocomplete:"new-password",label:"Confirm Password",tabindex:"2",error:!!(t(I)&&t(N).validated),"error-message":t(I)},{prepend:s(()=>[e(y,{name:"lock"})]),_:1},8,["modelValue","error","error-message"])):w("",!0)])]),_:1})]),_:1}),e(H,{class:"q-px-lg"},{default:s(()=>[v.value==="update-password"?(l(),m(K,{key:0,loading:i.value,disable:!t(D).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Update Password",tabindex:"3",onClick:B},null,8,["loading","disable"])):w("",!0)]),_:1}),e(f,{class:"text-center q-pa-sm"},{default:s(()=>[r("p",me,[e(p,{to:"/login",class:"text-grey-6",tabindex:"4"},{default:s(()=>[we]),_:1})]),r("p",fe,[_e,e(p,{to:"/register",class:"text-grey-6",tabindex:"5"},{default:s(()=>[ge]),_:1})])]),_:1})]),_:1})])]),_:1})}}};var Be=A(ve,[["__scopeId","data-v-24eb4a9c"]]);export{Be as default};
