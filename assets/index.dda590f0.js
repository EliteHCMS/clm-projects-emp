import{l as U,r as _,c as v,_ as I,b5 as C,A as u,B as k,d as s,br as d,ax as D,F as Q,b4 as V,aq as g,ac as $,G as W,dj as X,D as c,bQ as G,bV as J,cE as H,cF as S,cG as T}from"./index.e8fb2253.js";import{a as K}from"./QSelect.c4b0a406.js";import{Q as Z}from"./QPage.d147e8f9.js";import{u as N}from"./use-quasar.0aa2fc3d.js";import{H as Y,I as ee,q as h}from"./app.00bf1e10.js";import{dayjs as y}from"./dayjs.d1250a8a.js";import{u as ae}from"./dataStore.4cb31a18.js";import{Q as A,a as te}from"./QTable.1fcb10b7.js";import{Q as P}from"./QTr.0507fcae.js";import{Q as x}from"./QTd.a9c509ec.js";import{Q as le}from"./QInnerLoading.52e3072b.js";import{A as oe}from"./arrivalDate.462d5c36.js";import{_ as re}from"./projectSelector.e66d4c95.js";import"./QChip.178232ad.js";import"./QMenu.b4300bfa.js";import"./position-engine.d748a9db.js";import"./selection.1f477e95.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.8666a90b.js";import"./api.e92e8aaa.js";import"./index.04bc0a32.js";import"./i18n.2814a62c.js";import"./useQuerySaver.d29ff9ee.js";import"./QList.d18fd6ea.js";import"./QMarkupTable.167b6050.js";import"./use-fullscreen.b1caa6d3.js";import"./QTooltip.604a832b.js";import"./QForm.bc1b5926.js";import"./vee-validate.esm.f9a9192e.js";import"./array.6a8b7cfb.js";const se=U({emits:["arrivalMarked"],name:"Arrivals Table",components:{ArrivalDate:oe},props:{rows:Array,selected:Array},setup(n,{emit:m}){const f=N(),l=_(!1);return{columns:v(()=>f.screen.gt.sm?[{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${Y.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,t)=>t[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]:[{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${Y.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,t)=>t[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]),updateArrivals:({rows:e,added:t,evt:r})=>{l.value=!0,m("arrivalMarked",{record:e[0],added:t}),setTimeout(function(){l.value=!1},1500)},props:n,loading:l}}}),ne={class:"q-px-sm"},ie={class:"text-caption"},de={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function ce(n,m,f,l,p,b){const e=C("arrival-date");return u(),k("div",ne,[s(te,{dense:"",columns:n.columns,rows:n.rows,"row-key":t=>t[3],class:"q-pa-sm",pagination:{rowsPerPage:n.$q.screen.gt.sm?25:100},separator:"vertical",selection:"multiple",onSelection:n.updateArrivals,selected:n.selected,"table-header-class":"bg-dark text-white","no-data-label":"There are no expected arrivals",loading:n.loading,grid:n.$q.screen.lt.md},{header:d(t=>[s(P,{class:"bg-dark text-white",props:t},{default:d(()=>[s(A,{"auto-width":""}),s(A,{class:"text-left","auto-width":""},{default:d(()=>[D("Arrival Date")]),_:1}),(u(!0),k(Q,null,V(t.cols,r=>(u(),g(A,{class:"text-left",key:r.name},{default:d(()=>[D($(r.label),1)]),_:2},1024))),128))]),_:2},1032,["props"])]),body:d(t=>[s(P,{"no-hover":"",props:t,class:W(t.row[33]&&t.row[33].$d&&n.$dayjs().diff(n.$dayjs(t.row[33].$d),"day",!0)>3?"bg-red-12":"")},{default:d(()=>[s(x,{"auto-width":""},{default:d(()=>[s(X,{class:"q-pa-none q-ma-none",size:"xs",modelValue:t.selected,"onUpdate:modelValue":r=>t.selected=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t.row[20]==="Complete"&&t.row[207]?(u(),g(e,{key:0,class:"text-left",rowType:"deployment",row:t.row},null,8,["row"])):(u(),g(x,{key:1,"auto-width":"",class:"text-left"},{default:d(()=>[D("TBD")]),_:1})),(u(!0),k(Q,null,V(t.cols,r=>(u(),g(x,{key:r.name,props:t},{default:d(()=>[c("span",ie,$(r.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props","class"])]),"no-data":d(({message:t})=>[c("div",de,[s(G,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),c("span",null,$(t),1)])]),loading:d(()=>[s(le,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","onSelection","selected","loading","grid"])])}var me=I(se,[["render",ce]]);const ue={name:"Arrivals",components:{MarkArrivalsTable:me,projectSelector:re},setup(){const n=N(),m=ee(),f=_(null),l=_(""),p=_(""),{getSelectedProject:b}=J(m),{fetchAllDeployments:e,updateDeployment:t,getDeployments:r,fetchDeployments:F}=ae(),w=v(()=>b.value?b.value[3]:null),R=v(()=>r(w.value).filter(a=>a[20]==="Complete")),q=v(()=>{let a=[];return r(w.value).forEach(o=>{o[31].toLowerCase().includes(p.value.toLowerCase())&&a.push(o)}),a=l.value?a.filter(o=>y(o[33].$d).tz("America/Chicago").format("MM/DD/YYYY")===y(l.value).tz("America/Chicago").format("MM/DD/YYYY")):a,a=f.value?a.filter(o=>o[132]===f.value):a,a}),L=v(()=>[...new Map(q.value.map(a=>[a[132],a[132]])).values()]);async function z(a){n.loading.show(),w.value?await F({projectId:w.value,refresh:a}):await e({refresh:a}),n.loading.hide()}async function B({record:a,added:o}){if(o){await E(a),await j({id:a[21],status:7});const i=await M(a[3],"Complete");t({projectId:i[134],key:i[3],record:i})}else{await O(a),await j({id:a[21],status:6});const i=await M(a[3],"In Process");t({projectId:i[134],key:i[3],record:i})}}async function E(a){try{const{data:o}=await h.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:a[3]},13:{value:a[15]},18:{value:a[21]},60:{value:""},125:{value:y()},145:{value:y()}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return o[0][108]}catch(o){throw{message:"Cannot add assignment",error:o}}}async function j({id:a,status:o}){try{const{data:i}=await h.upsertRecordsXML({to:"bp3gb7ng2",data:[{3:{value:a},79:{value:o}}],fieldsToReturn:[3]});return i[0][3]}catch(i){throw{message:"Cannot edit employee",error:i}}}async function M(a,o){try{const{data:i}=await h.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:a},20:{value:o},22:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return i[0][204]}catch(i){throw{message:"Cannot edit deployment",error:i}}}async function O(a){try{const{data:o}=await h.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:a.assignment[3]},22:{value:new Date},21:{value:"Canceled"},19:{value:""},60:{value:""}}],fieldsToReturn:[108],formatObject:108});return o[0][108]}catch(o){throw{message:"Cannot cancel assignment",error:o}}}return z(!0),{arrived:R,allDeployments:q,arrivalMarked:B,craftOptions:L,craftFilter:f,startDateFilter:l,search:p}}},fe={class:"q-pt-sm"},pe={class:"text-h5 text-dark"},be={class:"text-body2 text-italic q-ml-sm"},ve=c("div",{class:"text-subtitle2 text-accent"},"Please toggle the switch for everyone that has arrived at the job site.",-1),ge={class:"row items-center"},we={class:"col-12 col-md-3 q-px-sm"},he={class:"col-12 col-md-3 q-px-sm"},ye={class:"col-12 col-md-3 q-px-sm"},_e={class:"col-12 col-md-3 q-px-sm"};function De(n,m,f,l,p,b){const e=C("projectSelector"),t=C("mark-arrivals-table");return u(),g(Z,{style:{"max-width":"100vw"}},{default:d(()=>[c("div",fe,[s(H,{flat:""},{default:d(()=>[s(S,{class:"q-pb-none"},{default:d(()=>[c("div",pe,[D(" Expected Arrivals "),c("span",be,"("+$(l.allDeployments.length)+" total)",1)]),ve]),_:1}),s(S,null,{default:d(()=>[c("div",ge,[c("div",we,[s(e,{dense:""})]),c("div",he,[s(T,{dense:"",modelValue:l.search,"onUpdate:modelValue":m[0]||(m[0]=r=>l.search=r),label:"Search"},null,8,["modelValue"])]),c("div",ye,[s(T,{dense:"",modelValue:l.startDateFilter,"onUpdate:modelValue":m[1]||(m[1]=r=>l.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),c("div",_e,[s(K,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:l.craftFilter,"onUpdate:modelValue":m[2]||(m[2]=r=>l.craftFilter=r),options:l.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),s(t,{rows:l.allDeployments,selected:l.arrived,onArrivalMarked:l.arrivalMarked},null,8,["rows","selected","onArrivalMarked"])])]),_:1})}var ea=I(ue,[["render",De]]);export{ea as default};
