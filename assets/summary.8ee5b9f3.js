import{Q as B}from"./QPage.bcf9b23c.js";import{k as w,c as b,_ as S,A as o,B as u,d as r,bi as n,D as t,ab as y,bJ as N,bH as A,au as O,cy as V,bO as M,bF as H,r as L,aZ as Y,an as m,cw as h,cz as I,ao as $,w as F,F as C,aY as R,bk as x,bI as z,cZ as J,bM as T,G}from"./index.61fe6e1c.js";import{u as U}from"./useQuerySaver.e863619d.js";import{q as P}from"./quickbase.7f66a5fd.js";import{u as Q}from"./dataStore.116b3066.js";import{Q as Z}from"./QSelect.a8f07c31.js";import{Q as W}from"./QForm.23f3acc2.js";import{a as E,b as X,u as K}from"./array.eb3aae39.js";import{u as ee}from"./use-quasar.4ee78fe6.js";import{u as se}from"./dataStore.3898036f.js";import{dayjs as f}from"./dayjs.07775a6d.js";import{d as te}from"./decode.593c6ccc.js";import{d as ae,Q as oe}from"./helpers.79f8082e.js";import{Q as le}from"./QList.ecce4ac7.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.81cbb332.js";import"./i18n.b5aeee55.js";import"./api.75a5bd03.js";import"./QChip.b9996413.js";import"./QItemLabel.3947d95a.js";import"./QMenu.46a8fbe5.js";import"./position-engine.94259159.js";import"./selection.111ecd00.js";import"./rtl.cf9bbe47.js";const ne=w({emits:["supUpdated"],props:{record:Object},setup(e,{emit:d}){const c=ee(),{getAssignments:a,fetchAssignments:i}=se(),p=b(()=>a(e.record[74]).filter(_=>_[138]&&_[3]!==e.record[3]).sort((_,g)=>_[75]>g[75]?1:-1)),s=b(()=>E({selection:E().required().nullable().label("Supervisor")})),{errors:l,handleSubmit:v,handleReset:q}=X({validationSchema:s}),{value:j}=K("selection"),k=v(async D=>{const _=[{3:{value:e.record[3]},133:{value:D.selection[3]}}];try{const{data:g}=await P.upsertRecordsXML({to:"bp3gazpqj",data:_,fieldsToReturn:[110],formatObject:110});console.log(g),d("supUpdated",g[0][110]),c.notify({type:"positive",message:"Supervisor successfully updated!"})}catch(g){console.log(g),c.notify({type:"negative",message:"Cannot save supervisor."}),q()}});return i({projectId:e.record[74],refresh:!0}),{props:e,options:p,selection:j,submit:k,formErrors:l,handleReset:q}}}),ie={class:"text-caption"};function re(e,d,c,a,i,p){return o(),u("div",null,[r(W,{onSubmit:H(e.submit,["prevent"])},{default:n(()=>[r(Z,{dense:"",clearable:"",label:"Select a Supervisor","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":d[0]||(d[0]=s=>e.selection=s),options:e.options,"option-label":s=>`${s[75]} - ${s[20]}`,"display-value":`${e.selection?e.selection[75]:""}`,"bottom-slots":"",error:!!e.formErrors.selection},{error:n(()=>[t("div",ie,y(e.formErrors.selection),1)]),"no-option":n(()=>[r(N,null,{default:n(()=>[r(A,{class:"text-grey"},{default:n(()=>[O(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","error"]),r(V,{align:"right"},{default:n(()=>[r(M,{color:"info",label:"Submit",type:"submit"}),r(M,{color:"secondary",label:"Cancel",onClick:e.handleReset},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var de=S(ne,[["render",re]]);const ce=w({props:{employee:Object,assignment:Object},components:{UpdateSupervisor:de},setup(e){const d=L(!1),{setAssignmentsByEmployee:c}=Q();return{props:e,supUpdated:i=>{d.value=!1,c({id:i[18],data:i})},editSup:d}}}),ue=t("div",{class:"text-h6 q-pb-sm"},"Assign a Supervisor",-1),me={class:"row text-body2"},pe={class:"col-12 col-md-6"},ve=t("div",{class:"q-mb-xs"},"Current Location",-1),ye={class:"q-pl-sm"},fe={class:"col-12 col-md-6"},be=t("div",{class:"q-mb-xs"},"Current Supervisor",-1),_e={class:"q-pl-sm"};function ge(e,d,c,a,i,p){const s=Y("update-supervisor");return o(),u("div",null,[e.assignment&&e.assignment[3]?(o(),m(I,{key:0,class:"text-dark"},{default:n(()=>[e.editSup?(o(),m(h,{key:0},{default:n(()=>[ue,r(s,{record:e.assignment,onSupUpdated:e.supUpdated},null,8,["record","onSupUpdated"])]),_:1})):(o(),m(h,{key:1},{default:n(()=>[t("div",me,[t("div",pe,[ve,t("div",ye,y(e.assignment[141]),1)]),t("div",fe,[be,t("div",_e,y(e.assignment[140]===""?"N/A":e.assignment[140]),1)])])]),_:1}))]),_:1})):$("",!0)])}var he=S(ce,[["render",ge]]);const $e=w({props:{employee:Object,assignment:Object},components:{},setup(e){const{getWorkdayData:d}=Q(),c=({id:l,idType:v})=>v.includes("J&amp;E")?l.slice(-5):l,a=b(()=>[]),i=b(()=>{const l=d(e.employee[3]);let v;if(l&&!e.employee[207]){const{employmentData:q,personalData:j}=l,{positionData:k,workerStatus:D}=q,{jobProfile:_}=k,{identificationData:g}=j;v=[{label:"Position",value:`${k.positionId} ${k.positionTitle}`},{label:"Job Profile",value:`${_.jobProfileId} - ${_.jobProfileName}`},{label:te(g.customIds[0].idType),value:c(g.customIds[0])},{label:"Hire Date",value:f(D.hireDate).format("MM/DD/YYYY")},{label:"Original Hire Date",value:f(D.originalHireDate).format("MM/DD/YYYY")},{label:"Years Since Last Hire",value:f().diff(D.hireDate,"year",!0).toFixed(2)}]}else v=[];return v}),p=b(()=>{let l;return e.assignment[3]?l=[{label:"Project",value:e.assignment[94]},{label:"Job Title",value:e.assignment[20]}]:l=[],l}),s=b(()=>a.value.concat(p.value).concat(i.value));return F(i,(l,v)=>{console.log(d(e.employee[3]))}),{props:e,details:s}}}),De=t("div",{class:"text-h6 text-weight-bold"},"Job Details",-1),ke=t("div",{class:"text-body1 text-primary text-italic"},"Employee has a pending release.",-1),we={class:"row"},Se={class:"col-12 col-md-4"},qe={class:"text-body2"},Ye={class:"col-12 col-md-8"},Ce={class:"text-body2 text-weight-light"};function Qe(e,d,c,a,i,p){return o(),u("div",null,[r(I,{class:"text-dark"},{default:n(()=>[r(h,{class:"q-pb-sm"},{default:n(()=>[De]),_:1}),e.employee[581]?(o(),m(h,{key:0,class:"q-py-sm"},{default:n(()=>[ke]),_:1})):$("",!0),(o(!0),u(C,null,R(e.details,s=>(o(),m(h,{key:s,class:"q-py-sm"},{default:n(()=>[t("div",we,[t("div",Se,[t("div",qe,y(s.label),1)]),t("div",Ye,[t("div",Ce,y(s.value),1)])])]),_:2},1024))),128))]),_:1})])}var je=S($e,[["render",Qe]]);const Ae=w({props:{employee:Object},components:{},setup(e){const{getReleases:d,setReleases:c}=Q(),a=b(()=>d(e.employee[581])),i=b(()=>{let s;return a.value&&a.value[3]?s=[{label:"Reason",value:a.value[32]},{label:"Last Hire Date",value:f(e.employee[397].$d).format("MM/DD/YYYY")},{label:"Last Day On Site",value:f(a.value[36].$d).format("MM/DD/YYYY")},{label:"Returned Equipment",value:a.value[72]?"Yes":"No"},{label:"Pay Deduct Needed",value:!a.value[72]&&f.duration(f(a.value[36].$d).diff(f(e.employee[397].$d))).asDays()<30?"Yes":"No"},{label:"CAAP Rating",value:a.value[59]&&a.value[59].length>0?a.value[59][0][37]:0,type:"rating"},{label:"Submitted By",value:`${a.value[38][35]} ${a.value[38][37]}`},{label:"Submitted On",value:f(a.value[1].$d).tz(f.tz.guess()).format("MM/DD/YYYY hh:mm a")},{label:"Comments",value:a.value[60],type:"comments"}]:s=[],s});return(async()=>{if(!a.value&&e.employee[581]){const{data:s}=await P.fetchFromHiringApp({fields:[U({type:"releases",query:"",id:e.employee[581]})]},{action:"read",type:"release"});c({id:s[3],data:s})}})(),{releaseDetails:i,release:a,downloadFile:ae}}}),Me={class:"row items-center"},Re=t("div",{class:"col-12 col-md-7"},[t("div",{class:"text-h6 text-weight-bold"},"Pending Release Details")],-1),Ie={key:0,class:"col-12 col-md-5"},Pe={class:"row"},Ee={class:"col-12 col-md-5"},Ne={class:"text-body2"},Oe={class:"col-12 col-md-7"},Ve={key:0},Fe={key:1,class:"text-body2 text-weight-light"},Ue={key:1,class:"text-body2 text-weight-light"},Be={class:"text-body1 text-weight-bold q-mb-xs"},He={class:"text-body2 text-italic text-primary q-pl-md"},Le=t("div",{class:"text-body1 text-weight-bold q-mb-xs"},"Supporting Docs",-1);function xe(e,d,c,a,i,p){return o(),u("div",null,[r(I,{class:"text-dark"},{default:n(()=>[r(h,{class:"q-pb-sm"},{default:n(()=>[t("div",Me,[Re,e.release?(o(),u("div",Ie,[r(V,{align:"right"},{default:n(()=>[r(M,{size:"md",flat:"",dense:"",label:"View Release",color:"info",to:{name:"view-ee-release",params:{id:e.release[25],release:e.release[3]}}},null,8,["to"])]),_:1})])):$("",!0)])]),_:1}),(o(!0),u(C,null,R(e.releaseDetails,s=>(o(),u(C,{key:s},[s.type!=="comments"?(o(),m(h,{key:0,class:"q-py-sm"},{default:n(()=>[t("div",Pe,[t("div",Ee,[t("div",Ne,y(s.label),1)]),t("div",Oe,[s.type==="rating"?(o(),u("div",Ve,[s.value>0?(o(),m(oe,{key:0,modelValue:s.value,"onUpdate:modelValue":l=>s.value=l,max:"5",size:"sm",color:"accent",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"])):(o(),u("div",Fe,"Not Available"))])):(o(),u("div",Ue,y(s.value),1))])])]),_:2},1024)):s.value!==""?(o(),m(h,{key:1},{default:n(()=>[t("div",Be,y(s.label),1),t("div",He,y(s.value),1)]),_:2},1024)):$("",!0)],64))),128)),e.release&&e.release[70].length>0?(o(),m(h,{key:0},{default:n(()=>[Le,r(le,null,{default:n(()=>[(o(!0),u(C,null,R(e.release[70],(s,l)=>x((o(),m(N,{key:l,clickable:"",class:"text-body2",onClick:v=>e.downloadFile({tableId:"bsstsai5d",recordId:s[3],fieldId:6,versionNumber:1,name:s[7]})},{default:n(()=>[r(A,null,{default:n(()=>[O(y(l+1)+". "+y(s[7]),1)]),_:2},1024),r(A,{avatar:""},{default:n(()=>[r(z,{color:"info",name:"file_download"})]),_:1})]),_:2},1032,["onClick"])),[[J]])),128))]),_:1})]),_:1})):$("",!0)]),_:1})])}var ze=S(Ae,[["render",xe]]);const Je=w({components:{LocationAndManager:he,EmployeeJobDetails:je,PendingReleaseDetails:ze},setup(){const e=T(),{getEmployee:d,getAssignmentsByEmployee:c,setAssignmentsByEmployee:a}=Q(),i=b(()=>d(e.params.id)),p=b(()=>i.value?c(i.value[3]):null),s=async()=>{if(!p.value&&i.value[577]){const{data:l}=await P.fetchFromHiringApp({fields:[U({type:"assignments",query:"",id:i.value[577]})]});console.log(l),a({id:i.value[3],data:l})}};return F(i,(l,v)=>{l&&s()}),{employee:i,assignment:p}}}),Te={class:"q-pa-sm"},Ge={class:"row"},Ze={class:"col-12 col-md-6 q-px-xs"},We={key:1},Xe={key:0};function Ke(e,d,c,a,i,p){const s=Y("location-and-manager"),l=Y("employee-job-details"),v=Y("pending-release-details");return o(),m(B,{style:{"max-width":"100vw"}},{default:n(()=>[t("div",Te,[t("div",Ge,[t("div",Ze,[e.employee&&e.employee[408]==="Active"?(o(),m(s,{key:0,employee:e.employee,assignment:e.assignment},null,8,["employee","assignment"])):$("",!0),e.employee&&e.assignment?(o(),u("div",We,[e.assignment[21]==="In Process"?(o(),m(l,{key:0,class:"q-mt-md",assignment:e.assignment,employee:e.employee},null,8,["assignment","employee"])):$("",!0)])):$("",!0)]),t("div",{class:G(["col-12 col-md-6 q-px-xs",e.employee&&e.employee[581]?"order-first":""])},[e.employee&&e.employee[581]?(o(),u("div",Xe,[r(v,{employee:e.employee},null,8,["employee"])])):$("",!0)],2)])])]),_:1})}var Ss=S(Je,[["render",Ke]]);export{Ss as default};
