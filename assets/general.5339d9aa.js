import{Q as de,a as Pe,b as ce}from"./QTabPanels.b55cf6e7.js";import{Q as Se}from"./QTabs.fd7f231c.js";import{Q as De}from"./QPage.f4574d3b.js";import{u as x}from"./use-quasar.4c4dbdcf.js";import{l as H,r as V,c as N,_ as Q,b5 as X,A as c,B as A,d as l,br as i,D as y,ac as E,bW as k,ar as R,cU as I,bO as pe,aq as $,cy as Oe,G as ae,cT as re,F,b4 as z,cS as le,bU as ee,cV as ge,w as he,ax as oe,y as ke,bV as Ae}from"./index.62f4c3c5.js";import{q as b,u as Ne,H as Xe}from"./app.ae0068fa.js";import{dayjs as Te}from"./dayjs.b3414925.js";import{a as O,c as M}from"./array.5117e02c.js";import{a as W,b as se,u as Re}from"./useQuerySaver.d29ff9ee.js";import{u as te}from"./dataStore.423cc352.js";import{a as me}from"./QSelect.63d295fd.js";import{Q as fe}from"./QForm.617a9252.js";import{a as ve,u as T}from"./vee-validate.esm.bd7c3d30.js";import{A as Ue,a as Me}from"./addNewCustomer.890f6978.js";import{Q as ne}from"./QInnerLoading.e16d5622.js";import{Q as B,a as ie}from"./QTable.6d9270ae.js";import{Q as Y}from"./QTr.e1f50597.js";import{Q as Fe}from"./QTooltip.9c964233.js";import{Q as G}from"./QTd.2f40c658.js";import{u as He}from"./project.6540fe93.js";import{s as Qe}from"./states.03e3d448.js";import{a as Je}from"./approveHeadcount.ba935a10.js";import{d as D}from"./decode.3998c82c.js";import"./use-panel.bbb00f2a.js";import"./touch.70a9dd44.js";import"./selection.3494d29b.js";import"./QResizeObserver.c2864a65.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.f977d509.js";import"./api.646f206c.js";import"./index.04bc0a32.js";import"./i18n.3f666946.js";import"./QChip.9ae5b419.js";import"./QMenu.83b714c5.js";import"./position-engine.9f816e9b.js";import"./QList.11a66c2b.js";import"./QMarkupTable.40e44e8b.js";import"./use-fullscreen.40a7c3de.js";const Ie=H({emits:["cancelEdit"],components:{AddProjectLocationForm:Ue,AddCustomerForm:Me},props:{config:Object},setup(e,{emit:t}){const d=V(null),p=V(null),f=V(!1),v=async()=>{const{type:n,initialValue:m}=e.config;if(n==="options"){const{getter:j}=e.config;p.value=await j(),d.value=p.value,g.value=m(d.value)}else g.value=m},u=N(()=>O({entry:e.config.formRules})),{meta:r,errors:a,handleSubmit:h}=ve({validationSchema:u}),{value:g}=T("entry"),P=(n,m)=>{const{filter:j}=e.config;n===""&&m(()=>{d.value=p.value}),m(()=>{const C=n.toLowerCase();d.value=j(p.value,C)})},s=n=>{f.value=!1,p.value.push(n),d.value.push(n),g.value=n},o=h(async n=>{const{setter:m}=e.config;await m(n.entry),t("cancelEdit")});return v(),{rawOptions:p,options:d,entry:g,formErrors:a,formMeta:r,submit:o,filterOptions:P,addNew:f,newOptionAdded:s}}}),ze={key:0,class:"q-pr-xl"},We={class:"text-caption"},Be={key:0,class:"text-center bg-info"},Ye={key:0,class:"text-center bg-info"},Ge={key:1,class:"q-pr-xl"},Ke={class:"text-caption"};function Ze(e,t,d,p,f,v){const u=X("add-project-location-form"),r=X("add-customer-form");return c(),A("div",null,[l(fe,{onSubmit:pe(e.submit,["prevent"])},{default:i(()=>[e.config.type==="options"?(c(),A("div",ze,[l(me,{class:"q-mb-sm",dense:"",label:`Select a ${e.config.fieldLabel}`,"transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":t[3]||(t[3]=a=>e.entry=a),options:e.options,"option-label":e.config.optionLabel,"display-value":`${e.entry?e.entry[e.config.displayValue]:""}`,"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":"","use-input":"","input-debounce":"0",onFilter:e.filterOptions,clearable:"",loading:!e.rawOptions,disable:!e.rawOptions},{error:i(()=>[y("div",We,E(e.formErrors.entry),1)]),after:i(()=>[l(k,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),l(k,{color:"dark",icon:"close",dense:"",onClick:t[0]||(t[0]=a=>e.$emit("cancelEdit"))})]),"after-options":i(()=>[e.config.allowNew&&e.options&&e.options.length>0?(c(),A("div",Be,[l(k,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[1]||(t[1]=a=>e.addNew=!0)},null,8,["label"])])):R("",!0)]),"no-option":i(()=>[e.config.allowNew?(c(),A("div",Ye,[l(k,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[2]||(t[2]=a=>e.addNew=!0)},null,8,["label"])])):R("",!0)]),_:1},8,["label","modelValue","options","option-label","display-value","error","onFilter","loading","disable"])])):R("",!0),e.config.type==="input"?(c(),A("div",Ge,[l(I,{class:"q-mb-sm",dense:"",label:e.config.fieldLabel,modelValue:e.entry,"onUpdate:modelValue":t[5]||(t[5]=a=>e.entry=a),"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":""},{error:i(()=>[y("div",Ke,E(e.formErrors.entry),1)]),after:i(()=>[l(k,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),l(k,{color:"dark",icon:"close",dense:"",onClick:t[4]||(t[4]=a=>e.$emit("cancelEdit"))})]),_:1},8,["label","modelValue","error"])])):R("",!0)]),_:1},8,["onSubmit"]),l(Oe,{modelValue:e.addNew,"onUpdate:modelValue":t[8]||(t[8]=a=>e.addNew=a)},{default:i(()=>[e.config.newType==="location"?(c(),$(u,{key:0,onCancelAdd:t[6]||(t[6]=a=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):R("",!0),e.config.newType==="customer"?(c(),$(r,{key:1,onCancelAdd:t[7]||(t[7]=a=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):R("",!0)]),_:1},8,["modelValue"])])}var _e=Q(Ie,[["render",Ze]]);const xe=H({emits:[],props:{item:Object},components:{EditDetailsForm:_e},setup(e,{emit:t}){const d=V(!1),p=N(()=>{const{permission:f}=e.item.editable&&e.item.config?e.item.config:{action:null,subject:null};return f});return{edit:d,permission:p}}}),et={key:0,class:"row"},tt={class:"col-12 col-md-4"},at={class:"col-12 col-md-8"};function ot(e,t,d,p,f,v){const u=X("edit-details-form");return c(),$(re,{class:"q-py-sm"},{default:i(()=>[e.edit?(c(),$(u,{key:1,type:e.item.label,config:e.item.config,onCancelEdit:t[1]||(t[1]=r=>e.edit=!1)},null,8,["type","config"])):(c(),A("div",et,[y("div",tt,[y("div",null,[y("span",{class:ae(e.$q.screen.gt.lg?"text-body2":"text-caption")},E(e.item.label),3)])]),y("div",at,[y("div",null,[y("span",{class:ae(["text-weight-light",e.$q.screen.gt.lg?"text-body2":"text-caption"])},E(e.item.value),3),e.item.editable&&e.$can(e.permission.action,e.permission.subject)?(c(),$(k,{key:0,color:"accent",flat:"",dense:"",round:"",icon:"edit",size:"sm",onClick:t[0]||(t[0]=r=>e.edit=!0)})):R("",!0)])])]))]),_:1})}var rt=Q(xe,[["render",ot]]);const st=H({props:{title:String,details:Array},components:{DetailsSection:rt}}),lt={class:"text-body1 text-white"};function nt(e,t,d,p,f,v){const u=X("details-section");return c(),A("div",null,[l(le,{class:"text-dark q-pb-sm"},{default:i(()=>[e.title&&e.title!==""?(c(),$(re,{key:0,class:"bg-info q-py-sm"},{default:i(()=>[y("div",lt,E(e.title.toUpperCase()),1)]),_:1})):R("",!0),(c(!0),A(F,null,z(e.details,r=>(c(),$(u,{key:r,item:r},null,8,["item"]))),128))]),_:1})])}var it=Q(st,[["render",nt]]);const ut=H({props:{project:Object},setup(e,t){const d=x(),p=ee(),{getViewedProjects:f,updateViewedProjects:v}=te(),u=N(()=>p.params.id?p.params.id:e.project[3]?e.project[3]:null),r=N(()=>u.value?f(u.value):null),a=N(()=>r.value&&r.value.crafts?r.value.crafts:[]),h=async()=>{if(u.value&&a.value.length===0){const{data:w}=await b.fetchFromProjectsApp({fields:[W({type:"projectCrafts",query:`{'7'.EX.'${u.value}'}`})]});v({id:u.value,dataset:"crafts",data:w})}},g=O({jobNumber:M().required().label("Job Number"),craft:O(),description:M()}),{meta:P,errors:s,handleSubmit:o,handleReset:n}=ve({validationSchema:g}),{value:m}=T("jobNumber"),{value:j}=T("craft"),{value:C}=T("description"),L=o(async w=>{const S={6:{value:u.value},11:{value:w.jobNumber}};w.craft&&Object.assign(S,{14:{value:w.craft[3]}}),w.description&&Object.assign(S,{20:{value:w.description}});try{const{data:U}=await b.upsertRecordsXML({to:"bpzpwr2eh",data:[S],fieldsToReturn:[35],formatObject:35}),K=r.value.jobNumbers;K.push(U[0][35]),v({id:u.value,dataset:"jobNumbers",data:K}),d.notify({type:"positive",message:`Job Number ${U[0][35][11]} successfully added`})}catch(U){console.log(U),d.notify({type:"negative",message:"Something went wrong!"})}t.emit("jobNumberAdded"),n()});return h(),{jobNumber:m,craft:j,description:C,formErrors:s,formMeta:P,submit:L,crafts:a}}}),dt={class:"row"},ct={class:"col-12 col-md-4 q-pr-sm"},pt={class:"text-caption"},mt={class:"col-12 col-md-4 q-pr-sm"},ft={class:"col-12 col-md-4"};function vt(e,t,d,p,f,v){return c(),A("div",null,[l(fe,{onSubmit:pe(e.submit,["prevent"])},{default:i(()=>[l(le,null,{default:i(()=>[l(re,null,{default:i(()=>[y("div",dt,[y("div",ct,[l(I,{label:"Job Number",dense:"",modelValue:e.jobNumber,"onUpdate:modelValue":t[0]||(t[0]=u=>e.jobNumber=u),error:!!e.formErrors.jobNumber,"bottom-slots":""},{error:i(()=>[y("div",pt,E(e.formErrors.jobNumber),1)]),_:1},8,["modelValue","error"])]),y("div",mt,[l(me,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craft,"onUpdate:modelValue":t[1]||(t[1]=u=>e.craft=u),options:e.crafts,"option-label":"10","display-value":`${e.craft?e.craft[10]:""}`},null,8,["modelValue","options","display-value"])]),y("div",ft,[l(I,{label:"Description",dense:"",modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=u=>e.description=u)},null,8,["modelValue"])])])]),_:1}),l(ge,{align:"right"},{default:i(()=>[l(k,{color:"secondary",label:"Cancel",onClick:t[3]||(t[3]=u=>e.$emit("cancelAddJobNumber"))}),l(k,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Ve=Q(ut,[["render",vt]]);const bt=[{name:0,label:"Job Number",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Craft",align:"left",field:e=>e[15],format:e=>`${e}`,sortable:!0,required:!0}],yt=H({components:{AddJobNumber:Ve},props:{project:String},setup(e){const t=x(),d=ee(),p=V(!0),f=V(!1),{getViewedProjects:v,updateViewedProjects:u}=te(),r=V(d.params.id?d.params.id:e.project);he(()=>d.params.id,o=>{r.value=d.params.id});const a=N(()=>v(r.value)),h=N(()=>{const o=a.value&&a.value.jobNumbers?a.value.jobNumbers:[];return o.length>0?o.sort((n,m)=>n[1].$d>m[1].$d?1:-1):o}),g=async o=>{if(p.value=!0,h.value.length===0||o){const{data:n}=await b.fetchFromProjectsApp({fields:[W({type:"jobNumbers",query:`{'6'.EX.'${r.value}'}AND{'29'.EX.'Active'}`})]});u({id:r.value,dataset:"jobNumbers",data:n})}p.value=!1};function P(o){console.log(o),t.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${o[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{s(o)})}async function s(o){try{const{data:n}=await b.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:o[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35}),m=h.value.filter(j=>j[3]!==n[0][35][3]);u({id:r.value,dataset:"jobNumbers",data:m}),t.notify({type:"positive",message:"Job Number Removed"})}catch(n){console.log(n),t.notify({type:"negative",message:"Something went wrong"})}}return g(),{projectData:a,jobNumberColumns:bt,rows:h,initialPagination:{rowsPerPage:V(10)},showAddJobNumber:f,removeRow:P,loadData:g,loading:p}}}),gt={class:"text-caption"};function wt(e,t,d,p,f,v){const u=X("add-job-number");return c(),A("div",null,[e.showAddJobNumber?R("",!0):(c(),$(ie,{key:0,dense:"",title:"Job Numbers","title-class":"text-primary",style:{},columns:e.jobNumberColumns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[l(ne,{label:"Loading...","label-class":"text-info"})]),"top-left":i(()=>[e.$can("create","projectJobNumbers")||e.$can("manage","projects")?(c(),$(k,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAddJobNumber=!0)})):R("",!0)]),"top-right":i(()=>[l(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[l(Y,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(B,{class:"text-left",key:a.name},{default:i(()=>[oe(E(a.label),1)]),_:2},1024))),128)),l(B,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[l(Y,{props:r},{default:i(()=>[l(Fe,{anchor:"top middle",self:"top middle"},{default:i(()=>[oe("Description: "+E(r.row[20]),1)]),_:2},1024),(c(!0),A(F,null,z(r.cols,a=>(c(),$(G,{key:a.name,props:r},{default:i(()=>[y("span",gt,E(a.value),1)]),_:2},1032,["props"]))),128)),l(G,{"auto-width":""},{default:i(()=>[e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(c(),$(k,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJobNumber?(c(),$(u,{key:1,project:e.projectData,onJobNumberAdded:t[2]||(t[2]=r=>e.showAddJobNumber=!1),onCancelAddJobNumber:t[3]||(t[3]=r=>e.showAddJobNumber=!1)},null,8,["project"])):R("",!0)])}var $t=Q(yt,[["render",wt]]);const ht=[{name:0,label:"Rule",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Miles",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0,required:!0},{name:2,label:"Amount",align:"left",field:e=>e[10],format:e=>e?`$ ${e.toFixed(2)}`:"",sortable:!0,required:!0}],jt=H({components:{AddJobNumber:Ve},props:{project:String},setup(e){const t=x(),d=ee(),p=V(!0),{getViewedProjects:f,updateViewedProjects:v}=te(),u=N(()=>d.params.id?d.params.id:e.project),r=N(()=>f(u.value)),a=N(()=>(r.value&&r.value.perDiem?r.value.perDiem:[]).sort((m,j)=>m[1].$d>j[1].$d?1:-1)),h=async n=>{if(p.value=!0,a.value.length===0||n){const{data:m}=await b.fetchFromProjectsApp({fields:[W({type:"perDiemSpecs",query:`{'12'.EX.'${u.value}'}AND{'38'.EX.'Active'}`})]});v({id:u.value,dataset:"perDiem",data:m})}p.value=!1},g=V(!1),{removeObject:P}=He();N(()=>(r.value&&r.value.jobNumbers?r.value.jobNumbers:[]).sort((m,j)=>m[1].$d>j[1].$d?1:-1));function s(n){console.log(n),t.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${n[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{o(n)})}async function o(n){try{const{data:m}=await b.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:n[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35});P({array:"jobNumbers",object:m[0][35]})}catch(m){console.log(m),t.notify({type:"negative",message:"Something went wrong"})}}return h(),{projectData:r,columns:ht,rows:a,initialPagination:{rowsPerPage:V(8)},showAddJobNumber:g,removeRow:s,loadData:h,loading:p}}}),Ct={class:"text-caption"};function kt(e,t,d,p,f,v){const u=X("add-job-number");return c(),A("div",null,[e.showAddJobNumber?R("",!0):(c(),$(ie,{key:0,dense:"",title:"Per-Diem","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[l(ne,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":i(()=>[e.$can("create","projectPerDiem")||e.$can("manage","projects")?(c(),$(k,{key:0,disable:"",dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAddJobNumber=!0)})):R("",!0)]),"top-right":i(()=>[l(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[l(Y,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(B,{class:"text-left",key:a.name},{default:i(()=>[oe(E(a.label),1)]),_:2},1024))),128)),l(B,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[l(Y,{props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(G,{key:a.name,props:r},{default:i(()=>[y("span",Ct,E(a.value),1)]),_:2},1032,["props"]))),128)),l(G,{"auto-width":""},{default:i(()=>[e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(c(),$(k,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJobNumber?(c(),$(u,{key:1,onJobNumberAdded:t[2]||(t[2]=r=>e.showAddJobNumber=!1),onCancelAddJobNumber:t[3]||(t[3]=r=>e.showAddJobNumber=!1)})):R("",!0)])}var At=Q(jt,[["render",kt]]);const Nt=H({emits:["cancelAdd","addComplete"],props:{project:Object},setup(e,{emit:t}){const d=x(),p=ee(),{getViewedProjects:f,updateViewedProjects:v}=te(),u=N(()=>p.params.id?p.params.id:e.project[3]?e.project[3]:null),r=N(()=>u.value?f(u.value):null),a=O({name:M().required().label("Location Name"),street1:M().required().label("Street Address 1"),street2:M(),city:M().required().label("City"),state:M().required().label("State"),postal:M().required().label("Postal Code")}),{meta:h,errors:g,handleSubmit:P,handleReset:s}=ve({validationSchema:a}),{value:o}=T("name"),{value:n}=T("street1"),{value:m}=T("street2"),{value:j}=T("city"),{value:C}=T("state"),{value:L}=T("postal"),w=P(async S=>{const U={6:{value:S.name},8:{value:S.street1},9:{value:S.street2?S.street2:""},10:{value:S.city},11:{value:S.state},12:{value:S.postal},13:{value:"United States"}};r.value[8]&&Object.assign(U,{15:{value:r.value[8]}});try{const{data:K}=await b.upsertRecordsXML({to:"bp5d2twyj",data:[U],fieldsToReturn:[22],formatObject:22}),be=r.value.meetingLocations;be.push(K[0][22]),v({id:u.value,dataset:"meetingLocations",data:be}),d.notify({type:"positive",message:`Meeting location ${K[0][22][6]} successfully added`}),t("addComplete"),s()}catch(K){console.log(K),d.notify({type:"negative",message:"Something went wrong!"})}});return{projectObject:r,formErrors:g,formMeta:h,submit:w,name:o,street1:n,street2:m,city:j,state:C,postal:L,states:Qe}}}),Rt={class:"row"},Vt={class:"col-6 col-md-12"},Et={class:"text-caption"},Lt={class:"text-caption"},qt={class:"text-caption"},Pt={class:"text-caption"},St={class:"text-caption"};function Dt(e,t,d,p,f,v){return c(),A("div",null,[l(fe,{onSubmit:pe(e.submit,["prevent"])},{default:i(()=>[l(le,null,{default:i(()=>[l(re,null,{default:i(()=>[y("div",Rt,[y("div",Vt,[l(I,{label:"Location Name",dense:"",modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=u=>e.name=u),error:!!e.formErrors.name,"bottom-slots":""},{error:i(()=>[y("div",Et,E(e.formErrors.name),1)]),_:1},8,["modelValue","error"]),l(I,{label:"Street Address 1",dense:"",modelValue:e.street1,"onUpdate:modelValue":t[1]||(t[1]=u=>e.street1=u),error:!!e.formErrors.street1,"bottom-slots":""},{error:i(()=>[y("div",Lt,E(e.formErrors.street1),1)]),_:1},8,["modelValue","error"]),l(I,{label:"Street Address 2",dense:"",modelValue:e.street2,"onUpdate:modelValue":t[2]||(t[2]=u=>e.street2=u),error:!!e.formErrors.street2,"bottom-slots":""},{error:i(()=>[y("div",qt,E(e.formErrors.street2),1)]),_:1},8,["modelValue","error"]),l(I,{label:"City",dense:"",modelValue:e.city,"onUpdate:modelValue":t[3]||(t[3]=u=>e.city=u),error:!!e.formErrors.city,"bottom-slots":""},{error:i(()=>[y("div",Pt,E(e.formErrors.city),1)]),_:1},8,["modelValue","error"]),l(me,{dense:"",label:"State","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.state,"onUpdate:modelValue":t[4]||(t[4]=u=>e.state=u),options:e.states,"bottom-slots":""},null,8,["modelValue","options"]),l(I,{label:"Postal Code",dense:"",modelValue:e.postal,"onUpdate:modelValue":t[5]||(t[5]=u=>e.postal=u),error:!!e.formErrors.postal,"bottom-slots":""},{error:i(()=>[y("div",St,E(e.formErrors.postal),1)]),_:1},8,["modelValue","error"])])])]),_:1}),l(ge,{align:"right"},{default:i(()=>[l(k,{color:"secondary",label:"Cancel",onClick:t[6]||(t[6]=u=>e.$emit("cancelAdd"))}),l(k,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Ot=Q(Nt,[["render",Dt]]);const Xt=[{name:0,label:"Location Name",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0},{name:1,label:"Address",align:"left",field:e=>e[8],format:e=>`${e}`,sortable:!1,required:!0}],Tt=H({components:{AddMeetingLocation:Ot},props:{project:String},setup(e){const t=x(),d=ee(),p=V(!0),f=V(!1),{getViewedProjects:v,updateViewedProjects:u}=te(),r=N(()=>d.params.id?d.params.id:e.project),a=N(()=>v(r.value)),h=N(()=>a.value&&a.value.meetingLocations?a.value.meetingLocations:[]),g=async o=>{if(p.value=!0,(h.value.length===0||o)&&a.value){const{data:n}=await b.fetchFromStructureApp({fields:[se({type:"meetingLocations",query:`{'15'.EX.'${a.value[8]}'}AND{'14'.EX.'Active'}`})]});u({id:r.value,dataset:"meetingLocations",data:n})}p.value=!1};function P(o){console.log(o),t.dialog({title:"Confirm",message:`Are you sure you want to remove location ${o[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{s(o)})}async function s(o){try{const{data:n}=await b.upsertRecordsXML({to:"bp5d2twyj",data:[{3:{value:o[3]},14:{value:"Inactive"}}],fieldsToReturn:[22],formatObject:22}),m=h.value.filter(j=>j[3]!==n[0][22][3]);u({id:r.value,dataset:"meetingLocations",data:m}),t.notify({type:"positive",message:"Meeting Location Removed"})}catch(n){console.log(n),t.notify({type:"negative",message:"Something went wrong"})}}return g(),{projectData:a,columns:Xt,rows:h,initialPagination:{rowsPerPage:V(8)},showAdd:f,removeRow:P,loadData:g,loading:p}}}),Ut={class:"text-caption"};function Mt(e,t,d,p,f,v){const u=X("add-meeting-location");return c(),A("div",null,[e.showAdd?R("",!0):(c(),$(ie,{key:0,dense:"",title:"Meeting Locations","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[l(ne,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":i(()=>[l(k,{dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAdd=!0)})]),"top-right":i(()=>[l(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[l(Y,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(B,{class:"text-left",key:a.name},{default:i(()=>[oe(E(a.label),1)]),_:2},1024))),128)),l(B,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[l(Y,{props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(G,{key:a.name,props:r},{default:i(()=>[y("span",Ut,E(a.value),1)]),_:2},1032,["props"]))),128)),l(G,{"auto-width":""},{default:i(()=>[l(k,{color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),$(u,{key:1,onAddComplete:t[2]||(t[2]=r=>e.showAdd=!1),onCancelAdd:t[3]||(t[3]=r=>e.showAdd=!1)})):R("",!0)])}var Ft=Q(Tt,[["render",Mt]]);const Ht=H({emits:["addComplete","cancelAdd"],props:{project:Object,current:Array},setup(e,{emit:t}){const d=x(),p=ee(),{capitalize:f}=ke,v=V([]),{setRosters:u,getManpowerData:r}=te(),a=N(()=>p.params.id?p.params.id:e.project&&e.project[3]?e.project[3]:null),h=N(()=>(r({dataset:"rosters",id:a.value})||[]).sort((S,U)=>S[75]>U[75]?1:-1)),g=L=>{const w=L.split(" ");let S="";return w.forEach((U,K)=>{S+=K>0?` ${f(U.toLowerCase())}`:f(U.toLowerCase())}),S},P=async()=>{if(a.value&&h.value.length===0){const L=`{'74'.EX.'${a.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:w}=await b.fetchFromHiringApp({fields:[Re({type:"assignments",query:L})]});u({id:a.value,data:w}),v.value=w}else v.value=h.value},s=O({entry:O().required().label("Contact")}),{errors:o,handleSubmit:n}=ve({validationSchema:s}),{value:m}=T("entry"),j=n(async L=>{if(e.current.filter(w=>w[18]===L.entry[18]).length>0)d.notify({type:"negative",message:"This employee is already a site contact!"}),t("cancelAdd");else try{const{data:w}=await b.upsertRecordsXML({to:"bp5hcce69",data:[{7:{value:a.value},18:{value:L.entry[18]}}],fieldsToReturn:[27],formatObject:27});t("addComplete",w[0][27]),d.notify({type:"positive",message:`Contact ${g(w[0][27][17])} successfully added`})}catch(w){console.log(w),d.notify({type:"negative",message:"Something went wrong!"})}}),C=(L,w)=>{if(L===""){w(()=>{v.value=h.value});return}w(()=>{const S=L.toLowerCase();v.value=h.value.filter(U=>U[75].toLowerCase().indexOf(S)>-1)})};return P(),{entry:m,options:v,formErrors:o,submit:j,filterOptions:C,properValue:g}}}),Qt={class:"text-caption"};function Jt(e,t,d,p,f,v){return c(),A("div",null,[l(fe,{onSubmit:pe(e.submit,["prevent"])},{default:i(()=>[l(le,null,{default:i(()=>[l(re,null,{default:i(()=>[l(me,{class:"q-mb-sm",dense:"",label:"Select New Contact","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":t[0]||(t[0]=u=>e.entry=u),options:e.options,"option-label":u=>u?e.properValue(u[75]):"","display-value":e.entry?`${e.entry[75]}`:"","bottom-slots":"",error:!!e.formErrors.entry,"use-input":"","input-debounce":"0",onFilter:e.filterOptions},{error:i(()=>[y("div",Qt,E(e.formErrors.entry),1)]),_:1},8,["modelValue","options","option-label","display-value","error","onFilter"])]),_:1}),l(ge,{align:"right"},{default:i(()=>[l(k,{color:"secondary",label:"Cancel",onClick:t[1]||(t[1]=u=>e.$emit("cancelAdd"))}),l(k,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var It=Q(Ht,[["render",Jt]]);const{capitalize:Ce}=ke,$e=e=>{const t=e.split(" ");let d="";return t.forEach((p,f)=>{d+=f>0?` ${Ce(p.toLowerCase())}`:Ce(p.toLowerCase())}),d},zt=[{name:0,label:"Name",align:"left",field:e=>e[17],format:e=>`${$e(e)}`,sortable:!0},{name:1,label:"Phone",align:"left",field:e=>e[20],format:e=>e!==""?`${e}`:"N/A",sortable:!0,required:!0}],Wt=H({components:{AddSiteContact:It},props:{project:String},setup(e){const t=x(),d=ee(),p=V(!0),{getViewedProjects:f,updateViewedProjects:v}=te(),u=N(()=>d.params.id?d.params.id:e.project),r=N(()=>f(u.value)),a=N(()=>(r.value&&r.value.siteContacts?r.value.siteContacts:[]).sort((m,j)=>m[17]>j[17]?1:-1)),h=async n=>{if(p.value=!0,a.value.length===0||n){const{data:m}=await b.fetchFromProjectsApp({fields:[W({type:"siteContacts",query:`{'7'.EX.'${u.value}'}AND{'6'.EX.'Active'}`})]});v({id:u.value,dataset:"siteContacts",data:m})}p.value=!1},g=V(!1);function P(n){t.dialog({title:"Confirm",message:`Are you sure you want to remove contact ${$e(n[17])}?`,cancel:!0,persistent:!0}).onOk(()=>{s(n)})}async function s(n){try{const{data:m}=await b.upsertRecordsXML({to:"bp5hcce69",data:[{3:{value:n[3]},6:{value:"Inactive"}}],fieldsToReturn:[27],formatObject:27}),j=a.value.filter(C=>C[3]!==m[0][27][3]);v({id:u.value,dataset:"siteContacts",data:j}),t.notify({type:"positive",message:"Contact Removed"})}catch(m){console.log(m),t.notify({type:"negative",message:"Something went wrong"})}}const o=n=>{v({id:u.value,dataset:"siteContacts",data:[n],push:!0}),g.value=!1};return h(),{projectData:r,columns:zt,rows:a,initialPagination:{rowsPerPage:V(8)},showAdd:g,removeRow:P,loadData:h,loading:p,properValue:$e,contactAdded:o}}}),Bt={class:"text-caption"};function Yt(e,t,d,p,f,v){const u=X("add-site-contact");return c(),A("div",null,[e.showAdd?R("",!0):(c(),$(ie,{key:0,dense:"",title:"Contacts","title-class":"text-primary",style:{"max-height":"300px"},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[l(ne,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":i(()=>[e.$can("create","projectContacts")||e.$can("manage","projects")?(c(),$(k,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAdd=!0)})):R("",!0)]),"top-right":i(()=>[l(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[l(Y,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(B,{class:"text-left",key:a.name},{default:i(()=>[oe(E(a.label),1)]),_:2},1024))),128)),l(B,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[l(Y,{props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(G,{key:a.name,props:r},{default:i(()=>[y("span",Bt,E(a.value),1)]),_:2},1032,["props"]))),128)),l(G,{"auto-width":""},{default:i(()=>[e.$can("manage","projectContacts")||e.$can("manage","projects")?(c(),$(k,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),$(u,{key:1,current:e.rows,project:e.projectData,onAddComplete:e.contactAdded,onCancelAdd:t[2]||(t[2]=r=>e.showAdd=!1)},null,8,["current","project","onAddComplete"])):R("",!0)])}var Gt=Q(Wt,[["render",Yt]]);const Kt=H({components:{},props:{project:Object},setup(e,t){const d=x(),p=V(10),f=V(null),{getUser:v}=Ae(Ne()),u=V(null),r=N(()=>{const q=new RegExp("^[0-9]{"+p.value+"}","g");return O({firstName:M().required().label("First Name"),lastName:M().required().label("Last Name"),email:M().email().required().label("Email"),phoneNumber:M().matches(q,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),role:O().required().nullable().label("Role"),workdayId:M().required().label("Workday ID")})}),{meta:a,errors:h,handleSubmit:g,handleReset:P}=ve({validationSchema:r}),{value:s}=T("firstName"),{value:o}=T("lastName"),{value:n}=T("email"),{value:m}=T("phoneNumber"),{value:j}=T("role"),{value:C}=T("workdayId");async function L({accessID:q}){const{data:J}=await b.upsertRecordsXML({to:"br598isx6",data:[{3:{value:q},20:{value:!0}}],fieldsToReturn:[28],formatObject:28});t.emit("userAdded",{user:J[0][28]}),d.loading.hide(),P()}async function w(q,J){b.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:q},10:{value:"Active"},11:{value:J}}]});const{data:ue}=await b.fetchFromStructureApp({fields:[{6:{value:"br598isx6"},7:{value:"Table Query"},8:{value:`{'6'.EX.${q}}`},9:{value:1},14:{value:24}}]});if(new Set(ue.filter(_=>_[7]==="Project").map(_=>_[9])).has(e.project[3])){const _=ue.find(we=>we[9]===e.project[3]);L({accessID:_[3]})}else return!1}async function S(q){const J=`{'6'.EX.'${q.email}'}AND{'8'.EX.'${q.phoneNumber}'}AND{'32'.EX.'${q.userType}'}`,ue=[{7:{value:"User Request"},8:{value:J},9:{value:1},14:{value:77}}];if(J==="{'10'.EX.'Active'}AND{'32'.EX.'Candidate'}"||J==="{'10'.EX.'Active'}AND{'32'.EX.'Project User'}")throw{response:{data:{errtext:"Unknown username",errdetail:"Sorry! Something's wrong. Try again."}}};const{data:Z}=await b.fetchFromStructureApp({fields:ue});if(Z.length<1)return null;if(!await w(Z[0][3],q.role))return Z}const U=g(async q=>{d.loading.show();const J={userType:"Project User",phoneNumber:`+${f.value?f.value.dialCode:"1"}${q.phoneNumber}`,email:q.email,role:q.role[3]};if(e.project.users.filter(Z=>Z[6]===J.email||Z[8]===J.phoneNumber).length>0)d.dialog({title:"Alert",message:"Your project already has a user with that phone or email."}).onOk(()=>{t.emit("userCanceled")});else{const Z=await S(J);if(console.log(Z),Z){const{data:_}=await b.upsertRecordsXML({to:"br598isx6",data:[{6:{value:Z[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});_.length>0&&t.emit("userAdded",{user:_[0][28]})}else{const _=n.value.match(/^([^@]*)@/)[1],we=Object.assign({phoneNumber:m.value},f.value),{data:je}=await b.upsertRecordsXML({to:"br4pxrbs6",data:[{6:{value:q.email},7:{value:"temp"},8:{value:`+${f.value?f.value.dialCode:"1"}${q.phoneNumber}`},9:{value:JSON.stringify(we)},10:{value:"Active"},11:{value:q.role[3]},17:{value:!0},23:{value:v.value[3]},24:{value:v.value[3]},25:{value:new Date},26:{value:new Date},32:{value:"Project User"},33:{value:_},35:{value:s.value},37:{value:o.value},49:{value:!0},50:{value:!0},70:{value:q.workdayId}}],fieldsToReturn:[3,96],formatObject:96});if(je[0]!==void 0){const ye=await b.upsertRecordsXML({to:"br598isx6",data:[{6:{value:je[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});ye.data[0]!==void 0&&d.dialog({title:"Confirm",message:"User successfully added. Would you like to send them an invite?",cancel:!0,persistent:!0}).onOk(async()=>{(await b.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:ye.data[0][28][3]},93:{value:new Date}}],fieldsToReturn:[3]})).data[0]!==void 0&&(d.notify({type:"positive",message:"User invite submitted"}),t.emit("userAdded",{user:ye.data[0][28]}))}).onCancel(()=>{t.emit("userAdded",{user:ye.data[0][28]})})}}}P(),d.loading.hide()}),K=N(()=>{const q=e.project.users.map(J=>J[9].phoneNumber);return new Set(q)});he(m,q=>{K.value.has(q)&&d.notify({type:"negative",message:"Phone Number is already in use!",timeout:1e4,position:d.screen.lt.md?"top":"center"})});const be=q=>{f.value=q},Ee=q=>{p.value=q};function Le(){P(),t.emit("userCanceled")}async function qe(){d.loading.show();const{data:q}=await b.fetchFromStructureApp({fields:[{6:{value:"br5v4in72"},7:{value:"Table Query"},8:{value:"{'7'.EX.'Projects'}AND{'15'.EX.'Active'}AND{'17'.EX.true}"},9:{value:1},14:{value:18}}]});u.value=q,d.loading.hide()}return qe(),{updateCountry:be,updatePhoneMaxLength:Ee,firstName:s,lastName:o,email:n,phoneNumber:m,role:j,workdayId:C,formMeta:a,formErrors:h,submitUser:U,roleOptions:u,cancel:Le}}}),Zt=y("div",{class:"text-primary text-h6"},"Add a New User",-1),_t=y("div",{class:"text-accent text-body2 text-italic q-mb-md"},"All info is required.",-1),xt={class:"row justify-between"},ea={class:"row justify-between"},ta={class:"text-caption"},aa={class:"row justify-between"},oa={class:"text-caption"},ra={class:"text-caption"};function sa(e,t,d,p,f,v){return c(),A("div",null,[l(le,null,{default:i(()=>[l(fe,{onSubmit:pe(e.submitUser,["prevent"])},{default:i(()=>[l(re,null,{default:i(()=>[Zt,_t,y("div",xt,[y("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[l(I,{dense:"",outlined:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=u=>e.firstName=u),error:!!e.formErrors.firstName},null,8,["modelValue","error"])],2),y("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[l(I,{dense:"",outlined:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=u=>e.lastName=u),error:!!e.formErrors.lastName},null,8,["modelValue","error"])],2)]),y("div",ea,[y("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[l(I,{dense:"",outlined:"",label:"Workday ID",modelValue:e.workdayId,"onUpdate:modelValue":t[2]||(t[2]=u=>e.workdayId=u),error:!!e.formErrors.workdayId},null,8,["modelValue","error"])],2),y("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[l(I,{dense:"",outlined:"",label:"Phone Number",modelValue:e.phoneNumber,"onUpdate:modelValue":t[3]||(t[3]=u=>e.phoneNumber=u),error:!!e.formErrors.phoneNumber,"bottom-slots":""},{error:i(()=>[y("div",ta,E(e.formErrors.phoneNumber),1)]),_:1},8,["modelValue","error"])],2)]),y("div",aa,[y("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[l(I,{dense:"",outlined:"",label:"Email","bottom-slots":"",modelValue:e.email,"onUpdate:modelValue":t[4]||(t[4]=u=>e.email=u),error:!!e.formErrors.email},{error:i(()=>[y("div",oa,E(e.formErrors.email),1)]),_:1},8,["modelValue","error"])],2),y("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[l(me,{dense:"",outlined:"",label:"Role","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.role,"onUpdate:modelValue":t[5]||(t[5]=u=>e.role=u),options:e.roleOptions,"option-label":"6","display-value":`${e.role?e.role[6]:""}`,"bottom-slots":"",error:!!e.formErrors.role},{error:i(()=>[y("div",ra,E(e.formErrors.role),1)]),_:1},8,["modelValue","options","display-value","error"])],2)])]),_:1}),l(ge,{align:"right"},{default:i(()=>[l(k,{color:"secondary",onClick:e.cancel,label:"Cancel"},null,8,["onClick"]),l(k,{color:"primary",type:"submit",label:"Submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])}var la=Q(Kt,[["render",sa]]);const na=[{name:1,label:"Name",align:"left",field:e=>e[35],format:(e,t)=>`${e} ${t[37]}`,sortable:!0},{name:2,label:"Role",align:"left",field:e=>e[44],format:e=>`${e}`,sortable:!0}],ia=H({components:{AddUser:la},props:{project:String},setup(e){const t=x(),d=ee(),p=V(!0),f=V(!1),{getViewedProjects:v,updateViewedProjects:u}=te(),{userData:r}=Ne(),a=N(()=>d.params.id?d.params.id:e.project),h=N(()=>v(a.value)),g=N(()=>(h.value&&h.value.users?h.value.users:[]).filter(j=>j[3]!==r[3]).sort((j,C)=>j[1].$d>C[1].$d?1:-1)),P=async m=>{if(p.value=!0,g.value.length===0||m){const{data:j}=await b.fetchFromStructureApp({fields:[se({type:"userAccess",query:`{'9'.EX.'${a.value}'}AND{'20'.EX.true}`})]});u({id:a.value,dataset:"users",data:j})}p.value=!1};function s(m){console.log(m),t.dialog({title:"Confirm",message:`Are you sure you want to remove user ${m[35]} ${m[37]}?`,cancel:!0,persistent:!0}).onOk(()=>{n(m)})}function o({user:m}){t.notify({type:"positive",message:"User successfully added!"}),f.value=!1;const j=h.value.users;j.push(m),u({id:a.value,dataset:"users",data:j})}async function n(m){const{data:j}=await b.fetchFromStructureApp({fields:[se({type:"userAccessObject",query:`{'6'.EX.'${m[3]}'}AND{'7'.EX.'Project'}AND{'9'.EX.'${a.value}'}`})]}),C=[];j.forEach(w=>{const S={3:{value:w[3]},20:{value:!1},38:{value:!1},39:{value:!1},40:{value:!1},41:{value:!1}};C.push(S)}),b.upsertRecordsXML({to:"br598isx6",data:C,fieldsToReturn:[3]});const L=g.value.filter(w=>w[3]!==m[3]);u({id:a.value,dataset:"users",data:L}),t.notify({type:"positive",message:"User Removed"})}return P(),{projectData:h,columns:na,rows:g,initialPagination:{rowsPerPage:V(8)},showAdd:f,removeRow:s,loadData:P,loading:p,userAdded:o}}}),ua={class:"text-caption"};function da(e,t,d,p,f,v){const u=X("add-user");return c(),A("div",null,[e.showAdd?R("",!0):(c(),$(ie,{key:0,dense:"",title:"Users","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[l(ne,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":i(()=>[e.$can("create","users")?(c(),$(k,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAdd=!0)})):R("",!0)]),"top-right":i(()=>[l(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[l(Y,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(B,{class:"text-left",key:a.name},{default:i(()=>[oe(E(a.label),1)]),_:2},1024))),128)),l(B,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[l(Y,{props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(G,{key:a.name,props:r},{default:i(()=>[y("span",ua,E(a.value),1)]),_:2},1032,["props"]))),128)),l(G,{"auto-width":""},{default:i(()=>[e.$can("manage","users")?(c(),$(k,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),$(u,{key:1,onUserAdded:e.userAdded,onUserCanceled:t[2]||(t[2]=r=>e.showAdd=!1),project:e.projectData},null,8,["onUserAdded","project"])):R("",!0)])}var ca=Q(ia,[["render",da]]);const pa=H({components:{approveHeadcount:Je},props:{project:Object},setup(e){const t=x(),d=ee(),p=V(!1),f=V(!0),v=V([]),u=V(null),r=te(),{getApprovedHeadcount:a}=Ae(r),h=N(()=>d.params.id?d.params.id:e.project&&e.project[3]?e.project[3]:null),g=N(()=>[{name:0,label:"Headcount",align:"left",field:C=>C[6],format:C=>`${C}`,sortable:!0},{name:1,label:"Date",align:"left",field:C=>C[7],format:C=>`${Xe.formatDate(new Date(C),"MM/DD/YYYY")}`,sortable:!0}]),P=N(()=>v.value&&v.value[0]&&v.value[0][6]?v.value[0][6]:null),s=async C=>{if(f.value=!0,C||v.value.length===0){const{data:L}=await b.fetchFromProjectsApp({fields:[{14:{value:10},9:{value:1},8:{value:`{'8'.EX.'${h.value}'}AND{'12'.EX.'TRUE'}`},7:{value:"Table Query"},6:{value:"bteqadt9j"}}]});console.log(L),v.value=L.sort((w,S)=>w[7].$d>S[7].$d?-1:1)}f.value=!1},o=async C=>{try{if(C||u.value===null){u.value=null;const L=`{'74'.EX.'${h.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:w}=await b.fetchFromHiringApp({fields:[Re({type:"assignments",query:L})]});console.log(w),u.value=w?w.length:null}}catch(L){console.log(L),u.value=null}},n=()=>{s(!0),o(!0)};function m(C){t.dialog({title:"Confirm",message:`Are you sure you want to remove Client Contracted Headcount ${C[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{j(C)})}async function j(C){try{console.log(C);const L=[{3:{value:C[3]},6:{value:C[6]},7:{value:C[7]},8:{value:C[8]},12:{value:!1}}],{data:w}=await b.upsertRecordsXML({to:"bteqadt9j",fieldsToReturn:[3,6,7,8,12],data:L,formatObject:10});if(console.log(w),w&&w[0]&&w[0][3])n(),t.notify({position:"top-right",type:"positive",message:"Client Contracted Headcount successfully removed"});else throw"Error in removing Client Contracted Headcount"}catch(L){console.log(L),t.notify({position:"top-right",type:"negative",message:"Error removing Client Contracted Headcount"})}}return he(a,()=>{n()}),s(!1),o(!1),{props:e,addHeadcount:p,loading:f,rows:v,columns:g,initialPagination:{rowsPerPage:V(10)},approvedHeadcount:P,activeHeadcount:u,refreshHeadcount:n,removeRow:m}}}),ma={class:"q-mt-xs"},fa={class:"text-body1 text-white text-uppercase"},va={key:0,class:"q-px-xs"},ba={key:1,class:"text-caption text-dark text-italic q-px-md"},ya={class:"text-caption"};function ga(e,t,d,p,f,v){const u=X("approveHeadcount");return c(),A(F,null,[y("div",ma,[l(le,{class:"text-dark q-pb-sm"},{default:i(()=>[l(re,{class:"bg-info q-py-sm"},{default:i(()=>[y("div",fa,[oe(" Client Contracted Headcount "),e.approvedHeadcount?(c(),A("span",va,"("+E(e.approvedHeadcount)+")",1)):R("",!0)])]),_:1})]),_:1})]),y("div",null,[l(ie,{dense:"",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[7],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[l(ne,{label:"Loading...","label-class":"text-info"})]),"top-left":i(()=>[y("div",null,[e.$can("create","projectHeadcount")||e.$can("manage","projects")?(c(),$(k,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.addHeadcount=!0)})):R("",!0),e.activeHeadcount!==null?(c(),A("span",ba,"Active Headcount: "+E(e.activeHeadcount),1)):R("",!0)])]),"top-right":i(()=>[l(k,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:e.refreshHeadcount},null,8,["onClick"])]),header:i(r=>[l(Y,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(B,{class:"text-left",key:a.name},{default:i(()=>[oe(E(a.label),1)]),_:2},1024))),128)),l(B,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[l(Y,{props:r},{default:i(()=>[(c(!0),A(F,null,z(r.cols,a=>(c(),$(G,{key:a.name,props:r},{default:i(()=>[y("span",ya,E(a.value),1)]),_:2},1032,["props"]))),128)),l(G,{"auto-width":""},{default:i(()=>[e.$can("manage","projectHeadcount")||e.$can("manage","projects")?(c(),$(k,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),l(u,{project:e.props.project,modelValue:e.addHeadcount,"onUpdate:modelValue":t[1]||(t[1]=r=>e.addHeadcount=r)},null,8,["project","modelValue"])])],64)}var wa=Q(pa,[["render",ga]]);const $a=H({components:{DetailsCard:it,JobNumbers:$t,PerDiem:At,MeetingLocations:Ft,SiteContacts:Gt,Users:ca,ApprovedHeadcount:wa},setup(e,{emit:t}){const d=x(),p=V(0),f=ee(),{getViewedProjects:v,updateViewedProjects:u,setViewedProjects:r}=te(),a=N(()=>v(f.params.id));(async()=>{if(!a.value){const{data:s}=await b.fetchFromProjectsApp({fields:[W({type:"projects",id:f.params.id})]});r({id:f.params.id,data:s})}})();const g=s=>{const o=[];for(const[n,m]of Object.entries(s)){const j={fid:n,value:m};o.push(j)}u({id:a.value[3],props:o})};return{details:N(()=>a.value?[{label:"Date Created",value:Te(a.value[1].$d).format("MM/DD/YYYY hh:mm:ss a"),editable:!1},{label:"Project Name",value:a.value[20],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:a.value[20],formRules:M().required().label("Project Name"),fieldLabel:"Enter the Project Name",getter:null,setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},20:{value:s}}],fieldsToReturn:[20,43]});g(o[0]),d.notify({type:"positive",message:"Project Name successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Name"})}}}},{label:"Project Alias",value:a.value[44],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:a.value[44],formRules:M().required().label("Project Alias"),fieldLabel:"Enter the Project Alias",getter:null,setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},44:{value:s}}],fieldsToReturn:[44]});g(o[0]),d.notify({type:"positive",message:"Project Alias successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Alias"})}}}},{label:"Customer",value:a.value[25],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"customer",initialValue:s=>s.find(o=>o[3]===a.value[9]),formRules:O().required().label("Customer").nullable(),fieldLabel:"Customer",optionLabel:"6",displayValue:6,getter:async()=>{const{data:s}=await b.fetchFromStructureApp({fields:[se({type:"projectCustomers",query:"{'7'.EX.'Active'}"})]});return s.sort((o,n)=>o[6]>n[6]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},9:{value:s[3]}}],fieldsToReturn:[9,25]});g(o[0]),d.notify({type:"positive",message:"Customer successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Customer"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1)}},{label:"Job Site",value:a.value[24],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"location",initialValue:s=>s.find(o=>o[3]===a.value[8]),formRules:O().required().label("Job Site").nullable(),fieldLabel:"Job Site",optionLabel:"6",displayValue:6,getter:async()=>{const{data:s}=await b.fetchFromStructureApp({fields:[se({type:"projectLocations",query:"{'51'.EX.true}"})]});return s.sort((o,n)=>o[6]>n[6]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},8:{value:s[3]}}],fieldsToReturn:[8,24,43,67,69,136]});g(o[0]),d.notify({type:"positive",message:"Job Site successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Job Site"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1)}},{label:"Address",value:a.value[67]},{label:"Sup Org Manager",value:a.value[245]},{label:"Primary Hiring Center",value:a.value[76],editable:!0,config:{permission:{action:"manage",subject:"hiringCenters"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[12]),formRules:O().required().label("Primary Hiring Center").nullable(),fieldLabel:"Hiring Center",optionLabel:"60",displayValue:60,getter:async()=>{const{data:s}=await b.fetchFromStructureApp({fields:[se({type:"hiringCenters",query:"{'51'.EX.'Active'}"})]});return s.sort((o,n)=>o[60]>n[60]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},12:{value:s[3]}}],fieldsToReturn:[12,26,76]});g(o[0]),d.notify({type:"positive",message:"Hiring Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Hiring Center"})}},filter:(s,o)=>s.filter(n=>n[60].toLowerCase().indexOf(o)>-1)}},{label:"Workday Location",value:`${a.value[241]} (${a.value[242]})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[240]),formRules:O().required().label("Workday Location").nullable(),fieldLabel:"Workday Location",optionLabel:s=>`${s[6]} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await b.fetchFromProjectsApp({fields:[W({type:"workdayLocations",query:`{'14'.EX.true}AND{'45'.EX.'${a.value[136]}'}`})]});return s.sort((o,n)=>o[6]>n[6]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},240:{value:s[40]}}],fieldsToReturn:[240,241,242,257,258]});return g(o[0]),d.notify({type:"positive",message:"Workday Location successfully updated"}),!0}catch{d.notify({type:"negative",message:"Error updating Workday Location"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1||n[7].toLowerCase().indexOf(o)>-1)}},{label:"Supervisory Org",value:`${D(a.value[259])} (${D(a.value[244])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[243]),formRules:O().required().label("Supervisory Organization").nullable(),fieldLabel:"Supervisory Organization",optionLabel:s=>`${s[42]} (${s[6]}) - ${D(s[26])}`,displayValue:42,getter:async()=>{const{data:s}=await b.fetchFromProjectsApp({fields:[W({type:"supOrgs",query:`{'32'.EX.'Active'}AND{'44'.EX.'${a.value[272]}'}`})]});return s.sort((o,n)=>o[42]>n[42]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},243:{value:s[16]}}],fieldsToReturn:[243,244,245,259]});g(o[0]),d.notify({type:"positive",message:"Supervisory Organization successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Supervisory Organization"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1||n[26].toLowerCase().indexOf(o)>-1||n[41].toLowerCase().indexOf(o)>-1||n[42].toLowerCase().indexOf(o)>-1)}},{label:"Company",value:`${D(a.value[286])} (${D(a.value[287])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[285]),formRules:O().required().label("Company").nullable(),fieldLabel:"Company",optionLabel:s=>`${D(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await b.fetchFromProjectsApp({fields:[W({type:"companies",query:`{'8'.EX.true}AND{'14'.EX.'${a.value[136]}'}`})]});return s.sort((o,n)=>o[6]>n[6]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},285:{value:s[10]}}],fieldsToReturn:[285,286,287]});g(o[0]),d.notify({type:"positive",message:"Company successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Company"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1||n[7].toLowerCase().indexOf(o)>-1)}},{label:"Workday Region",value:`${D(a.value[283])} (${D(a.value[284])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[282]),formRules:O().required().label("Workday Region").nullable(),fieldLabel:"Workday Region",optionLabel:s=>`${D(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await b.fetchFromProjectsApp({fields:[W({type:"workdayRegions",query:"{'8'.EX.true}"})]});return s.sort((o,n)=>o[6]>n[6]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},282:{value:s[9]}}],fieldsToReturn:[282,283,284]});g(o[0]),d.notify({type:"positive",message:"Region successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Region"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1||n[7].toLowerCase().indexOf(o)>-1)}},{label:"Workday Branch",value:`${D(a.value[289])} (${D(a.value[290])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[288]),formRules:O().required().label("Workday Branch").nullable(),fieldLabel:"Workday Branch",optionLabel:s=>`${D(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const s=a.value[264]===""?"Weekly":a.value[264],{data:o}=await b.fetchFromProjectsApp({fields:[W({type:"workdayBranches",query:`{'8'.EX.true}AND{'9'.EX.'${s}'}AND{'16'.EX.'${a.value[136]}'}`})]});return o.sort((n,m)=>n[6]>m[6]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},288:{value:s[12]}}],fieldsToReturn:[288,289,290]});g(o[0]),d.notify({type:"positive",message:"Branch successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Branch"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1||n[7].toLowerCase().indexOf(o)>-1)}},{label:"Pay Group",value:`${D(a.value[261])} (${D(a.value[262])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[260]),formRules:O().required().label("Workday Pay Group").nullable(),fieldLabel:"Workday Pay Group",optionLabel:s=>`${D(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await b.fetchFromProjectsApp({fields:[W({type:"workdayPayGroups",query:`{'8'.EX.'TRUE'}AND{'11'.EX.'Weekly'}AND{'21'.EX.'${a.value[136]}'}`})]});return s.sort((o,n)=>o[6]>n[6]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},260:{value:s[16]}}],fieldsToReturn:[260,261,262,263,264,272]});g(o[0]),d.notify({type:"positive",message:"Pay Group successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Pay Group"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1||n[7].toLowerCase().indexOf(o)>-1)}},{label:"Cost Center",value:`${D(a.value[276])} (${D(a.value[275])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[274]),formRules:O().required().label("Workday Cost Center").nullable(),fieldLabel:"Workday Cost Center",optionLabel:s=>`${D(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await b.fetchFromProjectsApp({fields:[W({type:"workdayCostCenters",query:`{'8'.EX.true}AND{'11'.EX.'${a.value[287]}'}`})]});return s.sort((o,n)=>o[6]>n[6]?1:-1)},setter:async s=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},274:{value:s[22]}}],fieldsToReturn:[274,275,276]});g(o[0]),d.notify({type:"positive",message:"Cost Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Cost Center"})}},filter:(s,o)=>s.filter(n=>n[6].toLowerCase().indexOf(o)>-1||n[7].toLowerCase().indexOf(o)>-1)}}]:[]),tab:p,project:a}}}),ha={class:"q-pa-sm"},ja={class:"row"},Ca={class:"col-12 col-sm-7 q-px-xs"},ka={class:"col-12 col-sm-5 q-px-xs"};function Aa(e,t,d,p,f,v){const u=X("details-card"),r=X("job-numbers"),a=X("meeting-locations"),h=X("site-contacts"),g=X("per-diem"),P=X("users"),s=X("approved-headcount");return c(),$(De,{style:{"max-width":"100vw"}},{default:i(()=>[y("div",ha,[y("div",ja,[y("div",Ca,[l(u,{details:e.details,title:"Details"},null,8,["details"])]),y("div",ka,[l(Se,{class:"q-py-xs bg-info text-white shadow-2 rounded-borders",align:"left",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=o=>e.tab=o),dense:"","indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:i(()=>[l(de,{name:0,label:"Job Numbers"}),l(de,{name:1,label:"Locations"}),l(de,{name:2,label:"Contacts"}),l(de,{name:3,label:"Per Diem"}),l(de,{name:4,label:"Users"})]),_:1},8,["modelValue"]),l(Pe,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=o=>e.tab=o),animated:"",class:"q-px-none"},{default:i(()=>[l(ce,{class:"q-px-xs",name:0},{default:i(()=>[l(r)]),_:1}),l(ce,{class:"q-px-xs",name:1},{default:i(()=>[l(a)]),_:1}),l(ce,{class:"q-px-xs",name:2},{default:i(()=>[l(h)]),_:1}),l(ce,{class:"q-px-xs",name:3},{default:i(()=>[l(g)]),_:1}),l(ce,{class:"q-px-xs",name:4},{default:i(()=>[l(P)]),_:1})]),_:1},8,["modelValue"]),l(s,{project:e.project},null,8,["project"])])])])]),_:1})}var mo=Q($a,[["render",Aa]]);export{mo as default};
