var _e=Object.defineProperty,qe=Object.defineProperties;var xe=Object.getOwnPropertyDescriptors;var re=Object.getOwnPropertySymbols;var Ne=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var ue=(y,l,n)=>l in y?_e(y,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):y[l]=n,h=(y,l)=>{for(var n in l||(l={}))Ne.call(l,n)&&ue(y,n,l[n]);if(re)for(var n of re(l))we.call(l,n)&&ue(y,n,l[n]);return y},G=(y,l)=>qe(y,xe(l));import{Q as $e}from"./QImg.8e96434f.js";import{_ as se,a3 as H,r as g,c as ie,w as L,z as o,A as w,d as N,bh as q,a6 as e,an as i,at as te,aa as B,c2 as P,bE as ne,bD as de,am as U,b as le,cx as ce,c6 as me,C as M,aU as ke,aS as Ce,c5 as Se,c4 as Ie,E as Ee,bX as Re,cy as De,c3 as Ue}from"./index.6c674a19.js";import{Q as ve}from"./QForm.a836d91e.js";import{Q as Me}from"./QPage.80490d1d.js";import{u as pe}from"./use-quasar.4e60ec94.js";import{u as Z,c as D,a as W,b as Ve}from"./array.f00f2e61.js";import{u as Pe}from"./i18n.8e2a8376.js";import{u as fe,q as A,c as Qe}from"./quickbase.c9a9fc75.js";import{api as he}from"./api.51f82bf2.js";import{_ as Ae}from"./languageSelector.d691c4cb.js";import{p as je}from"./VueTelInput.ecd4dc67.js";import{dayjs as T}from"./dayjs.69e964e9.js";import{c as Oe}from"./carousel.8ead42aa.js";import"./_commonjsHelpers.dfee5925.js";import"./localForage.7e70884e.js";import"./index.7dbe61ef.js";import"./QSelect.fdd46d88.js";import"./QChip.6c6d3173.js";import"./QMenu.b7fb2919.js";import"./position-engine.703db134.js";import"./selection.7761caf6.js";import"./rtl.a367ced8.js";import"./use-panel.fe019f7f.js";import"./touch.52aa58ff.js";import"./use-fullscreen.f7d9f446.js";const ge=y=>(ke("data-v-76d215d7"),y=y(),Ce(),y),Te={key:0,class:"text-dark"},Le={key:1,class:"text-dark"},Be={key:2,class:"text-dark"},Fe={key:3,class:"text-dark"},Ke={key:4,class:"text-dark"},ze=ge(()=>M("br",null,null,-1)),Ye={key:5,class:"text-dark"},Je=ge(()=>M("br",null,null,-1)),Xe={key:2,class:"text-grey-6 text-right"},Ge={key:3,class:"text-grey-6 text-right"},He={__name:"codeComponent",props:{phoneNumber:String,email:String,type:String,rid:String},emits:["verified"],setup(y,{emit:l}){const n=y,V=pe(),$=fe(),E=H(n,"phoneNumber"),a=H(n,"email"),t=H(n,"type"),r=g("code-confirmation"),x=g(Math.floor(1e5+Math.random()*9e5)),d=g(null),_=g(!1),c=g(!1),m=g(!1),b=g(0),p=H(n,"rid"),{value:R}=Z("codeConfirmation",D().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:"Code Not Valid!"}).required().oneOf([x.value],"Code Not Valid!")),oe=ie(()=>R.value===x.value),F=v=>{const u=Math.floor(v/6e4),f=(v%6e4/1e3).toFixed(0);return u+":"+(f<10?"0":"")+f};L(t,v=>{x.value=null,R.value=null,_.value=!1,x.value=null,d.value=null,r.value="code-confirmation"}),L(b,v=>{v===0?(_.value=!0,x.value=null,d.value=null):_.value=!1}),L(R,async v=>{Number(v)===x.value&&(V.notify({position:"top-right",type:"positive",message:"Code Verified!"}),t.value==="phone-number"?ee():t.value==="email"&&K())});const S=async()=>{m.value=!0,r.value==="code-confirmation"?(x.value=Math.floor(1e5+Math.random()*9e5),R.value=null,d.value=T().add(5,"minute").toISOString(),t.value==="phone-number"?(await he.createMessageQueue({to:E.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",message:`Your Brandsafway Verification Code is: ${x.value}`,extRef:null,massText:!1}),m.value=!1,V.notify({position:"top-right",type:"info",message:"Text message sent!"}),d.value=T().add(1,"minute")):t.value==="email"&&(await j(),m.value=!1,V.notify({position:"top-right",type:"info",message:"Email sent!"}),d.value=T().add(2,"minute")),m.value=!1,k(),r.value="code-sent"):m.value=!1},k=()=>{const v=setInterval(()=>{b.value=T(d.value).valueOf()-T().valueOf(),b.value<=0&&(b.value=0,clearInterval(v))},1e3)},j=async()=>{if(!p.value||p.value==="")return!1;const v=await A.isUserLoggedIn(),u=new Date;x.value||(x.value=Math.floor(1e5+Math.random()*9e5));const f={3:{value:p.value},26:{value:u},87:{value:u},88:{value:x.value},47:{value:!0}};try{return v?await A.updateUserData({fields:f}):await A.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[f],formatObject:76})}catch(O){V.notify({position:"top-right",type:"negative",message:O.message||"Error updating Verification!"})}},ee=async()=>{if(c.value=!0,!p.value||p.value==="")return c.value=!1,!1;const v=new Date,u={3:{value:p.value},26:{value:v},50:{value:!0}};try{await A.updateUserData({fields:u}),c.value=!1,l("verified")}catch(f){c.value=!1,V.notify({position:"top-right",type:"negative",message:f.message||"Error updating Verification!"})}},K=async()=>{if(c.value=!0,!p.value||p.value==="")return c.value=!1,!1;const v=new Date,u={3:{value:p.value},26:{value:v},49:{value:!0}};try{await A.updateUserData({fields:u}),c.value=!1,l("verified")}catch(f){c.value=!1,V.notify({position:"top-right",type:"negative",message:f.message||"Error updating Verification!"})}},I=()=>E.value.replace(/(\d{3})(\d{3})(\d{4})/,"******$3"),z=()=>($.userLoggedIn?$.user[34]:a.value||"").replace(/(.{2})(.*)(?=@)/,function(u,f,O){for(let Y=0;Y<O.length;Y++)f+="*";return f});return L(()=>n.phoneNumber,()=>{console.log(n)}),(v,u)=>(o(),w("div",null,[N(P,{class:"text-center auth-description"},{default:q(()=>[r.value==="code-sent"&&e(t)==="phone-number"?(o(),w("p",Te,"A text message with a verification code has been sent to your phone.")):i("",!0),r.value==="code-sent"&&e(t)==="email"?(o(),w("p",Le,"A verification code has been sent to your email. ")):i("",!0),r.value==="code-confirmation"&&e(t)==="phone-number"?(o(),w("p",Be,"Your Phone Number needs to be verified click the button below to verify.")):i("",!0),r.value==="code-confirmation"&&e(t)==="email"?(o(),w("p",Fe,"Your Email needs to be verified click the button below to verify.")):i("",!0),r.value==="code-confirmation"&&e(t)==="phone-number"?(o(),w("p",Ke,[ze,te(B(I()),1)])):i("",!0),r.value==="code-confirmation"&&e(t)==="email"?(o(),w("p",Ye,[Je,te(B(z()),1)])):i("",!0)]),_:1}),N(P,null,{default:q(()=>[N(ve,{class:"q-px-sm q-pt-sm",onSubmit:u[3]||(u[3]=ne(()=>{},["prevent"])),onKeyup:de(S,["enter"])},{default:q(()=>[r.value==="code-sent"?(o(),U(ce,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",clearable:!c.value,outlined:"",disable:_.value,loading:c.value,modelValue:e(R),"onUpdate:modelValue":u[0]||(u[0]=f=>le(R)?R.value=f:null),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:"Code",tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!e(oe),"error-message":"Code does not match!"},{append:q(()=>[te(B(F(b.value))+"\xA0 ",1)]),_:1},8,["clearable","disable","loading","modelValue","error"])):i("",!0),r.value==="code-confirmation"?(o(),U(me,{key:1,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Send Code",tabindex:"1",loading:m.value,onClick:S},null,8,["loading"])):i("",!0),e(t)==="phone-number"&&e(a)!==""?(o(),w("p",Xe,[M("a",{href:"javascript:void(0);",onClick:u[1]||(u[1]=f=>t.value="email")},"Use Email")])):i("",!0),e(t)==="email"&&e(E)!==""?(o(),w("p",Ge,[M("a",{href:"javascript:void(0);",onClick:u[2]||(u[2]=f=>t.value="phone-number")},"Use Phone Number")])):i("",!0),r.value==="code-sent"?(o(),U(P,{key:4,class:"q-py-none row justify-center"},{default:q(()=>[b.value===0?(o(),w("a",{key:0,onClick:S,class:"text-grey-6",href:"javascript:void(0);",tabindex:"2"},"Resend Code")):i("",!0)]),_:1})):i("",!0)]),_:1},8,["onKeyup"])]),_:1})]))}};var We=se(He,[["__scopeId","data-v-76d215d7"]]);const Ze={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ea={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},aa={class:"text-dark"},ta={key:0,class:"row q-col-gutter-xs"},la={key:1,class:"row q-col-gutter-xs"},oa={class:"text-grey-6"},ra={class:"row justify-center"},ua={__name:"updateInfo",setup(y){const l=pe(),n=fe(),{currentUserType:V}=Qe(),$=Se(),E=Ie(),{t:a}=Pe(),t=g(!1),r=g("update-information"),x=g(10),d=g(!1),_=g(!1),c=g(null),m=g(null),b=g(!1),p=g(!1),R=ie(()=>{const s=new RegExp("^[0-9]{"+x.value+"}","g");return _.value&&d.value?W({email:D().email(`${a("validEmailIsRequired")}`).required().label(`${a("email")}`),phoneNumber:D().matches(s,{excludeEmptyString:!0,message:`${a("validPhoneIsRequired")}`}).required().label(`${a("phoneNumber")}`)}):_.value&&!d.value?W({email:D().email(`${a("validEmailIsRequired")}`).required().label(`${a("email")}`),phoneNumber:D().matches(s,{excludeEmptyString:!0,message:`${a("validPhoneIsRequired")}`}).label(`${a("phoneNumber")}`)}):!_.value&&d.value?W({email:D().email(`${a("validEmailIsRequired")}`).label(`${a("email")}`),phoneNumber:D().matches(s,{excludeEmptyString:!0,message:`${a("validPhoneIsRequired")}`}).required().label(`${a("phoneNumber")}`)}):W({email:D().email(`${a("validEmailIsRequired")}`).required().label(`${a("email")}`),phoneNumber:D().matches(s,{excludeEmptyString:!0,message:`${a("validPhoneIsRequired")}`}).required().label(`${a("phoneNumber")}`)})}),{errors:oe,meta:F}=Ve({validationSchema:R,initialValues:{phoneNumber:"",email:""}}),{value:S}=Z("userRID"),{value:k,errorMessage:j,setErrors:ee,meta:K}=Z("phoneNumber"),{value:I,errorMessage:z,setErrors:v,meta:u}=Z("email");g(!0),$.query.rid?(S.value=$.query.rid,$.query.emailRequired&&(_.value=!0),$.query.phoneNumberRequired&&(d.value=!0),E.replace({query:{}})):E.push("/"),L(()=>$.query,()=>{$.query.rid&&(S.value=$.query.rid,$.query.emailRequired&&(_.value=!0),$.query.phoneNumberRequired&&(d.value=!0),E.replace({query:{}}))});const f=s=>{x.value=s},O=s=>{c.value=s},Y=()=>{n.logout().then(()=>{E.replace({name:"login"})})},ae=async()=>{if(t.value=!0,!F.value.valid)return t.value=!1,!1;if(!S.value||S.value==="")return t.value=!0,!1;const s=new Date;let C={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1};if(d.value){if(m.value=await he.twilioLookup({phoneNumber:k.value}),m.value&&(k.e164=m.value.phoneNumber,delete m.value.url,delete m.value.price,delete m.value.phoneNumber,delete m.value.addOns),m.value&&m.value.validPhoneNumber===!1)return ee(`${a("validPhoneIsRequired")}`),l.notify({type:"negative",message:`${a("validPhoneIsRequired")}`,timeout:7e3,position:l.screen.lt.md?"top":"top-right"}),t.value=!1,null;C=Object.assign({phoneNumber:k.value},c.value,m.value||{})}if(_.value&&I.value===""&&m.value&&m.value.validPhoneNumber===!1)return v(`${a("validEmailIsRequired")}`),l.notify({type:"negative",message:`${a("validEmailIsRequired")}`,timeout:7e3,position:l.screen.lt.md?"top":"top-right"}),t.value=!1,null;const Q=G(h(h(h(h(h({},d.value&&{8:{value:`+${c.value?c.value.dialCode:"1"}${k.value}`}}),d.value&&{9:{value:JSON.stringify(C)}}),d.value&&{111:{value:!1}}),_.value&&{6:{value:I.value}}),_.value&&{112:{value:!1}}),{26:{value:s}});try{await A.updateUserData({fields:Q}),t.value=!1,E.push({path:"/",query:h(h({rid:S.value},d.value&&{phoneNumber:`+${c.value?c.value.dialCode:"1"}${k.value}`}),_.value&&{email:I.value})})}catch(J){p.value=!1,b.value=!1,J.lineErrors&&J.lineErrors.forEach(X=>{X.includes('is not unique for unique formula field with ID "27"')&&(p.value=!0),X.includes('The field named "uniqueEmail" with field id 27 requires a unique value.')&&(p.value=!0),X.includes('is not unique for unique formula field with ID "28"')&&(b.value=!0),X.includes('The field named "uniquePhoneNumber" with field id 28 requires a unique value.')&&(b.value=!0)}),b.value||p.value?r.value="code-confirmation":l.notify({position:"top-right",type:"negative",message:J.message||"Error updating Information!"})}},ye=async()=>{try{const s=new Date,C={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1},Q=[h(h(h(G(h(h(h(h({},b.value&&{8:{value:""}}),b.value&&{9:{value:JSON.stringify(C)}}),b.value&&{50:{value:!1}}),b.value&&{111:{value:!0}}),{26:{value:s}}),p.value&&{6:{value:""}}),p.value&&{49:{value:!1}}),p.value&&{112:{value:!0}})];return await A.findAndUpdateUser(G(h(h({},b.value&&{phoneNumber:`+${c.value?c.value.dialCode:"1"}${k.value}`}),p.value&&{email:I.value}),{userType:V,fields:Q}))}catch(s){console.log(s)}},be=async()=>{r.value="update-information",await ye(),await ae()};return(s,C)=>(o(),U(Me,{class:"window-height window-width row"},{default:q(()=>[e(l).screen.lt.md?i("",!0):(o(),w("div",Ze,[N(Oe)])),M("div",ea,[N(Ue,{class:"auth-card",flat:""},{default:q(()=>[N(P,{style:{"padding-left":"30px","padding-right":"30px"}},{default:q(()=>[N($e,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),r.value==="update-information"?(o(),U(P,{key:0,class:"text-center auth-description"},{default:q(()=>[M("p",aa,B(s.$t("pleaseUpdateInformation")),1)]),_:1})):i("",!0),r.value==="update-information"?(o(),U(P,{key:1},{default:q(()=>[N(ve,{class:"q-px-sm q-pt-sm",onSubmit:C[2]||(C[2]=ne(()=>{},["prevent"])),onKeyup:de(ae,["enter"])},{default:q(()=>[d.value?(o(),w("div",ta,[N(je,{name:"phoneNumber",class:Ee(["col-xs-12 col-sm-12",{"q-pb-lg":e(j)&&e(K).validated}]),outlined:"",modelValue:e(k),"onUpdate:modelValue":C[0]||(C[0]=Q=>le(k)?k.value=Q:null),label:s.$t("phoneNumber"),tabindex:"3",onMaxLengthChanged:f,error:!!(e(j)&&e(K).validated),"error-message":e(j),onCountryChanged:O},null,8,["class","modelValue","label","error","error-message"])])):i("",!0),_.value?(o(),w("div",la,[N(ce,{class:"col-xs-12 col-sm-12 q-pb-lg",clearable:"",outlined:"",modelValue:e(I),"onUpdate:modelValue":C[1]||(C[1]=Q=>le(I)?I.value=Q:null),type:"email",autocomplete:"email",label:s.$t("email"),tabindex:"4",name:"email",error:!!(e(z)&&e(u).validated),"error-message":e(z)},{prepend:q(()=>[N(Re,{name:"email"})]),_:1},8,["modelValue","label","error","error-message"])])):i("",!0)]),_:1},8,["onKeyup"])]),_:1})):i("",!0),r.value==="code-confirmation"?(o(),U(We,{key:2,onVerified:be,phoneNumber:e(k),email:e(I),type:d.value?"phone-number":"email",rid:e(S)},null,8,["phoneNumber","email","type","rid"])):i("",!0),r.value==="update-information"?(o(),U(De,{key:3,class:"q-px-lg"},{default:q(()=>[r.value==="update-information"?(o(),U(me,{key:0,ref:"confirm",loading:t.value,disable:!e(F).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:s.$t("confirm"),tabindex:"3",onClick:ae},null,8,["loading","disable","label"])):i("",!0)]),_:1})):i("",!0),N(P,{class:"text-center q-pa-sm"},{default:q(()=>[M("p",oa,[M("a",{onClick:Y,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},B(s.$t("logout")),1)])]),_:1}),N(P,{class:"q-pl-lg q-pa-sm"},{default:q(()=>[M("div",ra,[N(Ae,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var Ua=se(ua,[["__scopeId","data-v-711f1fb5"]]);export{Ua as default};
