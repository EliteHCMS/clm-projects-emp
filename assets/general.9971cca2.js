import{Q as ne,b as ie,a as Ee}from"./QTabPanels.ec244ca6.js";import{Q as qe}from"./QTabs.e985372c.js";import{Q as Pe}from"./QPage.de97fdf1.js";import{u as x}from"./use-quasar.5edd4060.js";import{l as Q,r as E,c as k,_ as I,b5 as U,A as c,B as N,d as n,br as u,D as v,ac as L,bW as C,ar as R,cF as J,bO as ue,aq as $,cI as Se,G as ae,cE as se,F as H,b4 as Y,cH as de,bU as ee,cG as ge,w as Ce,ax as re,y as Ae,bV as De}from"./index.4017ca31.js";import{q as b,u as ke}from"./quickbase.4804bb81.js";import{dayjs as Oe}from"./dayjs.01a1f0cd.js";import{a as D,c as M}from"./array.46b57c33.js";import{a as z,b as oe,u as Xe}from"./useQuerySaver.d29ff9ee.js";import{u as te}from"./dataStore.0038134c.js";import{a as ce}from"./QSelect.f649ca34.js";import{Q as me}from"./QForm.09001e6a.js";import{a as pe,u as O}from"./vee-validate.esm.12a7079e.js";import{A as Te,a as Ue}from"./addNewCustomer.f7bdd9b1.js";import{Q as fe}from"./QInnerLoading.a464eed9.js";import{Q as K,a as be}from"./QTable.cf3c1214.js";import{Q as Z}from"./QTr.a6004cec.js";import{Q as Me}from"./QTooltip.1e7f358f.js";import{Q as _}from"./QTd.a5677bd1.js";import{u as Fe}from"./project.acee0b72.js";import{s as Je}from"./states.03e3d448.js";import{d as S}from"./decode.3998c82c.js";import"./use-panel.55e8ac5d.js";import"./touch.70a9dd44.js";import"./selection.238bfdbe.js";import"./QResizeObserver.1fc8b5d0.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.04bc0a32.js";import"./localForage.8295c071.js";import"./api.a5c07642.js";import"./i18n.c0a86e49.js";import"./QChip.4797ac30.js";import"./QMenu.f2054918.js";import"./position-engine.9b406c07.js";import"./QList.5e1c5b15.js";import"./QMarkupTable.73ed5d05.js";import"./use-fullscreen.61aac10e.js";const Qe=Q({emits:["cancelEdit"],components:{AddProjectLocationForm:Te,AddCustomerForm:Ue},props:{config:Object},setup(e,{emit:t}){const d=E(null),m=E(null),f=E(!1),g=async()=>{const{type:l,initialValue:p}=e.config;if(l==="options"){const{getter:w}=e.config;m.value=await w(),d.value=m.value,y.value=p(d.value)}else y.value=p},i=k(()=>D({entry:e.config.formRules})),{meta:s,errors:a,handleSubmit:h}=pe({validationSchema:i}),{value:y}=O("entry"),V=(l,p)=>{const{filter:w}=e.config;l===""&&p(()=>{d.value=m.value}),p(()=>{const X=l.toLowerCase();d.value=w(m.value,X)})},r=l=>{f.value=!1,m.value.push(l),d.value.push(l),y.value=l},o=h(async l=>{const{setter:p}=e.config;await p(l.entry),t("cancelEdit")});return g(),{rawOptions:m,options:d,entry:y,formErrors:a,formMeta:s,submit:o,filterOptions:V,addNew:f,newOptionAdded:r}}}),Ie={key:0,class:"q-pr-xl"},ze={class:"text-caption"},We={key:0,class:"text-center bg-info"},Be={key:0,class:"text-center bg-info"},Ge={key:1,class:"q-pr-xl"},He={class:"text-caption"};function Ye(e,t,d,m,f,g){const i=U("add-project-location-form"),s=U("add-customer-form");return c(),N("div",null,[n(me,{onSubmit:ue(e.submit,["prevent"])},{default:u(()=>[e.config.type==="options"?(c(),N("div",Ie,[n(ce,{class:"q-mb-sm",dense:"",label:`Select a ${e.config.fieldLabel}`,"transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":t[3]||(t[3]=a=>e.entry=a),options:e.options,"option-label":e.config.optionLabel,"display-value":`${e.entry?e.entry[e.config.displayValue]:""}`,"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":"","use-input":"","input-debounce":"0",onFilter:e.filterOptions,clearable:"",loading:!e.rawOptions,disable:!e.rawOptions},{error:u(()=>[v("div",ze,L(e.formErrors.entry),1)]),after:u(()=>[n(C,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),n(C,{color:"dark",icon:"close",dense:"",onClick:t[0]||(t[0]=a=>e.$emit("cancelEdit"))})]),"after-options":u(()=>[e.config.allowNew&&e.options&&e.options.length>0?(c(),N("div",We,[n(C,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[1]||(t[1]=a=>e.addNew=!0)},null,8,["label"])])):R("",!0)]),"no-option":u(()=>[e.config.allowNew?(c(),N("div",Be,[n(C,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[2]||(t[2]=a=>e.addNew=!0)},null,8,["label"])])):R("",!0)]),_:1},8,["label","modelValue","options","option-label","display-value","error","onFilter","loading","disable"])])):R("",!0),e.config.type==="input"?(c(),N("div",Ge,[n(J,{class:"q-mb-sm",dense:"",label:e.config.fieldLabel,modelValue:e.entry,"onUpdate:modelValue":t[5]||(t[5]=a=>e.entry=a),"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":""},{error:u(()=>[v("div",He,L(e.formErrors.entry),1)]),after:u(()=>[n(C,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),n(C,{color:"dark",icon:"close",dense:"",onClick:t[4]||(t[4]=a=>e.$emit("cancelEdit"))})]),_:1},8,["label","modelValue","error"])])):R("",!0)]),_:1},8,["onSubmit"]),n(Se,{modelValue:e.addNew,"onUpdate:modelValue":t[8]||(t[8]=a=>e.addNew=a)},{default:u(()=>[e.config.newType==="location"?(c(),$(i,{key:0,onCancelAdd:t[6]||(t[6]=a=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):R("",!0),e.config.newType==="customer"?(c(),$(s,{key:1,onCancelAdd:t[7]||(t[7]=a=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):R("",!0)]),_:1},8,["modelValue"])])}var Ke=I(Qe,[["render",Ye]]);const Ze=Q({emits:[],props:{item:Object},components:{EditDetailsForm:Ke},setup(e,{emit:t}){const d=E(!1),m=k(()=>{const{permission:f}=e.item.editable&&e.item.config?e.item.config:{action:null,subject:null};return f});return{edit:d,permission:m}}}),_e={key:0,class:"row"},xe={class:"col-12 col-md-4"},et={class:"col-12 col-md-8"};function tt(e,t,d,m,f,g){const i=U("edit-details-form");return c(),$(se,{class:"q-py-sm"},{default:u(()=>[e.edit?(c(),$(i,{key:1,type:e.item.label,config:e.item.config,onCancelEdit:t[1]||(t[1]=s=>e.edit=!1)},null,8,["type","config"])):(c(),N("div",_e,[v("div",xe,[v("div",null,[v("span",{class:ae(e.$q.screen.gt.lg?"text-body2":"text-caption")},L(e.item.label),3)])]),v("div",et,[v("div",null,[v("span",{class:ae(["text-weight-light",e.$q.screen.gt.lg?"text-body2":"text-caption"])},L(e.item.value),3),e.item.editable&&e.$can(e.permission.action,e.permission.subject)?(c(),$(C,{key:0,color:"accent",flat:"",dense:"",round:"",icon:"edit",size:"sm",onClick:t[0]||(t[0]=s=>e.edit=!0)})):R("",!0)])])]))]),_:1})}var at=I(Ze,[["render",tt]]);const ot=Q({props:{title:String,details:Array},components:{DetailsSection:at}}),rt={class:"text-body1 text-white"};function st(e,t,d,m,f,g){const i=U("details-section");return c(),N("div",null,[n(de,{class:"text-dark q-pb-sm"},{default:u(()=>[e.title&&e.title!==""?(c(),$(se,{key:0,class:"bg-info q-py-sm"},{default:u(()=>[v("div",rt,L(e.title.toUpperCase()),1)]),_:1})):R("",!0),(c(!0),N(H,null,Y(e.details,s=>(c(),$(i,{key:s,item:s},null,8,["item"]))),128))]),_:1})])}var lt=I(ot,[["render",st]]);const nt=Q({props:{project:Object},setup(e,t){const d=x(),m=ee(),{getViewedProjects:f,updateViewedProjects:g}=te(),i=k(()=>m.params.id?m.params.id:e.project[3]?e.project[3]:null),s=k(()=>i.value?f(i.value):null),a=k(()=>s.value&&s.value.crafts?s.value.crafts:[]),h=async()=>{if(i.value&&a.value.length===0){const{data:j}=await b.fetchFromProjectsApp({fields:[z({type:"projectCrafts",query:`{'7'.EX.'${i.value}'}`})]});g({id:i.value,dataset:"crafts",data:j})}},y=D({jobNumber:M().required().label("Job Number"),craft:D(),description:M()}),{meta:V,errors:r,handleSubmit:o,handleReset:l}=pe({validationSchema:y}),{value:p}=O("jobNumber"),{value:w}=O("craft"),{value:X}=O("description"),P=o(async j=>{const q={6:{value:i.value},11:{value:j.jobNumber}};j.craft&&Object.assign(q,{14:{value:j.craft[3]}}),j.description&&Object.assign(q,{20:{value:j.description}});try{const{data:T}=await b.upsertRecordsXML({to:"bpzpwr2eh",data:[q],fieldsToReturn:[35],formatObject:35}),W=s.value.jobNumbers;W.push(T[0][35]),g({id:i.value,dataset:"jobNumbers",data:W}),d.notify({type:"positive",message:`Job Number ${T[0][35][11]} successfully added`})}catch(T){console.log(T),d.notify({type:"negative",message:"Something went wrong!"})}t.emit("jobNumberAdded"),l()});return h(),{jobNumber:p,craft:w,description:X,formErrors:r,formMeta:V,submit:P,crafts:a}}}),it={class:"row"},ut={class:"col-12 col-md-4 q-pr-sm"},dt={class:"text-caption"},ct={class:"col-12 col-md-4 q-pr-sm"},mt={class:"col-12 col-md-4"};function pt(e,t,d,m,f,g){return c(),N("div",null,[n(me,{onSubmit:ue(e.submit,["prevent"])},{default:u(()=>[n(de,null,{default:u(()=>[n(se,null,{default:u(()=>[v("div",it,[v("div",ut,[n(J,{label:"Job Number",dense:"",modelValue:e.jobNumber,"onUpdate:modelValue":t[0]||(t[0]=i=>e.jobNumber=i),error:!!e.formErrors.jobNumber,"bottom-slots":""},{error:u(()=>[v("div",dt,L(e.formErrors.jobNumber),1)]),_:1},8,["modelValue","error"])]),v("div",ct,[n(ce,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craft,"onUpdate:modelValue":t[1]||(t[1]=i=>e.craft=i),options:e.crafts,"option-label":"10","display-value":`${e.craft?e.craft[10]:""}`},null,8,["modelValue","options","display-value"])]),v("div",mt,[n(J,{label:"Description",dense:"",modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=i=>e.description=i)},null,8,["modelValue"])])])]),_:1}),n(ge,{align:"right"},{default:u(()=>[n(C,{color:"secondary",label:"Cancel",onClick:t[3]||(t[3]=i=>e.$emit("cancelAddJobNumber"))}),n(C,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Ne=I(nt,[["render",pt]]);const ft=[{name:0,label:"Job Number",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Craft",align:"left",field:e=>e[15],format:e=>`${e}`,sortable:!0,required:!0}],bt=Q({components:{AddJobNumber:Ne},props:{project:String},setup(e){const t=x(),d=ee(),m=E(!0),f=E(!1),{getViewedProjects:g,updateViewedProjects:i}=te(),s=E(d.params.id?d.params.id:e.project);Ce(()=>d.params.id,o=>{s.value=d.params.id});const a=k(()=>g(s.value)),h=k(()=>{const o=a.value&&a.value.jobNumbers?a.value.jobNumbers:[];return o.length>0?o.sort((l,p)=>l[1].$d>p[1].$d?1:-1):o}),y=async o=>{if(m.value=!0,h.value.length===0||o){const{data:l}=await b.fetchFromProjectsApp({fields:[z({type:"jobNumbers",query:`{'6'.EX.'${s.value}'}AND{'29'.EX.'Active'}`})]});i({id:s.value,dataset:"jobNumbers",data:l})}m.value=!1};function V(o){console.log(o),t.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${o[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{r(o)})}async function r(o){try{const{data:l}=await b.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:o[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35}),p=h.value.filter(w=>w[3]!==l[0][35][3]);i({id:s.value,dataset:"jobNumbers",data:p}),t.notify({type:"positive",message:"Job Number Removed"})}catch(l){console.log(l),t.notify({type:"negative",message:"Something went wrong"})}}return y(),{projectData:a,jobNumberColumns:ft,rows:h,initialPagination:{rowsPerPage:E(10)},showAddJobNumber:f,removeRow:V,loadData:y,loading:m}}}),vt={class:"text-caption"};function yt(e,t,d,m,f,g){const i=U("add-job-number");return c(),N("div",null,[e.showAddJobNumber?R("",!0):(c(),$(be,{key:0,dense:"",title:"Job Numbers","title-class":"text-primary",style:{},columns:e.jobNumberColumns,rows:e.rows,"row-key":s=>s[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:u(()=>[n(fe,{label:"Loading...","label-class":"text-info"})]),"top-left":u(()=>[e.$can("create","projectJobNumbers")||e.$can("manage","projects")?(c(),$(C,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=s=>e.showAddJobNumber=!0)})):R("",!0)]),"top-right":u(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=s=>e.loadData(!0))})]),header:u(s=>[n(Z,{class:"bg-dark text-white",props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(K,{class:"text-left",key:a.name},{default:u(()=>[re(L(a.label),1)]),_:2},1024))),128)),n(K,{"auto-width":""})]),_:2},1032,["props"])]),body:u(s=>[n(Z,{props:s},{default:u(()=>[n(Me,{anchor:"top middle",self:"top middle"},{default:u(()=>[re("Description: "+L(s.row[20]),1)]),_:2},1024),(c(!0),N(H,null,Y(s.cols,a=>(c(),$(_,{key:a.name,props:s},{default:u(()=>[v("span",vt,L(a.value),1)]),_:2},1032,["props"]))),128)),n(_,{"auto-width":""},{default:u(()=>[e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(c(),$(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(s.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJobNumber?(c(),$(i,{key:1,project:e.projectData,onJobNumberAdded:t[2]||(t[2]=s=>e.showAddJobNumber=!1),onCancelAddJobNumber:t[3]||(t[3]=s=>e.showAddJobNumber=!1)},null,8,["project"])):R("",!0)])}var gt=I(bt,[["render",yt]]);const wt=[{name:0,label:"Rule",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Miles",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0,required:!0},{name:2,label:"Amount",align:"left",field:e=>e[10],format:e=>e?`$ ${e.toFixed(2)}`:"",sortable:!0,required:!0}],$t=Q({components:{AddJobNumber:Ne},props:{project:String},setup(e){const t=x(),d=ee(),m=E(!0),{getViewedProjects:f,updateViewedProjects:g}=te(),i=k(()=>d.params.id?d.params.id:e.project),s=k(()=>f(i.value)),a=k(()=>(s.value&&s.value.perDiem?s.value.perDiem:[]).sort((p,w)=>p[1].$d>w[1].$d?1:-1)),h=async l=>{if(m.value=!0,a.value.length===0||l){const{data:p}=await b.fetchFromProjectsApp({fields:[z({type:"perDiemSpecs",query:`{'12'.EX.'${i.value}'}AND{'38'.EX.'Active'}`})]});g({id:i.value,dataset:"perDiem",data:p})}m.value=!1},y=E(!1),{removeObject:V}=Fe();k(()=>(s.value&&s.value.jobNumbers?s.value.jobNumbers:[]).sort((p,w)=>p[1].$d>w[1].$d?1:-1));function r(l){console.log(l),t.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${l[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{o(l)})}async function o(l){try{const{data:p}=await b.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:l[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35});V({array:"jobNumbers",object:p[0][35]})}catch(p){console.log(p),t.notify({type:"negative",message:"Something went wrong"})}}return h(),{projectData:s,columns:wt,rows:a,initialPagination:{rowsPerPage:E(8)},showAddJobNumber:y,removeRow:r,loadData:h,loading:m}}}),ht={class:"text-caption"};function jt(e,t,d,m,f,g){const i=U("add-job-number");return c(),N("div",null,[e.showAddJobNumber?R("",!0):(c(),$(be,{key:0,dense:"",title:"Per-Diem","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":s=>s[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:u(()=>[n(fe,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":u(()=>[e.$can("create","projectPerDiem")||e.$can("manage","projects")?(c(),$(C,{key:0,disable:"",dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=s=>e.showAddJobNumber=!0)})):R("",!0)]),"top-right":u(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=s=>e.loadData(!0))})]),header:u(s=>[n(Z,{class:"bg-dark text-white",props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(K,{class:"text-left",key:a.name},{default:u(()=>[re(L(a.label),1)]),_:2},1024))),128)),n(K,{"auto-width":""})]),_:2},1032,["props"])]),body:u(s=>[n(Z,{props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(_,{key:a.name,props:s},{default:u(()=>[v("span",ht,L(a.value),1)]),_:2},1032,["props"]))),128)),n(_,{"auto-width":""},{default:u(()=>[e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(c(),$(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(s.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJobNumber?(c(),$(i,{key:1,onJobNumberAdded:t[2]||(t[2]=s=>e.showAddJobNumber=!1),onCancelAddJobNumber:t[3]||(t[3]=s=>e.showAddJobNumber=!1)})):R("",!0)])}var Ct=I($t,[["render",jt]]);const At=Q({emits:["cancelAdd","addComplete"],props:{project:Object},setup(e,{emit:t}){const d=x(),m=ee(),{getViewedProjects:f,updateViewedProjects:g}=te(),i=k(()=>m.params.id?m.params.id:e.project[3]?e.project[3]:null),s=k(()=>i.value?f(i.value):null),a=D({name:M().required().label("Location Name"),street1:M().required().label("Street Address 1"),street2:M(),city:M().required().label("City"),state:M().required().label("State"),postal:M().required().label("Postal Code")}),{meta:h,errors:y,handleSubmit:V,handleReset:r}=pe({validationSchema:a}),{value:o}=O("name"),{value:l}=O("street1"),{value:p}=O("street2"),{value:w}=O("city"),{value:X}=O("state"),{value:P}=O("postal"),j=V(async q=>{const T={6:{value:q.name},8:{value:q.street1},9:{value:q.street2?q.street2:""},10:{value:q.city},11:{value:q.state},12:{value:q.postal},13:{value:"United States"}};s.value[8]&&Object.assign(T,{15:{value:s.value[8]}});try{const{data:W}=await b.upsertRecordsXML({to:"bp5d2twyj",data:[T],fieldsToReturn:[22],formatObject:22}),ve=s.value.meetingLocations;ve.push(W[0][22]),g({id:i.value,dataset:"meetingLocations",data:ve}),d.notify({type:"positive",message:`Meeting location ${W[0][22][6]} successfully added`}),t("addComplete"),r()}catch(W){console.log(W),d.notify({type:"negative",message:"Something went wrong!"})}});return{projectObject:s,formErrors:y,formMeta:h,submit:j,name:o,street1:l,street2:p,city:w,state:X,postal:P,states:Je}}}),kt={class:"row"},Nt={class:"col-6 col-md-12"},Rt={class:"text-caption"},Lt={class:"text-caption"},Vt={class:"text-caption"},Et={class:"text-caption"},qt={class:"text-caption"};function Pt(e,t,d,m,f,g){return c(),N("div",null,[n(me,{onSubmit:ue(e.submit,["prevent"])},{default:u(()=>[n(de,null,{default:u(()=>[n(se,null,{default:u(()=>[v("div",kt,[v("div",Nt,[n(J,{label:"Location Name",dense:"",modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=i=>e.name=i),error:!!e.formErrors.name,"bottom-slots":""},{error:u(()=>[v("div",Rt,L(e.formErrors.name),1)]),_:1},8,["modelValue","error"]),n(J,{label:"Street Address 1",dense:"",modelValue:e.street1,"onUpdate:modelValue":t[1]||(t[1]=i=>e.street1=i),error:!!e.formErrors.street1,"bottom-slots":""},{error:u(()=>[v("div",Lt,L(e.formErrors.street1),1)]),_:1},8,["modelValue","error"]),n(J,{label:"Street Address 2",dense:"",modelValue:e.street2,"onUpdate:modelValue":t[2]||(t[2]=i=>e.street2=i),error:!!e.formErrors.street2,"bottom-slots":""},{error:u(()=>[v("div",Vt,L(e.formErrors.street2),1)]),_:1},8,["modelValue","error"]),n(J,{label:"City",dense:"",modelValue:e.city,"onUpdate:modelValue":t[3]||(t[3]=i=>e.city=i),error:!!e.formErrors.city,"bottom-slots":""},{error:u(()=>[v("div",Et,L(e.formErrors.city),1)]),_:1},8,["modelValue","error"]),n(ce,{dense:"",label:"State","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.state,"onUpdate:modelValue":t[4]||(t[4]=i=>e.state=i),options:e.states,"bottom-slots":""},null,8,["modelValue","options"]),n(J,{label:"Postal Code",dense:"",modelValue:e.postal,"onUpdate:modelValue":t[5]||(t[5]=i=>e.postal=i),error:!!e.formErrors.postal,"bottom-slots":""},{error:u(()=>[v("div",qt,L(e.formErrors.postal),1)]),_:1},8,["modelValue","error"])])])]),_:1}),n(ge,{align:"right"},{default:u(()=>[n(C,{color:"secondary",label:"Cancel",onClick:t[6]||(t[6]=i=>e.$emit("cancelAdd"))}),n(C,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var St=I(At,[["render",Pt]]);const Dt=[{name:0,label:"Location Name",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0},{name:1,label:"Address",align:"left",field:e=>e[8],format:e=>`${e}`,sortable:!1,required:!0}],Ot=Q({components:{AddMeetingLocation:St},props:{project:String},setup(e){const t=x(),d=ee(),m=E(!0),f=E(!1),{getViewedProjects:g,updateViewedProjects:i}=te(),s=k(()=>d.params.id?d.params.id:e.project),a=k(()=>g(s.value)),h=k(()=>a.value&&a.value.meetingLocations?a.value.meetingLocations:[]),y=async o=>{if(m.value=!0,(h.value.length===0||o)&&a.value){const{data:l}=await b.fetchFromStructureApp({fields:[oe({type:"meetingLocations",query:`{'15'.EX.'${a.value[8]}'}AND{'14'.EX.'Active'}`})]});i({id:s.value,dataset:"meetingLocations",data:l})}m.value=!1};function V(o){console.log(o),t.dialog({title:"Confirm",message:`Are you sure you want to remove location ${o[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{r(o)})}async function r(o){try{const{data:l}=await b.upsertRecordsXML({to:"bp5d2twyj",data:[{3:{value:o[3]},14:{value:"Inactive"}}],fieldsToReturn:[22],formatObject:22}),p=h.value.filter(w=>w[3]!==l[0][22][3]);i({id:s.value,dataset:"meetingLocations",data:p}),t.notify({type:"positive",message:"Meeting Location Removed"})}catch(l){console.log(l),t.notify({type:"negative",message:"Something went wrong"})}}return y(),{projectData:a,columns:Dt,rows:h,initialPagination:{rowsPerPage:E(8)},showAdd:f,removeRow:V,loadData:y,loading:m}}}),Xt={class:"text-caption"};function Tt(e,t,d,m,f,g){const i=U("add-meeting-location");return c(),N("div",null,[e.showAdd?R("",!0):(c(),$(be,{key:0,dense:"",title:"Meeting Locations","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":s=>s[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:u(()=>[n(fe,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":u(()=>[n(C,{dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=s=>e.showAdd=!0)})]),"top-right":u(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=s=>e.loadData(!0))})]),header:u(s=>[n(Z,{class:"bg-dark text-white",props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(K,{class:"text-left",key:a.name},{default:u(()=>[re(L(a.label),1)]),_:2},1024))),128)),n(K,{"auto-width":""})]),_:2},1032,["props"])]),body:u(s=>[n(Z,{props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(_,{key:a.name,props:s},{default:u(()=>[v("span",Xt,L(a.value),1)]),_:2},1032,["props"]))),128)),n(_,{"auto-width":""},{default:u(()=>[n(C,{color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(s.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),$(i,{key:1,onAddComplete:t[2]||(t[2]=s=>e.showAdd=!1),onCancelAdd:t[3]||(t[3]=s=>e.showAdd=!1)})):R("",!0)])}var Ut=I(Ot,[["render",Tt]]);const Mt=Q({emits:["addComplete","cancelAdd"],props:{project:Object,current:Array},setup(e,{emit:t}){const d=x(),m=ee(),{capitalize:f}=Ae,g=E([]),{setRosters:i,getManpowerData:s}=te(),a=k(()=>m.params.id?m.params.id:e.project&&e.project[3]?e.project[3]:null),h=k(()=>(s({dataset:"rosters",id:a.value})||[]).sort((q,T)=>q[75]>T[75]?1:-1)),y=P=>{const j=P.split(" ");let q="";return j.forEach((T,W)=>{q+=W>0?` ${f(T.toLowerCase())}`:f(T.toLowerCase())}),q},V=async()=>{if(a.value&&h.value.length===0){const P=`{'74'.EX.'${a.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:j}=await b.fetchFromHiringApp({fields:[Xe({type:"assignments",query:P})]});i({id:a.value,data:j}),g.value=j}else g.value=h.value},r=D({entry:D().required().label("Contact")}),{errors:o,handleSubmit:l}=pe({validationSchema:r}),{value:p}=O("entry"),w=l(async P=>{if(e.current.filter(j=>j[18]===P.entry[18]).length>0)d.notify({type:"negative",message:"This employee is already a site contact!"}),t("cancelAdd");else try{const{data:j}=await b.upsertRecordsXML({to:"bp5hcce69",data:[{7:{value:a.value},18:{value:P.entry[18]}}],fieldsToReturn:[27],formatObject:27});t("addComplete",j[0][27]),d.notify({type:"positive",message:`Contact ${y(j[0][27][17])} successfully added`})}catch(j){console.log(j),d.notify({type:"negative",message:"Something went wrong!"})}}),X=(P,j)=>{if(P===""){j(()=>{g.value=h.value});return}j(()=>{const q=P.toLowerCase();g.value=h.value.filter(T=>T[75].toLowerCase().indexOf(q)>-1)})};return V(),{entry:p,options:g,formErrors:o,submit:w,filterOptions:X,properValue:y}}}),Ft={class:"text-caption"};function Jt(e,t,d,m,f,g){return c(),N("div",null,[n(me,{onSubmit:ue(e.submit,["prevent"])},{default:u(()=>[n(de,null,{default:u(()=>[n(se,null,{default:u(()=>[n(ce,{class:"q-mb-sm",dense:"",label:"Select New Contact","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":t[0]||(t[0]=i=>e.entry=i),options:e.options,"option-label":i=>i?e.properValue(i[75]):"","display-value":e.entry?`${e.entry[75]}`:"","bottom-slots":"",error:!!e.formErrors.entry,"use-input":"","input-debounce":"0",onFilter:e.filterOptions},{error:u(()=>[v("div",Ft,L(e.formErrors.entry),1)]),_:1},8,["modelValue","options","option-label","display-value","error","onFilter"])]),_:1}),n(ge,{align:"right"},{default:u(()=>[n(C,{color:"secondary",label:"Cancel",onClick:t[1]||(t[1]=i=>e.$emit("cancelAdd"))}),n(C,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Qt=I(Mt,[["render",Jt]]);const{capitalize:je}=Ae,$e=e=>{const t=e.split(" ");let d="";return t.forEach((m,f)=>{d+=f>0?` ${je(m.toLowerCase())}`:je(m.toLowerCase())}),d},It=[{name:0,label:"Name",align:"left",field:e=>e[17],format:e=>`${$e(e)}`,sortable:!0},{name:1,label:"Phone",align:"left",field:e=>e[20],format:e=>e!==""?`${e}`:"N/A",sortable:!0,required:!0}],zt=Q({components:{AddSiteContact:Qt},props:{project:String},setup(e){const t=x(),d=ee(),m=E(!0),{getViewedProjects:f,updateViewedProjects:g}=te(),i=k(()=>d.params.id?d.params.id:e.project),s=k(()=>f(i.value)),a=k(()=>(s.value&&s.value.siteContacts?s.value.siteContacts:[]).sort((p,w)=>p[17]>w[17]?1:-1)),h=async l=>{if(m.value=!0,a.value.length===0||l){const{data:p}=await b.fetchFromProjectsApp({fields:[z({type:"siteContacts",query:`{'7'.EX.'${i.value}'}AND{'6'.EX.'Active'}`})]});g({id:i.value,dataset:"siteContacts",data:p})}m.value=!1},y=E(!1);function V(l){t.dialog({title:"Confirm",message:`Are you sure you want to remove contact ${$e(l[17])}?`,cancel:!0,persistent:!0}).onOk(()=>{r(l)})}async function r(l){try{const{data:p}=await b.upsertRecordsXML({to:"bp5hcce69",data:[{3:{value:l[3]},6:{value:"Inactive"}}],fieldsToReturn:[27],formatObject:27}),w=a.value.filter(X=>X[3]!==p[0][27][3]);g({id:i.value,dataset:"siteContacts",data:w}),t.notify({type:"positive",message:"Contact Removed"})}catch(p){console.log(p),t.notify({type:"negative",message:"Something went wrong"})}}const o=l=>{g({id:i.value,dataset:"siteContacts",data:[l],push:!0}),y.value=!1};return h(),{projectData:s,columns:It,rows:a,initialPagination:{rowsPerPage:E(8)},showAdd:y,removeRow:V,loadData:h,loading:m,properValue:$e,contactAdded:o}}}),Wt={class:"text-caption"};function Bt(e,t,d,m,f,g){const i=U("add-site-contact");return c(),N("div",null,[e.showAdd?R("",!0):(c(),$(be,{key:0,dense:"",title:"Contacts","title-class":"text-primary",style:{"max-height":"300px"},columns:e.columns,rows:e.rows,"row-key":s=>s[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:u(()=>[n(fe,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":u(()=>[e.$can("create","projectContacts")||e.$can("manage","projects")?(c(),$(C,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=s=>e.showAdd=!0)})):R("",!0)]),"top-right":u(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=s=>e.loadData(!0))})]),header:u(s=>[n(Z,{class:"bg-dark text-white",props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(K,{class:"text-left",key:a.name},{default:u(()=>[re(L(a.label),1)]),_:2},1024))),128)),n(K,{"auto-width":""})]),_:2},1032,["props"])]),body:u(s=>[n(Z,{props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(_,{key:a.name,props:s},{default:u(()=>[v("span",Wt,L(a.value),1)]),_:2},1032,["props"]))),128)),n(_,{"auto-width":""},{default:u(()=>[e.$can("manage","projectContacts")||e.$can("manage","projects")?(c(),$(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(s.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),$(i,{key:1,current:e.rows,project:e.projectData,onAddComplete:e.contactAdded,onCancelAdd:t[2]||(t[2]=s=>e.showAdd=!1)},null,8,["current","project","onAddComplete"])):R("",!0)])}var Gt=I(zt,[["render",Bt]]);const Ht=Q({components:{},props:{project:Object},setup(e,t){const d=x(),m=E(10),f=E(null),{getUser:g}=De(ke()),i=E(null),s=k(()=>{const A=new RegExp("^[0-9]{"+m.value+"}","g");return D({firstName:M().required().label("First Name"),lastName:M().required().label("Last Name"),email:M().email().required().label("Email"),phoneNumber:M().matches(A,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),role:D().required().nullable().label("Role"),workdayId:M().required().label("Workday ID")})}),{meta:a,errors:h,handleSubmit:y,handleReset:V}=pe({validationSchema:s}),{value:r}=O("firstName"),{value:o}=O("lastName"),{value:l}=O("email"),{value:p}=O("phoneNumber"),{value:w}=O("role"),{value:X}=O("workdayId");async function P({accessID:A}){const{data:F}=await b.upsertRecordsXML({to:"br598isx6",data:[{3:{value:A},20:{value:!0}}],fieldsToReturn:[28],formatObject:28});t.emit("userAdded",{user:F[0][28]}),d.loading.hide(),V()}async function j(A,F){b.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:A},10:{value:"Active"},11:{value:F}}]});const{data:le}=await b.fetchFromStructureApp({fields:[{6:{value:"br598isx6"},7:{value:"Table Query"},8:{value:`{'6'.EX.${A}}`},9:{value:1},14:{value:24}}]});if(new Set(le.filter(G=>G[7]==="Project").map(G=>G[9])).has(e.project[3])){const G=le.find(we=>we[9]===e.project[3]);P({accessID:G[3]})}else return!1}async function q(A){const F=`{'6'.EX.'${A.email}'}AND{'8'.EX.'${A.phoneNumber}'}AND{'32'.EX.'${A.userType}'}`,le=[{7:{value:"User Request"},8:{value:F},9:{value:1},14:{value:77}}];if(F==="{'10'.EX.'Active'}AND{'32'.EX.'Candidate'}"||F==="{'10'.EX.'Active'}AND{'32'.EX.'Project User'}")throw{response:{data:{errtext:"Unknown username",errdetail:"Sorry! Something's wrong. Try again."}}};const{data:B}=await b.fetchFromStructureApp({fields:le});if(B.length<1)return null;if(!await j(B[0][3],A.role))return B}const T=y(async A=>{d.loading.show();const F={userType:"Project User",phoneNumber:`+${f.value?f.value.dialCode:"1"}${A.phoneNumber}`,email:A.email,role:A.role[3]};if(e.project.users.filter(B=>B[6]===F.email||B[8]===F.phoneNumber).length>0)d.dialog({title:"Alert",message:"Your project already has a user with that phone or email."}).onOk(()=>{t.emit("userCanceled")});else{const B=await q(F);if(console.log(B),B){const{data:G}=await b.upsertRecordsXML({to:"br598isx6",data:[{6:{value:B[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});G.length>0&&t.emit("userAdded",{user:G[0][28]})}else{const G=l.value.match(/^([^@]*)@/)[1],we=Object.assign({phoneNumber:p.value},f.value),{data:he}=await b.upsertRecordsXML({to:"br4pxrbs6",data:[{6:{value:A.email},7:{value:"temp"},8:{value:`+${f.value?f.value.dialCode:"1"}${A.phoneNumber}`},9:{value:JSON.stringify(we)},10:{value:"Active"},11:{value:A.role[3]},17:{value:!0},23:{value:g.value[3]},24:{value:g.value[3]},25:{value:new Date},26:{value:new Date},32:{value:"Project User"},33:{value:G},35:{value:r.value},37:{value:o.value},49:{value:!0},50:{value:!0},70:{value:A.workdayId}}],fieldsToReturn:[3,96],formatObject:96});if(he[0]!==void 0){const ye=await b.upsertRecordsXML({to:"br598isx6",data:[{6:{value:he[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});ye.data[0]!==void 0&&d.dialog({title:"Confirm",message:"User successfully added. Would you like to send them an invite?",cancel:!0,persistent:!0}).onOk(async()=>{(await b.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:ye.data[0][28][3]},93:{value:new Date}}],fieldsToReturn:[3]})).data[0]!==void 0&&(d.notify({type:"positive",message:"User invite submitted"}),t.emit("userAdded",{user:ye.data[0][28]}))}).onCancel(()=>{t.emit("userAdded",{user:ye.data[0][28]})})}}}V(),d.loading.hide()}),W=k(()=>{const A=e.project.users.map(F=>F[9].phoneNumber);return new Set(A)});Ce(p,A=>{W.value.has(A)&&d.notify({type:"negative",message:"Phone Number is already in use!",timeout:1e4,position:d.screen.lt.md?"top":"center"})});const ve=A=>{f.value=A},Re=A=>{m.value=A};function Le(){V(),t.emit("userCanceled")}async function Ve(){d.loading.show();const{data:A}=await b.fetchFromStructureApp({fields:[{6:{value:"br5v4in72"},7:{value:"Table Query"},8:{value:"{'7'.EX.'Projects'}AND{'15'.EX.'Active'}AND{'17'.EX.true}"},9:{value:1},14:{value:18}}]});i.value=A,d.loading.hide()}return Ve(),{updateCountry:ve,updatePhoneMaxLength:Re,firstName:r,lastName:o,email:l,phoneNumber:p,role:w,workdayId:X,formMeta:a,formErrors:h,submitUser:T,roleOptions:i,cancel:Le}}}),Yt=v("div",{class:"text-primary text-h6"},"Add a New User",-1),Kt=v("div",{class:"text-accent text-body2 text-italic q-mb-md"},"All info is required.",-1),Zt={class:"row justify-between"},_t={class:"row justify-between"},xt={class:"text-caption"},ea={class:"row justify-between"},ta={class:"text-caption"},aa={class:"text-caption"};function oa(e,t,d,m,f,g){return c(),N("div",null,[n(de,null,{default:u(()=>[n(me,{onSubmit:ue(e.submitUser,["prevent"])},{default:u(()=>[n(se,null,{default:u(()=>[Yt,Kt,v("div",Zt,[v("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(J,{dense:"",outlined:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=i=>e.firstName=i),error:!!e.formErrors.firstName},null,8,["modelValue","error"])],2),v("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(J,{dense:"",outlined:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=i=>e.lastName=i),error:!!e.formErrors.lastName},null,8,["modelValue","error"])],2)]),v("div",_t,[v("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(J,{dense:"",outlined:"",label:"Workday ID",modelValue:e.workdayId,"onUpdate:modelValue":t[2]||(t[2]=i=>e.workdayId=i),error:!!e.formErrors.workdayId},null,8,["modelValue","error"])],2),v("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(J,{dense:"",outlined:"",label:"Phone Number",modelValue:e.phoneNumber,"onUpdate:modelValue":t[3]||(t[3]=i=>e.phoneNumber=i),error:!!e.formErrors.phoneNumber,"bottom-slots":""},{error:u(()=>[v("div",xt,L(e.formErrors.phoneNumber),1)]),_:1},8,["modelValue","error"])],2)]),v("div",ea,[v("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(J,{dense:"",outlined:"",label:"Email","bottom-slots":"",modelValue:e.email,"onUpdate:modelValue":t[4]||(t[4]=i=>e.email=i),error:!!e.formErrors.email},{error:u(()=>[v("div",ta,L(e.formErrors.email),1)]),_:1},8,["modelValue","error"])],2),v("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(ce,{dense:"",outlined:"",label:"Role","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.role,"onUpdate:modelValue":t[5]||(t[5]=i=>e.role=i),options:e.roleOptions,"option-label":"6","display-value":`${e.role?e.role[6]:""}`,"bottom-slots":"",error:!!e.formErrors.role},{error:u(()=>[v("div",aa,L(e.formErrors.role),1)]),_:1},8,["modelValue","options","display-value","error"])],2)])]),_:1}),n(ge,{align:"right"},{default:u(()=>[n(C,{color:"secondary",onClick:e.cancel,label:"Cancel"},null,8,["onClick"]),n(C,{color:"primary",type:"submit",label:"Submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])}var ra=I(Ht,[["render",oa]]);const sa=[{name:1,label:"Name",align:"left",field:e=>e[35],format:(e,t)=>`${e} ${t[37]}`,sortable:!0},{name:2,label:"Role",align:"left",field:e=>e[44],format:e=>`${e}`,sortable:!0}],la=Q({components:{AddUser:ra},props:{project:String},setup(e){const t=x(),d=ee(),m=E(!0),f=E(!1),{getViewedProjects:g,updateViewedProjects:i}=te(),{userData:s}=ke(),a=k(()=>d.params.id?d.params.id:e.project),h=k(()=>g(a.value)),y=k(()=>(h.value&&h.value.users?h.value.users:[]).filter(w=>w[3]!==s[3]).sort((w,X)=>w[1].$d>X[1].$d?1:-1)),V=async p=>{if(m.value=!0,y.value.length===0||p){const{data:w}=await b.fetchFromStructureApp({fields:[oe({type:"userAccess",query:`{'9'.EX.'${a.value}'}AND{'20'.EX.true}`})]});i({id:a.value,dataset:"users",data:w})}m.value=!1};function r(p){console.log(p),t.dialog({title:"Confirm",message:`Are you sure you want to remove user ${p[35]} ${p[37]}?`,cancel:!0,persistent:!0}).onOk(()=>{l(p)})}function o({user:p}){t.notify({type:"positive",message:"User successfully added!"}),f.value=!1;const w=h.value.users;w.push(p),i({id:a.value,dataset:"users",data:w})}async function l(p){const{data:w}=await b.fetchFromStructureApp({fields:[oe({type:"userAccessObject",query:`{'6'.EX.'${p[3]}'}AND{'7'.EX.'Project'}AND{'9'.EX.'${a.value}'}`})]}),X=[];w.forEach(j=>{const q={3:{value:j[3]},20:{value:!1},38:{value:!1},39:{value:!1},40:{value:!1},41:{value:!1}};X.push(q)}),b.upsertRecordsXML({to:"br598isx6",data:X,fieldsToReturn:[3]});const P=y.value.filter(j=>j[3]!==p[3]);i({id:a.value,dataset:"users",data:P}),t.notify({type:"positive",message:"User Removed"})}return V(),{projectData:h,columns:sa,rows:y,initialPagination:{rowsPerPage:E(8)},showAdd:f,removeRow:r,loadData:V,loading:m,userAdded:o}}}),na={class:"text-caption"};function ia(e,t,d,m,f,g){const i=U("add-user");return c(),N("div",null,[e.showAdd?R("",!0):(c(),$(be,{key:0,dense:"",title:"Users","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":s=>s[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:u(()=>[n(fe,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":u(()=>[e.$can("create","users")?(c(),$(C,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=s=>e.showAdd=!0)})):R("",!0)]),"top-right":u(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=s=>e.loadData(!0))})]),header:u(s=>[n(Z,{class:"bg-dark text-white",props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(K,{class:"text-left",key:a.name},{default:u(()=>[re(L(a.label),1)]),_:2},1024))),128)),n(K,{"auto-width":""})]),_:2},1032,["props"])]),body:u(s=>[n(Z,{props:s},{default:u(()=>[(c(!0),N(H,null,Y(s.cols,a=>(c(),$(_,{key:a.name,props:s},{default:u(()=>[v("span",na,L(a.value),1)]),_:2},1032,["props"]))),128)),n(_,{"auto-width":""},{default:u(()=>[e.$can("manage","users")?(c(),$(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(s.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),$(i,{key:1,onUserAdded:e.userAdded,onUserCanceled:t[2]||(t[2]=s=>e.showAdd=!1),project:e.projectData},null,8,["onUserAdded","project"])):R("",!0)])}var ua=I(la,[["render",ia]]);const da=Q({components:{DetailsCard:lt,JobNumbers:gt,PerDiem:Ct,MeetingLocations:Ut,SiteContacts:Gt,Users:ua},setup(e,{emit:t}){const d=x(),m=E(0),f=ee(),{getViewedProjects:g,updateViewedProjects:i,setViewedProjects:s}=te(),a=k(()=>g(f.params.id));(async()=>{if(!a.value){const{data:r}=await b.fetchFromProjectsApp({fields:[z({type:"projects",id:f.params.id})]});s({id:f.params.id,data:r})}})();const y=r=>{const o=[];for(const[l,p]of Object.entries(r)){const w={fid:l,value:p};o.push(w)}i({id:a.value[3],props:o})};return{details:k(()=>a.value?[{label:"Date Created",value:Oe(a.value[1].$d).format("MM/DD/YYYY hh:mm:ss a"),editable:!1},{label:"Project Name",value:a.value[20],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:a.value[20],formRules:M().required().label("Project Name"),fieldLabel:"Enter the Project Name",getter:null,setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},20:{value:r}}],fieldsToReturn:[20,43]});y(o[0]),d.notify({type:"positive",message:"Project Name successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Name"})}}}},{label:"Project Alias",value:a.value[44],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:a.value[44],formRules:M().required().label("Project Alias"),fieldLabel:"Enter the Project Alias",getter:null,setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},44:{value:r}}],fieldsToReturn:[44]});y(o[0]),d.notify({type:"positive",message:"Project Alias successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Alias"})}}}},{label:"Customer",value:a.value[25],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"customer",initialValue:r=>r.find(o=>o[3]===a.value[9]),formRules:D().required().label("Customer").nullable(),fieldLabel:"Customer",optionLabel:"6",displayValue:6,getter:async()=>{const{data:r}=await b.fetchFromStructureApp({fields:[oe({type:"projectCustomers",query:"{'7'.EX.'Active'}"})]});return r.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},9:{value:r[3]}}],fieldsToReturn:[9,25]});y(o[0]),d.notify({type:"positive",message:"Customer successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Customer"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1)}},{label:"Job Site",value:a.value[24],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"location",initialValue:r=>r.find(o=>o[3]===a.value[8]),formRules:D().required().label("Job Site").nullable(),fieldLabel:"Job Site",optionLabel:"6",displayValue:6,getter:async()=>{const{data:r}=await b.fetchFromStructureApp({fields:[oe({type:"projectLocations",query:"{'51'.EX.true}"})]});return r.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},8:{value:r[3]}}],fieldsToReturn:[8,24,43,67,69,136]});y(o[0]),d.notify({type:"positive",message:"Job Site successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Job Site"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1)}},{label:"Address",value:a.value[67]},{label:"Sup Org Manager",value:a.value[245]},{label:"Primary Hiring Center",value:a.value[76],editable:!0,config:{permission:{action:"manage",subject:"hiringCenters"},type:"options",allowNew:!1,initialValue:r=>r.find(o=>o[3]===a.value[12]),formRules:D().required().label("Primary Hiring Center").nullable(),fieldLabel:"Hiring Center",optionLabel:"60",displayValue:60,getter:async()=>{const{data:r}=await b.fetchFromStructureApp({fields:[oe({type:"hiringCenters",query:"{'51'.EX.'Active'}"})]});return r.sort((o,l)=>o[60]>l[60]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},12:{value:r[3]}}],fieldsToReturn:[12,26,76]});y(o[0]),d.notify({type:"positive",message:"Hiring Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Hiring Center"})}},filter:(r,o)=>r.filter(l=>l[60].toLowerCase().indexOf(o)>-1)}},{label:"Workday Location",value:`${a.value[241]} (${a.value[242]})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(o=>o[3]===a.value[240]),formRules:D().required().label("Workday Location").nullable(),fieldLabel:"Workday Location",optionLabel:r=>`${r[6]} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await b.fetchFromProjectsApp({fields:[z({type:"workdayLocations",query:`{'14'.EX.true}AND{'45'.EX.'${a.value[136]}'}`})]});return r.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},240:{value:r[40]}}],fieldsToReturn:[240,241,242,257,258]});return y(o[0]),d.notify({type:"positive",message:"Workday Location successfully updated"}),!0}catch{d.notify({type:"negative",message:"Error updating Workday Location"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Supervisory Org",value:`${S(a.value[259])} (${S(a.value[244])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(o=>o[3]===a.value[243]),formRules:D().required().label("Supervisory Organization").nullable(),fieldLabel:"Supervisory Organization",optionLabel:r=>`${r[42]} (${r[6]}) - ${S(r[26])}`,displayValue:42,getter:async()=>{const{data:r}=await b.fetchFromProjectsApp({fields:[z({type:"supOrgs",query:`{'32'.EX.'Active'}AND{'44'.EX.'${a.value[272]}'}`})]});return r.sort((o,l)=>o[42]>l[42]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},243:{value:r[16]}}],fieldsToReturn:[243,244,245,259]});y(o[0]),d.notify({type:"positive",message:"Supervisory Organization successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Supervisory Organization"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[26].toLowerCase().indexOf(o)>-1||l[41].toLowerCase().indexOf(o)>-1||l[42].toLowerCase().indexOf(o)>-1)}},{label:"Company",value:`${S(a.value[286])} (${S(a.value[287])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(o=>o[3]===a.value[285]),formRules:D().required().label("Company").nullable(),fieldLabel:"Company",optionLabel:r=>`${S(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await b.fetchFromProjectsApp({fields:[z({type:"companies",query:`{'8'.EX.true}AND{'14'.EX.'${a.value[136]}'}`})]});return r.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},285:{value:r[10]}}],fieldsToReturn:[285,286,287]});y(o[0]),d.notify({type:"positive",message:"Company successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Company"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Workday Region",value:`${S(a.value[283])} (${S(a.value[284])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(o=>o[3]===a.value[282]),formRules:D().required().label("Workday Region").nullable(),fieldLabel:"Workday Region",optionLabel:r=>`${S(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await b.fetchFromProjectsApp({fields:[z({type:"workdayRegions",query:"{'8'.EX.true}"})]});return r.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},282:{value:r[9]}}],fieldsToReturn:[282,283,284]});y(o[0]),d.notify({type:"positive",message:"Region successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Region"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Workday Branch",value:`${S(a.value[289])} (${S(a.value[290])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(o=>o[3]===a.value[288]),formRules:D().required().label("Workday Branch").nullable(),fieldLabel:"Workday Branch",optionLabel:r=>`${S(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const r=a.value[264]===""?"Weekly":a.value[264],{data:o}=await b.fetchFromProjectsApp({fields:[z({type:"workdayBranches",query:`{'8'.EX.true}AND{'9'.EX.'${r}'}AND{'16'.EX.'${a.value[136]}'}`})]});return o.sort((l,p)=>l[6]>p[6]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},288:{value:r[12]}}],fieldsToReturn:[288,289,290]});y(o[0]),d.notify({type:"positive",message:"Branch successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Branch"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Pay Group",value:`${S(a.value[261])} (${S(a.value[262])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(o=>o[3]===a.value[260]),formRules:D().required().label("Workday Pay Group").nullable(),fieldLabel:"Workday Pay Group",optionLabel:r=>`${S(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await b.fetchFromProjectsApp({fields:[z({type:"workdayPayGroups",query:`{'8'.EX.'TRUE'}AND{'11'.EX.'Weekly'}AND{'21'.EX.'${a.value[136]}'}`})]});return r.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},260:{value:r[16]}}],fieldsToReturn:[260,261,262,263,264,272]});y(o[0]),d.notify({type:"positive",message:"Pay Group successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Pay Group"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Cost Center",value:`${S(a.value[276])} (${S(a.value[275])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(o=>o[3]===a.value[274]),formRules:D().required().label("Workday Cost Center").nullable(),fieldLabel:"Workday Cost Center",optionLabel:r=>`${S(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await b.fetchFromProjectsApp({fields:[z({type:"workdayCostCenters",query:`{'8'.EX.true}AND{'11'.EX.'${a.value[287]}'}`})]});return r.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async r=>{try{const{data:o}=await b.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},274:{value:r[22]}}],fieldsToReturn:[274,275,276]});y(o[0]),d.notify({type:"positive",message:"Cost Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Cost Center"})}},filter:(r,o)=>r.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}}]:[]),tab:m,project:a}}}),ca={class:"q-pa-sm"},ma={class:"row"},pa={class:"col-12 col-sm-7 q-px-xs"},fa={class:"col-12 col-sm-5 q-px-xs"};function ba(e,t,d,m,f,g){const i=U("details-card"),s=U("job-numbers"),a=U("meeting-locations"),h=U("site-contacts"),y=U("per-diem"),V=U("users");return c(),$(Pe,{style:{"max-width":"100vw"}},{default:u(()=>[v("div",ca,[v("div",ma,[v("div",pa,[n(i,{details:e.details,title:"Details"},null,8,["details"])]),v("div",fa,[n(qe,{class:"q-py-xs bg-info text-white shadow-2 rounded-borders",align:"left",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=r=>e.tab=r),dense:"","indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:u(()=>[n(ne,{name:0,label:"Job Numbers"}),n(ne,{name:1,label:"Locations"}),n(ne,{name:2,label:"Contacts"}),n(ne,{name:3,label:"Per Diem"}),n(ne,{name:4,label:"Users"})]),_:1},8,["modelValue"]),n(Ee,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=r=>e.tab=r),animated:"",class:"q-px-none"},{default:u(()=>[n(ie,{class:"q-px-xs",name:0},{default:u(()=>[n(s)]),_:1}),n(ie,{class:"q-px-xs",name:1},{default:u(()=>[n(a)]),_:1}),n(ie,{class:"q-px-xs",name:2},{default:u(()=>[n(h)]),_:1}),n(ie,{class:"q-px-xs",name:3},{default:u(()=>[n(y)]),_:1}),n(ie,{class:"q-px-xs",name:4},{default:u(()=>[n(V)]),_:1})]),_:1},8,["modelValue"])])])])]),_:1})}var to=I(da,[["render",ba]]);export{to as default};
