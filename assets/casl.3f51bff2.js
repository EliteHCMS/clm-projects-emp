var v=Object.defineProperty;var q=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var b=(u,t,e)=>t in u?v(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,f=(u,t)=>{for(var e in t||(t={}))P.call(t,e)&&b(u,e,t[e]);if(q)for(var e of q(t))R.call(t,e)&&b(u,e,t[e]);return u};import{f as E,P as h,k as c}from"./index.9cb4d69c.js";import{l as N}from"./index.1d555e96.js";import{S as L,a as k,q as a}from"./quickbase.c67a5ef5.js";import"./_commonjsHelpers.a26ce4be.js";import"./dayjs.9f14cc3f.js";import"./index.7dbe61ef.js";import"./localForage.178f4477.js";import"./api.7fe62952.js";import"./i18n.7a878e3d.js";const O=u=>u.matched.some(t=>k.can(t.meta.action||"read",t.meta.resource));var _=E(({app:u,router:t})=>{try{const n=new DeviceUUID().get();h.has("clm-qb-id")||h.set("clm-qb-id",n,{expires:"365d",secure:!0,sameSite:"Strict"})}catch(e){console.log(e)}u.config.globalProperties.$subject=L,u.use(N,k,{useGlobalProperties:!0}),t.beforeEach(async(e,n,i)=>{const r=await a.isUserLoggedIn(),s=Object.assign({},e.query);if(r||a.logout(),s.office_id?(a.setOfficeLocation({rid:s.office_id}),!!s.qr&(s.qr==="3422"||s.qr===3422)&&a.setCheckIn(!0)):s.qr&&s.type&&a.setEvent(s,!0),n.fullPath==="/"&&!n.name){const d=await a.getIpInfo();if(d){if(d.country!==c.country)try{a.fetchIpInfo()}catch{}}else try{a.fetchIpInfo()}catch{}if(r){if(await a.reloadUserInfo({reAuthenticate:!0}),e.path==="/login"&&await a.startPageEnabled()&&c.pageType==="Candidate Kiosk")return await a.logout(),i({name:"start"})}else if(c.pageType==="Candidate Kiosk"&&(await a.updateStore(),e.path==="/login"&&await a.startPageEnabled()&&c.pageType==="Candidate Kiosk"))return i({name:"start"})}if(!O(e)){const d=e.path!=="/",m=await a.startPageEnabled();return!r&&c.pageType==="Candidate Kiosk"&&m?i({name:"start"}):i(r?{name:"not-authorized"}:{name:"login",query:f({},d&&{redirect:e.path})})}if(c.pageType==="Candidate Kiosk"&&e.name!=="bookmarks"&&e.name!=="start"){const d=await a.bookmarksValid(),m=await a.bookMarksOnly();if(d&&m)return i({name:"bookmarks"})}if(e.name==="bookmarks"&&!await a.bookmarksValid())return a.clearBookmarks(),i("/");if(e.meta.redirectIfLoggedIn&&r)return i("/");const y=await a.phoneNumberRequired(r),p=await a.emailRequired(r),w=await a.verifyRequired(r),g=await a.employeeLinkRequired(r),o=await a.getUserFromStore(r),I=await a.getSocialRequired(r),l=await a.getEvent(r);if(y||p)return n.name==="update-information"&&r&&e.query.rid?(e.query.phoneNumber&&await a.setPhoneNumber(e.query.phoneNumber),e.query.email&&await a.setEmail(e.query.email),i({path:"/",query:{}})):e.name!=="update-information"?i({name:"update-information",query:f(f({rid:o[3]},y&&{phoneNumberRequired:!0}),p&&{emailRequired:!0})}):Object.keys(e.query).length===0&&n.name!=="update-information"?i({name:"update-information",query:f(f({rid:o[3]},y&&{phoneNumberRequired:!0}),p&&{emailRequired:!0})}):i();if(n.name==="update-information"&&Object.keys(e.query).length>=1)return i({path:"/",query:{}});if(w)return n.name==="code-confirmation"&&r&&e.query.code?(await a.setVerified(!0),i({path:"/"})):e.name!=="code-confirmation"?i({name:"code-confirmation",query:{p:o[9]?o[9].phoneNumber:o[8].replace(/[^0-9]/g,""),rid:o[3]}}):Object.keys(e.query).length===0&&n.name!=="code-confirmation"?i({name:"code-confirmation",query:{p:o[9]?o[9].phoneNumber:o[8].replace(/[^0-9]/g,""),rid:o[3]}}):i();if(g||I)return n.name==="verify-identity"&&r&&e.query.verify?(e.query.rid?await a.setIdentityVerified(e.query.rid):await a.setIdentityVerified(!1),i({path:"/",query:{}})):e.name!=="verify-identity"?i({name:"verify-identity",query:{rid:o[3]}}):Object.keys(e.query).length===0&&n.name!=="verify-identity"?i({name:"verify-identity",query:{rid:o[3]}}):i();if(e.name==="verify-identity"){if(!g)return i({path:"/"})}else if(e.name==="code-confirmation")return!r&&e.query.ac?i():i({path:"/"});return r&&l&&l.type==="Training"&&l.qr&&e.name!=="training"?i({name:"training",query:l}):i()}),t.afterEach(async(e,n)=>{const i=await a.isUserLoggedIn();n.fullPath==="/"&&!n.name&&i&&await a.updateStore({reAuthenticate:!1})})});export{_ as default};
