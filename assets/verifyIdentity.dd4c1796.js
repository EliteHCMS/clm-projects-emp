import{Q as z}from"./QImg.d041d423.js";import{_ as H,c1 as G,c5 as J,c4 as W,r as x,c as Z,w as ee,z as b,am as _,bh as o,A as ae,d as r,an as C,C as m,c2 as h,aa as A,bE as te,bD as se,cx as Q,a6 as i,b as V,bX as N,cy as re,c6 as oe,c3 as le}from"./index.5d9ecb6c.js";import{Q as ie}from"./QForm.f178c5b4.js";import{Q as ne}from"./QPage.d5aae801.js";import{a as ue,e as ce,c as L,d as de,b as me,u as U}from"./array.329de675.js";import{u as pe}from"./i18n.39517f01.js";import{u as fe,e as ve,c as ge,q as u}from"./quickbase.11eb57f3.js";import{_ as ye}from"./languageSelector.83f48c34.js";import{c as be}from"./carousel.2855e2be.js";import"./_commonjsHelpers.dfee5925.js";import"./dayjs.4e8a1aff.js";import"./localForage.70fc081b.js";import"./index.7dbe61ef.js";import"./api.744a6f79.js";import"./QSelect.7ab405ec.js";import"./QChip.64fb8da5.js";import"./QMenu.3ff7d2cc.js";import"./position-engine.ef583924.js";import"./selection.b864be86.js";import"./rtl.65b79c69.js";import"./use-quasar.5aa4bbf6.js";import"./use-panel.cc6726f0.js";import"./touch.d8ab472d.js";import"./use-fullscreen.47c5ff5d.js";const he={key:0,class:"col-md-7 col-lg-8 col-lx-8"},we={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},_e={class:"text-dark"},Ce={class:"row"},Ie={class:"row"},qe={class:"text-grey-6"},xe={class:"row justify-center"},Ne={__name:"verifyIdentity",setup(Ue){const a=fe(),{employeeData:$,socialRequired:k,updateEmployeeData:j,setEmployee:X}=ve(),D=ge(),{getCountry:n}=G(D),f=J(),v=W(),{t:c}=pe(),d=x(!1),I=x("confirm-identity"),B=Z(()=>ue({userRID:ce().required(),ssn:L().required().matches(/^[0-9]{9}/g,{excludeEmptyString:!0,message:`${c("nineDigitsRequired")}`}).nullable().label(`${n.value==="CA"?c("socialInsuranceNumber"):c("socialSecurityNumber")}`),ssnConfirmation:L().oneOf([de("ssn"),null],`${n.value==="CA",c("socialInsuranceNumberMustMatch")}`).required().nullable().label(`${n.value==="CA"?c("socialInsuranceNumberConfirmation"):c("socialSecurityNumberConfirmation")}`)})),{errors:$e,meta:S}=me({validationSchema:B,initialValues:{ssn:"",ssnConfirmation:""}}),{value:g}=U("userRID"),{value:l,errorMessage:R,meta:O}=U("ssn"),{value:y,errorMessage:M,meta:F}=U("ssnConfirmation"),w=x(!0);f.query.rid?(g.value=f.query.rid,l.value="",y.value="",v.replace({query:{}})):v.push("/"),ee(()=>f.query,()=>{f.query.rid&&(g.value=f.query.rid,l.value="",y.value="",v.replace({query:{}}))});const T=async()=>{const e=u.getOfficeLocation(),t=[{20:{value:a.getUser[35]},22:{value:a.getUser[37]},...n.value==="CA"?{564:{value:l.value}}:{109:{value:l.value}},25:{value:a.getUser[9]?a.getUser[9].phoneNumber:a.getUser[8].replace(/[^0-9]/g,"")},28:{value:a.getUser[50]?"Yes":"No"},26:{value:a.getUser[6]},34:{value:a.getUser[49]?"Yes":"No"},16:{value:e?e.rid:""}}],{data:s}=await u.upsertRecordsXML({to:"bp3gb7ng2",fieldsToReturn:[500],data:t,formatObject:500}),p=s[0][500];return a.userLoggedIn&&X(p,!0),p[3]},q=async e=>{const t=u.getOfficeLocation(),s={3:{value:e},20:{value:a.getUser[35]},22:{value:a.getUser[37]},...n.value==="CA"?{564:{value:l.value}}:{109:{value:l.value}},25:{value:a.getUser[9]?a.getUser[9].phoneNumber:a.getUser[8].replace(/[^0-9]/g,"")},28:{value:a.getUser[50]?"Yes":"No"},26:{value:a.getUser[6]},34:{value:a.getUser[49]?"Yes":"No"},...t&&{16:{value:t.rid}}};return(await j({fields:s}))[3]},Y=async e=>{const t=[{3:{value:a.getUser[86]},16:{value:e}}],{data:s}=await u.upsertRecordsXML({to:"br26nivmr",fieldsToReturn:[76],data:t,formatObject:76});return u.setCheckInData(s[0][76]),s[3]},K=async()=>{const t=[{8:{value:`${n.value==="CA"?`{'564'.EX.'${l.value}'}`:`{'188'.EX.'${l.value}'}`}AND{'509'.EX.'false'} `},7:{value:"Employees"},9:{value:12}}],{data:s}=await u.fetchFromHiringApp({fields:t});return s[0]?s[0][3]:null},E=async()=>{if(d.value=!0,!S.value.valid||!g.value||g.value==="")return d.value=!1,!1;let e=await K();const t=new Date,s={3:{value:Number(g.value)},26:{value:t}};k&&e?(await u.softDeleteEmployee($[3]),await q(e)):k&&!e?e=await q($[3]):e?await q(e):e||(e=await T()),D.checkedIn&&Y(e),s[80]={value:e},s[85]={value:!1};try{await u.updateUserData({fields:s}),d.value=!1,v.push({path:"/",query:{verify:!0,...e&&{rid:e}}})}catch(p){d.value=!1,console.log(p)}d.value=!1},P=()=>{a.logout().then(()=>{v.replace({name:"login"})})};return(e,t)=>(b(),_(ne,{class:"window-height window-width row"},{default:o(()=>[e.$q.screen.lt.md?C("",!0):(b(),ae("div",he,[r(be)])),m("div",we,[r(le,{class:"auth-card",flat:""},{default:o(()=>[r(h,{style:{"padding-left":"30px","padding-right":"30px"}},{default:o(()=>[r(z,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),r(h,{class:"text-center auth-description"},{default:o(()=>[m("p",_e,A(e.$t("pleaseVerifyInfoToCompleteRegistration")),1)]),_:1}),r(h,null,{default:o(()=>[r(ie,{class:"q-px-sm q-pt-sm",onSubmit:t[3]||(t[3]=te(()=>{},["prevent"])),onKeyup:se(E,["enter"])},{default:o(()=>[m("div",Ce,[I.value==="confirm-identity"?(b(),_(Q,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:i(l),"onUpdate:modelValue":t[0]||(t[0]=s=>V(l)?l.value=s:null),maxlength:"9",minlength:"9",type:"password",label:i(n)==="CA"?e.$t("socialInsuranceNumber"):e.$t("socialSecurityNumber"),tabindex:"1",error:!!(i(R)&&i(O).validated),"error-message":i(R)},{prepend:o(()=>[r(N,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):C("",!0)]),m("div",Ie,[I.value==="confirm-identity"?(b(),_(Q,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:i(y),"onUpdate:modelValue":t[2]||(t[2]=s=>V(y)?y.value=s:null),maxlength:"9",minlength:"9",type:w.value?"password":"text",label:i(n)==="CA"?e.$t("confirmSIN"):e.$t("confirmSSN"),tabindex:"2",error:!!(i(M)&&i(F).validated),"error-message":i(M)},{prepend:o(()=>[r(N,{name:"lock"})]),append:o(()=>[r(N,{name:w.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[1]||(t[1]=s=>w.value=!w.value)},null,8,["name"])]),_:1},8,["modelValue","type","label","error","error-message"])):C("",!0)])]),_:1},8,["onKeyup"])]),_:1}),r(re,{class:"q-px-lg"},{default:o(()=>[I.value==="confirm-identity"?(b(),_(oe,{key:0,loading:d.value,disable:!i(S).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:e.$t("confirm"),tabindex:"3",onClick:E},null,8,["loading","disable","label"])):C("",!0)]),_:1}),r(h,{class:"text-center q-pa-sm"},{default:o(()=>[m("p",qe,[m("a",{onClick:P,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},A(e.$t("logout")),1)])]),_:1}),r(h,{class:"q-pl-lg q-pa-sm"},{default:o(()=>[m("div",xe,[r(ye,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var Ze=H(Ne,[["__scopeId","data-v-32ec965b"]]);export{Ze as default};
