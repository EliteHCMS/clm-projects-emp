import{Q as L,b as M,a as me}from"./QTabPanels.2ce215a2.js";import{Q as fe}from"./QTabs.ea6fbe6f.js";import{Q as ve}from"./QToolbar.076204d3.js";import{Q as be}from"./QPage.62f8b85f.js";import{E as we}from"./roster.6f1253df.js";import{l as H,bM as G,r as D,bN as J,c as b,_ as B,aZ as A,A as h,B as R,d as a,bi as i,cw as x,D as d,ao as U,cx as N,cz as W,bL as ge,w as $e,F as oe,aY as le,an as O,au as X,ab as Y,bI as se,bO as re,y as he}from"./index.8856b4a9.js";import{a as ye}from"./QSelect.342faa10.js";import{u as Z}from"./use-quasar.5082239b.js";import{u as K}from"./dataStore.505188fd.js";import{I as ee,q as ce}from"./quickbase.ce7d8f68.js";import{u as te}from"./dataStore.8f46c1d0.js";import{dayjs as C}from"./dayjs.da6fbf87.js";import{u as ue}from"./useQuerySaver.ae1b8d62.js";import{R as _e}from"./rosterTable.eeb9794b.js";import{_ as ae}from"./projectSelector.1db0377b.js";import{Q as ne,a as De}from"./QTable.9f12789c.js";import{Q as ie}from"./QTr.70fb5497.js";import{Q as de}from"./QTd.1bcc7d93.js";import{Q as je}from"./QInnerLoading.68b35a5a.js";import{e as Ve}from"./export-file.751205c9.js";import{g as Pe}from"./quickbaseDataHelpers.2e3d1f51.js";import{P as Ae}from"./projectPipeline.6c7e0507.js";import"./use-panel.d8a882d3.js";import"./touch.9d375472.js";import"./selection.92f13da4.js";import"./QResizeObserver.be1e9ef2.js";import"./rtl.d0f7624c.js";import"./QChip.fed3d1fb.js";import"./QMenu.17081656.js";import"./position-engine.160e6493.js";import"./localForage.942c4d1e.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./api.40572673.js";import"./i18n.436c7a19.js";import"./arrivalDate.ad9a67ef.js";import"./QTooltip.3d86c391.js";import"./QForm.94899070.js";import"./vee-validate.esm.f729b0e8.js";import"./array.ce069234.js";import"./QList.761b1b13.js";import"./QMarkupTable.1dcf9e43.js";import"./use-fullscreen.a41ae4e1.js";const Se=H({props:{},components:{RosterTable:_e,projectSelector:ae},setup(t){const o=Z(),j=G(),f=ee(),w=D(null),y=D(""),v=D(null),s=D(null),{getSelectedProject:n}=J(f),{getAssignments:S,fetchAllAssignments:_,fetchAssignments:F}=K(),{getManpowerData:Q,setRosters:T}=te(),u=b(()=>j.params.id?j.params.id:null),V=b(()=>n.value?n.value[3]:null),g=b(()=>{let r;const p=C().subtract(14,"day");return u.value?r=(Q({dataset:"rosters",id:u.value})||[]).sort((m,z)=>m[1].$d<z[1].$d?1:-1):r=S(V.value).sort((l,m)=>l[1].$d<m[1].$d?1:-1),r.filter(l=>!l[112]&&l.latest&&l[102]==="Active"&&C(l[1].$d).isSameOrAfter(p)&&C(l[1].$d).isSameOrBefore(C()))}),q=b(()=>{let r=[];return g.value.forEach(p=>{p[75].toLowerCase().includes(y.value.toLowerCase())&&r.push(p)}),r=v.value?r.filter(p=>C(p[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===C(v.value).tz("America/Chicago").format("MM/DD/YYYY")):r,r=s.value?r.filter(p=>p[68]===s.value):r,r.sort((p,l)=>p.employee[22]>l.employee[22]?1:-1)}),k=b(()=>[...new Map(g.value.map(r=>[r[68],r[68]])).values()]),I=async r=>{o.loading.show(),u.value?(r||!Q({dataset:"rosters",id:u.value}))&&await E():w.value?await F({projectId:V.value,refresh:r}):await _({refresh:r}),o.loading.hide()},E=async()=>{const r=`{'74'.EX.'${u.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:p}=await ce.fetchFromProjectsApp({fields:[ue({type:"assignments",query:r})]});T({id:u.value,data:p})};return{allAssignments:g,projectFilter:w,search:y,startDateFilter:v,craftFilter:s,craftOptions:k,rows:q,loadData:I}}}),Ce={class:"row items-center"},Re={key:0,class:"col-12 col-md-3"},Qe={class:"col-12 col-md-3 q-px-sm"},qe={class:"col-12 col-md-3 q-px-sm"},ke={class:"col-12 col-md-3 q-px-sm"};function Fe(t,o,j,f,w,y){const v=A("projectSelector"),s=A("roster-table");return h(),R("div",null,[a(W,{flat:""},{default:i(()=>[a(x,null,{default:i(()=>[d("div",Ce,[t.$route.params.id?U("",!0):(h(),R("div",Re,[a(v,{dense:""})])),d("div",Qe,[a(N,{dense:"",modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),label:"Search"},null,8,["modelValue"])]),d("div",qe,[a(N,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=n=>t.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),d("div",ke,[a(ye,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=n=>t.craftFilter=n),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(s,{rows:t.rows,onRefresh:o[3]||(o[3]=n=>t.loadData(!0)),title:"New Arrivals"},null,8,["rows"])])}var Te=B(Se,[["render",Fe]]);const Ie=H({props:{},components:{projectSelector:ae},setup(t){const o=Z(),j=ge(),f=G(),{capitalize:w}=he,y=ee(),v=D(null),s=D(""),n=D(null),S=D(null),{getSelectedProject:_}=J(y),{getReleases:F,fetchReleases:Q,fetchAllReleases:T}=K(),{getManpowerData:u,setDepartures:V}=te(),g=b(()=>f.params.id?f.params.id:null),q=b(()=>_.value?_.value[3]:null),k=[{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${I(e)}`,sortable:!0,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Depature Date",align:"left",field:e=>e[36].$d,format:e=>`${C(e).format("MM/DD/YYYY")}`,sortable:!0}],I=e=>{const P=e.split(" ");let $="";return P.forEach((c,pe)=>{$+=pe>0?` ${w(c.toLowerCase())}`:w(c.toLowerCase())}),$};function E(e){j.push({name:"view-release",params:{release:e[3]}})}function r(e,P,$){let c=P!==void 0?P(e,$):e;return c=c==null?"":String(c),c=c.split('"').join('""'),`"${c}"`}function p(){const e=[k.value.map($=>r($.label))].concat(l.value.map($=>k.value.map(c=>r(typeof c.field=="function"?c.field($):$[c.field===void 0?c.name:c.field],c.format,$)).join(","))).join(`\r
`);Ve(`${C().format("MM.DD.YYYY")} Releases-Export.csv`,e,"text/csv")!==!0&&o.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const l=b(()=>{let e;return g.value?e=u({dataset:"departures",id:g.value})||[]:e=F(q.value).sort((P,$)=>P[1].$d<$[1].$d?1:-1),e}),m=async e=>{o.loading.show(),g.value?(e||!u({dataset:"departures",id:g.value}))&&await z():v.value?await Q({projectId:q.value}):await T(),o.loading.hide()},z=async()=>{const e=`{'41'.EX.'${g.value}'}AND{'42'.XEX.'Complete'}AND({'36'.OAF.'today'}OR{'36'.IR.'last 30 d'}OR{'1'.IR.'last 30 d'})`,{data:P}=await ce.fetchFromHiringApp({fields:[ue({type:"releases",query:e})]});V({id:g.value,data:P})};return $e(_,()=>{m()}),m(),{projectFilterValue:q,search:s,dateFilter:n,craftFilter:S,loadData:m,getReleases:F,columns:k,viewRelease:E,exportAllReleases:p,rows:l}}}),Ee={class:"row items-center"},Ye={key:0,class:"col-12 col-md-3"},Ne={class:"col-12 col-md-3 q-px-sm"},Le={class:"col-12 col-md-3 q-px-sm"},Me=d("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),xe={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Oe={class:"text-dark text-caption text-italic"};function Be(t,o,j,f,w,y){const v=A("projectSelector");return h(),R("div",null,[a(W,{flat:""},{default:i(()=>[a(x,null,{default:i(()=>[d("div",Ee,[t.$route.params.id?U("",!0):(h(),R("div",Ye,[a(v,{dense:""})])),d("div",Ne,[a(N,{dense:"",modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=s=>t.search=s),label:"Search"},null,8,["modelValue"])]),d("div",Le,[a(N,{dense:"",modelValue:t.dateFilter,"onUpdate:modelValue":o[1]||(o[1]=s=>t.dateFilter=s),label:"Departure Date",type:"date","stack-label":""},null,8,["modelValue"])]),Me])]),_:1})]),_:1}),d("div",null,[a(De,{title:"Recent Departures","title-class":"text-h5 text-primary",columns:t.columns,rows:t.rows,"row-key":s=>s[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent departures",dense:""},{header:i(s=>[a(ie,{class:"bg-dark text-white",props:s},{default:i(()=>[a(ne,{"auto-width":""}),(h(!0),R(oe,null,le(s.cols,n=>(h(),O(ne,{key:n.name,props:s},{default:i(()=>[X(Y(n.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:i(s=>[a(ie,{props:s},{default:i(()=>[a(de,{"auto-width":""},{default:i(()=>[a(se,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:n=>t.viewRelease(s.row),name:s.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(h(!0),R(oe,null,le(s.cols,n=>(h(),O(de,{key:n.name,props:s},{default:i(()=>[X(Y(n.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":i(({message:s})=>[d("div",xe,[a(se,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),d("span",null,Y(s),1)])]),"top-right":i(()=>[d("div",Oe,"(Total: "+Y(t.getReleases(t.projectFilterValue).length)+" departures)",1),a(re,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[2]||(o[2]=s=>t.loadData(!0))}),a(re,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllReleases,disable:t.getReleases(t.projectFilterValue).length<1},null,8,["dense","onClick","disable"])]),loading:i(()=>[a(je,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Ue=B(Ie,[["render",Be]]);const ze={name:"Pipeline",components:{ProjectPipelineTable:Ae,projectSelector:ae},setup(){const t=Z(),o=G(),j=ee(),f=D(null),w=D(""),{getSelectedProject:y}=J(j),{fetchAllDeployments:v,fetchAllInProcess:s,fetchAllPending:n,getDeployments:S,getInProcess:_,getPending:F}=K(),{getManpowerData:Q,setPipelines:T}=te(),u=b(()=>o.params.id?o.params.id:null),V=b(()=>y.value?y.value[3]:null),g=b(()=>S(V.value).filter(l=>l[20]==="Complete")),q=b(()=>{const l=[];return S(V.value).forEach(m=>{m[31].toLowerCase().includes(w.value.toLowerCase())&&l.push(m)}),l}),k=b(()=>{const l=[];return F(V.value).forEach(m=>{m[25].toLowerCase().includes(w.value.toLowerCase())&&l.push(m)}),l}),I=b(()=>{const l=[];return _(V.value).forEach(m=>{m[39].toLowerCase().includes(w.value.toLowerCase())&&l.push(m)}),l}),E=b(()=>{let l;return u.value?l=Q({dataset:"pipelines",id:u.value})||[]:l=I.value.concat(k.value.concat(q.value)),l}),r=async l=>{t.loading.show(),u.value?(l||!Q({dataset:"pipelines",id:u.value}))&&await p():(await v(l),await s(l),await n(l)),t.loading.hide()},p=async()=>{const l=await Pe(u.value);T({id:u.value,data:l})};return r(),{projectFilter:f,arrived:g,allPipeline:E,search:w,loadData:r}}},Xe={class:"text-h5 text-dark"},He={class:"text-body2 text-italic q-ml-sm"},Ge=d("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Je={class:"row items-center"},We={key:0,class:"col-12 col-md-3 q-px-sm"},Ze={class:"col-12 col-md-3 q-px-sm"};function Ke(t,o,j,f,w,y){const v=A("projectSelector"),s=A("project-pipeline-table");return h(),R("div",null,[a(W,{flat:""},{default:i(()=>[a(x,{class:"q-pb-none"},{default:i(()=>[d("div",Xe,[X(" Staffing Pipeline "),d("span",He,"("+Y(f.allPipeline.length)+" total)",1)]),Ge]),_:1}),a(x,null,{default:i(()=>[d("div",Je,[t.$route.params.id?U("",!0):(h(),R("div",We,[a(v,{dense:""})])),d("div",Ze,[a(N,{dense:"",modelValue:f.search,"onUpdate:modelValue":o[0]||(o[0]=n=>f.search=n),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(s,{rows:f.allPipeline,onRefresh:o[1]||(o[1]=n=>f.loadData(!0))},null,8,["rows"])])}var et=B(ze,[["render",Ke]]);const tt=H({name:"Employees",components:{RosterTab:we,NewArrivalsTab:Te,ReleasesTab:Ue,PipelineTab:et},setup(){return{tab:D(0)}}}),at={class:"q-pa-md"};function ot(t,o,j,f,w,y){const v=A("roster-tab"),s=A("new-arrivals-tab"),n=A("pipeline-tab"),S=A("releases-tab");return h(),O(be,{style:{"max-width":"100vw"}},{default:i(()=>[d("div",at,[a(ve,{class:"bg-info text-white shadow-2 rounded-borders"},{default:i(()=>[a(fe,{modelValue:t.tab,"onUpdate:modelValue":o[0]||(o[0]=_=>t.tab=_),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:i(()=>[a(L,{name:0,label:t.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),a(L,{name:1,label:"New Arrivals"}),t.$route.name==="project-manpower"?(h(),O(L,{key:0,name:3,label:"Pipeline"})):U("",!0),a(L,{name:2,label:"Departures"})]),_:1},8,["modelValue"])]),_:1}),a(me,{modelValue:t.tab,"onUpdate:modelValue":o[1]||(o[1]=_=>t.tab=_),animated:""},{default:i(()=>[a(M,{name:0},{default:i(()=>[a(v)]),_:1}),a(M,{name:1},{default:i(()=>[a(s)]),_:1}),a(M,{name:3},{default:i(()=>[a(n)]),_:1}),a(M,{name:2},{default:i(()=>[a(S)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var Xt=B(tt,[["render",ot]]);export{Xt as default};
