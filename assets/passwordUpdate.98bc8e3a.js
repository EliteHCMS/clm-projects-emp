import{Q as j}from"./QImg.9135c4ea.js";import{_ as A,b$ as E,b_ as F,r as b,c as O,aV as T,v as l,aj as m,be as a,a3 as t,x as Z,d as e,ak as w,z as r,cx as f,bB as H,cy as P,b as R,bU as x,cz as X,c1 as G,cA as J,aR as K,aP as W,aq as k}from"./index.b06fce66.js";import{Q as Y}from"./QForm.315b8db6.js";import{Q as ee}from"./QPage.22cc3336.js";import{u as ae}from"./use-quasar.182cb904.js";import{a as se,e as te,c as S,d as oe,b as re,u as y}from"./array.614e2fa3.js";import{q as C,f as U}from"./quickbase.fdea35da.js";import{c as le}from"./carousel.c9ca4b75.js";import"./_commonjsHelpers.dfee5925.js";import"./dayjs.5a7ff99a.js";import"./localForage.b80c3212.js";import"./index.7dbe61ef.js";import"./i18n.a3a63bb3.js";import"./api.03104534.js";import"./use-panel.b012cfa0.js";import"./touch.d8ab472d.js";import"./selection.95a2b369.js";import"./use-fullscreen.050441ac.js";const ie=i=>(K("data-v-24eb4a9c"),i=i(),W(),i),de={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ne={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},pe=ie(()=>r("p",{class:"text-dark"},"Update Password",-1)),ce={class:"row"},ue={class:"row"},me={class:"text-grey-6"},we=k("Return to Login"),fe={class:"text-grey-6"},ge=k("Need an account? "),_e=k("Register"),ve={__name:"passwordUpdate",setup(i){const g=ae(),q=E(),_=F(),v=b("update-password"),d=b(!1),$=O(()=>se({userRID:te().required(),password:S().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:"Must Contain at least 8 Characters, at least 1 Uppercase, 1 Lowercase, and 1 Number"}).nullable(),passwordConfirmation:S().oneOf([oe("password"),null],"Passwords must match")})),{errors:he,meta:L}=re({validationSchema:$,initialValues:{password:"",passwordConfirmation:""}}),{value:n}=y("userRID"),{value:p,errorMessage:Q,meta:B}=y("password"),{value:h,errorMessage:I,meta:D}=y("passwordConfirmation"),c=b(!0);q.query.rid?(n.value=q.query.rid,_.replace({query:{}})):_.push("/");const N=async()=>{if(!n.value||n.value==="")return!1;d.value=!0;const V=await C.isUserLoggedIn(),s=await U.genSalt(10),u=U.hashSync(p.value,s),o=new Date,M={3:{value:n.value},7:{value:u},26:{value:o}};try{V?await C.updateUserData({fields:M}):(await C.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[M],formatObject:76}),g.notify({position:"top-right",type:"info",message:"Login with new password!"})),d.value=!1,_.push("/")}catch(z){d.value=!1,g.notify({position:"top-right",type:"negative",message:z.message||"Error updating password"})}};return(V,s)=>{const u=T("router-link");return l(),m(ee,{class:"window-height window-width row"},{default:a(()=>[t(g).screen.lt.md?w("",!0):(l(),Z("div",de,[e(le)])),r("div",ne,[e(J,{class:"auth-card",flat:""},{default:a(()=>[e(f,{style:{"padding-left":"30px","padding-right":"30px"}},{default:a(()=>[e(j,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),e(f,{class:"text-center auth-description"},{default:a(()=>[pe]),_:1}),e(f,null,{default:a(()=>[e(Y,{class:"q-px-sm q-pt-sm",onSubmit:s[3]||(s[3]=H(()=>{},["prevent"]))},{default:a(()=>[r("div",ce,[v.value==="update-password"?(l(),m(P,{key:0,class:"col-xs-12",outlined:"",modelValue:t(p),"onUpdate:modelValue":s[1]||(s[1]=o=>R(p)?p.value=o:null),type:c.value?"password":"text",autocomplete:"current-password",label:"Password",tabindex:"1",error:!!(t(Q)&&t(B).validated),"error-message":t(Q)},{append:a(()=>[e(x,{name:c.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[0]||(s[0]=o=>c.value=!c.value)},null,8,["name"])]),prepend:a(()=>[e(x,{name:"lock"})]),_:1},8,["modelValue","type","error","error-message"])):w("",!0)]),r("div",ue,[v.value==="update-password"?(l(),m(P,{key:0,class:"col-xs-12",outlined:"",modelValue:t(h),"onUpdate:modelValue":s[2]||(s[2]=o=>R(h)?h.value=o:null),type:"password",autocomplete:"new-password",label:"Confirm Password",tabindex:"2",error:!!(t(I)&&t(D).validated),"error-message":t(I)},{prepend:a(()=>[e(x,{name:"lock"})]),_:1},8,["modelValue","error","error-message"])):w("",!0)])]),_:1})]),_:1}),e(X,{class:"q-px-lg"},{default:a(()=>[v.value==="update-password"?(l(),m(G,{key:0,loading:d.value,disable:!t(L).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Update Password",tabindex:"3",onClick:N},null,8,["loading","disable"])):w("",!0)]),_:1}),e(f,{class:"text-center q-pa-sm"},{default:a(()=>[r("p",me,[e(u,{to:"/login",class:"text-grey-6",tabindex:"4"},{default:a(()=>[we]),_:1})]),r("p",fe,[ge,e(u,{to:"/register",class:"text-grey-6",tabindex:"5"},{default:a(()=>[_e]),_:1})])]),_:1})]),_:1})])]),_:1})}}};var Ne=A(ve,[["__scopeId","data-v-24eb4a9c"]]);export{Ne as default};
