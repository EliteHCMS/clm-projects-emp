import{Q as $e}from"./QImg.7fb223b7.js";import{_ as ze,b_ as Fe,r as n,c as me,w as Z,aV as L,v as g,aj as M,be as l,x as de,d as a,ak as x,z as c,cx as i,a7 as p,bB as Xe,bA as He,cy as q,bU as _,B as Ke,cz as G,c1 as A,aq as k,cA as J,bg as Y,cB as We}from"./index.1246e09c.js";import{Q as Ze}from"./QForm.13ca2be3.js";import{Q as Ge}from"./QPage.6a802d99.js";import{C as ee}from"./ClosePopup.6305abab.js";import{u as Je}from"./use-quasar.065c0da0.js";import{a as Ye,c as h,d as ea,b as aa,u as y}from"./array.bd314615.js";import{u as oa}from"./i18n.54a73b20.js";import{b as ta,f as ue,q as w}from"./quickbase.8a34ade0.js";import{p as la}from"./VueTelInput.5d85d700.js";import{_ as sa}from"./languageSelector.7e850055.js";import{c as ra}from"./carousel.92b9ae37.js";import{api as na}from"./api.e5fb973e.js";import{dayjs as ae}from"./dayjs.0f7b12c7.js";import"./_commonjsHelpers.dfee5925.js";import"./localForage.2ed1b66f.js";import"./index.7dbe61ef.js";import"./QSelect.b951dfd5.js";import"./QMenu.6bb3870b.js";import"./position-engine.f75a9ead.js";import"./selection.28a9f654.js";import"./rtl.65b79c69.js";import"./use-panel.a77b0c06.js";import"./touch.d8ab472d.js";import"./use-fullscreen.9a6d3ab3.js";const ia={name:"Register",props:["phoneTemp","emailTemp"],components:{phoneNumberInput:la,carousel:ra,languageSelector:sa},setup(s){const t=Je(),B=Fe(),{t:e}=oa(),{currentUserType:S}=ta(),I=n(!1),P=n(!1),D=n(10),d=n(null),O=n(!1),r=n("phoneNumber"),oe=n("register"),E=n(!1),ce=n(!1),T=n([]),$=n(!1),te=n(!1),v=n(null),V=n(null),N=n(0),pe=me(()=>{const o=new RegExp("^[0-9]{"+D.value+"}","g");return Ye({firstName:h().required().label(`${e("firstName")}`),lastName:h().required().label(`${e("lastName")}`),email:h().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:h().matches(o,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`),password:h().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:`${e("passwordRules")}`}).nullable(),passwordConfirmation:h().oneOf([ea("password"),null],`${e("passwordMustMatch")}`)})}),fe=me(()=>X.value===v.value);S==="Candidate"||B.push("/");const{errors:ge,meta:le}=aa({validationSchema:pe,initialValues:{firstName:"",lastName:"",phoneNumber:"",email:"",password:"",passwordConfirmation:""}}),{value:se,errorMessage:ve,meta:be}=y("firstName"),{value:re,errorMessage:he,meta:ye}=y("lastName"),{value:m,errorMessage:we,setErrors:z,meta:Ne}=y("phoneNumber"),{value:U,errorMessage:Ce,setErrors:ne,meta:Me}=y("email"),{value:F,errorMessage:xe,meta:qe}=y("password"),{value:_e,errorMessage:Ae,meta:Ie}=y("passwordConfirmation"),{value:X,errorMessage:Pe,meta:Ve}=y("codeConfirmation",h().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().oneOf([v.value],`${e("codeMustMatch")}`)),ke=n(!0);s.phoneTemp&&(m.value=s.phoneTemp),s.emailTemp&&(U.value=s.emailTemp);const Se=o=>{D.value=o};Z(m,o=>{T.value.includes(o)&&(z(`${e("phoneNumberAlreadyInUse")}`),T.value.push(m.value),I.value=!1,t.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"}),E.value=!0)}),Z(N,o=>{o===0&&(v.value=null,V.value=null),$.value=!0}),Z(X,async o=>{Number(o)===v.value&&(te.value=!0,await Be(),await H())});const De=o=>{d.value=o},Ee=async()=>{v.value=Math.floor(1e5+Math.random()*9e5),await na.createMessageQueue({to:m.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",message:`${e("yourBrandSafwayVerificationCodeIs")} ${v.value}`,extRef:null,massText:!1}),V.value=ae().add(1,"minute"),Te()},Te=()=>{const o=setInterval(()=>{N.value=ae(V.value).valueOf()-ae().valueOf(),N.value<=0&&(N.value=0,clearInterval(o))},1e3)},Ue=()=>{E.value=!1,$.value=!1,v.value=null,V.value=null,N.value=0},Re=o=>{const f=Math.floor(o/6e4),u=(o%6e4/1e3).toFixed(0);return f+":"+(u<10?"0":"")+u},Qe=async o=>{const u=[{8:{value:`{'20'.CT.'${o[35]}'}AND{'22'.CT.'${o[37]}'}AND({'24'.CT.'${o[35]}'}AND{'24'.CT.'${o[37]}'})AND({'27'.EX.'${d.value?d.value.dialCode:"1"}${m.value}'}OR{'27'.EX.'${m.value}'})AND{'26'.EX.'${o[6]}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:C}=await w.fetchFromHiringApp({fields:u});return C[0]?C[0][3]:null},je=async o=>{const f=await w.isUserLoggedIn(),u=await Qe(o),C=new Date,b={3:{value:o[3]},26:{value:C}};if(u)b[80]={value:u};else return!1;try{f?await w.updateUserData({fields:b}):await w.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[b],formatObject:76})}catch(K){console.log(K)}},Le=async o=>{const f={password:F.value,userType:S,phoneNumber:`+${d.value?d.value.dialCode:"1"}${m.value}`};try{if(await w.login(f))return await je(o),B.push({path:"/"})}catch(u){console.log(u)}},H=async()=>{const o=U.value.match(/^([^@]*)@/)[1],f=await ue.genSalt(10),u=ue.hashSync(F.value,f),C=Math.floor(1e5+Math.random()*9e5),b=new Date,K=Object.assign({phoneNumber:m.value},d.value),Oe=[{6:{value:U.value},7:{value:u},8:{value:`+${d.value?d.value.dialCode:"1"}${m.value}`},9:{value:JSON.stringify(K)},10:{value:"Active"},11:{value:7},21:{value:C},32:{value:"Candidate"},35:{value:se.value.trim()},37:{value:re.value.trim()},23:{value:0},24:{value:0},25:{value:b},26:{value:b},33:{value:o},50:{value:te.value}}];try{const{data:R,metadata:ie}=await w.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:Oe,formatObject:76});if(ie.lineErrors){const Q=ie.lineErrors[1];let W=!1;Q.forEach(j=>{j.includes('is not unique for unique formula field with ID "27"')&&(ne(`${e("emailAlreadyInUse")}`),P.value=!1,t.notify({type:"negative",message:`${e("emailAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"})),j.includes('The field named "uniqueEmail" with field id 27 requires a unique value.')&&(ne(`${e("emailAlreadyInUse")}`),P.value=!1,t.notify({type:"negative",message:`${e("emailAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"})),j.includes('is not unique for unique formula field with ID "28"')&&(W=!0,z(`${e("phoneNumberAlreadyInUse")}`),T.value.push(m.value),I.value=!1,t.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"})),j.includes('The field named "uniquePhoneNumber" with field id 28 requires a unique value.')&&(W=!0,z(`${e("phoneNumberAlreadyInUse")}`),T.value.push(m.value),I.value=!1,t.notify({type:"negative",message:`${e("phoneNumberAlreadyInUse")}`,timeout:7e3,position:t.screen.lt.md?"top":"top-right"}))}),W&&Q.length===1&&(E.value=!0)}else{const Q=R[0][76];return await Le(Q)}return R}catch(R){console.log(R)}},Be=async()=>{try{return await w.deActivateAccount({phoneNumber:`+${d.value?d.value.dialCode:"1"}${m.value}`,userType:S})}catch(o){console.log(o)}};return{firstName:se,lastName:re,email:U,phoneNumber:m,password:F,passwordConfirmation:_e,isPwd:ke,codeConfirmation:X,verifyExistingPhoneNumber:ce,validPhone:I,validEmail:P,step:oe,validPassword:O,loginType:r,firstNameMeta:be,lastNameMeta:ye,phoneNumberMeta:Ne,emailMeta:Me,passwordMeta:qe,passwordConfirmationMeta:Ie,codeConfirmationMeta:Ve,firstNameMessage:ve,lastNameMessage:he,passwordMessage:xe,phoneNumberMessage:we,emailMessage:Ce,passwordConfirmationMessage:Ae,errors:ge,meta:le,codeConfirmationMessage:Pe,updatePhoneMaxLength:Se,createAccount:H,updateCountry:De,phoneNumberPrompt:E,sendCode:Ee,codeExpiration:V,countDown:N,millisToMinutesAndSeconds:Re,codePrompt:$,closePhoneNumberPrompt:Ue,codeRules:fe,onSubmit:o=>{oe.value==="register"&&le.valid?H():o.preventDefault()}}}},ma={key:0,class:"col-md-7 col-lg-8 col-lx-8"},da={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ua={class:"text-dark"},ca={class:"row q-col-gutter-xs"},pa={class:"row q-col-gutter-xs"},fa={class:"row q-col-gutter-xs"},ga={class:"row q-col-gutter-xs"},va={class:"row justify-center"},ba={class:"text-h6"},ha={class:"text-h6"};function ya(s,t,B,e,S,I){const P=L("carousel"),D=L("phone-number-input"),d=L("router-link"),O=L("languageSelector");return g(),M(Ge,{class:"window-height window-width row"},{default:l(()=>[s.$q.screen.lt.md?x("",!0):(g(),de("div",ma,[a(P)])),c("div",da,[a(J,{class:"register-card",flat:""},{default:l(()=>[a(i,{style:{"padding-left":"30px","padding-right":"30px"}},{default:l(()=>[a($e,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"register-logo full-width"})]),_:1}),a(i,{class:"text-center register-description"},{default:l(()=>[c("p",ua,p(s.$t("register")),1)]),_:1}),a(i,null,{default:l(()=>[a(Ze,{class:"q-px-xs q-pt-xs",onSubmit:t[7]||(t[7]=Xe(()=>{},["prevent"])),onKeyup:He(e.onSubmit,["enter"])},{default:l(()=>[c("div",ca,[a(q,{class:"col-xs-12 col-sm-6 q-pb-lg",clearable:"",outlined:"",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=r=>e.firstName=r),type:"text",autocomplete:"given-name",label:s.$t("firstName"),tabindex:"1",name:"firstName",error:!!(e.firstNameMessage&&e.firstNameMeta.validated),"error-message":e.firstNameMessage},{prepend:l(()=>[a(_,{name:"person"})]),_:1},8,["modelValue","label","error","error-message"]),a(q,{class:"col-xs-12 col-sm-6",clearable:"",outlined:"",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=r=>e.lastName=r),type:"text",autocomplete:"family-name",label:s.$t("lastName"),tabindex:"2",name:"lastName",error:!!(e.lastNameMessage&&e.lastNameMeta.validated),"error-message":e.lastNameMessage},{prepend:l(()=>[a(_,{name:"person_outline"})]),_:1},8,["modelValue","label","error","error-message"])]),c("div",pa,[a(D,{name:"phoneNumber",class:Ke(["col-xs-12 col-sm-12",{"q-pb-lg":e.phoneNumberMessage&&e.phoneNumberMeta.validated}]),outlined:"",modelValue:e.phoneNumber,"onUpdate:modelValue":t[2]||(t[2]=r=>e.phoneNumber=r),label:s.$t("phoneNumber"),tabindex:"3",onMaxLengthChanged:e.updatePhoneMaxLength,error:!!(e.phoneNumberMessage&&e.phoneNumberMeta.validated),"error-message":e.phoneNumberMessage,onCountryChanged:e.updateCountry},null,8,["class","modelValue","label","onMaxLengthChanged","error","error-message","onCountryChanged"])]),c("div",fa,[a(q,{class:"col-xs-12 col-sm-12 q-pb-lg",clearable:"",outlined:"",modelValue:e.email,"onUpdate:modelValue":t[3]||(t[3]=r=>e.email=r),type:"email",autocomplete:"email",label:s.$t("email"),tabindex:"4",name:"email",error:!!(e.emailMessage&&e.emailMeta.validated),"error-message":e.emailMessage},{prepend:l(()=>[a(_,{name:"email"})]),_:1},8,["modelValue","label","error","error-message"])]),c("div",ga,[e.step==="register"?(g(),M(q,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",outlined:"",modelValue:e.password,"onUpdate:modelValue":t[5]||(t[5]=r=>e.password=r),type:e.isPwd?"password":"text",autocomplete:"current-password",label:s.$t("password"),tabindex:"5",error:!!(e.passwordMessage&&e.passwordMeta.validated),"error-message":e.passwordMessage},{append:l(()=>[a(_,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[4]||(t[4]=r=>e.isPwd=!e.isPwd)},null,8,["name"])]),prepend:l(()=>[a(_,{name:"lock"})]),_:1},8,["modelValue","type","label","error","error-message"])):x("",!0),e.step==="register"?(g(),M(q,{key:1,class:"col-xs-12 col-sm-6 q-pb-md",outlined:"",modelValue:e.passwordConfirmation,"onUpdate:modelValue":t[6]||(t[6]=r=>e.passwordConfirmation=r),type:"password",autocomplete:"new-password",label:s.$t("confirmPassword"),tabindex:"6",error:!!(e.passwordConfirmationMessage&&e.passwordConfirmationMeta.validated),"error-message":e.passwordConfirmationMessage},{prepend:l(()=>[a(_,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):x("",!0)])]),_:1},8,["onKeyup"])]),_:1}),a(G,{class:"q-px-lg"},{default:l(()=>[e.step==="register"?(g(),M(A,{key:0,onClick:e.createAccount,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:s.$t("createAccount"),tabindex:e.meta.valid?"7":"-1",disable:!e.meta.valid},null,8,["onClick","label","tabindex","disable"])):x("",!0)]),_:1}),a(i,{class:"text-center q-pa-sm"},{default:l(()=>[a(d,{to:"/login",class:"text-grey-6",tabindex:e.meta.valid?"8":"7"},{default:l(()=>[k(p(s.$t("alreadyHaveAnAccount")),1)]),_:1},8,["tabindex"])]),_:1}),a(i,{class:"q-pl-lg q-pa-sm"},{default:l(()=>[c("div",va,[a(O,{dense:"",borderless:""})])]),_:1})]),_:1}),a(We,{modelValue:e.phoneNumberPrompt,"onUpdate:modelValue":t[10]||(t[10]=r=>e.phoneNumberPrompt=r),persistent:""},{default:l(()=>[e.codePrompt?e.codePrompt?(g(),M(J,{key:1,style:{"min-width":"350px"}},{default:l(()=>[a(i,null,{default:l(()=>[c("div",ha,p(s.$t("mobilePhoneVerification")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[k(p(s.$t("textMessageWithCodeSent")),1)]),_:1}),a(i,{class:"q-py-none q-p"},{default:l(()=>[a(q,{class:"col-xs-12 col-sm-6 q-pb-md",clearable:"",outlined:"",modelValue:e.codeConfirmation,"onUpdate:modelValue":t[8]||(t[8]=r=>e.codeConfirmation=r),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:s.$t("code"),tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!e.codeRules,"error-message":"Code does not match!"},{append:l(()=>[k(p(e.millisToMinutesAndSeconds(e.countDown))+"\xA0 ",1)]),_:1},8,["modelValue","label","error"])]),_:1}),a(i,{class:"q-py-none row justify-center"},{default:l(()=>[e.countDown===0?(g(),de("a",{key:0,onClick:t[9]||(t[9]=(...r)=>e.sendCode&&e.sendCode(...r)),class:"text-grey-6",href:"javascript:void(0);"},p(s.$t("resendCode")),1)):x("",!0)]),_:1}),a(G,{align:"right",class:"text-primary"},{default:l(()=>[Y(a(A,{flat:"",label:s.$t("cancel"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]])]),_:1})]),_:1})):x("",!0):(g(),M(J,{key:0,style:{"min-width":"350px"}},{default:l(()=>[a(i,null,{default:l(()=>[c("div",ba,p(s.$t("thisPhoneNumberAlreadyInUse")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[k(p(s.$t("signInWithExistingAccount")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[a(A,{to:"/login",color:"primary",label:s.$t("signIn")},null,8,["label"])]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[k(p(s.$t("verifyPhoneNumberFirst")),1)]),_:1}),a(i,{class:"q-pt-none"},{default:l(()=>[a(A,{color:"primary",label:s.$t("sendCode"),onClick:e.sendCode},null,8,["label","onClick"])]),_:1}),a(G,{align:"right",class:"text-primary"},{default:l(()=>[Y(a(A,{flat:"",label:s.$t("cancel"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]]),Y(a(A,{flat:"",label:s.$t("ok"),onClick:e.closePhoneNumberPrompt},null,8,["label","onClick"]),[[ee]])]),_:1})]),_:1}))]),_:1},8,["modelValue"])])]),_:1})}var Xa=ze(ia,[["render",ya],["__scopeId","data-v-55be8434"]]);export{Xa as default};
