import{h as k,bZ as se,d6 as oe,d7 as re,l as N,r as V,c as y,_ as F,B as i,as as D,bt as v,C as $,F as R,b6 as U,az as K,ae as P,bS as M,at as x,b7 as E,d as b,E as w,z as H,H as ne,b3 as le,b1 as ie,bX as B,w as ce,cV as ue,cW as de,cX as me}from"./index.960d5b34.js";import{a as pe}from"./QSelect.ce23f885.js";import{Q as X,a as fe,b as W}from"./QTabPanels.7f2b2f83.js";import{Q as ye}from"./QTabs.3a560d12.js";import{Q as ge}from"./QToolbar.6b905ef4.js";import{Q as he}from"./QPage.8d15663e.js";import{u as ve}from"./use-quasar.09536e80.js";import{r as be,q as L,c as we,u as _e}from"./app.bda2cd70.js";import{dayjs as T}from"./dayjs.501e8a8e.js";import{u as Y}from"./dataStore.d3a4115a.js";import{u as q}from"./dataStore.1da58b7a.js";import{Q as J}from"./QTable.2cc075de.js";import{a as G}from"./useQuerySaver.d29ff9ee.js";import{Q as z}from"./QTd.e3f90e32.js";import{Q as Z}from"./QTr.4b36010c.js";import{_ as $e}from"./projectSelector.32d51d56.js";import"./QChip.e4d2f168.js";import"./QMenu.dd57348b.js";import"./position-engine.40859e34.js";import"./selection.4cab378b.js";import"./rtl.b51694b1.js";import"./use-panel.98705a6b.js";import"./touch.3df10340.js";import"./QResizeObserver.b1215cec.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.84a30b23.js";import"./index.04bc0a32.js";import"./i18n.2abc02f2.js";import"./QList.c2993b6b.js";import"./QMarkupTable.17a90ccc.js";import"./use-fullscreen.7e074d8e.js";const Ce=[k("defs",[k("linearGradient",{x1:"8.042%",y1:"0%",x2:"65.682%",y2:"23.865%",id:"a"},[k("stop",{"stop-color":"currentColor","stop-opacity":"0",offset:"0%"}),k("stop",{"stop-color":"currentColor","stop-opacity":".631",offset:"63.146%"}),k("stop",{"stop-color":"currentColor",offset:"100%"})])]),k("g",{transform:"translate(1 1)",fill:"none","fill-rule":"evenodd"},[k("path",{d:"M36 18c0-9.94-8.06-18-18-18",stroke:"url(#a)","stroke-width":"2"},[k("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.9s",repeatCount:"indefinite"})]),k("circle",{fill:"currentColor",cx:"36",cy:"18",r:"1"},[k("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.9s",repeatCount:"indefinite"})])])];var je=se({name:"QSpinnerTail",props:oe,setup(e){const{cSize:t,classes:r}=re(e);return()=>k("svg",{class:r.value,width:t.value,height:t.value,viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg"},Ce)}});const Se=({assignment:e,employee:t,project:r})=>{const u=t[556]&&t[556][1].$d?t[556][1].$d:null;if(u?T(u).isSameOrAfter(T().subtract(T.duration({days:2})),"day"):!1){const{setDisaStatusChecks:p}=Y(),{setDisaStatus:s}=q();p({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:t[556][10]}),s({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:t[556]})}else ee({assignment:e,employee:t,project:r})},ee=async({assignment:e,employee:t,project:r})=>new Promise((u,c)=>{const p={ownerId:r[322],socialSecurityNumbers:[t[188]]};be.justChecking(p).then(async s=>{const a=s.results?s.results[0]:null;a&&(a.dateChecked=T(),r[321][36]&&a.dccStatus==="ACTIVE"||a.dccStatus==="ACTIVE"?a.ownerStatus="Active":a.ownerStatus="Inactive");const{data:l}=await L.upsertRecordsXML({to:"bsfjg3kz9",data:[{6:{value:t[3]},10:{value:JSON.stringify(a)}}],fieldsToReturn:[15],formatObject:15}),{setDisaStatusChecks:m}=Y(),{setDisaStatus:g}=q();m({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:l[0][15][10]}),g({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:l[0][15]}),u(l[0][15])}).catch(s=>{console.log(s),c(s)})}),ke=async({roster:e,project:t})=>{const r=[];e.forEach(async c=>{const p=new Promise((s,a)=>{const l=c.employee[556]&&c.employee[556][1].$d?c.employee[556][1].$d:null;(l?T(l).isSameOrAfter(T().subtract(T.duration({days:2})),"day"):!1)?s(c.employee[556]):ee({assignment:c,employee:c.employee,project:t}).then(g=>{s(g)}).catch(g=>{a(g)})});r.push(p)}),await Promise.allSettled(r);const{setDisaReady:u}=q();u({id:t[3]})},De=N({props:{row:Object,columns:Array},setup(e){const{getMatrixInputs:t,setMatrixInputs:r}=q(),u=V(!0),c=y(()=>t(e.row.employee[3]).sort((m,g)=>m[1].$d>g[1].$d?-1:1)),p=async()=>{c.value.length===0&&r({id:e.row.employee[3],data:e.row.employee[561]}),u.value=!1},s=({col:m})=>{const g=c.value.find(n=>n[21]===m.name);return g?m.type==="date"?T(g.value,"MM-DD-YYYY").format("MM/DD/YYYY"):g.value:null},a=y(()=>e.columns.filter(g=>g.dynamic)),l=y(()=>e.columns.filter(g=>!g.dynamic));return p(),{props:e,stored:c,loading:u,calculateValue:s,dynamicColumns:a,staticColumns:l}}}),Te={key:0},Pe={key:0},Ve={key:1},Ae={key:1},Ie={key:1};function Qe(e,t,r,u,c,p){return i(),D(Z,null,{default:v(()=>[e.loading?x("",!0):(i(),$(R,{key:0},[(i(!0),$(R,null,U(e.staticColumns,s=>(i(),D(z,{key:s.name},{default:v(()=>[K(P(s.value),1)]),_:2},1024))),128)),(i(!0),$(R,null,U(e.dynamicColumns,s=>(i(),D(z,{class:"text-center",key:s.name},{default:v(()=>[s.type!=="checkbox"?(i(),$("div",Te,[e.calculateValue({col:s})?(i(),$("span",Pe,P(e.calculateValue({col:s})),1)):(i(),$("span",Ve,"-"))])):(i(),$("div",Ae,[e.calculateValue({col:s})?(i(),D(M,{key:0,size:"sm",name:e.calculateValue({col:s})?"done":"check_box_outline_blank",color:e.calculateValue({col:s})?"positive":"negative"},null,8,["name","color"])):(i(),$("span",Ie,"-"))]))]),_:2},1024))),128))],64))]),_:1})}var xe=F(De,[["render",Qe]]);const Re=N({props:{project:Number,roster:Array},components:{TrainingMatrixRow:xe},setup(e){const{capitalize:t}=H,r=n=>{const d=n[20]!==""?t(n[20].toLowerCase().trim()):"",_=n[22]!==""?t(n[22].toLowerCase().trim()):"",C=n[21]!==""?` ${t(n[21].toLowerCase().trim())}`:"",A=n[23]!==""?` ${t(n[23])}`:"";return`${_}${A}, ${d}${C}`},u=n=>{const d=n.split(" "),_=[];return d.forEach((C,A)=>{const Q=t(C);_[A]=Q}),_.join(" ")},c=[{name:0,label:"Name",align:"left",field:n=>r(n.employee),format:n=>n,sortable:!0,sortOrder:"ad"}],{getMatrixColumns:p,setMatrixColumns:s}=q(),a=y(()=>p(e.project)),l=y(()=>{const n=[];return c.forEach(d=>{n.push(d)}),a.value.forEach(d=>{const _=d.default?{name:d[12],label:u(d[6]),align:"center",dynamic:!0,default:!0,type:d[8],sortable:!0}:{name:d[18],label:u(d[7]),align:"center",dynamic:!0,default:!1,type:d[13],sortable:!0};n.push(_)}),n.sort((d,_)=>d.name>_.name?1:-1)});async function m(){if(a.value.length===0&&e.project){const{data:n}=await L.fetchFromProjectsApp({fields:[G({type:"matrixColumns",query:`{'8'.EX.'false'}AND{'10'.EX.'${e.project}'}`})]}),d=await g(),_=[];n.forEach(C=>{_.push(C)}),d.forEach(C=>{_.push(C)}),s({id:e.project,data:_})}}async function g(){const{data:n}=await L.fetchFromProjectsApp({fields:[G({type:"availableMatrixColumns",query:"{'14'.EX.'true'}"})]});return n}return m(),{props:e,tableColumns:l,initialPagination:V({rowsPerPage:e.roster.length})}}}),qe={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function Me(e,t,r,u,c,p){const s=E("training-matrix-row");return i(),$("div",null,[b(J,{columns:e.tableColumns,rows:e.props.roster,"row-key":a=>a.employee[3],"title-class":e.$q.screen.gt.sm?"text-primary text-h6":"text-primary text-body1",title:"Training Matrix",class:"q-pa-sm",pagination:e.initialPagination,"onUpdate:pagination":t[0]||(t[0]=a=>e.initialPagination=a),"rows-per-page-options":[0],separator:"vertical","table-header-class":"bg-dark text-white","no-data-label":"There are no employees",grid:e.$q.screen.lt.sm,dense:""},{body:v(a=>[b(s,{columns:a.cols,row:a.row},null,8,["columns","row"])]),"no-data":v(({message:a})=>[w("div",qe,[b(M,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),w("span",null,P(a),1)])]),_:1},8,["columns","rows","row-key","title-class","pagination","grid"])])}var Ee=F(Re,[["render",Me],["__scopeId","data-v-71f7f8cd"]]);const Ne=N({props:{row:Object,columns:Array,project:Object},setup(e){const{getDisaStatusChecks:t}=Y(),r=V(!0),u=async()=>{Se({assignment:e.row,employee:e.row.employee,project:e.project}),r.value=!1},c=({col:a})=>{const l=t({id:e.row.employee[3],key:a.dataKey});return a.dataKey==="hasPendingRandom"?l?"Yes":"No":a.dataKey==="daysUntilWindowCloses"?l||"N/A":l?T(l).isValid()?T(l).format("MM/DD/YYYY"):l:null},p=y(()=>e.columns.filter(l=>l.dynamic)),s=y(()=>e.columns.filter(l=>!l.dynamic));return u(),{props:e,loading:r,calculateValue:c,dynamicColumns:p,staticColumns:s}}});function Fe(e,t,r,u,c,p){return i(),D(Z,null,{default:v(()=>[e.loading?x("",!0):(i(),$(R,{key:0},[(i(!0),$(R,null,U(e.staticColumns,s=>(i(),D(z,{key:s.name},{default:v(()=>[K(P(s.value),1)]),_:2},1024))),128)),(i(!0),$(R,null,U(e.dynamicColumns,s=>(i(),D(z,{class:"text-center",key:s.name},{default:v(()=>[w("div",null,[w("span",null,P(e.calculateValue({col:s})||"?"),1)])]),_:2},1024))),128))],64))]),_:1})}var Oe=F(Ne,[["render",Fe]]);const Ue=N({props:{project:Object,roster:Array,filter:String},components:{DisaMatrixRow:Oe},setup(e){const t=V({sortBy:null,descending:!1,page:1,rowsPerPage:25}),{capitalize:r}=H,{getProjectDisaRoster:u}=Y(),c=o=>{const h=o[20]!==""?r(o[20].toLowerCase().trim()):"",f=o[22]!==""?r(o[22].toLowerCase().trim()):"",j=o[21]!==""?` ${r(o[21].toLowerCase().trim())}`:"",I=o[23]!==""?` ${r(o[23])}`:"";return`${f}${I}, ${h}${j}`},p=o=>o.split(" ").join("_"),s=o=>{const h=o.split(" "),f=[];return h.forEach((j,I)=>{const ae=r(j);f[I]=ae}),f.join(" ")},a=o=>{const h=o.toLowerCase().trim();return h.includes("dccha")||h.includes("dcceo")||h.includes("upstream")?"lastUrineTest":h.includes("dccht")?"lastHairTest":h.includes("nasap")?"lastNASAPTest":h.includes("dccof")?"lastOralFluidTest":""},l=[{name:0,label:"Name",align:"left",field:o=>c(o.employee),format:o=>o,sortable:!0,sortOrder:"ad"},{name:1,dataKey:"ownerStatus",label:"Status",align:"center",dynamic:!0},{name:2,dataKey:"hasPendingRandom",label:"On Random",align:"center",dynamic:!0},{name:3,dataKey:"daysUntilWindowCloses",label:"Days Left",align:"center",dynamic:!0}],m=y(()=>e.project[321][10].split(",")),g=y(()=>{const o=[];return l.forEach(h=>{o.push(h)}),m.value.forEach(h=>{const f={name:p(h),dataKey:a(h),label:`${s(h)} Last Test`,align:"center",dynamic:!0};o.push(f)}),e.project[321][36]&&o.push({name:"bg",label:"Background Status",dataKey:"backgrounds",align:"center",dynamic:!0},{name:"bg_exp",label:"Background Expires",dataKey:"backgroundsExpDate",align:"center",dynamic:!0}),o.sort((h,f)=>h.name>f.name?1:-1)}),n=y(()=>e.project),d=y(()=>n.value[321]),_=y(()=>d.value?decodeURI(d.value[14]):""),C=y(()=>u(n.value[3])),A=y(()=>C.value.filter(o=>o.hasPendingRandom)),Q=y(()=>C.value.filter(o=>o.ownerStatus!=="Active")),S=y(()=>Q.value.length===0);console.log(e.roster);const O=o=>{console.log(o),t.value=o};return{props:e,tableColumns:g,initialPagination:V({rowsPerPage:e.roster.length}),projectData:n,ownerData:d,totalRoster:C,randoms:A,notActive:Q,specialRules:_,rosterCompliant:S,pageUpdated:O,pagination:t}}}),te=e=>(le("data-v-93af3fcc"),e=e(),ie(),e),ze={key:0},Ye=te(()=>w("span",{class:"text-positive text-body1 q-pr-md"},"Roster is in compliance.",-1)),Le={key:1},Ke={class:"text-negative text-body1 q-pr-md"},Be={class:"text-right"},Xe=te(()=>w("div",{class:"text-body1 text-info"},"Owner Special Rules",-1)),We={class:"text-body2 text-italic text-info"},Ge={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function He(e,t,r,u,c,p){const s=E("disa-matrix-row");return i(),$("div",null,[b(J,{columns:e.tableColumns,rows:e.props.roster,"row-key":a=>a.employee[3],class:"q-pa-sm sticky-header-table",filter:e.filter?e.filter.trim():null,pagination:e.initialPagination,"onUpdate:pagination":t[0]||(t[0]=a=>e.initialPagination=a),"rows-per-page-options":[0],separator:"vertical","table-header-class":"bg-dark text-white","no-data-label":"There are no employees",grid:e.$q.screen.lt.sm,dense:""},{"top-left":v(()=>[e.rosterCompliant?(i(),$("div",ze,[Ye,b(M,{color:"positive",name:"task_alt",size:"sm"})])):(i(),$("div",Le,[w("span",Ke,P(e.notActive.length)+" out of compliance.",1),b(M,{color:"negative",name:"error",size:"sm"})])),w("div",null,[w("div",{class:ne(["text-body2 text-italic",e.randoms.length>0?"text-negative":"text-positive"])},P(e.randoms.length)+" pending randoms",3)])]),"top-right":v(()=>[w("div",Be,[Xe,w("div",We,P(e.specialRules),1)])]),body:v(a=>[b(s,{columns:a.cols,row:a.row,project:e.projectData},null,8,["columns","row","project"])]),"no-data":v(({message:a})=>[w("div",Ge,[b(M,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),w("span",null,P(a),1)])]),_:1},8,["columns","rows","row-key","filter","pagination","grid"])])}var Je=F(Ue,[["render",He],["__scopeId","data-v-93af3fcc"]]);const Ze=N({name:"Compliance",components:{MatrixTab:Ee,DisaTab:Je,projectSelector:$e},setup(){const e=ve(),t=we(),r=_e(),u=V(0),c=V(""),p=V(null),{getSelectedProject:s,getProjects:a}=B(t),{getAssignments:l,fetchAllAssignments:m,fetchAssignments:g,getDisaReady:n}=q(),{getUserType:d,getUser:_}=B(r),C=y(()=>l(S.value).sort((j,I)=>j[1].$d<I[1].$d?1:-1).filter(j=>!j[112]&&j.latest&&j[102]==="Active")),A=y(()=>{let f=C.value;return f=p.value?f.filter(j=>j[68]===p.value):f,f.sort((j,I)=>j.employee[22]>I.employee[22]?1:-1)}),Q=y(()=>[...new Map(C.value.map(f=>[f[68],f[68]])).values()]),S=y(()=>s.value?s.value[3]:null),O=y(()=>S.value?a.value({userType:d.value,selectedId:_.value[3],can:"read"}).find(f=>f[3]===S.value)[322]!==null:!1),o=y(()=>S.value?a.value({userType:d.value,selectedId:_.value[3],can:"read"}).find(f=>f[3]===S.value):null);async function h(){e.loading.show(),S.value?(await g({projectId:S.value}),O.value&&ke({roster:C.value,project:o.value})):await m(),e.loading.hide()}return ce(S,(f,j)=>{h()}),{tab:u,projectFilterValue:S,search:c,isDisaProject:O,project:o,rows:A,craftOptions:Q,craftFilter:p,getDisaReady:n}}}),et={class:"q-pa-md"},tt={class:"row items-center"},at={class:"col-12 col-md-3"},st={class:"col-12 col-md-3 q-px-sm"},ot={class:"col-12 col-md-3 q-px-sm"},rt={key:0};function nt(e,t,r,u,c,p){const s=E("projectSelector"),a=E("matrix-tab"),l=E("disa-tab");return i(),D(he,{style:{"max-width":"100vw"}},{default:v(()=>[w("div",et,[b(ue,{flat:""},{default:v(()=>[b(de,null,{default:v(()=>[w("div",tt,[w("div",at,[b(s,{dense:""})]),w("div",st,[b(me,{dense:"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=m=>e.search=m),label:"Search"},null,8,["modelValue"])]),w("div",ot,[b(pe,{dense:"",label:"Filter by Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":t[1]||(t[1]=m=>e.craftFilter=m),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),e.projectFilterValue?(i(),$("div",rt,[b(ge,{class:"bg-info text-white shadow-2 rounded-borders"},{default:v(()=>[b(ye,{modelValue:e.tab,"onUpdate:modelValue":t[2]||(t[2]=m=>e.tab=m),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:v(()=>[b(X,{name:0,label:"Matrix"}),e.isDisaProject?(i(),D(X,{key:0,name:1,disable:!e.getDisaReady(e.projectFilterValue)},{default:v(()=>[w("div",null,[K(" Disa "),e.getDisaReady(e.projectFilterValue)?x("",!0):(i(),D(je,{key:0,color:"white",size:"2em"}))])]),_:1},8,["disable"])):x("",!0)]),_:1},8,["modelValue"])]),_:1}),b(fe,{modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=m=>e.tab=m),animated:""},{default:v(()=>[b(W,{name:0},{default:v(()=>[b(a,{project:e.projectFilterValue,roster:e.rows},null,8,["project","roster"])]),_:1}),e.isDisaProject?(i(),D(W,{key:0,name:1},{default:v(()=>[b(l,{project:e.project,roster:e.rows,filter:e.search},null,8,["project","roster","filter"])]),_:1})):x("",!0)]),_:1},8,["modelValue"])])):x("",!0)])]),_:1})}var Et=F(Ze,[["render",nt]]);export{Et as default};
