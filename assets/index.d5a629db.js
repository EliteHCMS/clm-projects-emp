import{Q as W,a as De,b as H}from"./QTabPanels.1a2b5b1e.js";import{Q as je}from"./QTabs.a3e7b08b.js";import{Q as Pe}from"./QToolbar.1e286d91.js";import{Q as Ve}from"./QPage.49220ad5.js";import{l as se,bW as re,bV as fe,r as v,bX as K,c as j,w as G,_ as Z,b7 as T,B as k,C as U,d as a,bt as m,cW as O,E as p,at as z,cX as B,cV as ee,o as Se,bS as ce,aa as ue,ae as oe,bY as me,z as Ae,az as Ce,as as J}from"./index.8838c464.js";import{a as ve}from"./QSelect.78b00ca7.js";import{u as ae}from"./use-quasar.ed4be5d9.js";import{u as ne}from"./dataStore.3ad5bd5e.js";import{u as ie}from"./dataStore.a53dbdfc.js";import{c as te,q as be,u as Ye,i as pe}from"./app.42c36b1f.js";import{dayjs as Y}from"./dayjs.106d80ab.js";import{u as ge}from"./useQuerySaver.d29ff9ee.js";import{R as $e,g as qe}from"./quickbaseDataHelpers.491fa56a.js";import{_ as le}from"./projectSelector.5f0831d7.js";import{Q as Re}from"./QTd.1bc00af2.js";import{Q as ke}from"./QInnerLoading.ca28e90a.js";import{Q as Ie}from"./QTable.2b553278.js";import{e as Ne}from"./export-file.dc78ba05.js";import{P as Qe}from"./projectPipeline.b8321cfc.js";import"./use-panel.9c83e7d4.js";import"./touch.3df10340.js";import"./selection.26380b58.js";import"./QResizeObserver.9199488f.js";import"./rtl.b51694b1.js";import"./QChip.5ba75959.js";import"./QMenu.b8edc490.js";import"./position-engine.cba8bd09.js";import"./localForage.ca6e9d39.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.04bc0a32.js";import"./i18n.c69e89dd.js";import"./QTr.1a2ec5e9.js";import"./index.2e95e514.js";import"./arrivalDate.d2bad71a.js";import"./QTooltip.72214d5e.js";import"./QForm.fc17450c.js";import"./vee-validate.esm.ac2c348d.js";import"./array.59f93f43.js";import"./QList.43880dff.js";import"./QMarkupTable.8c4a6d35.js";import"./use-fullscreen.abb80350.js";const Me=se({props:{},components:{RosterTable:$e,projectSelector:le},setup(l){const o=ae(),h=re(),P=fe(),$=te(),S=v(""),b=v(null),c=v(null),{getSelectedProject:n}=K($),{getAssignments:I,fetchAllAssignments:q,fetchAssignments:F}=ne(),{getManpowerData:E,setRosters:A}=ie(),u=j(()=>h.params.id?h.params.id:null),w=j(()=>n.value?n.value[3]:null),C=j(()=>{let t;return u.value?t=(E({dataset:"rosters",id:u.value})||[]).sort((r,_)=>r[1].$d<_[1].$d?1:-1):t=I(w.value).sort((s,r)=>s[1].$d<r[1].$d?1:-1),t.filter(s=>!s[112]&&s.latest&&s[102]==="Active")}),Q=j(()=>{let t=[];return C.value.forEach(s=>{s[75].toLowerCase().includes(S.value.toLowerCase())&&t.push(s)}),t=b.value?t.filter(s=>Y(s[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Y(b.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=c.value?t.filter(s=>s[68]===c.value):t,t.sort((s,r)=>s.employee[22]>r.employee[22]?1:-1)}),y=j(()=>[...new Map(C.value.map(t=>[t[68],t[68]])).values()]),N=async t=>{o.loading.show(),h.query&&h.query.refresh&&(t=!0,P.push({query:{}})),u.value?(t||!E({dataset:"rosters",id:u.value}))&&await i():w.value?await F({projectId:w.value,refresh:t}):await q({refresh:t}),o.loading.hide()},i=async()=>{const t=`{'173'.EX.'${u.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:s}=await be.fetchFromHiringApp({fields:[ge({type:"assignments",query:t})]});A({id:u.value,data:s})};return G(w,()=>{N()}),N(),{allAssignments:C,search:S,startDateFilter:b,craftFilter:c,craftOptions:y,rows:Q,loadData:N}}}),Te={class:"row items-center"},Ee={key:0,class:"col-12 col-md-3"},Fe={class:"col-12 col-md-3 q-px-sm"},Ue={class:"col-12 col-md-3 q-px-sm"},xe={class:"col-12 col-md-3 q-px-sm"};function ze(l,o,h,P,$,S){const b=T("projectSelector"),c=T("roster-table");return k(),U("div",null,[a(ee,{flat:""},{default:m(()=>[a(O,null,{default:m(()=>[p("div",Te,[l.$route.params.id?z("",!0):(k(),U("div",Ee,[a(b,{dense:""})])),p("div",Fe,[a(B,{dense:"",modelValue:l.search,"onUpdate:modelValue":o[0]||(o[0]=n=>l.search=n),label:"Search"},null,8,["modelValue"])]),p("div",Ue,[a(B,{dense:"",modelValue:l.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=n=>l.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),p("div",xe,[a(ve,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:l.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=n=>l.craftFilter=n),options:l.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(c,{rows:l.rows,onRefreshData:o[3]||(o[3]=n=>l.loadData(!0)),title:"Active Roster"},null,8,["rows"])])}var Be=Z(Me,[["render",ze]]);const Le=se({props:{},components:{RosterTable:$e,projectSelector:le},setup(l){const o=ae(),h=re(),P=te(),$=v(""),S=v(null),b=v(null),{getSelectedProject:c}=K(P),{getAssignments:n,fetchAllAssignments:I,fetchAssignments:q}=ne(),{getManpowerData:F,setRosters:E}=ie(),A=j(()=>h.params.id?h.params.id:null),u=j(()=>c.value?c.value[3]:null),w=j(()=>{let i;const t=Y().subtract(14,"day");return A.value?i=(F({dataset:"rosters",id:A.value})||[]).sort((r,_)=>r[1].$d<_[1].$d?1:-1):i=n(u.value).sort((s,r)=>s[1].$d<r[1].$d?1:-1),i.filter(s=>!s[112]&&s.latest&&s[102]==="Active"&&Y(s[1].$d).isSameOrAfter(t)&&Y(s[1].$d).isSameOrBefore(Y()))}),C=j(()=>{let i=[];return w.value.forEach(t=>{t[75].toLowerCase().includes($.value.toLowerCase())&&i.push(t)}),i=S.value?i.filter(t=>Y(t[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Y(S.value).tz("America/Chicago").format("MM/DD/YYYY")):i,i=b.value?i.filter(t=>t[68]===b.value):i,i.sort((t,s)=>t.employee[22]>s.employee[22]?1:-1)}),Q=j(()=>[...new Map(w.value.map(i=>[i[68],i[68]])).values()]),y=async i=>{o.loading.show(),A.value?(i||!F({dataset:"rosters",id:A.value}))&&await N():u.value?await q({projectId:u.value,refresh:i}):await I({refresh:i}),o.loading.hide()},N=async()=>{const i=`{'173'.EX.'${A.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:t}=await be.fetchFromProjectsApp({fields:[ge({type:"assignments",query:i})]});E({id:A.value,data:t})};return{allAssignments:w,search:$,startDateFilter:S,craftFilter:b,craftOptions:Q,rows:C,loadData:y}}}),Oe={class:"row items-center"},Xe={key:0,class:"col-12 col-md-3"},We={class:"col-12 col-md-3 q-px-sm"},He={class:"col-12 col-md-3 q-px-sm"},Je={class:"col-12 col-md-3 q-px-sm"};function Ge(l,o,h,P,$,S){const b=T("projectSelector"),c=T("roster-table");return k(),U("div",null,[a(ee,{flat:""},{default:m(()=>[a(O,null,{default:m(()=>[p("div",Oe,[l.$route.params.id?z("",!0):(k(),U("div",Xe,[a(b,{dense:""})])),p("div",We,[a(B,{dense:"",modelValue:l.search,"onUpdate:modelValue":o[0]||(o[0]=n=>l.search=n),label:"Search"},null,8,["modelValue"])]),p("div",He,[a(B,{dense:"",modelValue:l.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=n=>l.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),p("div",Je,[a(ve,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:l.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=n=>l.craftFilter=n),options:l.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(c,{rows:l.rows,onRefreshData:o[3]||(o[3]=n=>l.loadData(!0)),title:"New Arrivals"},null,8,["rows"])])}var Ke=Z(Le,[["render",Ge]]);const Ze={class:"row items-center"},ea={key:0,class:"col-12 col-md-3"},aa={class:"col-12 col-md-3 q-px-sm"},ta={class:"col-12 col-md-3 q-px-sm"},la=p("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),oa={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},sa={class:"text-dark text-caption text-italic"},ra={__name:"releases",setup(l){const o=fe(),h=ae(),P=te(),{getUserType:$,getUser:S}=Ye(),{getProjects:b,getSelectedProject:c,getSelectedOffice:n}=K(P),{capitalize:I}=Ae,q=v(n.value?n.value[8]:null),F=v(c.value?c.value[3]:null),E=v($==="Project User"?S[3]:q),A=v(),u=v([]),w=v(""),C=v(""),Q=v(!1),y=v({sortBy:"effectiveDate",descending:!0,page:1,rowsPerPage:25,rowsNumber:0});$==="QuickBase User"&&G(n,()=>{q.value=n.value?n.value[8]:null,_()}),$==="Project User"&&G(c,()=>{F.value=c.value?c.value[3]:null,_()}),G(C,()=>{_()});const N=v([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${t(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0}]),i=v([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${t(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0}]),t=e=>{const D=e.split(" ");let d="";return D.forEach((f,M)=>{d+=M>0?` ${I(f.toLowerCase())}`:I(f.toLowerCase())}),d},s=({page:e,pageSize:D,descending:d,filter:f,sortBy:M})=>{try{let R="";f&&(R=f.trim());let x=null;c.value?x=c.value[3]:(x=[],b.value({userType:$,selectedId:E.value,can:"read"}).forEach(g=>{x.push(g[3])}));const V={...f&&{$or:[{fullName:{$containsi:`${R}`}},{classification:{$containsi:`${R}`}},{jobNumber:{$containsi:`${R}`}},{workdayId:{$containsi:`${R}`}},{phoneNumber:{$containsi:`${R}`}},{payrollId:{$containsi:`${R}`}}]},...C.value&&{effectiveDate:{$eq:C.value}},projectRID:{$eq:x}};return pe.getReleases({pagination:{page:e,pageSize:D},sort:`${M||"releaseDateCreated"}:${d?"desc":"asc"}`,filters:V}).then(g=>{const{data:L,meta:he}=g,de=[];return L.forEach(_e=>{de.push(pe.formatObject(_e.syncObject))}),Q.value=!1,{data:de,meta:he}})}catch{Q.value=!1}},r=async e=>{const{page:D,rowsPerPage:d,sortBy:f,descending:M}=e.pagination,R=e.filter,x=d===0?y.value.rowsNumber:d;Q.value=!0;const V=await s({page:D,sortBy:f,descending:M,pageSize:x,filter:R});if(Q.value=!1,V){const{data:g,meta:L}=V;u.value.splice(0,u.value.length,...g),y.value.page=L.pagination.page,y.value.sortBy=f,y.value.descending=M,y.value.rowsPerPage=L.pagination.pageSize,y.value.rowsPerPage=L.pagination.pageSize,y.value.rowsNumber=L.pagination.total}};Se(()=>{A.value.requestServerInteraction()});const _=()=>{A.value.requestServerInteraction()};function X(e,D,d){let f=D!==void 0?D(e,d):e;return f=f==null?"":String(f),f=f.split('"').join('""'),`"${f}"`}const we=async()=>{const{page:e,rowsNumber:D,sortBy:d,descending:f}=y.value,M=await s({page:e,sortBy:d,descending:f,pageSize:D,filter:w.value});let R=[N.value.map(V=>X(V.label))].concat(u.value.map(V=>N.value.map(g=>X(typeof g.field=="function"?g.field(V):V[g.field===void 0?g.name:g.field],g.format,V)).join(","))).join(`\r
`);M&&M.data&&(R=[i.value.map(V=>X(V.label))].concat(M.data.map(V=>i.value.map(g=>X(typeof g.field=="function"?g.field(V):V[g.field===void 0?g.name:g.field],g.format,V)).join(","))).join(`\r
`)),Ne(`${Y().format("MM.DD.YYYY")} Releases-Export.csv`,R,"text/csv")!==!0&&h.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};function ye(e){o.push({name:"view-release",params:{release:e[3]}})}return(e,D)=>(k(),U("div",null,[a(ee,{flat:""},{default:m(()=>[a(O,null,{default:m(()=>[p("div",Ze,[e.$route.params.id?z("",!0):(k(),U("div",ea,[a(le,{debounce:"300",dense:""})])),p("div",aa,[a(B,{dense:"",debounce:"300",modelValue:w.value,"onUpdate:modelValue":D[0]||(D[0]=d=>w.value=d),label:"Search"},null,8,["modelValue"])]),p("div",ta,[a(B,{dense:"",debounce:"300",modelValue:C.value,"onUpdate:modelValue":D[1]||(D[1]=d=>C.value=d),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])]),la])]),_:1})]),_:1}),p("div",null,[a(Ie,{title:"Releases","title-class":"text-h5 text-primary",ref_key:"tableRef",ref:A,columns:N.value,rows:u.value,"row-key":d=>d[3],class:"q-pa-sm",pagination:y.value,"onUpdate:pagination":D[2]||(D[2]=d=>y.value=d),"table-header-class":"bg-dark text-white","no-data-label":"There are no releases",dense:"","binary-state-sort":"",filter:w.value,onRequest:r},{"body-cell-action":m(d=>[a(Re,{props:d},{default:m(()=>[a(ce,{class:"cursor-pointer",size:ue(h).screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:f=>ye(d.row),name:d.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1032,["props"])]),"no-data":m(({message:d})=>[p("div",oa,[a(ce,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),p("span",null,oe(d),1)])]),"top-right":m(()=>[p("div",sa,"(Total: "+oe(y.value.rowsNumber)+" releases)",1),a(me,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:_}),a(me,{dense:ue(h).screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:we,disable:y.value.rowsNumber<1},null,8,["dense","disable"])]),loading:m(()=>[a(ke,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","filter"])])]))}},na={name:"Pipeline",components:{ProjectPipelineTable:Qe,projectSelector:le},setup(){const l=ae(),o=re(),h=te(),P=v(null),$=v(""),{getSelectedProject:S}=K(h),{fetchAllDeployments:b,fetchAllInProcess:c,fetchAllPending:n,getDeployments:I,getInProcess:q,getPending:F}=ne(),{getManpowerData:E,setPipelines:A}=ie(),u=j(()=>o.params.id?o.params.id:null),w=j(()=>S.value?S.value[3]:null),C=j(()=>I(w.value).filter(r=>r[20]==="Complete")),Q=j(()=>{const r=[];return I(w.value).forEach(_=>{_[31].toLowerCase().includes($.value.toLowerCase())&&r.push(_)}),r}),y=j(()=>{const r=[];return F(w.value).forEach(_=>{_[25].toLowerCase().includes($.value.toLowerCase())&&r.push(_)}),r}),N=j(()=>{const r=[];return q(w.value).forEach(_=>{_[39].toLowerCase().includes($.value.toLowerCase())&&r.push(_)}),r}),i=j(()=>{let r;return u.value?r=E({dataset:"pipelines",id:u.value})||[]:r=N.value.concat(y.value.concat(Q.value)),r}),t=async r=>{l.loading.show(),u.value?(r||!E({dataset:"pipelines",id:u.value}))&&await s():(await b(r),await c(r),await n(r)),l.loading.hide()},s=async()=>{const r=await qe(u.value);A({id:u.value,data:r})};return t(),{projectFilter:P,arrived:C,allPipeline:i,search:$,loadData:t}}},ia={class:"text-h5 text-dark"},da={class:"text-body2 text-italic q-ml-sm"},ca=p("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),ua={class:"row items-center"},ma={key:0,class:"col-12 col-md-3 q-px-sm"},pa={class:"col-12 col-md-3 q-px-sm"};function fa(l,o,h,P,$,S){const b=T("projectSelector"),c=T("project-pipeline-table");return k(),U("div",null,[a(ee,{flat:""},{default:m(()=>[a(O,{class:"q-pb-none"},{default:m(()=>[p("div",ia,[Ce(" Staffing Pipeline "),p("span",da,"("+oe(P.allPipeline.length)+" total)",1)]),ca]),_:1}),a(O,null,{default:m(()=>[p("div",ua,[l.$route.params.id?z("",!0):(k(),U("div",ma,[a(b,{dense:""})])),p("div",pa,[a(B,{dense:"",modelValue:P.search,"onUpdate:modelValue":o[0]||(o[0]=n=>P.search=n),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(c,{rows:P.allPipeline,onRefresh:o[1]||(o[1]=n=>P.loadData(!0))},null,8,["rows"])])}var va=Z(na,[["render",fa]]);const ba=se({name:"Employees",components:{RosterTab:Be,NewArrivalsTab:Ke,ReleasesTab:ra,PipelineTab:va},setup(){return{tab:v(0)}}}),ga={class:"q-pa-md"};function $a(l,o,h,P,$,S){const b=T("roster-tab"),c=T("new-arrivals-tab"),n=T("pipeline-tab"),I=T("releases-tab");return k(),J(Ve,{style:{"max-width":"100vw"}},{default:m(()=>[p("div",ga,[a(Pe,{class:"bg-info text-white shadow-2 rounded-borders"},{default:m(()=>[a(je,{modelValue:l.tab,"onUpdate:modelValue":o[0]||(o[0]=q=>l.tab=q),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:m(()=>[a(W,{name:0,label:l.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),a(W,{name:1,label:"New Arrivals"}),l.$route.name==="project-manpower"?(k(),J(W,{key:0,name:3,label:"Pipeline"})):z("",!0),l.$can("read","releases")?(k(),J(W,{key:1,name:2,label:"Releases"})):z("",!0)]),_:1},8,["modelValue"])]),_:1}),a(De,{modelValue:l.tab,"onUpdate:modelValue":o[1]||(o[1]=q=>l.tab=q),animated:""},{default:m(()=>[a(H,{name:0},{default:m(()=>[a(b)]),_:1}),a(H,{name:1},{default:m(()=>[a(c)]),_:1}),a(H,{name:3},{default:m(()=>[a(n)]),_:1}),l.$can("read","releases")?(k(),J(H,{key:0,name:2},{default:m(()=>[a(I)]),_:1})):z("",!0)]),_:1},8,["modelValue"])])]),_:1})}var rt=Z(ba,[["render",$a]]);export{rt as default};
