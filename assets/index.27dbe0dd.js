import{Q as G,a as _e,b as J}from"./QTabPanels.7f2b2f83.js";import{Q as he}from"./QTabs.3a560d12.js";import{Q as De}from"./QToolbar.6b905ef4.js";import{Q as qe}from"./QPage.8d15663e.js";import{bW as W,bV as ne,r as v,bX as ee,c as w,w as Z,B as A,C as N,d as l,bt as i,cW as F,E as u,aa as X,at as U,cX as z,cV as ae,o as Ve,bS as ce,ae as re,bY as me,z as Pe,az as je,as as K}from"./index.960d5b34.js";import{a as pe}from"./QSelect.ce23f885.js";import{u as te}from"./use-quasar.09536e80.js";import{u as ie}from"./dataStore.1da58b7a.js";import{u as ue}from"./dataStore.d3a4115a.js";import{c as le,q as ve,u as Ae,i as fe}from"./app.bda2cd70.js";import{dayjs as V}from"./dayjs.501e8a8e.js";import{u as be}from"./useQuerySaver.d29ff9ee.js";import{R as ge,g as xe}from"./quickbaseDataHelpers.3254b19b.js";import{_ as se}from"./projectSelector.32d51d56.js";import{Q as Ye}from"./QTd.e3f90e32.js";import{Q as Se}from"./QInnerLoading.13b17dc0.js";import{Q as Re}from"./QTable.2cc075de.js";import{e as ke}from"./export-file.dc78ba05.js";import{P as Qe}from"./projectPipeline.91fab734.js";import"./use-panel.98705a6b.js";import"./touch.3df10340.js";import"./selection.4cab378b.js";import"./QResizeObserver.b1215cec.js";import"./rtl.b51694b1.js";import"./QChip.e4d2f168.js";import"./QMenu.dd57348b.js";import"./position-engine.40859e34.js";import"./localForage.84a30b23.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.04bc0a32.js";import"./i18n.2abc02f2.js";import"./QTr.4b36010c.js";import"./index.3d38bdab.js";import"./arrivalDate.defa95ba.js";import"./QTooltip.7454b396.js";import"./QForm.f3e65354.js";import"./vee-validate.esm.d4095220.js";import"./array.164cfe36.js";import"./QList.c2993b6b.js";import"./QMarkupTable.17a90ccc.js";import"./use-fullscreen.7e074d8e.js";const Ie={class:"row items-center"},Ce={key:0,class:"col-12 col-md-3"},Me={class:"col-12 col-md-3 q-px-sm"},Ne={class:"col-12 col-md-3 q-px-sm"},Oe={class:"col-12 col-md-3 q-px-sm"},Te={__name:"roster",setup(L){const b=te(),r=W(),m=ne(),h=le(),f=v(""),D=v(null),q=v(null),{getSelectedProject:_}=ee(h),{getAssignments:x,fetchAllAssignments:C,fetchAssignments:M}=ie(),{getManpowerData:S,setRosters:O}=ue(),n=w(()=>r.params.id?r.params.id:null),g=w(()=>_.value?_.value[3]:null);if(r.query){const t=Object.assign({},r.query);delete t.tab,m.replace({query:t})}const P=w(()=>{let t;return n.value?t=(S({dataset:"rosters",id:n.value})||[]).sort((s,Q)=>s[1].$d<Q[1].$d?1:-1):t=x(g.value).sort((a,s)=>a[1].$d<s[1].$d?1:-1),t.filter(a=>!a[112]&&a.latest&&a[102]==="Active")}),Y=w(()=>{let t=P.value;return t=D.value?t.filter(a=>V(a[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===V(D.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=q.value?t.filter(a=>a[68]===q.value):t,t.sort((a,s)=>a.employee[22]>s.employee[22]?1:-1)}),R=w(()=>[...new Map(P.value.map(t=>[t[68],t[68]])).values()]),d=async t=>{b.loading.show(),r.query&&r.query.refresh&&(t=!0,m.push({query:{}})),n.value?(t||!S({dataset:"rosters",id:n.value}))&&await k():g.value?await M({projectId:g.value,refresh:t}):await C({refresh:t}),b.loading.hide()},k=async()=>{const t=`{'173'.EX.'${n.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:a}=await ve.fetchFromHiringApp({fields:[be({type:"assignments",query:t})]});O({id:n.value,data:a})};return Z(g,()=>{d()}),d(),(t,a)=>(A(),N("div",null,[l(ae,{flat:""},{default:i(()=>[l(F,null,{default:i(()=>[u("div",Ie,[X(r).params.id?U("",!0):(A(),N("div",Ce,[l(se,{dense:""})])),u("div",Me,[l(z,{dense:"",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),label:"Search"},null,8,["modelValue"])]),u("div",Ne,[l(z,{dense:"",modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=s=>D.value=s),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Oe,[l(pe,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=s=>q.value=s),options:R.value,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(ge,{rows:Y.value,onRefreshData:a[3]||(a[3]=s=>d(!0)),filter:f.value,title:"Active Roster"},null,8,["rows","filter"])]))}},Ue={class:"row items-center"},ze={key:0,class:"col-12 col-md-3"},Ee={class:"col-12 col-md-3 q-px-sm"},Be={class:"col-12 col-md-3 q-px-sm"},Fe={class:"col-12 col-md-3 q-px-sm"},Xe={__name:"newArrivals",setup(L){const b=te(),r=ne(),m=W(),h=le(),f=v(""),D=v(null),q=v(null),{getSelectedProject:_}=ee(h),{getAssignments:x,fetchAllAssignments:C,fetchAssignments:M}=ie(),{getManpowerData:S,setRosters:O}=ue(),n=w(()=>m.params.id?m.params.id:null),g=w(()=>_.value?_.value[3]:null);if(m.query){const t=Object.assign({},m.query);t.tab="newArrivals",r.replace({query:t})}const P=w(()=>{let t;const a=V().subtract(14,"day");return n.value?t=(S({dataset:"rosters",id:n.value})||[]).sort((Q,E)=>Q[1].$d<E[1].$d?1:-1):t=x(g.value).sort((s,Q)=>s[1].$d<Q[1].$d?1:-1),t.filter(s=>!s[112]&&s.latest&&s[102]==="Active"&&V(s[1].$d).isSameOrAfter(a)&&V(s[1].$d).isSameOrBefore(V()))}),Y=w(()=>{let t=P.value;return t=D.value?t.filter(a=>V(a[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===V(D.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=q.value?t.filter(a=>a[68]===q.value):t,t.sort((a,s)=>a.employee[22]>s.employee[22]?1:-1)}),R=w(()=>[...new Map(P.value.map(t=>[t[68],t[68]])).values()]),d=async t=>{b.loading.show(),n.value?(t||!S({dataset:"rosters",id:n.value}))&&await k():g.value?await M({projectId:g.value,refresh:t}):await C({refresh:t}),b.loading.hide()},k=async()=>{const t=`{'173'.EX.'${n.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:a}=await ve.fetchFromProjectsApp({fields:[be({type:"assignments",query:t})]});O({id:n.value,data:a})};return(t,a)=>(A(),N("div",null,[l(ae,{flat:""},{default:i(()=>[l(F,null,{default:i(()=>[u("div",Ue,[X(m).params.id?U("",!0):(A(),N("div",ze,[l(se,{dense:""})])),u("div",Ee,[l(z,{dense:"",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=s=>f.value=s),label:"Search"},null,8,["modelValue"])]),u("div",Be,[l(z,{dense:"",modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=s=>D.value=s),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Fe,[l(pe,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=s=>q.value=s),options:R.value,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(ge,{rows:Y.value,onRefreshData:a[3]||(a[3]=s=>d(!0)),title:"New Arrivals",filter:f.value},null,8,["rows","filter"])]))}},We={class:"row items-center"},Le={key:0,class:"col-12 col-md-3"},He={class:"col-12 col-md-3 q-px-sm"},Ge={class:"col-12 col-md-3 q-px-sm"},Je=u("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),Ke={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Ze={class:"text-dark text-caption text-italic"},ea={__name:"releases",setup(L){const b=ne(),r=W(),m=te(),h=le(),{getUserType:f,getUser:D}=Ae(),{getProjects:q,getSelectedProject:_,getSelectedOffice:x}=ee(h),{capitalize:C}=Pe,M=v(x.value?x.value[8]:null),S=v(_.value?_.value[3]:null),O=v(f==="Project User"?D[3]:M),n=v(),g=v([]),P=v(""),Y=v(""),R=v(!1),d=v({sortBy:"effectiveDate",descending:!0,page:1,rowsPerPage:25,rowsNumber:0});if(r.query){const e=Object.assign({},r.query);e.tab="releases",b.replace({query:e})}f==="QuickBase User"&&Z(x,()=>{M.value=x.value?x.value[8]:null,E()}),f==="Project User"&&Z(_,()=>{S.value=_.value?_.value[3]:null,E()}),Z(Y,()=>{E()});const k=v([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${a(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e.replace("&amp;","&")}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:42,label:"Status",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1,sortOrder:"ad"}]),t=v([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${a(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e.replace("&amp;","&")}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:42,label:"Status",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1,sortOrder:"ad"}]),a=e=>{const y=e.split(" ");let o="";return y.forEach((c,I)=>{o+=I>0?` ${C(c.toLowerCase())}`:C(c.toLowerCase())}),o},s=({page:e,pageSize:y,descending:o,filter:c,sortBy:I})=>{try{let j="";c&&(j=c.trim());let T=null;_.value?T=_.value[3]:(T=[],q.value({userType:f,selectedId:O.value,can:"read"}).forEach(p=>{T.push(p[3])}));const $={...c&&{$or:[{fullName:{$containsi:`${j}`}},{classification:{$containsi:`${j}`}},{jobNumber:{$containsi:`${j}`}},{workdayId:{$containsi:`${j}`}},{phoneNumber:{$containsi:`${j}`}},{payrollId:{$containsi:`${j}`}}]},...Y.value&&{effectiveDate:{$eq:Y.value}},projectRID:{$eq:T}};return fe.getReleases({pagination:{page:e,pageSize:y},sort:`${I||"releaseDateCreated"}:${o?"desc":"asc"}`,filters:$}).then(p=>{const{data:B,meta:we}=p,de=[];return B.forEach(oe=>{oe.syncObject[48]=oe.syncObject[48].replace("&amp;","&"),de.push(fe.formatObject(oe.syncObject))}),R.value=!1,{data:de,meta:we}})}catch{R.value=!1}},Q=async e=>{const{page:y,rowsPerPage:o,sortBy:c,descending:I}=e.pagination,j=e.filter,T=o===0?d.value.rowsNumber:o;R.value=!0;const $=await s({page:y,sortBy:c,descending:I,pageSize:T,filter:j});if(R.value=!1,$){const{data:p,meta:B}=$;g.value.splice(0,g.value.length,...p),d.value.page=B.pagination.page,d.value.sortBy=c,d.value.descending=I,d.value.rowsPerPage=B.pagination.pageSize,d.value.rowsPerPage=B.pagination.pageSize,d.value.rowsNumber=B.pagination.total}};Ve(()=>{n.value.requestServerInteraction()});const E=()=>{n.value.requestServerInteraction()};function H(e,y,o){let c=y!==void 0?y(e,o):e;return c=c==null?"":String(c),c=c.split('"').join('""'),`"${c}"`}const ye=async()=>{const{page:e,rowsNumber:y,sortBy:o,descending:c}=d.value,I=await s({page:e,sortBy:o,descending:c,pageSize:y,filter:P.value});let j=[k.value.map($=>H($.label))].concat(g.value.map($=>k.value.map(p=>H(typeof p.field=="function"?p.field($):$[p.field===void 0?p.name:p.field],p.format,$)).join(","))).join(`\r
`);I&&I.data&&(j=[t.value.map($=>H($.label))].concat(I.data.map($=>t.value.map(p=>H(typeof p.field=="function"?p.field($):$[p.field===void 0?p.name:p.field],p.format,$)).join(","))).join(`\r
`)),ke(`${V().format("MM.DD.YYYY")} Releases-Export.csv`,j,"text/csv")!==!0&&m.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};function $e(e){b.push({name:"view-release",params:{release:e[3]}})}return(e,y)=>(A(),N("div",null,[l(ae,{flat:""},{default:i(()=>[l(F,null,{default:i(()=>[u("div",We,[e.$route.params.id?U("",!0):(A(),N("div",Le,[l(se,{debounce:"300",dense:""})])),u("div",He,[l(z,{dense:"",debounce:"300",modelValue:P.value,"onUpdate:modelValue":y[0]||(y[0]=o=>P.value=o),label:"Search"},null,8,["modelValue"])]),u("div",Ge,[l(z,{dense:"",debounce:"300",modelValue:Y.value,"onUpdate:modelValue":y[1]||(y[1]=o=>Y.value=o),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])]),Je])]),_:1})]),_:1}),u("div",null,[l(Re,{title:"Releases","title-class":"text-h5 text-primary",ref_key:"tableRef",ref:n,columns:k.value,rows:g.value,"row-key":o=>o[3],class:"q-pa-sm",pagination:d.value,"onUpdate:pagination":y[2]||(y[2]=o=>d.value=o),"table-header-class":"bg-dark text-white","no-data-label":"There are no releases",dense:"","binary-state-sort":"",filter:P.value,onRequest:Q},{"body-cell-action":i(o=>[l(Ye,{props:o},{default:i(()=>[l(ce,{class:"cursor-pointer",size:X(m).screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:c=>$e(o.row),name:o.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1032,["props"])]),"no-data":i(({message:o})=>[u("div",Ke,[l(ce,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),u("span",null,re(o),1)])]),"top-right":i(()=>[u("div",Ze,"(Total: "+re(d.value.rowsNumber)+" releases)",1),l(me,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:E}),l(me,{dense:X(m).screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:ye,disable:d.value.rowsNumber<1},null,8,["dense","disable"])]),loading:i(()=>[l(Se,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","filter"])])]))}},aa={class:"text-h5 text-dark"},ta={class:"text-body2 text-italic q-ml-sm"},la=u("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),sa={class:"row items-center"},oa={key:0,class:"col-12 col-md-3 q-px-sm"},ra={class:"col-12 col-md-3 q-px-sm"},na={__name:"pipeline",setup(L){const b=te(),r=W(),m=le(),h=v(""),{getSelectedProject:f}=ee(m),{fetchAllDeployments:D,fetchAllInProcess:q,fetchAllPending:_,getDeployments:x,getInProcess:C,getPending:M}=ie(),{getManpowerData:S,setPipelines:O}=ue(),n=w(()=>r.params.id?r.params.id:null),g=w(()=>f.value?f.value[3]:null),P=w(()=>x(g.value)),Y=w(()=>M(g.value)),R=w(()=>C(g.value)),d=w(()=>{let a;return n.value?a=S({dataset:"pipelines",id:n.value})||[]:a=R.value.concat(Y.value.concat(P.value)),a}),k=async a=>{b.loading.show(),n.value?(a||!S({dataset:"pipelines",id:n.value}))&&await t():(await D(a),await q(a),await _(a)),b.loading.hide()},t=async()=>{const a=await xe(n.value);O({id:n.value,data:a})};return k(),(a,s)=>(A(),N("div",null,[l(ae,{flat:""},{default:i(()=>[l(F,{class:"q-pb-none"},{default:i(()=>[u("div",aa,[je(" Staffing Pipeline "),u("span",ta,"("+re(d.value.length)+" total)",1)]),la]),_:1}),l(F,null,{default:i(()=>[u("div",sa,[X(r).params.id?U("",!0):(A(),N("div",oa,[l(se,{dense:""})])),u("div",ra,[l(z,{dense:"",modelValue:h.value,"onUpdate:modelValue":s[0]||(s[0]=Q=>h.value=Q),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(Qe,{rows:d.value,onRefresh:s[1]||(s[1]=Q=>k(!0)),filter:h.value},null,8,["rows","filter"])]))}},ia={class:"q-pa-md"},Ga={__name:"index",setup(L){const b=W(),r=v(null);return b.query&&b.query.tab?b.query.tab==="releases"||b.query.tab==="release"?r.value=2:(b.query.tab==="newArrivals"||b.query.tab==="new-arrivals")&&(r.value=1):r.value=0,(m,h)=>(A(),K(qe,{style:{"max-width":"100vw"}},{default:i(()=>[u("div",ia,[l(De,{class:"bg-info text-white shadow-2 rounded-borders"},{default:i(()=>[l(he,{modelValue:r.value,"onUpdate:modelValue":h[0]||(h[0]=f=>r.value=f),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:i(()=>[l(G,{name:0,label:m.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),l(G,{name:1,label:"New Arrivals"}),m.$route.name==="project-manpower"?(A(),K(G,{key:0,name:3,label:"Pipeline"})):U("",!0),m.$can("read","releases")?(A(),K(G,{key:1,name:2,label:"Releases"})):U("",!0)]),_:1},8,["modelValue"])]),_:1}),l(_e,{modelValue:r.value,"onUpdate:modelValue":h[1]||(h[1]=f=>r.value=f),animated:""},{default:i(()=>[l(J,{name:0},{default:i(()=>[l(Te)]),_:1}),l(J,{name:1},{default:i(()=>[l(Xe)]),_:1}),l(J,{name:3},{default:i(()=>[l(na)]),_:1}),m.$can("read","releases")?(A(),K(J,{key:0,name:2},{default:i(()=>[l(ea)]),_:1})):U("",!0)]),_:1},8,["modelValue"])])]),_:1}))}};export{Ga as default};
