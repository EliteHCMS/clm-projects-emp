import{l as U,r as _,c as g,_ as I,aZ as $,A as u,B as k,d as s,bi as i,au as y,F as j,aY as S,an as v,ab as D,db as E,D as c,bI as W,bN as X,cw as T,cx as V,cz as J}from"./index.323fc631.js";import{Q as H}from"./QSelect.33612d66.js";import{Q as Z}from"./QPage.466075b6.js";import{u as N}from"./use-quasar.3f2121a5.js";import{H as Y,I as G,q as w}from"./quickbase.6ac4f30e.js";import{dayjs as h}from"./dayjs.06dd814d.js";import{u as K}from"./dataStore.4496995c.js";import{Q as x,a as ee}from"./QTable.1a240931.js";import{Q as P}from"./QTr.37fbaf74.js";import{Q as A}from"./QTd.a6fb5135.js";import{Q as te}from"./QInnerLoading.be250331.js";import{A as ae}from"./arrivalDate.069c830c.js";import{_ as le}from"./projectSelector.c054c36d.js";import"./QChip.b617217b.js";import"./QItemLabel.ef02ff6c.js";import"./QMenu.9da69efa.js";import"./position-engine.e825e98f.js";import"./selection.f718deb7.js";import"./rtl.d0f7624c.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.dd9802e5.js";import"./api.b50a8157.js";import"./i18n.3a003f1d.js";import"./useQuerySaver.ae1b8d62.js";import"./QList.13743bc9.js";import"./QMarkupTable.96fcc235.js";import"./use-fullscreen.e74ce5f2.js";import"./QTooltip.fe7f775f.js";import"./QForm.0a695231.js";import"./vee-validate.esm.a54ca1ae.js";import"./array.437e6965.js";const oe=U({emits:["arrivalMarked"],name:"Arrivals Table",components:{ArrivalDate:ae},props:{rows:Array,selected:Array},setup(d,{emit:m}){const f=N(),l=_(!1);return{columns:g(()=>f.screen.gt.sm?[{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,a)=>a[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${Y.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0}]:[{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,a)=>a[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${Y.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0}]),updateArrivals:({rows:e,added:a,evt:r})=>{l.value=!0,m("arrivalMarked",{record:e[0],added:a}),setTimeout(function(){l.value=!1},1500)},props:d,loading:l}}}),re={class:"q-px-sm"},se={class:"text-caption"},ne={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function ie(d,m,f,l,p,b){const e=$("arrival-date");return u(),k("div",re,[s(ee,{dense:"",columns:d.columns,rows:d.rows,"row-key":a=>a[3],class:"q-pa-sm",pagination:{rowsPerPage:d.$q.screen.gt.sm?25:100},separator:"vertical",selection:"multiple",onSelection:d.updateArrivals,selected:d.selected,"table-header-class":"bg-dark text-white","no-data-label":"There are no expected arrivals",loading:d.loading,grid:d.$q.screen.lt.md},{header:i(a=>[s(P,{class:"bg-dark text-white",props:a},{default:i(()=>[s(x,{"auto-width":""}),s(x,{class:"text-left","auto-width":""},{default:i(()=>[y("Arrival Date")]),_:1}),(u(!0),k(j,null,S(a.cols,r=>(u(),v(x,{class:"text-left",key:r.name},{default:i(()=>[y(D(r.label),1)]),_:2},1024))),128))]),_:2},1032,["props"])]),body:i(a=>[s(P,{"no-hover":"",props:a},{default:i(()=>[s(A,{"auto-width":""},{default:i(()=>[s(E,{class:"q-pa-none q-ma-none",size:"xs",modelValue:a.selected,"onUpdate:modelValue":r=>a.selected=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a.row[20]==="Complete"&&a.row[207]?(u(),v(e,{key:0,class:"text-left",rowType:"deployment",row:a.row},null,8,["row"])):(u(),v(A,{key:1,"auto-width":"",class:"text-left"},{default:i(()=>[y("TBD")]),_:1})),(u(!0),k(j,null,S(a.cols,r=>(u(),v(A,{key:r.name,props:a},{default:i(()=>[c("span",se,D(r.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":i(({message:a})=>[c("div",ne,[s(W,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),c("span",null,D(a),1)])]),loading:i(()=>[s(te,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","onSelection","selected","loading","grid"])])}var de=I(oe,[["render",ie]]);const ce={name:"Arrivals",components:{MarkArrivalsTable:de,projectSelector:le},setup(){const d=N(),m=G(),f=_(null),l=_(""),p=_(""),{getSelectedProject:b}=X(m),{fetchAllDeployments:e,updateDeployment:a,getDeployments:r}=K(),C=g(()=>b.value?b.value[3]:null),F=g(()=>r(C.value).filter(t=>t[20]==="Complete")),q=g(()=>{let t=[];return r(C.value).forEach(o=>{o[31].toLowerCase().includes(p.value.toLowerCase())&&t.push(o)}),t=l.value?t.filter(o=>h(o[33].$d).tz("America/Chicago").format("MM/DD/YYYY")===h(l.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=f.value?t.filter(o=>o[132]===f.value):t,t}),R=g(()=>[...new Map(q.value.map(t=>[t[132],t[132]])).values()]);async function L(){d.loading.show(),await e(),d.loading.hide()}async function z({record:t,added:o}){if(o){await B(t),await M({id:t[21],status:7});const n=await Q(t[3],"Complete");a({projectId:n[134],key:n[3],record:n})}else{await O(t),await M({id:t[21],status:6});const n=await Q(t[3],"In Process");a({projectId:n[134],key:n[3],record:n})}}async function B(t){try{const{data:o}=await w.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:t[3]},13:{value:t[15]},18:{value:t[21]},60:{value:""},125:{value:h()},145:{value:h()}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return o[0][108]}catch(o){throw{message:"Cannot add assignment",error:o}}}async function M({id:t,status:o}){try{const{data:n}=await w.upsertRecordsXML({to:"bp3gb7ng2",data:[{3:{value:t},79:{value:o}}],fieldsToReturn:[3]});return n[0][3]}catch(n){throw{message:"Cannot edit employee",error:n}}}async function Q(t,o){try{const{data:n}=await w.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:t},20:{value:o},22:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return n[0][204]}catch(n){throw{message:"Cannot edit deployment",error:n}}}async function O(t){try{const{data:o}=await w.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:t.assignment[3]},22:{value:new Date},21:{value:"Canceled"},19:{value:""},60:{value:""}}],fieldsToReturn:[108],formatObject:108});return o[0][108]}catch(o){throw{message:"Cannot cancel assignment",error:o}}}return L(),{arrived:F,allDeployments:q,arrivalMarked:z,craftOptions:R,craftFilter:f,startDateFilter:l,search:p}}},me={class:"q-pt-sm"},ue={class:"text-h5 text-dark"},fe={class:"text-body2 text-italic q-ml-sm"},pe=c("div",{class:"text-subtitle2 text-accent"},"Please toggle the switch for everyone that has arrived at the job site.",-1),be={class:"row items-center"},ge={class:"col-12 col-md-3 q-px-sm"},ve={class:"col-12 col-md-3 q-px-sm"},we={class:"col-12 col-md-3 q-px-sm"},he={class:"col-12 col-md-3 q-px-sm"};function _e(d,m,f,l,p,b){const e=$("projectSelector"),a=$("mark-arrivals-table");return u(),v(Z,{style:{"max-width":"100vw"}},{default:i(()=>[c("div",me,[s(J,{flat:""},{default:i(()=>[s(T,{class:"q-pb-none"},{default:i(()=>[c("div",ue,[y(" Expected Arrivals "),c("span",fe,"("+D(l.allDeployments.length)+" total)",1)]),pe]),_:1}),s(T,null,{default:i(()=>[c("div",be,[c("div",ge,[s(e,{dense:""})]),c("div",ve,[s(V,{dense:"",modelValue:l.search,"onUpdate:modelValue":m[0]||(m[0]=r=>l.search=r),label:"Search"},null,8,["modelValue"])]),c("div",we,[s(V,{dense:"",modelValue:l.startDateFilter,"onUpdate:modelValue":m[1]||(m[1]=r=>l.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),c("div",he,[s(H,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:l.craftFilter,"onUpdate:modelValue":m[2]||(m[2]=r=>l.craftFilter=r),options:l.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),s(a,{rows:l.allDeployments,selected:l.arrived,onArrivalMarked:l.arrivalMarked},null,8,["rows","selected","onArrivalMarked"])])]),_:1})}var Ke=I(ce,[["render",_e]]);export{Ke as default};
