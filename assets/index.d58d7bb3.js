import{Q as X,a as be,b as z}from"./QTabPanels.7e0c7e42.js";import{Q as we}from"./QTabs.ba87150e.js";import{Q as $e}from"./QToolbar.35e2d581.js";import{Q as ge}from"./QPage.eed23df8.js";import{l as B,bU as x,bT as ue,r as S,bV as H,c as f,w as pe,_ as O,b5 as R,A as y,B as C,d as o,br as c,cT as U,D as u,ar as I,cU as M,cS as W,F as se,b4 as le,aq as N,ax as te,ac as L,bQ as re,bW as ne,y as he}from"./index.2bf5f3d5.js";import{a as me}from"./QSelect.35e2e745.js";import{u as G}from"./use-quasar.900ac942.js";import{u as J}from"./dataStore.eb3c3ed9.js";import{u as K}from"./dataStore.ccd157ed.js";import{c as Z,q as ae}from"./app.c06ae7e4.js";import{dayjs as q}from"./dayjs.67bcdf99.js";import{u as oe}from"./useQuerySaver.d29ff9ee.js";import{R as fe,g as ye}from"./quickbaseDataHelpers.84905b28.js";import{_ as ee}from"./projectSelector.53ecbe48.js";import{a as ie,Q as _e}from"./QTable.158fedee.js";import{Q as de}from"./QTr.a87da3e9.js";import{Q as ce}from"./QTd.4d74c04b.js";import{Q as De}from"./QInnerLoading.1c063683.js";import{e as Ve}from"./export-file.dc78ba05.js";import{P as je}from"./projectPipeline.04b5207f.js";import"./use-panel.c6f17dc8.js";import"./touch.3df10340.js";import"./selection.d9f9c811.js";import"./QResizeObserver.6f03dad5.js";import"./rtl.b51694b1.js";import"./QChip.4a8cc4f1.js";import"./QMenu.f5054ee4.js";import"./position-engine.ed83372a.js";import"./localForage.fc877897.js";import"./_commonjsHelpers.a26ce4be.js";import"./api.c01eef32.js";import"./index.04bc0a32.js";import"./i18n.43e58d72.js";import"./index.168e6d32.js";import"./arrivalDate.c1a32ace.js";import"./QTooltip.6e254bc4.js";import"./QForm.8b79410e.js";import"./vee-validate.esm.365d338d.js";import"./array.59f93f43.js";import"./QList.1e2f5ca3.js";import"./QMarkupTable.2acd56f7.js";import"./use-fullscreen.217361b2.js";const Ae=B({props:{},components:{RosterTable:fe,projectSelector:ee},setup(e){const a=G(),g=x(),b=ue(),w=Z(),h=S(""),p=S(null),l=S(null),{getSelectedProject:n}=H(w),{getAssignments:V,fetchAllAssignments:j,fetchAssignments:T}=J(),{getManpowerData:F,setRosters:D}=K(),v=f(()=>g.params.id?g.params.id:null),m=f(()=>n.value?n.value[3]:null),A=f(()=>{let s;return v.value?s=(F({dataset:"rosters",id:v.value})||[]).sort((r,_)=>r[1].$d<_[1].$d?1:-1):s=V(m.value).sort((i,r)=>i[1].$d<r[1].$d?1:-1),s.filter(i=>!i[112]&&i.latest&&i[102]==="Active")}),k=f(()=>{let s=[];return A.value.forEach(i=>{i[75].toLowerCase().includes(h.value.toLowerCase())&&s.push(i)}),s=p.value?s.filter(i=>q(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===q(p.value).tz("America/Chicago").format("MM/DD/YYYY")):s,s=l.value?s.filter(i=>i[68]===l.value):s,s.sort((i,r)=>i.employee[22]>r.employee[22]?1:-1)}),E=f(()=>[...new Map(A.value.map(s=>[s[68],s[68]])).values()]),Q=async s=>{a.loading.show(),g.query&&g.query.refresh&&(s=!0,b.push({query:{}})),v.value?(s||!F({dataset:"rosters",id:v.value}))&&await d():m.value?await T({projectId:m.value,refresh:s}):await j({refresh:s}),a.loading.hide()},d=async()=>{const s=`{'74'.EX.'${v.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:i}=await ae.fetchFromHiringApp({fields:[oe({type:"assignments",query:s})]});D({id:v.value,data:i})};return pe(m,()=>{Q()}),Q(),{allAssignments:A,search:h,startDateFilter:p,craftFilter:l,craftOptions:E,rows:k,loadData:Q}}}),Pe={class:"row items-center"},Se={key:0,class:"col-12 col-md-3"},Re={class:"col-12 col-md-3 q-px-sm"},qe={class:"col-12 col-md-3 q-px-sm"},Ce={class:"col-12 col-md-3 q-px-sm"};function Fe(e,a,g,b,w,h){const p=R("projectSelector"),l=R("roster-table");return y(),C("div",null,[o(W,{flat:""},{default:c(()=>[o(U,null,{default:c(()=>[u("div",Pe,[e.$route.params.id?I("",!0):(y(),C("div",Se,[o(p,{dense:""})])),u("div",Re,[o(M,{dense:"",modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=n=>e.search=n),label:"Search"},null,8,["modelValue"])]),u("div",qe,[o(M,{dense:"",modelValue:e.startDateFilter,"onUpdate:modelValue":a[1]||(a[1]=n=>e.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Ce,[o(me,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":a[2]||(a[2]=n=>e.craftFilter=n),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),o(l,{rows:e.rows,onRefreshData:a[3]||(a[3]=n=>e.loadData(!0)),title:"Active Roster"},null,8,["rows"])])}var ke=O(Ae,[["render",Fe]]);const Qe=B({props:{},components:{RosterTable:fe,projectSelector:ee},setup(e){const a=G(),g=x(),b=Z(),w=S(""),h=S(null),p=S(null),{getSelectedProject:l}=H(b),{getAssignments:n,fetchAllAssignments:V,fetchAssignments:j}=J(),{getManpowerData:T,setRosters:F}=K(),D=f(()=>g.params.id?g.params.id:null),v=f(()=>l.value?l.value[3]:null),m=f(()=>{let d;const s=q().subtract(14,"day");return D.value?d=(T({dataset:"rosters",id:D.value})||[]).sort((r,_)=>r[1].$d<_[1].$d?1:-1):d=n(v.value).sort((i,r)=>i[1].$d<r[1].$d?1:-1),d.filter(i=>!i[112]&&i.latest&&i[102]==="Active"&&q(i[1].$d).isSameOrAfter(s)&&q(i[1].$d).isSameOrBefore(q()))}),A=f(()=>{let d=[];return m.value.forEach(s=>{s[75].toLowerCase().includes(w.value.toLowerCase())&&d.push(s)}),d=h.value?d.filter(s=>q(s[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===q(h.value).tz("America/Chicago").format("MM/DD/YYYY")):d,d=p.value?d.filter(s=>s[68]===p.value):d,d.sort((s,i)=>s.employee[22]>i.employee[22]?1:-1)}),k=f(()=>[...new Map(m.value.map(d=>[d[68],d[68]])).values()]),E=async d=>{a.loading.show(),D.value?(d||!T({dataset:"rosters",id:D.value}))&&await Q():v.value?await j({projectId:v.value,refresh:d}):await V({refresh:d}),a.loading.hide()},Q=async()=>{const d=`{'74'.EX.'${D.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:s}=await ae.fetchFromProjectsApp({fields:[oe({type:"assignments",query:d})]});F({id:D.value,data:s})};return{allAssignments:m,search:w,startDateFilter:h,craftFilter:p,craftOptions:k,rows:A,loadData:E}}}),Ye={class:"row items-center"},Te={key:0,class:"col-12 col-md-3"},Ee={class:"col-12 col-md-3 q-px-sm"},Ie={class:"col-12 col-md-3 q-px-sm"},Me={class:"col-12 col-md-3 q-px-sm"};function Ne(e,a,g,b,w,h){const p=R("projectSelector"),l=R("roster-table");return y(),C("div",null,[o(W,{flat:""},{default:c(()=>[o(U,null,{default:c(()=>[u("div",Ye,[e.$route.params.id?I("",!0):(y(),C("div",Te,[o(p,{dense:""})])),u("div",Ee,[o(M,{dense:"",modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=n=>e.search=n),label:"Search"},null,8,["modelValue"])]),u("div",Ie,[o(M,{dense:"",modelValue:e.startDateFilter,"onUpdate:modelValue":a[1]||(a[1]=n=>e.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Me,[o(me,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":a[2]||(a[2]=n=>e.craftFilter=n),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),o(l,{rows:e.rows,onRefreshData:a[3]||(a[3]=n=>e.loadData(!0)),title:"New Arrivals"},null,8,["rows"])])}var Le=O(Qe,[["render",Ne]]);const Ue=B({props:{},components:{projectSelector:ee},setup(e){const a=G(),g=ue(),b=x(),{capitalize:w}=he,h=Z(),p=S(""),l=S(null),n=S(null),{getSelectedProject:V}=H(h),{getReleases:j,fetchReleases:T,fetchAllReleases:F}=J(),{getManpowerData:D,setDepartures:v}=K(),m=f(()=>b.params.id?b.params.id:null),A=f(()=>V.value?V.value[3]:null),k=[{name:1,label:"Name",align:"left",field:t=>t[49],format:t=>`${E(t)}`,sortable:!0,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:t=>t[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:t=>t[50],format:t=>`${t}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:t=>t[51],format:t=>t===""?"not available":t,sortable:!0},{name:4,label:"Classification",align:"left",field:t=>t[82],format:t=>`${!t||t===""?"Not Assigned":t}`,sortable:!0},{name:5,label:"Job #",align:"left",field:t=>t[81],format:t=>`${t===""||!t?"Not Assigned":t}`,sortable:!0},{name:6,label:"Release Date",align:"left",field:t=>t[36].$d,format:t=>`${q(t).format("MM/DD/YYYY")}`,sortable:!0}],E=t=>{const Y=t.split(" ");let P="";return Y.forEach(($,ve)=>{P+=ve>0?` ${w($.toLowerCase())}`:w($.toLowerCase())}),P};function Q(t){g.push({name:"view-release",params:{release:t[3]}})}function d(t,Y,P){let $=Y!==void 0?Y(t,P):t;return $=$==null?"":String($),$=$.split('"').join('""'),`"${$}"`}function s(){const t=[k.value.map(P=>d(P.label))].concat(i.value.map(P=>k.value.map($=>d(typeof $.field=="function"?$.field(P):P[$.field===void 0?$.name:$.field],$.format,P)).join(","))).join(`\r
`);Ve(`${q().format("MM.DD.YYYY")} Releases-Export.csv`,t,"text/csv")!==!0&&a.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const i=f(()=>{let t;return m.value?t=D({dataset:"departures",id:m.value})||[]:t=j(A.value).sort((Y,P)=>Y[1].$d<P[1].$d?1:-1),t}),r=async t=>{a.loading.show(),m.value?(t||!D({dataset:"departures",id:m.value}))&&await _():A.value?await T({projectId:A.value,refresh:t}):await F({refresh:t}),a.loading.hide()},_=async()=>{const t=`{'41'.EX.'${m.value}'}AND{'42'.XEX.'Complete'}AND({'36'.OAF.'today'}OR{'36'.IR.'last 30 d'}OR{'1'.IR.'last 30 d'})`,{data:Y}=await ae.fetchFromHiringApp({fields:[oe({type:"releases",query:t})]});v({id:m.value,data:Y})};return pe(V,()=>{r()}),r(!0),{projectFilterValue:A,search:p,dateFilter:l,craftFilter:n,loadData:r,getReleases:j,columns:k,viewRelease:Q,exportAllReleases:s,rows:i}}}),Oe={class:"row items-center"},Xe={key:0,class:"col-12 col-md-3"},ze={class:"col-12 col-md-3 q-px-sm"},Be={class:"col-12 col-md-3 q-px-sm"},xe=u("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),He={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},We={class:"text-dark text-caption text-italic"};function Ge(e,a,g,b,w,h){const p=R("projectSelector");return y(),C("div",null,[o(W,{flat:""},{default:c(()=>[o(U,null,{default:c(()=>[u("div",Oe,[e.$route.params.id?I("",!0):(y(),C("div",Xe,[o(p,{dense:""})])),u("div",ze,[o(M,{dense:"",modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=l=>e.search=l),label:"Search"},null,8,["modelValue"])]),u("div",Be,[o(M,{dense:"",modelValue:e.dateFilter,"onUpdate:modelValue":a[1]||(a[1]=l=>e.dateFilter=l),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])]),xe])]),_:1})]),_:1}),u("div",null,[o(_e,{title:"Recent Releases","title-class":"text-h5 text-primary",columns:e.columns,rows:e.rows,"row-key":l=>l[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent releases",dense:""},{header:c(l=>[o(de,{class:"bg-dark text-white",props:l},{default:c(()=>[o(ie,{"auto-width":""}),(y(!0),C(se,null,le(l.cols,n=>(y(),N(ie,{key:n.name,props:l},{default:c(()=>[te(L(n.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:c(l=>[o(de,{props:l},{default:c(()=>[o(ce,{"auto-width":""},{default:c(()=>[o(re,{class:"cursor-pointer",size:e.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:n=>e.viewRelease(l.row),name:l.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(y(!0),C(se,null,le(l.cols,n=>(y(),N(ce,{key:n.name,props:l},{default:c(()=>[te(L(n.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":c(({message:l})=>[u("div",He,[o(re,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),u("span",null,L(l),1)])]),"top-right":c(()=>[u("div",We,"(Total: "+L(e.getReleases(e.projectFilterValue).length)+" releases)",1),o(ne,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:a[2]||(a[2]=l=>e.loadData(!0))}),o(ne,{dense:e.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:e.exportAllReleases,disable:e.getReleases(e.projectFilterValue).length<1},null,8,["dense","onClick","disable"])]),loading:c(()=>[o(De,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Je=O(Ue,[["render",Ge]]);const Ke={name:"Pipeline",components:{ProjectPipelineTable:je,projectSelector:ee},setup(){const e=G(),a=x(),g=Z(),b=S(null),w=S(""),{getSelectedProject:h}=H(g),{fetchAllDeployments:p,fetchAllInProcess:l,fetchAllPending:n,getDeployments:V,getInProcess:j,getPending:T}=J(),{getManpowerData:F,setPipelines:D}=K(),v=f(()=>a.params.id?a.params.id:null),m=f(()=>h.value?h.value[3]:null),A=f(()=>V(m.value).filter(r=>r[20]==="Complete")),k=f(()=>{const r=[];return V(m.value).forEach(_=>{_[31].toLowerCase().includes(w.value.toLowerCase())&&r.push(_)}),r}),E=f(()=>{const r=[];return T(m.value).forEach(_=>{_[25].toLowerCase().includes(w.value.toLowerCase())&&r.push(_)}),r}),Q=f(()=>{const r=[];return j(m.value).forEach(_=>{_[39].toLowerCase().includes(w.value.toLowerCase())&&r.push(_)}),r}),d=f(()=>{let r;return v.value?r=F({dataset:"pipelines",id:v.value})||[]:r=Q.value.concat(E.value.concat(k.value)),r}),s=async r=>{e.loading.show(),v.value?(r||!F({dataset:"pipelines",id:v.value}))&&await i():(await p(r),await l(r),await n(r)),e.loading.hide()},i=async()=>{const r=await ye(v.value);D({id:v.value,data:r})};return s(),{projectFilter:b,arrived:A,allPipeline:d,search:w,loadData:s}}},Ze={class:"text-h5 text-dark"},et={class:"text-body2 text-italic q-ml-sm"},tt=u("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),at={class:"row items-center"},ot={key:0,class:"col-12 col-md-3 q-px-sm"},st={class:"col-12 col-md-3 q-px-sm"};function lt(e,a,g,b,w,h){const p=R("projectSelector"),l=R("project-pipeline-table");return y(),C("div",null,[o(W,{flat:""},{default:c(()=>[o(U,{class:"q-pb-none"},{default:c(()=>[u("div",Ze,[te(" Staffing Pipeline "),u("span",et,"("+L(b.allPipeline.length)+" total)",1)]),tt]),_:1}),o(U,null,{default:c(()=>[u("div",at,[e.$route.params.id?I("",!0):(y(),C("div",ot,[o(p,{dense:""})])),u("div",st,[o(M,{dense:"",modelValue:b.search,"onUpdate:modelValue":a[0]||(a[0]=n=>b.search=n),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),o(l,{rows:b.allPipeline,onRefresh:a[1]||(a[1]=n=>b.loadData(!0))},null,8,["rows"])])}var rt=O(Ke,[["render",lt]]);const nt=B({name:"Employees",components:{RosterTab:ke,NewArrivalsTab:Le,ReleasesTab:Je,PipelineTab:rt},setup(){return{tab:S(0)}}}),it={class:"q-pa-md"};function dt(e,a,g,b,w,h){const p=R("roster-tab"),l=R("new-arrivals-tab"),n=R("pipeline-tab"),V=R("releases-tab");return y(),N(ge,{style:{"max-width":"100vw"}},{default:c(()=>[u("div",it,[o($e,{class:"bg-info text-white shadow-2 rounded-borders"},{default:c(()=>[o(we,{modelValue:e.tab,"onUpdate:modelValue":a[0]||(a[0]=j=>e.tab=j),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:c(()=>[o(X,{name:0,label:e.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),o(X,{name:1,label:"New Arrivals"}),e.$route.name==="project-manpower"?(y(),N(X,{key:0,name:3,label:"Pipeline"})):I("",!0),e.$can("read","releases")?(y(),N(X,{key:1,name:2,label:"Releases"})):I("",!0)]),_:1},8,["modelValue"])]),_:1}),o(be,{modelValue:e.tab,"onUpdate:modelValue":a[1]||(a[1]=j=>e.tab=j),animated:""},{default:c(()=>[o(z,{name:0},{default:c(()=>[o(p)]),_:1}),o(z,{name:1},{default:c(()=>[o(l)]),_:1}),o(z,{name:3},{default:c(()=>[o(n)]),_:1}),e.$can("read","releases")?(y(),N(z,{key:0,name:2},{default:c(()=>[o(V)]),_:1})):I("",!0)]),_:1},8,["modelValue"])])]),_:1})}var Kt=O(nt,[["render",dt]]);export{Kt as default};
