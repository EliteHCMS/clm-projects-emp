import{l as k,bV as q,r as b,c as w,_,B as A,ar as B,bs as r,d as o,cU as R,bP as X,cV as v,cW as g,E as i,ad as D,cX as F,bX as h,cA as M}from"./index.5232afe7.js";import{Q as N}from"./QForm.0fd20abe.js";import{a as Y,u as y}from"./vee-validate.esm.54bd3c83.js";import{a as I,e as O,b as P}from"./array.59f93f43.js";import{g as T,q as C}from"./app.062f4def.js";import{u as G}from"./use-quasar.30e2351a.js";import{u as L}from"./dataStore.9b754527.js";const W=k({props:{project:Object},setup(e){const s=q(),c=G(),u=b(null),n=b(null),p=L(),{setApprovedHeadcount:d}=p,m=w(()=>s.params.id?s.params.id:e.project&&e.project[3]?e.project[3]:null),H=I({headcount:O().required().positive().integer().typeError("Headcount must be a positive integer").label("Headcount"),lastUpdateDate:P().required().typeError("Valid Date Only!").label("Date")}),{errors:$,handleSubmit:U,handleReset:E}=Y({validationSchema:H,initialValues:{lastUpdateDate:T.formatDate(new Date,"YYYY-MM-DD")}}),{value:V}=y("headcount"),{value:j}=y("lastUpdateDate"),Q=U(async l=>{try{console.log(l),await S(l.lastUpdateDate),console.log(n.value);const t=[{6:{value:Number(l.headcount)},7:{value:l.lastUpdateDate},8:{value:m.value},12:{value:!0}}];n.value&&(t[0][3]={value:n.value});const{data:a}=await C.upsertRecordsXML({to:"bteqadt9j",fieldsToReturn:[3,6,7,8],data:t,formatObject:10});if(console.log(a),a&&a[0]&&a[0][3])d(`${a[0][3]} ${a[0][6]?a[0][6]:""} ${a[0][7]?a[0][7]:""} ${a[0][8]?a[0][8]:""}`),c.notify({position:"top-right",type:"positive",message:"Client Contracted Headcount successfully added"});else throw"Error in adding Client Contracted Headcount";f()}catch(t){console.log(t),c.notify({position:"top-right",type:"negative",message:"Error adding Client Contracted Headcount"})}}),S=async l=>{console.log(l);const{data:t}=await C.fetchFromProjectsApp({fields:[{14:{value:10},9:{value:1},8:{value:`{'8'.EX.'${m.value}'}AND{'7'.EX.'${l}'}`},7:{value:"Table Query"},6:{value:"bteqadt9j"}}]});console.log(t),n.value=t&&t[0]&&t[0][3]?t[0][3]:null},f=()=>{E(),u.value.hide()};return{approveHeadcountDialog:u,headcount:V,lastUpdateDate:j,formErrors:$,addHeadcount:Q,closeHeadcountDialog:f}}}),x=i("div",{class:"text-h6 text-info"},"Add Client Contracted Headcount",-1),z={class:"text-caption"},J={class:"text-caption"};function K(e,s,c,u,n,p){return A(),B(M,{ref:"approveHeadcountDialog"},{default:r(()=>[o(R,{flat:"",style:{width:"400px"}},{default:r(()=>[o(N,{onSubmit:X(e.addHeadcount,["prevent"])},{default:r(()=>[o(v,null,{default:r(()=>[x]),_:1}),o(v,null,{default:r(()=>[o(g,{dense:"",label:"Headcount",type:"number",modelValue:e.headcount,"onUpdate:modelValue":s[0]||(s[0]=d=>e.headcount=d),"bottom-slots":"","stack-label":"",error:!!e.formErrors.headcount},{error:r(()=>[i("div",z,D(e.formErrors.headcount),1)]),_:1},8,["modelValue","error"]),o(g,{class:"q-mt-sm",dense:"",label:"Date",type:"date",modelValue:e.lastUpdateDate,"onUpdate:modelValue":s[1]||(s[1]=d=>e.lastUpdateDate=d),"bottom-slots":"","stack-label":"",error:!!e.formErrors.lastUpdateDate},{error:r(()=>[i("div",J,D(e.formErrors.lastUpdateDate),1)]),_:1},8,["modelValue","error"])]),_:1}),o(F,{class:"q-px-xs",align:"right"},{default:r(()=>[o(h,{color:"secondary",label:"Cancel",onClick:e.closeHeadcountDialog},null,8,["onClick"]),o(h,{color:"primary",label:"Submit",type:"submit",onClick:e.addHeadcount},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},512)}var le=_(W,[["render",K]]);export{le as a};
