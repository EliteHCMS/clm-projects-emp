import{Q as T,b as Y,a as le}from"./QTabPanels.b9ad1004.js";import{Q as se}from"./QTabs.c2494432.js";import{Q as re}from"./QToolbar.e3e89c52.js";import{Q as ne}from"./QPage.1078672d.js";import{R as ie,E as ce}from"./roster.395f5860.js";import{l as M,bM as B,r as w,bN as U,c as _,_ as E,aZ as C,A as v,B as S,d as a,bi as s,cw as L,D as n,ao as I,cx as F,cz as z,bL as de,w as ue,F as G,aY as H,an as x,au as N,ab as R,bI as K,bO as X,y as me}from"./index.9762efb3.js";import{Q as pe}from"./QSelect.4c250828.js";import{u as O}from"./use-quasar.1a2013e3.js";import{u as J}from"./dataStore.f9b24e1e.js";import{I as W}from"./quickbase.0330480d.js";import{dayjs as Q}from"./dayjs.b06c0c0b.js";import{_ as Z}from"./projectSelector.16b0eb4a.js";import{Q as ee,a as fe}from"./QTable.0077212c.js";import{Q as te}from"./QTr.d46e16b6.js";import{Q as ae}from"./QTd.337029ba.js";import{Q as be}from"./QInnerLoading.9f020a3c.js";import{e as ve}from"./export-file.eb604dd4.js";import{P as he}from"./projectPipeline.1c244297.js";import"./use-panel.77030442.js";import"./touch.60582172.js";import"./selection.2be80553.js";import"./QResizeObserver.ae660eeb.js";import"./rtl.cf9bbe47.js";import"./QChip.deeb90cb.js";import"./QItemLabel.a7bd6a61.js";import"./QMenu.6d936437.js";import"./position-engine.e9001b32.js";import"./localForage.591f4db3.js";import"./_commonjsHelpers.a26ce4be.js";import"./useQuerySaver.4199d87d.js";import"./index.7dbe61ef.js";import"./i18n.d2983beb.js";import"./api.5a7b34fc.js";import"./QList.eefd78b8.js";import"./QMarkupTable.1f939997.js";import"./use-fullscreen.7c1ef657.js";const $e=M({props:{},components:{RosterTable:ie,projectSelector:Z},setup(t){const l=O(),g=B(),p=W(),u=w(null),h=w(""),m=w(null),o=w(null),{getSelectedProject:r}=U(p),{getAssignments:y,fetchAllAssignments:$}=J(),q=_(()=>g.params.id?g.params.id:r.value?r.value[3]:null),V=_(()=>{const i=Q().subtract(14,"day");return y(q.value).sort((b,c)=>b[1].$d<c[1].$d?1:-1).filter(b=>!b[112]&&b.latest&&b[102]==="Active"&&Q(b[1].$d).isSameOrAfter(i)&&Q(b[1].$d).isSameOrBefore(Q()))}),j=_(()=>{let i=[];return V.value.forEach(f=>{f[75].toLowerCase().includes(h.value.toLowerCase())&&i.push(f)}),i=m.value?i.filter(f=>Q(f[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Q(m.value).tz("America/Chicago").format("MM/DD/YYYY")):i,i=o.value?i.filter(f=>f[68]===o.value):i,i.sort((f,b)=>f.employee[22]>b.employee[22]?1:-1)}),P=_(()=>[...new Map(V.value.map(i=>[i[68],i[68]])).values()]);async function A(){l.loading.show(),await $(),l.loading.hide()}return A(),{allAssignments:V,projectFilter:u,search:h,startDateFilter:m,craftFilter:o,craftOptions:P,rows:j}}}),_e={class:"row items-center"},we={key:0,class:"col-12 col-md-3"},ge={class:"col-12 col-md-3 q-px-sm"},ye={class:"col-12 col-md-3 q-px-sm"},Ve={class:"col-12 col-md-3 q-px-sm"};function je(t,l,g,p,u,h){const m=C("projectSelector"),o=C("roster-table");return v(),S("div",null,[a(z,{flat:""},{default:s(()=>[a(L,null,{default:s(()=>[n("div",_e,[t.$route.params.id?I("",!0):(v(),S("div",we,[a(m,{dense:""})])),n("div",ge,[a(F,{dense:"",modelValue:t.search,"onUpdate:modelValue":l[0]||(l[0]=r=>t.search=r),label:"Search"},null,8,["modelValue"])]),n("div",ye,[a(F,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":l[1]||(l[1]=r=>t.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),n("div",Ve,[a(pe,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":l[2]||(l[2]=r=>t.craftFilter=r),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(o,{rows:t.rows},null,8,["rows"])])}var De=E($e,[["render",je]]);const Ce=M({props:{},components:{projectSelector:Z},setup(t){const l=O(),g=de(),p=B(),{capitalize:u}=me,h=W();w(null);const m=w(""),o=w(null),r=w(null),{getSelectedProject:y}=U(h),{getReleases:$,fetchReleases:q,fetchAllReleases:V}=J(),j=_(()=>p.params.id?p.params.id:y.value?y.value[3]:null),P=[{name:1,label:"Name",align:"left",field:e=>e[66][22],format:(e,k)=>`${A(k[66])}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e[66][378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[66][213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[67][20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[67][105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Depature Date",align:"left",field:e=>e[36].$d,format:e=>`${Q(e).format("MM/DD/YYYY")}`,sortable:!0}],A=e=>{const k=e[20]!==""?u(e[20].toLowerCase().trim()):"",D=e[22]!==""?u(e[22].toLowerCase().trim()):"",d=e[21]!==""?` ${u(e[21].toLowerCase().trim())}`:"",oe=e[23]!==""?` ${u(e[23])}`:"";return`${D}${oe}, ${k}${d}`};function i(e){g.push({name:"view-release",params:{release:e[3]}})}function f(e,k,D){let d=k!==void 0?k(e,D):e;return d=d==null?"":String(d),d=d.split('"').join('""'),`"${d}"`}function b(){const e=[P.value.map(D=>f(D.label))].concat($(j.value).map(D=>P.value.map(d=>f(typeof d.field=="function"?d.field(D):D[d.field===void 0?d.name:d.field],d.format,D)).join(","))).join(`\r
`);ve(`${Q().format("MM.DD.YYYY")} Releases-Export.csv`,e,"text/csv")!==!0&&l.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const c=async e=>{j.value?await q({projectId:j.value}):await V(),console.log($(j.value))};return ue(y,()=>{c()}),c(),{projectFilterValue:j,search:m,dateFilter:o,craftFilter:r,loadData:c,getReleases:$,columns:P,viewRelease:i,exportAllReleases:b}}}),Qe={class:"row items-center"},Se={key:0,class:"col-12 col-md-3"},Pe={class:"col-12 col-md-3 q-px-sm"},ke={class:"col-12 col-md-3 q-px-sm"},qe=n("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),Ae={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Re={class:"text-dark text-caption text-italic"};function Fe(t,l,g,p,u,h){const m=C("projectSelector");return v(),S("div",null,[a(z,{flat:""},{default:s(()=>[a(L,null,{default:s(()=>[n("div",Qe,[t.$route.params.id?I("",!0):(v(),S("div",Se,[a(m,{dense:""})])),n("div",Pe,[a(F,{dense:"",modelValue:t.search,"onUpdate:modelValue":l[0]||(l[0]=o=>t.search=o),label:"Search"},null,8,["modelValue"])]),n("div",ke,[a(F,{dense:"",modelValue:t.dateFilter,"onUpdate:modelValue":l[1]||(l[1]=o=>t.dateFilter=o),label:"Departure Date",type:"date","stack-label":""},null,8,["modelValue"])]),qe])]),_:1})]),_:1}),n("div",null,[a(fe,{title:"Recent Departures","title-class":"text-h5 text-primary",columns:t.columns,rows:t.getReleases(t.projectFilterValue),"row-key":o=>o[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent departures",dense:""},{header:s(o=>[a(te,{class:"bg-dark text-white",props:o},{default:s(()=>[a(ee,{"auto-width":""}),(v(!0),S(G,null,H(o.cols,r=>(v(),x(ee,{key:r.name,props:o},{default:s(()=>[N(R(r.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:s(o=>[a(te,{props:o},{default:s(()=>[a(ae,{"auto-width":""},{default:s(()=>[a(K,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:r=>t.viewRelease(o.row),name:o.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(v(!0),S(G,null,H(o.cols,r=>(v(),x(ae,{key:r.name,props:o},{default:s(()=>[N(R(r.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":s(({message:o})=>[n("div",Ae,[a(K,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),n("span",null,R(o),1)])]),"top-right":s(()=>[n("div",Re,"(Total: "+R(t.getReleases(t.projectFilterValue).length)+" departures)",1),a(X,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:l[2]||(l[2]=o=>t.loadData(!0))}),a(X,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllReleases,disable:t.getReleases(t.projectFilterValue).length<1},null,8,["dense","onClick","disable"])]),loading:s(()=>[a(be,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Te=E(Ce,[["render",Fe]]);const Ye={name:"Pipeline",components:{ProjectPipelineTable:he,projectSelector:Z},setup(){const t=O(),l=B(),g=W(),p=w(null),u=w(""),{getSelectedProject:h}=U(g),{fetchAllDeployments:m,fetchAllInProcess:o,fetchAllPending:r,getDeployments:y,getInProcess:$,getPending:q}=J(),V=_(()=>l.params.id?l.params.id:h.value?h.value[3]:null),j=_(()=>y(V.value).filter(c=>c[20]==="Complete")),P=_(()=>{const c=[];return y(V.value).forEach(e=>{e[31].toLowerCase().includes(u.value.toLowerCase())&&c.push(e)}),c}),A=_(()=>{const c=[];return q(V.value).forEach(e=>{e[25].toLowerCase().includes(u.value.toLowerCase())&&c.push(e)}),c}),i=_(()=>{const c=[];return $(V.value).forEach(e=>{e[39].toLowerCase().includes(u.value.toLowerCase())&&c.push(e)}),c}),f=_(()=>i.value.concat(A.value.concat(P.value)));async function b(){t.loading.show(),await m(),await o(),await r(),t.loading.hide()}return b(),{projectFilter:p,arrived:j,allPipeline:f,search:u}}},Le={class:"text-h5 text-dark"},xe={class:"text-body2 text-italic q-ml-sm"},Ee=n("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Ie={class:"row items-center"},Ne={key:0,class:"col-12 col-md-3 q-px-sm"},Me={class:"col-12 col-md-3 q-px-sm"};function Be(t,l,g,p,u,h){const m=C("projectSelector"),o=C("project-pipeline-table");return v(),S("div",null,[a(z,{flat:""},{default:s(()=>[a(L,{class:"q-pb-none"},{default:s(()=>[n("div",Le,[N(" Staffing Pipeline "),n("span",xe,"("+R(p.allPipeline.length)+" total)",1)]),Ee]),_:1}),a(L,null,{default:s(()=>[n("div",Ie,[t.$route.params.id?I("",!0):(v(),S("div",Ne,[a(m,{dense:""})])),n("div",Me,[a(F,{dense:"",modelValue:p.search,"onUpdate:modelValue":l[0]||(l[0]=r=>p.search=r),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(o,{rows:p.allPipeline},null,8,["rows"])])}var Ue=E(Ye,[["render",Be]]);const ze=M({name:"Employees",components:{RosterTab:ce,NewArrivalsTab:De,ReleasesTab:Te,PipelineTab:Ue},setup(){return{tab:w(0)}}}),Oe={class:"q-pa-md"};function Je(t,l,g,p,u,h){const m=C("roster-tab"),o=C("new-arrivals-tab"),r=C("pipeline-tab"),y=C("releases-tab");return v(),x(ne,{style:{"max-width":"100vw"}},{default:s(()=>[n("div",Oe,[a(re,{class:"bg-info text-white shadow-2 rounded-borders"},{default:s(()=>[a(se,{modelValue:t.tab,"onUpdate:modelValue":l[0]||(l[0]=$=>t.tab=$),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:s(()=>[a(T,{name:0,label:t.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),a(T,{name:1,label:"New Arrivals"}),t.$route.name==="project-manpower"?(v(),x(T,{key:0,name:3,label:"Pipeline"})):I("",!0),a(T,{name:2,label:"Departures"})]),_:1},8,["modelValue"])]),_:1}),a(le,{modelValue:t.tab,"onUpdate:modelValue":l[1]||(l[1]=$=>t.tab=$),animated:""},{default:s(()=>[a(Y,{name:0},{default:s(()=>[a(m)]),_:1}),a(Y,{name:1},{default:s(()=>[a(o)]),_:1}),a(Y,{name:3},{default:s(()=>[a(r)]),_:1}),a(Y,{name:2},{default:s(()=>[a(y)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var kt=E(ze,[["render",Je]]);export{kt as default};
