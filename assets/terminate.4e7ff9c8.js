import{l as Ae,r as g,bU as de,bT as ue,c as C,w as _,_ as Se,A as y,B as q,d as l,br as s,cS as Z,cT as x,D as o,ac as w,bR as O,bP as $,ax as Q,cU as se,bW as H,F as ne,b4 as Ue,bS as ie,ar as me,dA as d,cV as Re,bO as Ee,aq as re}from"./index.429672c4.js";import{Q as De}from"./QPage.1c164a0a.js";import{u as pe}from"./use-quasar.e6ca1583.js";import{u as F}from"./useQuerySaver.d29ff9ee.js";import{q as D}from"./app.d59c0f43.js";import{u as ce}from"./dataStore.59ac3960.js";import{a as T,Q as Ce}from"./QSelect.4d6ed681.js";import{Q as ke}from"./QFile.e5662f9b.js";import{Q as Ne}from"./QList.a027e3e6.js";import{Q as $e}from"./QForm.644d5019.js";import{a as Qe,u as v}from"./vee-validate.esm.217e8859.js";import{a as M,b as Fe,c as G,e as Y}from"./array.59f93f43.js";import{dayjs as J}from"./dayjs.cdbadc74.js";import{s as Ie}from"./submitRelease.5541d898.js";import{u as Be}from"./dataStore.3d312598.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.7b97ba34.js";import"./api.682a7e8f.js";import"./index.04bc0a32.js";import"./i18n.0152b37a.js";import"./QChip.6eeb9910.js";import"./QMenu.c6a626a1.js";import"./position-engine.daa72afe.js";import"./selection.fa3bc4cc.js";import"./rtl.b51694b1.js";const Oe=Ae({emits:["releaseSubmitted"],props:{record:Object,employee:Object},setup(e,{emit:a}){const A=g(!1),S=g(!1),b=g(null),V=g(!1),t=g([]),c=pe(),U=de(),K=ue(),{getTermReasons:h,setTermReasons:j}=ce(),{getAssignments:P,fetchAssignments:L}=Be(),W=C(()=>["Without Reservation","With Some Reservation","Would Not Recommend"]),u=C(()=>M({selection:M().required().nullable().label("Reason"),effective:Fe().required().label("Last Day On Site"),category:G().nullable(),attendance:Y().required().label("Attendance"),capability:Y().required().label("Capability"),attitude:Y().required().label("Attitude"),promotable:Y().required().label("Promotability"),comments:G().nullable().label("Comments"),equipment:M().required().nullable().label("Equipment Returned"),supervisor:M().nullable().label("Supervisor").required(),recommendation:G().nullable().label("Recommendation").required()})),{errors:R,handleSubmit:X,handleReset:I}=Qe({validationSchema:u,initialValues:{}}),{value:E}=v("selection"),{value:i}=v("effective"),{value:r}=v("category"),{value:p}=v("attachments"),{value:k}=v("capability"),{value:ee}=v("attendance"),{value:te}=v("attitude"),{value:ae}=v("promotable"),{value:ve}=v("comments"),{value:le}=v("equipment"),{value:be}=v("supervisor"),{value:fe}=v("recommendation"),B=C(()=>{const n=h();return r.value?n.filter(m=>m[6]===r.value).sort((m,f)=>m[12]>f[12]?1:-1):n.sort((m,f)=>m[12]>f[12]?1:-1)});U.query&&U.query.reason==="no-show"&&(r.value="Voluntary",B.value.length>0&&(V.value=!0,E.value=B.value.find(n=>n[3]===6)),i.value=J().format("YYYY-MM-DD"),le.value={value:!0,label:"None Issued"},k.value="0",ee.value="0",te.value="0",ae.value="0"),_(B,(n,m)=>{U.query&&U.query.reason==="no-show"&&V.value===!1&&(V.value=!0,E.value=B.value.find(f=>f[3]===6))}),_(r,(n,m)=>{E.value=null});const ye=X(async n=>{if(S.value&&t.value.length===0)c.dialog({title:"Alert",message:"Supporting documents are required for this reason!"});else{const m={capability:n.capability,attendance:n.attendance,attitude:n.attitude,promotable:n.promotable,comments:n.comments?n.comments.replace(/(\r\n|\n|\r)/gm," "):null};c.dialog({title:"Confirm",message:"Are you sure you want to release this employee?",cancel:!0,persistent:!0}).onOk(async()=>{try{A.value=!0;const{release:f,employee:N,assignment:z}=await Ie({employee:e.employee,assignment:e.record,values:n,effectiveNow:!oe.value,attachments:t.value,ratings:m,supervisor:n.supervisor});a("releaseSubmitted",{release:f,employee:N,assignment:z,effectiveNow:!oe.value}),I()}catch{A.value=!1,c.notify({type:"negative",message:"Cannot submit release."})}})}}),ge=()=>{c.dialog({title:"Confirm",message:"Are you sure you want to cancel?",cancel:!0,persistent:!0}).onOk(()=>{I(),K.go(-1)})};_(E,(n,m)=>{n&&n[19]?(S.value=!0,p.value=!0):(p.value=!1,S.value=!1)});const Ve=C(()=>{const n=h();return[...new Map(n.map(m=>[m[6],m[6]])).values()]}),oe=C(()=>i.value&&i.value!==""?J().isBefore(J(i.value)):!1),he=n=>new Promise((m,f)=>{const N=new FileReader;N.readAsDataURL(n),N.onload=()=>m(N.result.replace(/^data:.+;base64,/,"")),N.onerror=z=>f(z)}),qe=()=>{b.value&&b.value.forEach(async n=>{const m={6:{value:await he(n),filename:n.name},7:{value:n.name}};t.value.push(m),b.value=null}),console.log(t.value)},we=n=>{console.log(t.value[n]),t.value.splice(n,1)};return(async()=>{if(h().length===0){const{data:n}=await D.fetchFromHiringApp({fields:[F({type:"termReasons",query:"{'11'.EX.'true'}"})]});j({reasons:n})}L({projectId:e.record[74]})})(),{props:e,options:B,primaryReasons:Ve,category:r,selection:E,effective:i,attachments:p,capability:k,attendance:ee,attitude:te,promotable:ae,comments:ve,equipment:le,supervisor:be,attachmentsRequired:S,fileAttachment:b,attachedFiles:t,recommendation:fe,recommendationOptions:W,submit:ye,formErrors:R,handleReset:I,cancelRelease:ge,showFiles:qe,deleteFile:we,getAssignments:P,disableSubmit:A}}}),Te={class:"row"},je={class:"col-12 col-md-4 q-px-sm"},Pe=o("div",{class:"text-caption"},"Is this release voluntary or involuntary?",-1),Le={class:"text-caption"},We={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},He=o("div",{class:"text-caption"},"What is the reason for this release?",-1),Me={class:"text-caption"},Ye={class:"row"},_e={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},Ke=o("div",{class:"text-caption"},"When is the employee's last day on site?",-1),Xe={class:"text-caption"},ze={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},Ge=o("div",{class:"text-caption"},"Has all Company Equipment been returned?",-1),Je={class:"text-caption"},Ze={class:"row items-top justify-between q-mt-sm"},xe={class:"col-4 q-pl-xs q-pr-sm"},et={key:0,class:"text-body2 text-negative text-italic"},tt={key:0},at={key:1},lt={key:1,class:"text-body2 text-dark text-italic"},ot=o("span",null,"**Supporting documents are optional for this reason.",-1),st=[ot],nt={key:0,class:"col-6 q-pl-xs q-pr-sm"},it=o("div",{class:"text-body1 text-info q-mb-sm"},"Attached Documents",-1),rt={class:"row q-my-md"},dt={class:"col-12"},ut=o("div",{class:"q-pa-sm"},[o("div",{class:"text-h6 text-bold"},"CAAP Rating"),o("div",{class:"text-body1 text-dark text-italic"},"Capability, Attendance, Attitude, and Promotability"),o("div",{class:"text-body2 text-accent q-mt-sm"},"Select how much you agree with each of the following statements.")],-1),mt={class:"q-pb-sm"},pt=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee is capable of performing their assigned job.",-1),ct={class:"q-pb-sm"},vt=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee regularly shows up to work on time.",-1),bt={class:"q-pb-sm"},ft=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee has a good attitude.",-1),yt={class:"q-pb-sm"},gt=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"I am confident that this employee can be promoted in the future.",-1),Vt={class:"row q-mt-md"},ht={class:"col-12 col-md-5"},qt=o("div",{class:"text-body2 text-weight-bold text-info"}," Who conducted this evaluation? ",-1),wt={class:"text-caption"},At={class:"row q-mt-md"},St={class:"col-12 col-md-5"},Ut=o("div",{class:"text-body2 text-weight-bold text-info"}," Supervisor Recommendation for Rehire ",-1),Rt={class:"text-caption"},Et={class:"row q-py-sm"},Dt={class:"col-12"};function Ct(e,a,A,S,b,V){return y(),q("div",null,[l($e,{onSubmit:Ee(e.submit,["prevent"])},{default:s(()=>[l(Z,null,{default:s(()=>[l(x,null,{default:s(()=>[o("div",Te,[o("div",je,[Pe,l(T,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":a[0]||(a[0]=t=>e.category=t),options:e.primaryReasons},{error:s(()=>[o("div",Le,w(e.formErrors.selection),1)]),"no-option":s(()=>[l(O,null,{default:s(()=>[l($,{class:"text-grey"},{default:s(()=>[Q(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),o("div",We,[He,l(T,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":a[1]||(a[1]=t=>e.selection=t),options:e.options,"option-label":"12","display-value":`${e.selection?e.selection[12]:""}`,"bottom-slots":"",error:!!e.formErrors.selection,disable:!e.category},{error:s(()=>[o("div",Me,w(e.formErrors.selection),1)]),"no-option":s(()=>[l(O,null,{default:s(()=>[l($,{class:"text-grey"},{default:s(()=>[Q(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","display-value","error","disable"])])]),o("div",Ye,[o("div",_e,[Ke,l(se,{dense:"",type:"date",modelValue:e.effective,"onUpdate:modelValue":a[2]||(a[2]=t=>e.effective=t),error:!!e.formErrors.effective,"bottom-slots":""},{error:s(()=>[o("div",Xe,w(e.formErrors.effective),1)]),_:1},8,["modelValue","error"])]),o("div",ze,[Ge,l(T,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.equipment,"onUpdate:modelValue":a[3]||(a[3]=t=>e.equipment=t),options:[{value:!0,label:"Yes"},{value:!1,label:"No"},{value:!0,label:"None Issued"}],"bottom-slots":"",error:!!e.formErrors.equipment},{error:s(()=>[o("div",Je,w(e.formErrors.equipment),1)]),_:1},8,["modelValue","error"])])]),o("div",Ze,[o("div",xe,[l(ke,{dense:"","bottom-slots":"",modelValue:e.fileAttachment,"onUpdate:modelValue":a[4]||(a[4]=t=>e.fileAttachment=t),multiple:"",append:"",label:"Attach Supporting Documents"},{after:s(()=>[l(H,{dense:"",color:"info",round:"",flat:"",icon:"cloud_upload",onClick:e.showFiles},null,8,["onClick"])]),_:1},8,["modelValue"]),e.attachmentsRequired?(y(),q("div",et,[Q("!! "),e.selection[12].toLowerCase().includes("attendance")?(y(),q("span",tt,"Supporting attendance records must be attached.")):(y(),q("span",at,"Supporting documents are required for this reason."))])):(y(),q("div",lt,st))]),e.attachedFiles.length>0?(y(),q("div",nt,[it,l(Ne,{dense:""},{default:s(()=>[(y(!0),q(ne,null,Ue(e.attachedFiles,(t,c)=>(y(),q(ne,{key:t},[l(O,null,{default:s(()=>[l($,null,{default:s(()=>[l(Ce,null,{default:s(()=>[Q(w(c+1)+". "+w(t[6].filename),1)]),_:2},1024)]),_:2},1024),l($,{side:""},{default:s(()=>[l(H,{color:"accent",round:"",flat:"",class:"cursor-pointer",icon:"delete",size:"md",onClick:U=>e.deleteFile(c)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),l(ie)],64))),128))]),_:1})])):me("",!0)])]),_:1})]),_:1}),l(ie),o("div",rt,[o("div",dt,[ut,l(Z,null,{default:s(()=>[l(x,null,{default:s(()=>[o("div",null,[o("div",mt,[pt,l(d,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[5]||(a[5]=t=>e.capability=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(d,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[6]||(a[6]=t=>e.capability=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(d,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[7]||(a[7]=t=>e.capability=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(d,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[8]||(a[8]=t=>e.capability=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(d,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[9]||(a[9]=t=>e.capability=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(d,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[10]||(a[10]=t=>e.capability=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",ct,[vt,l(d,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[11]||(a[11]=t=>e.attendance=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(d,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[12]||(a[12]=t=>e.attendance=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(d,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[13]||(a[13]=t=>e.attendance=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(d,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[14]||(a[14]=t=>e.attendance=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(d,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[15]||(a[15]=t=>e.attendance=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(d,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[16]||(a[16]=t=>e.attendance=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",bt,[ft,l(d,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[17]||(a[17]=t=>e.attitude=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(d,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[18]||(a[18]=t=>e.attitude=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(d,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[19]||(a[19]=t=>e.attitude=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(d,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[20]||(a[20]=t=>e.attitude=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(d,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[21]||(a[21]=t=>e.attitude=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(d,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[22]||(a[22]=t=>e.attitude=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",yt,[gt,l(d,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[23]||(a[23]=t=>e.promotable=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(d,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[24]||(a[24]=t=>e.promotable=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(d,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[25]||(a[25]=t=>e.promotable=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(d,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[26]||(a[26]=t=>e.promotable=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(d,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[27]||(a[27]=t=>e.promotable=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(d,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[28]||(a[28]=t=>e.promotable=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])])]),o("div",Vt,[o("div",ht,[qt,l(T,{dense:"",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.supervisor,"onUpdate:modelValue":a[29]||(a[29]=t=>e.supervisor=t),options:e.getAssignments(e.props.record[74]).length>0?e.getAssignments(e.props.record[74]).filter(t=>t[3]!==e.props.record[3]).sort((t,c)=>t[75]>c[75]?1:-1):[],"option-label":t=>`${t[75]} - ${t[104]}`,"display-value":`${e.supervisor?e.supervisor[75]:""}`,"bottom-slots":"",error:!!e.formErrors.supervisor,hint:"Ex: Employee's Supervisor"},{error:s(()=>[o("div",wt,w(e.formErrors.supervisor),1)]),"no-option":s(()=>[l(O,null,{default:s(()=>[l($,{class:"text-grey"},{default:s(()=>[Q(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","error"])])]),o("div",At,[o("div",St,[Ut,l(T,{dense:"",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.recommendation,"onUpdate:modelValue":a[30]||(a[30]=t=>e.recommendation=t),options:e.recommendationOptions,"bottom-slots":"",error:!!e.formErrors.recommendation},{error:s(()=>[o("div",Rt,w(e.formErrors.recommendation),1)]),"no-option":s(()=>[l(O,null,{default:s(()=>[l($,{class:"text-grey"},{default:s(()=>[Q(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","error"])])])]),_:1})]),_:1})])]),o("div",Et,[o("div",Dt,[l(se,{filled:"",type:"textarea",modelValue:e.comments,"onUpdate:modelValue":a[31]||(a[31]=t=>e.comments=t),label:"Comments"},null,8,["modelValue"])])]),l(Re,{align:"right"},{default:s(()=>[l(H,{disable:e.disableSubmit,color:"info",label:"Submit",type:"submit"},null,8,["disable"]),l(H,{color:"secondary",label:"Cancel",onClick:e.cancelRelease},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var kt=Se(Oe,[["render",Ct]]);const Nt={class:"q-pa-sm"},$t={class:"row"},Qt={class:"col-12"},Ft=o("div",{class:"text-h6 text-weight-bold q-mb-md"},"Please complete the following to submit this release.",-1),ia={__name:"terminate",setup(e){g(0);const a=de(),A=ue(),S=pe(),b=g("employee"),V=g(null),t=g(null),c=g(0);b.value=a.query.reason==="no-show"?"arrivals":"employee",b.value==="no-show"&&(V.value=a.query.aid,t.value=a.query.did);const{getEmployee:U,getAssignmentsByEmployee:K,setAssignmentsByEmployee:h,setEmployees:j,setReleases:P,setReleasesByAssignment:L,setReleasesByEmployee:W}=ce(),u=C(()=>U(a.params.id)),R=C(()=>u.value?K(a.params.id):null),X=async()=>{if(!R.value&&u.value[577]&&u.value[577]>0){const{data:i}=await D.fetchFromHiringApp({fields:[F({type:"assignments",query:"",id:u.value[577]})]});h({id:u.value[3],data:i})}else if(u.value[577]&&u.value[577]>0)await D.fetchFromHiringApp({fields:[F({type:"assignments",query:"",id:u.value[577]})]});else if(!R.value&&V.value&&V.value>0){const{data:i}=await D.fetchFromHiringApp({fields:[F({type:"assignments",query:"",id:V.value})]});h({id:u.value[3],data:i})}else if(!R.value&&u.value[608]&&u.value[608]>0){const{data:i}=await D.fetchFromHiringApp({fields:[F({type:"assignments",query:"",id:u.value[608]})]});h({id:u.value[3],data:i})}else{const i=F({type:"assignments",query:"",id:u.value[577]});i[8]={value:`{3.EX.${a.query.aid}}`};const{data:r}=await D.fetchFromHiringApp({fields:[i]});h({id:u.value[3],data:r})}};_(u,(i,r)=>{i&&c.value===0&&(X(),c.value++)});const I=async({employee:i,release:r,assignment:p,effectiveNow:k})=>{b.value==="arrivals"&&a.query.did&&await E(a.query.did,r),S.notify({type:"positive",message:"Release successfully submitted."}),k?(i[581]=r[3],P({id:r[3],data:r}),j({id:i[3],data:i}),h({id:i[3],assignment:p}),L({id:p[3],data:r}),W({id:i[3],data:r})):(i[581]=r[3],j({id:i[3],data:i}),P({id:r[3],data:r}),L({id:p[3],data:r}),W({id:i[3],data:r})),b.value==="arrivals"?A.replace({name:"arrivals"}):A.replace({name:"view-ee-release",params:{id:i[3],release:r[3]}})};async function E(i,r){try{let p=7;r[33]==="Terminate_Employee_Voluntary_Never_Started_Working"?p=7:(r[33]==="Terminate_Employee_Involuntary_Lack_of_Work_End_of_Contract_Project"||r[33]==="Terminate_Employee_Involuntary_Project_Cancelled_Before_Employee_Started")&&(p=8);const{data:k}=await D.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:i},20:{value:"DNC"},61:{value:p},63:{value:r[33]},74:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return k[0][204]}catch(p){throw{message:"Cannot edit deployment",error:p}}}return(i,r)=>(y(),re(De,{style:{"max-width":"100vw"}},{default:s(()=>[o("div",Nt,[o("div",$t,[o("div",Qt,[l(Z,{flat:""},{default:s(()=>[R.value?(y(),re(x,{key:0},{default:s(()=>[Ft,l(kt,{record:R.value,employee:u.value,onReleaseSubmitted:I},null,8,["record","employee"])]),_:1})):me("",!0)]),_:1})])])])]),_:1}))}};export{ia as default};
