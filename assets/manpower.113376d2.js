import{Q as M,b as T,a as ae}from"./QTabPanels.c6a0ab04.js";import{Q as oe}from"./QTabs.dae2502b.js";import{Q as se}from"./QToolbar.85ee1da8.js";import{Q as le}from"./QPage.f2628afe.js";import{l as N,bM as I,r as V,c as $,_ as j,aZ as q,A as _,B as Y,d as a,bi as n,cw as F,D as p,cx as Q,cz as S,bL as re,F as x,aY as B,an as E,au as z,ab as k,bI as H,bO as G,y as ne,ao as ie}from"./index.b48bafa3.js";import{Q as K}from"./QSelect.b8f07e1a.js";import{u as O}from"./use-quasar.ed3977b0.js";import{u as U}from"./dataStore.beef04c5.js";import{dayjs as D}from"./dayjs.1b825f16.js";import{u as L}from"./useQuerySaver.b8f46e72.js";import{q as X}from"./quickbase.76c41fac.js";import{R as ee}from"./rosterTable.2fdc0062.js";import{Q as J,a as de}from"./QTable.a5b8e509.js";import{Q as W}from"./QTr.a2300b34.js";import{Q as Z}from"./QTd.cb00d1da.js";import{Q as pe}from"./QInnerLoading.7b168168.js";import{e as ue}from"./export-file.eb604dd4.js";import{g as me}from"./quickbaseDataHelpers.965058c7.js";import{P as ce}from"./projectPipeline.73bb50f7.js";import"./use-panel.96b32d19.js";import"./touch.60582172.js";import"./selection.880c234f.js";import"./QResizeObserver.1d221316.js";import"./rtl.cf9bbe47.js";import"./QChip.a60f92f6.js";import"./QItemLabel.6755a8b9.js";import"./QMenu.c9ecf4aa.js";import"./position-engine.859102af.js";import"./localForage.81a16957.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./i18n.469ad19f.js";import"./api.004b0e8a.js";import"./arrivalDate.cceb9cd2.js";import"./QTooltip.b1ab7884.js";import"./QForm.fc9a358b.js";import"./vee-validate.esm.caf1489b.js";import"./array.b59bb1b2.js";import"./QList.fb685d10.js";import"./QMarkupTable.971575d1.js";import"./use-fullscreen.0ef5a5d5.js";const fe=N({props:{},components:{RosterTable:ee},setup(e){const t=O(),v=I(),d=V(""),c=V(null),u=V(null),{getManpowerData:s,setRosters:r}=U(),b=$(()=>v.params.id?v.params.id:null),m=$(()=>(s({dataset:"rosters",id:b.value})||[]).sort((w,g)=>w[1].$d<g[1].$d?1:-1).filter(w=>!w[112]&&w.latest&&w[102]==="Active")),h=$(()=>{let l=[];return m.value.forEach(i=>{i[75].toLowerCase().includes(d.value.toLowerCase())&&l.push(i)}),l=c.value?l.filter(i=>D(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===D(c.value).tz("America/Chicago").format("MM/DD/YYYY")):l,l=u.value?l.filter(i=>i[68]===u.value):l,l.sort((i,w)=>i.employee[22]>w.employee[22]?1:-1)}),R=$(()=>[...new Map(m.value.map(l=>[l[68],l[68]])).values()]),C=async l=>{(l||!s({dataset:"rosters",id:b.value}))&&(t.loading.show(),await P(),t.loading.hide())},P=async()=>{const l=`{'74'.EX.'${b.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:i}=await X.fetchFromHiringApp({fields:[L({type:"assignments",query:l})]});r({id:b.value,data:i})};return C(!1),{allAssignments:m,search:d,startDateFilter:c,craftFilter:u,craftOptions:R,rows:h,loadData:C}}}),be={class:"row items-center"},ve={class:"col-12 col-md-3 q-px-sm"},we={class:"col-12 col-md-3 q-px-sm"},$e={class:"col-12 col-md-3 q-px-sm"};function he(e,t,v,d,c,u){const s=q("roster-table");return _(),Y("div",null,[a(S,{flat:""},{default:n(()=>[a(F,null,{default:n(()=>[p("div",be,[p("div",ve,[a(Q,{dense:"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=r=>e.search=r),label:"Search"},null,8,["modelValue"])]),p("div",we,[a(Q,{dense:"",modelValue:e.startDateFilter,"onUpdate:modelValue":t[1]||(t[1]=r=>e.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),p("div",$e,[a(K,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":t[2]||(t[2]=r=>e.craftFilter=r),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(s,{rows:e.rows,onRefreshData:t[3]||(t[3]=r=>e.loadData(!0))},null,8,["rows"])])}var ge=j(fe,[["render",he]]);const ye=N({props:{},components:{RosterTable:ee},setup(e){const t=O(),v=I(),d=V(""),c=V(null),u=V(null),{getManpowerData:s,setRosters:r}=U(),b=$(()=>v.params.id?v.params.id:null),m=$(()=>{const l=D().subtract(14,"day");return(s({dataset:"rosters",id:b.value})||[]).sort((g,o)=>g[1].$d<o[1].$d?1:-1).filter(g=>!g[112]&&g.latest&&g[102]==="Active"&&D(g[1].$d).isSameOrAfter(l)&&D(g[1].$d).isSameOrBefore(D()))}),h=$(()=>{let l=[];return m.value.forEach(i=>{i[75].toLowerCase().includes(d.value.toLowerCase())&&l.push(i)}),l=c.value?l.filter(i=>D(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===D(c.value).tz("America/Chicago").format("MM/DD/YYYY")):l,l=u.value?l.filter(i=>i[68]===u.value):l,l.sort((i,w)=>i.employee[22]>w.employee[22]?1:-1)}),R=$(()=>[...new Map(m.value.map(l=>[l[68],l[68]])).values()]),C=async l=>{(l||!s({dataset:"rosters",id:b.value}))&&(t.loading.show(),await P(),t.loading.hide())},P=async()=>{const l=`{'74'.EX.'${b.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:i}=await X.fetchFromProjectsApp({fields:[L({type:"assignments",query:l})]});r({id:b.value,data:i})};return{allAssignments:m,search:d,startDateFilter:c,craftFilter:u,craftOptions:R,rows:h,loadData:C}}}),De={class:"row items-center"},_e={class:"col-12 col-md-3 q-px-sm"},Ve={class:"col-12 col-md-3 q-px-sm"},Ae={class:"col-12 col-md-3 q-px-sm"};function qe(e,t,v,d,c,u){const s=q("roster-table");return _(),Y("div",null,[a(S,{flat:""},{default:n(()=>[a(F,null,{default:n(()=>[p("div",De,[p("div",_e,[a(Q,{dense:"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=r=>e.search=r),label:"Search"},null,8,["modelValue"])]),p("div",Ve,[a(Q,{dense:"",modelValue:e.startDateFilter,"onUpdate:modelValue":t[1]||(t[1]=r=>e.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),p("div",Ae,[a(K,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":t[2]||(t[2]=r=>e.craftFilter=r),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(s,{rows:e.rows,onRefresh:t[3]||(t[3]=r=>e.loadData(!0))},null,8,["rows"])])}var Qe=j(ye,[["render",qe]]);const Ce=N({props:{},components:{},setup(e){const t=O(),v=re(),d=I(),{capitalize:c}=ne,u=V(""),s=V(null),{getManpowerData:r,setDepartures:b}=U(),m=$(()=>d.params.id?d.params.id:null),h=[{name:1,label:"Name",align:"left",field:o=>o[49],format:o=>`${R(o)}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:o=>o[50],format:o=>`${o}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:o=>o[51],format:o=>o===""?"not available":o,sortable:!0},{name:4,label:"Classification",align:"left",field:o=>o[82],format:o=>`${!o||o===""?"Not Assigned":o}`,sortable:!0},{name:5,label:"Job #",align:"left",field:o=>o[81],format:o=>`${o===""||!o?"Not Assigned":o}`,sortable:!0},{name:6,label:"Depature Date",align:"left",field:o=>o[36].$d,format:o=>`${D(o).format("MM/DD/YYYY")}`,sortable:!0}],R=o=>{const A=o.split(" ");let y="";return A.forEach((f,te)=>{y+=te>0?` ${c(f.toLowerCase())}`:c(f.toLowerCase())}),y};function C(o){v.push({name:"view-release",params:{release:o[3]}})}function P(o,A,y){let f=A!==void 0?A(o,y):o;return f=f==null?"":String(f),f=f.split('"').join('""'),`"${f}"`}function l(){const o=[h.value.map(y=>P(y.label))].concat(i.value.map(y=>h.value.map(f=>P(typeof f.field=="function"?f.field(y):y[f.field===void 0?f.name:f.field],f.format,y)).join(","))).join(`\r
`);ue(`${D().format("MM.DD.YYYY")} Releases-Export.csv`,o,"text/csv")!==!0&&t.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const i=$(()=>r({dataset:"departures",id:m.value})||[]),w=async o=>{(o||!r({dataset:"departures",id:m.value}))&&(t.loading.show(),await g(),t.loading.hide())},g=async()=>{const o=`{'41'.EX.'${m.value}'}AND{'42'.XEX.'Complete'}AND({'36'.OAF.'today'}OR{'36'.IR.'last 30 d'}OR{'1'.IR.'last 30 d'})`,{data:A}=await X.fetchFromHiringApp({fields:[L({type:"releases",query:o})]});b({id:m.value,data:A})};return w(),{search:u,dateFilter:s,loadData:w,columns:h,viewRelease:C,exportAllReleases:l,rows:i}}}),Pe={class:"row items-center"},Ye={class:"col-12 col-md-3 q-px-sm"},Re={class:"col-12 col-md-3 q-px-sm"},ke={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Fe={class:"text-dark text-caption text-italic"};function je(e,t,v,d,c,u){return _(),Y("div",null,[a(S,{flat:""},{default:n(()=>[a(F,null,{default:n(()=>[p("div",Pe,[p("div",Ye,[a(Q,{dense:"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=s=>e.search=s),label:"Search"},null,8,["modelValue"])]),p("div",Re,[a(Q,{dense:"",modelValue:e.dateFilter,"onUpdate:modelValue":t[1]||(t[1]=s=>e.dateFilter=s),label:"Departure Date",type:"date","stack-label":""},null,8,["modelValue"])])])]),_:1})]),_:1}),p("div",null,[a(de,{title:"Recent Departures","title-class":"text-h5 text-primary",columns:e.columns,rows:e.rows,"row-key":s=>s[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent departures",dense:""},{header:n(s=>[a(W,{class:"bg-dark text-white",props:s},{default:n(()=>[a(J,{"auto-width":""}),(_(!0),Y(x,null,B(s.cols,r=>(_(),E(J,{key:r.name,props:s},{default:n(()=>[z(k(r.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:n(s=>[a(W,{props:s},{default:n(()=>[a(Z,{"auto-width":""},{default:n(()=>[a(H,{class:"cursor-pointer",size:e.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:r=>e.viewRelease(s.row),name:s.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(_(!0),Y(x,null,B(s.cols,r=>(_(),E(Z,{key:r.name,props:s},{default:n(()=>[z(k(r.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":n(({message:s})=>[p("div",ke,[a(H,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),p("span",null,k(s),1)])]),"top-right":n(()=>[p("div",Fe,"(Total: "+k(e.rows.length)+" departures)",1),a(G,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[2]||(t[2]=s=>e.loadData(!0))}),a(G,{dense:e.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:e.exportAllReleases,disable:e.rows.length<1},null,8,["dense","onClick","disable"])]),loading:n(()=>[a(pe,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Me=j(Ce,[["render",je]]);const Te={name:"Pipeline",components:{ProjectPipelineTable:ce},setup(){const e=O(),t=I(),v=V(""),{getManpowerData:d,setPipelines:c}=U(),u=$(()=>t.params.id?t.params.id:null),s=$(()=>d({dataset:"pipelines",id:u.value})||[]),r=async m=>{(m||!d({dataset:"pipelines",id:u.value}))&&(e.loading.show(),await b(),e.loading.hide())},b=async()=>{const m=await me(u.value);c({id:u.value,data:m})};return r(),{allPipeline:s,search:v,loadData:r}}},Ee={class:"text-h5 text-dark"},Ne={class:"text-body2 text-italic q-ml-sm"},Ie=p("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Se={class:"row items-center"},Oe={class:"col-12 col-md-3 q-px-sm"};function Ue(e,t,v,d,c,u){const s=q("project-pipeline-table");return _(),Y("div",null,[a(S,{flat:""},{default:n(()=>[a(F,{class:"q-pb-none"},{default:n(()=>[p("div",Ee,[z(" Staffing Pipeline "),p("span",Ne,"("+k(d.allPipeline.length)+" total)",1)]),Ie]),_:1}),a(F,null,{default:n(()=>[p("div",Se,[p("div",Oe,[a(Q,{dense:"",modelValue:d.search,"onUpdate:modelValue":t[0]||(t[0]=r=>d.search=r),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(s,{rows:d.allPipeline,onRefresh:t[1]||(t[1]=r=>d.loadData(!0))},null,8,["rows"])])}var ze=j(Te,[["render",Ue]]);const Le=N({name:"Employees",components:{RosterTab:ge,NewArrivalsTab:Qe,ReleasesTab:Me,PipelineTab:ze},setup(){return{tab:V(0)}}}),Xe={class:"q-pa-md"};function xe(e,t,v,d,c,u){const s=q("roster-tab"),r=q("new-arrivals-tab"),b=q("pipeline-tab"),m=q("releases-tab");return _(),E(le,{style:{"max-width":"100vw"}},{default:n(()=>[p("div",Xe,[a(se,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[a(oe,{modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=h=>e.tab=h),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:n(()=>[a(M,{name:0,label:e.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),a(M,{name:1,label:"New Arrivals"}),e.$route.name==="project-manpower"?(_(),E(M,{key:0,name:3,label:"Pipeline"})):ie("",!0),a(M,{name:2,label:"Departures"})]),_:1},8,["modelValue"])]),_:1}),a(ae,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=h=>e.tab=h),animated:""},{default:n(()=>[a(T,{name:0},{default:n(()=>[a(s)]),_:1}),a(T,{name:1},{default:n(()=>[a(r)]),_:1}),a(T,{name:3},{default:n(()=>[a(b)]),_:1}),a(T,{name:2},{default:n(()=>[a(m)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var jt=j(Le,[["render",xe]]);export{jt as default};
