import{u as p,q as n}from"./quickbase.c0a4ee71.js";import{dayjs as v}from"./dayjs.126d3740.js";import{u as T}from"./dataStore.ebf099da.js";import{l as h}from"./index.e59a70b7.js";const A=async({employee:e,assignment:t,effectiveNow:a,values:s,attachments:o,ratings:c,supervisor:u})=>{const{userData:f,getUserType:j}=p(),l=f;l.access&&delete l.access,l.permissions&&delete l.permissions;const y=[{25:{value:e[3]},28:{value:t[3]},30:{value:s.selection[10]},35:{value:t[142]},36:{value:s.effective},38:{value:JSON.stringify(l)},39:{value:j!=="QuickBase User"},60:{value:c.comments?c.comments:""},72:{value:s.equipment.value}}];if(a){const{ee:d,assign:r}=await L({assignment:t,supervisor:u}),{data:m}=await n.upsertRecordsXML({to:"bp3ga39ut",data:y,fieldsToReturn:[37],formatObject:37},{action:"create",type:"release"}),{release:i}=await g({release:m[0][37][3],employee:m[0][37][25],ratings:c,user:l,supervisor:u});if(o.length>0){const{docs:R}=await O({release:i,attachments:o,user:l});return i[70]=R.map(w=>w[12]),{release:i,employee:d,assignment:r,attachments:R}}else return{release:i,employee:d,assignment:r,attachments:[]}}else{const{data:d}=await n.upsertRecordsXML({to:"bp3ga39ut",data:y,fieldsToReturn:[37],formatObject:37},{action:"create",type:"release"});u&&M({assignment:t,supervisor:u});const{release:r}=await g({release:d[0][37][3],employee:d[0][37][25],ratings:c,user:l,supervisor:u});if(o.length>0){const{docs:m}=await O({release:r,attachments:o,user:l});return r[70]=m.map(i=>i[12]),{release:r,employee:e,assignment:t,attachments:m}}else return{release:r,employee:e,assignment:t,attachments:[]}}},g=async({release:e,employee:t,ratings:a,user:s,supervisor:o})=>{const c={6:{value:a.attendance},8:{value:a.attitude},10:{value:a.capability},12:{value:a.promotable},14:{value:a.comments?a.comments:""},16:{value:t},34:{value:e},36:{value:JSON.stringify(s)}};o&&Object.assign(c,{42:{value:o[18]}});const{data:u}=await n.upsertRecordsXML({to:"bqzkbcxup",data:[c],fieldsToReturn:[35],formatObject:35});return{release:u[0][35]}},O=async({release:e,attachments:t,user:a})=>{const s=[];t.forEach(c=>{Object.assign(c,{8:{value:JSON.stringify(a)},9:{value:e[3]},10:{value:e[25]}}),s.push(c)});const{data:o}=await n.upsertRecordsXML({to:"bsstsai5d",data:s,fieldsToReturn:[12],formatObject:12});return{docs:o}},L=async({assignment:e,supervisor:t})=>{const{removeData:a}=T(),s={3:{value:e[3]},21:{value:"Complete"},22:{value:v().tz("America/Chicago")}};t&&Object.assign(s,{133:{value:t[3]}});const{data:o}=await n.upsertRecordsXML({to:"bp3gazpqj",data:[s],fieldsToReturn:[110],formatObject:110});return a({type:"assignments",key:o[0][110][74],item:o[0][110],storageKey:h.storageAssignments}),{ee:await b({3:{value:e[18]},79:{value:19}}),assign:o[0][110]}},b=async e=>{const{data:t}=await n.upsertRecordsXML({to:"bp3gb7ng2",data:[e],fieldsToReturn:[549],formatObject:549});return t[0][549]},M=async({assignment:e,supervisor:t})=>{n.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:e[3]},133:{value:t[3]}}],fieldsToReturn:[110],formatObject:110})},C=async({release:e,disp:t})=>{const{userData:a}=p(),s=a;s.access&&delete s.access,s.permissions&&delete s.permissions;const o=[{3:{value:e[3]},42:{value:"Reviewed"},43:{value:t.value},75:{value:JSON.stringify(s)},77:{value:v().tz("America/Chicago")}}],c=t.value==="Terminate"?19:15,u=await b({3:{value:e[25]},79:{value:c},16:{value:e[35]}}),{data:f}=await n.upsertRecordsXML({to:"bp3ga39ut",data:o,fieldsToReturn:[37],formatObject:37},{action:"update",type:"release"});return{release:f[0][37],employee:u}},D=async({release:e})=>{const{userData:t}=p(),a=t;a.access&&delete a.access,a.permissions&&delete a.permissions;const s=[{3:{value:e[3]},42:{value:"Complete"},73:{value:"Processed"},76:{value:JSON.stringify(a)},78:{value:v().tz("America/Chicago")}}];b({3:{value:e[25]},79:{value:""},122:{value:""}});const{data:o}=await n.upsertRecordsXML({to:"bp3ga39ut",data:s,fieldsToReturn:[37],formatObject:37},{action:"update",type:"release"});return{data:o[0][37]}};export{C as f,L as r,A as s,D as t};
