import{k as U,r as b,c as p,_ as M,A as v,B as x,d as i,bi as c,db as V,D as d,bI as O,ab as Y,aZ as R,an as L,cw as j,au as z,ao as B,cx as k,cz as E}from"./index.544726d2.js";import{Q as A}from"./QSelect.152777d1.js";import{Q as W}from"./QPage.2113fa42.js";import{u as $}from"./use-quasar.de9b4251.js";import{H as C,u as X,q as g}from"./quickbase.dc759386.js";import{dayjs as q}from"./dayjs.18653603.js";import{u as J}from"./dataStore.e510ce04.js";import{Q as H}from"./QInnerLoading.7bea1a41.js";import{a as Z}from"./QTable.1089518a.js";import"./QChip.2eb47deb.js";import"./QItemLabel.9df651b6.js";import"./QMenu.afaf079f.js";import"./position-engine.9b566ae2.js";import"./selection.019ae5ac.js";import"./rtl.cf9bbe47.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.cf0f4dd4.js";import"./i18n.95b8f7c4.js";import"./api.c454b805.js";import"./QList.8b6cd145.js";import"./QMarkupTable.871b0fab.js";import"./use-fullscreen.6fa96420.js";const G=U({name:"Arrivals Table",components:{},props:{rows:Array,selected:Array},setup(n,r){const m=$(),a=b(!1),u=p(()=>m.screen.gt.sm?[{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,l)=>l[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${C.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0}]:[{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,l)=>l[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${C.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0}]);function f({rows:e,added:l,evt:h}){a.value=!0,r.emit("arrivalMarked",{record:e[0],added:l}),setTimeout(function(){a.value=!1},1500)}return{columns:u,updateArrivals:f,props:n,loading:a}}}),K={class:"q-px-sm"},ee={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function te(n,r,m,a,u,f){return v(),x("div",K,[i(Z,{dense:"",columns:n.columns,rows:n.props.rows,"row-key":e=>e[3],class:"q-pa-sm",pagination:{rowsPerPage:n.$q.screen.gt.sm?25:100},separator:"vertical",selection:"multiple",onSelection:n.updateArrivals,selected:n.props.selected,"table-header-class":"bg-dark text-white","no-data-label":"There are no expected arrivals",loading:n.loading,grid:n.$q.screen.lt.md},{"header-selection":c(e=>[i(V,{disable:"",modelValue:e.selected,"onUpdate:modelValue":l=>e.selected=l},null,8,["modelValue","onUpdate:modelValue"])]),"body-selection":c(e=>[i(V,{label:n.$q.screen.lt.sm?"Arrived":"",modelValue:e.selected,"onUpdate:modelValue":l=>e.selected=l},null,8,["label","modelValue","onUpdate:modelValue"])]),"no-data":c(({message:e})=>[d("div",ee,[i(O,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),d("span",null,Y(e),1)])]),loading:c(()=>[i(H,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","onSelection","selected","loading","grid"])])}var ae=M(G,[["render",te]]);const le={name:"Arrivals",components:{MarkArrivalsTable:ae},setup(){const n=$(),r=b(null),m=b(null),a=b(""),u=b(""),{fetchAllDeployments:f,updateDeployment:e,getDeployments:l}=J(),{userProjects:h}=X(),w=p(()=>r.value?r.value[9]:null),F=p(()=>h()),Q=p(()=>l(w.value).filter(t=>t[20]==="Complete")),y=p(()=>{let t=[];return l(w.value).forEach(o=>{o[31].toLowerCase().includes(u.value.toLowerCase())&&t.push(o)}),t=a.value?t.filter(o=>q(o[33].$d).tz("America/Chicago").format("MM/DD/YYYY")===q(a.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=m.value?t.filter(o=>o[132]===m.value):t,t}),N=p(()=>[...new Map(y.value.map(t=>[t[132],t[132]])).values()]);async function P(){n.loading.show(),await f(),n.loading.hide()}async function S({record:t,added:o}){if(o){await I(t),await D({id:t[21],status:7});const s=await _(t[3],"Complete");e({projectId:s[134],key:s[3],record:s})}else{await T(t),await D({id:t[21],status:6});const s=await _(t[3],"In Process");e({projectId:s[134],key:s[3],record:s})}}async function I(t){try{const{data:o}=await g.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:t[3]},13:{value:t[15]},18:{value:t[21]},60:{value:""}}],fieldsToReturn:[108],formatObject:108});return o[0][108]}catch(o){throw{message:"Cannot add assignment",error:o}}}async function D({id:t,status:o}){try{const{data:s}=await g.upsertRecordsXML({to:"bp3gb7ng2",data:[{3:{value:t},79:{value:o}}],fieldsToReturn:[3]});return s[0][3]}catch(s){throw{message:"Cannot edit employee",error:s}}}async function _(t,o){try{const{data:s}=await g.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:t},20:{value:o},22:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return s[0][204]}catch(s){throw{message:"Cannot edit deployment",error:s}}}async function T(t){try{const{data:o}=await g.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:t.assignment[3]},22:{value:new Date},21:{value:"Canceled"},19:{value:""},60:{value:""}}],fieldsToReturn:[108],formatObject:108});return o[0][108]}catch(o){throw{message:"Cannot cancel assignment",error:o}}}return P(),{projectFilter:r,arrived:Q,allDeployments:y,arrivalMarked:S,projectOptions:F,craftOptions:N,craftFilter:m,startDateFilter:a,search:u}}},oe={class:"q-pt-sm"},re={class:"text-h5 text-dark"},se={class:"text-body2 text-italic q-ml-sm"},ne=d("div",{class:"text-subtitle2 text-accent"},"Please toggle the switch for everyone that has arrived at the job site.",-1),ie={class:"row items-center"},de={key:0,class:"col-12 col-md-3 q-px-sm"},ce={class:"col-12 col-md-3 q-px-sm"},me={class:"col-12 col-md-3 q-px-sm"},ue={class:"col-12 col-md-3 q-px-sm"};function pe(n,r,m,a,u,f){const e=R("mark-arrivals-table");return v(),L(W,{style:{"max-width":"100vw"}},{default:c(()=>[d("div",oe,[i(E,{flat:""},{default:c(()=>[i(j,{class:"q-pb-none"},{default:c(()=>[d("div",re,[z(" Expected Arrivals "),d("span",se,"("+Y(a.allDeployments.length)+" total)",1)]),ne]),_:1}),i(j,null,{default:c(()=>[d("div",ie,[a.projectOptions.length>1?(v(),x("div",de,[i(A,{dense:"",label:"Filter By Project","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.projectFilter,"onUpdate:modelValue":r[0]||(r[0]=l=>a.projectFilter=l),options:a.projectOptions,"option-value":"9","option-label":"12","display-value":a.projectFilter?a.projectFilter[12]:"","use-chips":""},null,8,["modelValue","options","display-value"])])):B("",!0),d("div",ce,[i(k,{dense:"",modelValue:a.search,"onUpdate:modelValue":r[1]||(r[1]=l=>a.search=l),label:"Search"},null,8,["modelValue"])]),d("div",me,[i(k,{dense:"",modelValue:a.startDateFilter,"onUpdate:modelValue":r[2]||(r[2]=l=>a.startDateFilter=l),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),d("div",ue,[i(A,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.craftFilter,"onUpdate:modelValue":r[3]||(r[3]=l=>a.craftFilter=l),options:a.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),i(e,{rows:a.allDeployments,selected:a.arrived,onArrivalMarked:a.arrivalMarked},null,8,["rows","selected","onArrivalMarked"])])]),_:1})}var Se=M(le,[["render",pe]]);export{Se as default};
