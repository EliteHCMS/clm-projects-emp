import{Q as V}from"./QSelect.08716fd1.js";import{k as P,bL as S,c as w,_ as T,y as x,A as b,B as $,d as s,bi as u,F as Q,aY as F,an as q,au as M,ab as D,bI as N,D as y,bO as E,r as C,w as U,aZ as _,cw as J,ao as W,cx as O,cz as Z}from"./index.df995f5f.js";import{u as z}from"./use-quasar.e1d67d94.js";import{u as G}from"./dataStore.e1ab6f28.js";import{u as H}from"./quickbase.95274e2f.js";import{dayjs as v}from"./dayjs.2c96dcd3.js";import{Q as I,a as K}from"./QTable.ec6bcda4.js";import{Q as B}from"./QTr.6646e9f9.js";import{Q as L}from"./QTd.4973894f.js";import{Q as X}from"./QInnerLoading.bdf3df47.js";import{e as ee}from"./export-file.eb604dd4.js";const te=P({props:{rows:Array},setup(t,r){const p=z(),g=S(),{capitalize:f}=x,c=w(()=>p.screen.gt.sm?[{name:1,label:"Name",align:"left",field:e=>e.employee[22],format:(e,m)=>`${o(m.employee)}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e.employee[378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e.employee[213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Arrival Date",align:"left",field:e=>e[63].$d,format:e=>`${v(e).format("MM/DD/YYYY")}`,sortable:!0}]:[{name:1,label:"Name",align:"left",field:e=>e.employee[22],format:(e,m)=>`${o(m.employee)}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e.employee[378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e.employee[213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Arrival Date",align:"left",field:e=>e[63].$d,format:e=>`${v(e).format("MM/DD/YYYY")}`,sortable:!0}]),o=e=>{const m=e[20]!==""?f(e[20].toLowerCase().trim()):"",d=e[22]!==""?f(e[22].toLowerCase().trim()):"",l=e[21]!==""?` ${f(e[21].toLowerCase().trim())}`:"",k=e[23]!==""?` ${f(e[23])}`:"";return`${d}${k}, ${m}${l}`};function a(e){g.push({name:"ee-summary",params:{id:e[18]}})}function h(e,m,d){let l=m!==void 0?m(e,d):e;return l=l==null?"":String(l),l=l.split('"').join('""'),`"${l}"`}function Y(){const e=[c.value.map(d=>h(d.label))].concat(t.rows.value.map(d=>c.value.map(l=>h(typeof l.field=="function"?l.field(d):d[l.field===void 0?l.name:l.field],l.format,d)).join(","))).join(`\r
`);ee(`${v().format("MM.DD.YYYY")} Employees-Export.csv`,e,"text/csv")!==!0&&p.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return{columns:c,props:t,exportAllEmployees:Y,viewEmployee:a}}}),oe={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},ae={class:"text-dark text-caption text-italic"};function le(t,r,p,g,f,c){return b(),$("div",null,[s(K,{title:"Active Roster","title-class":"text-h5 text-primary",columns:t.columns,rows:t.props.rows,"row-key":o=>o[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no employees in the roster",dense:""},{header:u(o=>[s(B,{class:"bg-dark text-white",props:o},{default:u(()=>[s(I,{"auto-width":""}),(b(!0),$(Q,null,F(o.cols,a=>(b(),q(I,{key:a.name,props:o},{default:u(()=>[M(D(a.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:u(o=>[s(B,{props:o},{default:u(()=>[s(L,{"auto-width":""},{default:u(()=>[s(N,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:a=>t.viewEmployee(o.row),name:o.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(b(!0),$(Q,null,F(o.cols,a=>(b(),q(L,{key:a.name,props:o},{default:u(()=>[M(D(a.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":u(({message:o})=>[y("div",oe,[s(N,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),y("span",null,D(o),1)])]),"top-right":u(()=>[y("div",ae,"(Total: "+D(t.props.rows.length)+" employees)",1),s(E,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:r[0]||(r[0]=o=>t.$emit("refreshData"))}),s(E,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllEmployees,disable:t.props.rows.length<1},null,8,["dense","onClick","disable"])]),loading:u(()=>[s(X,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])}var re=T(te,[["render",le]]);const se=P({props:{},components:{RosterTable:re},setup(t){const r=z(),p=C(null),g=C(""),f=C(null),c=C(null),{userProjects:o}=H(),{getAssignments:a,fetchAllAssignments:h,fetchAssignments:Y}=G(),e=w(()=>p.value?p.value[9]:null),m=w(()=>o()),d=w(()=>a(e.value).sort((i,A)=>i[1].$d<A[1].$d?1:-1).filter(i=>!i[112]&&i.latest&&i[102]==="Active")),l=w(()=>{let n=[];return d.value.forEach(i=>{i[75].toLowerCase().includes(g.value.toLowerCase())&&n.push(i)}),n=f.value?n.filter(i=>v(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===v(f.value).tz("America/Chicago").format("MM/DD/YYYY")):n,n=c.value?n.filter(i=>i[68]===c.value):n,n.sort((i,A)=>i.employee[22]>A.employee[22]?1:-1)}),k=w(()=>[...new Map(d.value.map(n=>[n[68],n[68]])).values()]);async function j(n){r.loading.show(),p.value?await Y({projectId:e.value,refresh:n}):await h({refresh:n}),r.loading.hide()}function R(){p.value=m.value[0]}return U(p,()=>{j(!1)}),R(),{allAssignments:d,projectOptions:m,projectFilter:p,search:g,startDateFilter:f,craftFilter:c,craftOptions:k,rows:l,loadData:j}}}),ne={class:"row items-center"},ie={key:0,class:"col-12 col-md-3"},de={class:"col-12 col-md-3 q-px-sm"},me={class:"col-12 col-md-3 q-px-sm"},ue={class:"col-12 col-md-3 q-px-sm"};function pe(t,r,p,g,f,c){const o=_("roster-table");return b(),$("div",null,[s(Z,{flat:""},{default:u(()=>[s(J,null,{default:u(()=>[y("div",ne,[t.projectOptions.length>1?(b(),$("div",ie,[s(V,{dense:"",label:"Filter By Project","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.projectFilter,"onUpdate:modelValue":r[0]||(r[0]=a=>t.projectFilter=a),options:t.projectOptions,"option-value":"9","option-label":"12","display-value":t.projectFilter?t.projectFilter[12]:"","use-chips":""},null,8,["modelValue","options","display-value"])])):W("",!0),y("div",de,[s(O,{dense:"",modelValue:t.search,"onUpdate:modelValue":r[1]||(r[1]=a=>t.search=a),label:"Search"},null,8,["modelValue"])]),y("div",me,[s(O,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":r[2]||(r[2]=a=>t.startDateFilter=a),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),y("div",ue,[s(V,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":r[3]||(r[3]=a=>t.craftFilter=a),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),s(o,{rows:t.rows,onRefreshData:r[4]||(r[4]=a=>t.loadData(!0))},null,8,["rows"])])}var Ye=T(se,[["render",pe]]);export{Ye as E,re as R};
