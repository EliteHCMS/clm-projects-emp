import{Q as U,a as K,b as C}from"./QTabPanels.7f2b2f83.js";import{Q as Z}from"./QTabs.3a560d12.js";import{Q as ce}from"./QToolbar.6b905ef4.js";import{Q as pe}from"./QPage.8d15663e.js";import{u as oe,q as se,i as ee}from"./app.bda2cd70.js";import{l as x,bW as z,r as D,c as A,_ as O,b7 as N,B as v,C as X,d as l,bt as o,cW as B,E as c,cX as E,as as V,at as q,cV as W,bV as fe,w as be,o as ve,bS as ae,aa as te,ae as H,bY as le,z as $e,az as ge}from"./index.960d5b34.js";import{a as re}from"./QSelect.ce23f885.js";import{u as L}from"./use-quasar.09536e80.js";import{u as G}from"./dataStore.d3a4115a.js";import{dayjs as Y}from"./dayjs.501e8a8e.js";import{u as ne}from"./useQuerySaver.d29ff9ee.js";import{_ as ye}from"./projectSelector.32d51d56.js";import{R as ie,g as we}from"./quickbaseDataHelpers.3254b19b.js";import{Q as De}from"./QTd.e3f90e32.js";import{Q as he}from"./QInnerLoading.13b17dc0.js";import{Q as _e}from"./QTable.2cc075de.js";import{e as Ve}from"./export-file.dc78ba05.js";import{P as je}from"./projectPipeline.91fab734.js";import"./use-panel.98705a6b.js";import"./touch.3df10340.js";import"./selection.4cab378b.js";import"./QResizeObserver.b1215cec.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.84a30b23.js";import"./index.04bc0a32.js";import"./i18n.2abc02f2.js";import"./QChip.e4d2f168.js";import"./QMenu.dd57348b.js";import"./position-engine.40859e34.js";import"./QTr.4b36010c.js";import"./index.3d38bdab.js";import"./arrivalDate.defa95ba.js";import"./QTooltip.7454b396.js";import"./QForm.f3e65354.js";import"./vee-validate.esm.d4095220.js";import"./array.164cfe36.js";import"./QList.c2993b6b.js";import"./QMarkupTable.17a90ccc.js";import"./use-fullscreen.7e074d8e.js";const Pe=x({props:{},components:{RosterTable:ie,projectSelector:ye},setup(a){const t=L(),j=z(),{getUserType:f}=oe(),P=D(""),b=D(null),d=D(null),{getManpowerData:s,setRosters:i}=G(),m=A(()=>j.params.id?j.params.id:null),$=A(()=>(s({dataset:"rosters",id:m.value})||[]).sort((g,S)=>g[1].$d<S[1].$d?1:-1).filter(g=>!g[112]&&g.latest&&g[102]==="Active")),_=A(()=>{let r=$.value;return r=b.value?r.filter(k=>Y(k[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Y(b.value).tz("America/Chicago").format("MM/DD/YYYY")):r,r=d.value?r.filter(k=>k[68]===d.value):r,r.sort((k,g)=>k.employee[22]>g.employee[22]?1:-1)}),M=A(()=>[...new Map($.value.map(r=>[r[68],r[68]])).values()]),T=async r=>{(r||!s({dataset:"rosters",id:m.value}))&&(t.loading.show(),await u(),t.loading.hide())},u=async()=>{const r=`{'173'.EX.'${m.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:k}=await se.fetchFromHiringApp({fields:[ne({type:"assignments",query:r})]});i({id:m.value,data:k})};return T(!1),{allAssignments:$,search:P,startDateFilter:b,craftFilter:d,craftOptions:M,rows:_,getUserType:f,loadData:T}}}),ke={class:"row items-center"},Ye={class:"col-12 col-md-3 q-px-sm"},Re={class:"col-12 col-md-3 q-px-sm"},qe={class:"col-12 col-md-3 q-px-sm"};function Ae(a,t,j,f,P,b){const d=N("projectSelector"),s=N("roster-table");return v(),X("div",null,[l(W,{flat:""},{default:o(()=>[l(B,null,{default:o(()=>[c("div",ke,[c("div",Ye,[l(E,{dense:"",modelValue:a.search,"onUpdate:modelValue":t[0]||(t[0]=i=>a.search=i),label:"Search"},null,8,["modelValue"])]),c("div",Re,[l(E,{dense:"",modelValue:a.startDateFilter,"onUpdate:modelValue":t[1]||(t[1]=i=>a.startDateFilter=i),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),c("div",qe,[l(re,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.craftFilter,"onUpdate:modelValue":t[2]||(t[2]=i=>a.craftFilter=i),options:a.craftOptions,"use-chips":""},null,8,["modelValue","options"]),a.getUserType==="Project User"?(v(),V(d,{key:0,can:"read",dense:"",style:{display:"none"}})):q("",!0)])])]),_:1})]),_:1}),l(s,{rows:a.rows,onRefreshData:t[3]||(t[3]=i=>a.loadData(!0)),title:"Active Roster",filter:a.search},null,8,["rows","filter"])])}var Se=O(Pe,[["render",Ae]]);const Qe=x({props:{},components:{RosterTable:ie},setup(a){const t=L(),j=z(),f=D(""),P=D(null),b=D(null),{getManpowerData:d,setRosters:s}=G(),i=A(()=>j.params.id?j.params.id:null),m=A(()=>{const u=Y().subtract(14,"day");return(d({dataset:"rosters",id:i.value})||[]).sort((g,S)=>g[1].$d<S[1].$d?1:-1).filter(g=>!g[112]&&g.latest&&g[102]==="Active"&&Y(g[1].$d).isSameOrAfter(u)&&Y(g[1].$d).isSameOrBefore(Y()))}),$=A(()=>{let u=m.value;return u=P.value?u.filter(r=>Y(r[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Y(P.value).tz("America/Chicago").format("MM/DD/YYYY")):u,u=b.value?u.filter(r=>r[68]===b.value):u,u.sort((r,k)=>r.employee[22]>k.employee[22]?1:-1)}),_=A(()=>[...new Map(m.value.map(u=>[u[68],u[68]])).values()]),M=async u=>{(u||!d({dataset:"rosters",id:i.value}))&&(t.loading.show(),await T(),t.loading.hide())},T=async()=>{const u=`{'173'.EX.'${i.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:r}=await se.fetchFromProjectsApp({fields:[ne({type:"assignments",query:u})]});s({id:i.value,data:r})};return{allAssignments:m,search:f,startDateFilter:P,craftFilter:b,craftOptions:_,rows:$,loadData:M}}}),Ce={class:"row items-center"},Ne={class:"col-12 col-md-3 q-px-sm"},Me={class:"col-12 col-md-3 q-px-sm"},Te={class:"col-12 col-md-3 q-px-sm"};function Ue(a,t,j,f,P,b){const d=N("roster-table");return v(),X("div",null,[l(W,{flat:""},{default:o(()=>[l(B,null,{default:o(()=>[c("div",Ce,[c("div",Ne,[l(E,{dense:"",modelValue:a.search,"onUpdate:modelValue":t[0]||(t[0]=s=>a.search=s),label:"Search"},null,8,["modelValue"])]),c("div",Me,[l(E,{dense:"",modelValue:a.startDateFilter,"onUpdate:modelValue":t[1]||(t[1]=s=>a.startDateFilter=s),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),c("div",Te,[l(re,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.craftFilter,"onUpdate:modelValue":t[2]||(t[2]=s=>a.craftFilter=s),options:a.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(d,{rows:a.rows,onRefresh:t[3]||(t[3]=s=>a.loadData(!0)),title:"New Arrivals",filter:a.search},null,8,["rows","filter"])])}var Ee=O(Qe,[["render",Ue]]);const Ie={class:"row items-center"},Be={class:"col-12 col-md-3 q-px-sm"},Fe={class:"col-12 col-md-3 q-px-sm"},ze={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Oe={class:"text-dark text-caption text-italic"},Xe={__name:"releases",setup(a){const t=fe(),j=z(),f=L(),{capitalize:P}=$e,b=D(j.params.id?j.params.id:null),d=D(),s=D([]),i=D(""),m=D(""),$=D(!1),_=D({sortBy:6,descending:!0,page:1,rowsPerPage:25,rowsNumber:0});be(m,()=>{g()});const M=D([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${u(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e.replace("&amp;","&")}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:42,label:"Status",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1,sortOrder:"ad"}]),T=D([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${u(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e.replace("&amp;","&")}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0},{name:42,label:"Status",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1,sortOrder:"ad"}]),u=e=>{const y=e.split(" ");let n="";return y.forEach((p,Q)=>{n+=Q>0?` ${P(p.toLowerCase())}`:P(p.toLowerCase())}),n},r=({page:e,pageSize:y,descending:n,filter:p,sortBy:Q})=>{try{let R="";p&&(R=p.trim());const F={...p&&{$or:[{fullName:{$containsi:`${R}`}},{classification:{$containsi:`${R}`}},{jobNumber:{$containsi:`${R}`}},{workdayId:{$containsi:`${R}`}},{phoneNumber:{$containsi:`${R}`}},{payrollId:{$containsi:`${R}`}}]},...m.value&&{effectiveDate:{$eq:m.value}},...b.value&&{projectRID:{$eq:b.value}}};return ee.getReleases({pagination:{page:e,pageSize:y},sort:`effectiveDate:${n?"desc":"asc"}`,filters:F}).then(h=>{const{data:w,meta:I}=h,J=[];return w.forEach(ue=>{J.push(ee.formatObject(ue.syncObject))}),$.value=!1,{data:J,meta:I}})}catch{$.value=!1}},k=async e=>{const{page:y,rowsPerPage:n,sortBy:p,descending:Q}=e.pagination,R=e.filter,F=n===0?_.value.rowsNumber:n;$.value=!0;const h=await r({page:y,sortBy:p,descending:Q,pageSize:F,filter:R});if($.value=!1,h){const{data:w,meta:I}=h;s.value.splice(0,s.value.length,...w),_.value.page=I.pagination.page,_.value.rowsPerPage=I.pagination.pageSize,_.value.sortBy=p,_.value.rowsPerPage=I.pagination.pageSize,_.value.rowsNumber=I.pagination.total}};ve(()=>{d.value.requestServerInteraction()});const g=()=>{d.value.requestServerInteraction()};function S(e,y,n){let p=y!==void 0?y(e,n):e;return p=p==null?"":String(p),p=p.split('"').join('""'),`"${p}"`}const de=async()=>{const{page:e,rowsNumber:y,sortBy:n,descending:p}=_.value,Q=await r({page:e,sortBy:n,descending:p,pageSize:y,filter:i.value});let R=[M.value.map(h=>S(h.label))].concat(s.value.map(h=>M.value.map(w=>S(typeof w.field=="function"?w.field(h):h[w.field===void 0?w.name:w.field],w.format,h)).join(","))).join(`\r
`);Q&&Q.data&&(R=[T.value.map(h=>S(h.label))].concat(Q.data.map(h=>T.value.map(w=>S(typeof w.field=="function"?w.field(h):h[w.field===void 0?w.name:w.field],w.format,h)).join(","))).join(`\r
`)),Ve(`${Y().format("MM.DD.YYYY")} Releases-Export.csv`,R,"text/csv")!==!0&&f.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};function me(e){t.push({name:"view-release",params:{release:e[3]}})}return(e,y)=>(v(),X("div",null,[l(W,{flat:""},{default:o(()=>[l(B,null,{default:o(()=>[c("div",Ie,[c("div",Be,[l(E,{dense:"",debounce:"300",modelValue:i.value,"onUpdate:modelValue":y[0]||(y[0]=n=>i.value=n),label:"Search"},null,8,["modelValue"])]),c("div",Fe,[l(E,{dense:"",debounce:"300",modelValue:m.value,"onUpdate:modelValue":y[1]||(y[1]=n=>m.value=n),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])])])]),_:1})]),_:1}),c("div",null,[l(_e,{title:"Releases","title-class":"text-h5 text-primary",ref_key:"tableRef",ref:d,columns:M.value,rows:s.value,"row-key":n=>n[3],class:"q-pa-sm",pagination:_.value,"onUpdate:pagination":y[2]||(y[2]=n=>_.value=n),"table-header-class":"bg-dark text-white","no-data-label":"There are no releases",dense:"",filter:i.value,onRequest:k},{"body-cell-action":o(n=>[l(De,{props:n},{default:o(()=>[l(ae,{class:"cursor-pointer",size:te(f).screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:p=>me(n.row),name:n.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1032,["props"])]),"no-data":o(({message:n})=>[c("div",ze,[l(ae,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),c("span",null,H(n),1)])]),"top-right":o(()=>[c("div",Oe,"(Total: "+H(_.value.rowsNumber)+" releases)",1),l(le,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:g}),l(le,{dense:te(f).screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:de,disable:_.value.rowsNumber<1},null,8,["dense","disable"])]),loading:o(()=>[l(he,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","filter"])])]))}},We={name:"Pipeline",components:{ProjectPipelineTable:je},setup(){const a=L(),t=z(),j=D(""),{getManpowerData:f,setPipelines:P}=G(),b=A(()=>t.params.id?t.params.id:null),d=A(()=>f({dataset:"pipelines",id:b.value})||[]),s=async m=>{(m||!f({dataset:"pipelines",id:b.value}))&&(a.loading.show(),await i(),a.loading.hide())},i=async()=>{const m=await we(b.value);P({id:b.value,data:m})};return s(),{allPipeline:d,search:j,loadData:s}}},Le={class:"text-h5 text-dark"},He={class:"text-body2 text-italic q-ml-sm"},xe=c("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Ge={class:"row items-center"},Je={class:"col-12 col-md-3 q-px-sm"};function Ke(a,t,j,f,P,b){const d=N("project-pipeline-table");return v(),X("div",null,[l(W,{flat:""},{default:o(()=>[l(B,{class:"q-pb-none"},{default:o(()=>[c("div",Le,[ge(" Staffing Pipeline "),c("span",He,"("+H(f.allPipeline.length)+" total)",1)]),xe]),_:1}),l(B,null,{default:o(()=>[c("div",Ge,[c("div",Je,[l(E,{dense:"",modelValue:f.search,"onUpdate:modelValue":t[0]||(t[0]=s=>f.search=s),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),l(d,{rows:f.allPipeline,onRefresh:t[1]||(t[1]=s=>f.loadData(!0))},null,8,["rows"])])}var Ze=O(We,[["render",Ke]]);const ea=x({name:"Employees",components:{RosterTab:Se,NewArrivalsTab:Ee,ReleasesTab:Xe,PipelineTab:Ze},setup(){const a=D(0),{getUserType:t}=oe();return t==="QuickBase User"&&(a.value=3),{tab:a,getUserType:t}}}),aa={class:"q-pa-md"};function ta(a,t,j,f,P,b){const d=N("roster-tab"),s=N("new-arrivals-tab"),i=N("pipeline-tab"),m=N("releases-tab");return v(),V(pe,{style:{"max-width":"100vw"}},{default:o(()=>[c("div",aa,[l(ce,{class:"bg-info text-white shadow-2 rounded-borders"},{default:o(()=>[a.getUserType==="QuickBase User"?(v(),V(Z,{key:0,modelValue:a.tab,"onUpdate:modelValue":t[0]||(t[0]=$=>a.tab=$),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:o(()=>[a.$route.name==="project-manpower"?(v(),V(U,{key:0,name:3,label:"Pipeline"})):q("",!0),l(U,{name:2,label:"Releases"}),l(U,{name:0,label:a.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"])]),_:1},8,["modelValue"])):(v(),V(Z,{key:1,modelValue:a.tab,"onUpdate:modelValue":t[1]||(t[1]=$=>a.tab=$),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:o(()=>[a.$can("read","projectEmployees")?(v(),V(U,{key:0,name:0,label:a.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"])):q("",!0),a.$can("read","projectArrivals")?(v(),V(U,{key:1,name:1,label:"New Arrivals"})):q("",!0),a.$route.name==="project-manpower"&&a.$can("read","projectPipeline")?(v(),V(U,{key:2,name:3,label:"Pipeline"})):q("",!0),a.$can("read","projectEmployees")?(v(),V(U,{key:3,name:2,label:"Releases"})):q("",!0)]),_:1},8,["modelValue"]))]),_:1}),a.getUserType==="QuickBase User"?(v(),V(K,{key:0,modelValue:a.tab,"onUpdate:modelValue":t[2]||(t[2]=$=>a.tab=$),animated:""},{default:o(()=>[l(C,{name:0},{default:o(()=>[l(d)]),_:1}),l(C,{name:1},{default:o(()=>[l(s)]),_:1}),l(C,{name:3},{default:o(()=>[l(i)]),_:1}),l(C,{name:2},{default:o(()=>[l(m)]),_:1})]),_:1},8,["modelValue"])):(v(),V(K,{key:1,modelValue:a.tab,"onUpdate:modelValue":t[3]||(t[3]=$=>a.tab=$),animated:""},{default:o(()=>[a.$can("read","projectEmployees")?(v(),V(C,{key:0,name:0},{default:o(()=>[l(d)]),_:1})):q("",!0),a.$can("read","projectArrivals")?(v(),V(C,{key:1,name:1},{default:o(()=>[l(s)]),_:1})):q("",!0),a.$can("read","projectPipeline")?(v(),V(C,{key:2,name:3},{default:o(()=>[l(i)]),_:1})):q("",!0),a.$can("read","projectEmployees")?(v(),V(C,{key:3,name:2},{default:o(()=>[l(m)]),_:1})):q("",!0)]),_:1},8,["modelValue"]))])]),_:1})}var za=O(ea,[["render",ta]]);export{za as default};
