import{l as O,bL as B,c as q,_ as x,A as d,B as C,d as o,bi as n,F as H,aY as U,an as p,au as I,ab as v,bI as z,ao as b,D as r,aZ as R,r as S,cw as D,cx as F,cz as N,y as ee,w as J,bM as ae,cy as M,bO as $,bK as E}from"./index.9762efb3.js";import{Q,b as V,a as te}from"./QTabPanels.b9ad1004.js";import{Q as se}from"./QTabs.c2494432.js";import{Q as oe}from"./QToolbar.e3e89c52.js";import{Q as Y}from"./QPage.1078672d.js";import{u as P}from"./use-quasar.1a2013e3.js";import{q as L,u as Z}from"./quickbase.0330480d.js";import{dayjs as A}from"./dayjs.b06c0c0b.js";import{u as j}from"./dataStore.13d3cdd5.js";import{Q as X,a as W}from"./QTable.0077212c.js";import{Q as K}from"./QTr.d46e16b6.js";import{Q as G}from"./QTd.337029ba.js";import{N as re}from"./nameRequestData.48abc639.js";import{P as ne}from"./projectPipeline.1c244297.js";import"./use-panel.77030442.js";import"./touch.60582172.js";import"./selection.2be80553.js";import"./QResizeObserver.ae660eeb.js";import"./rtl.cf9bbe47.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.591f4db3.js";import"./i18n.d2983beb.js";import"./api.5a7b34fc.js";import"./useQuerySaver.4199d87d.js";import"./QList.eefd78b8.js";import"./QMarkupTable.1f939997.js";import"./QSelect.4c250828.js";import"./QChip.deeb90cb.js";import"./QItemLabel.a7bd6a61.js";import"./QMenu.6d936437.js";import"./position-engine.e9001b32.js";import"./use-fullscreen.7c1ef657.js";import"./NameRequestGetEmployee.c3c4df52.js";import"./QTooltip.31d5b5c3.js";import"./workday.5938f06a.js";import"./syncEmployeeWithWorkday.412e39db.js";import"./workdayAPI.e71fddd8.js";import"./QInnerLoading.9f020a3c.js";import"./export-file.eb604dd4.js";const le=O({props:{rows:Array},setup(t,i){const l=P();B();const s=q(()=>l.screen.gt.sm?[{name:1,label:"Created",align:"left",field:e=>e[1].$d,format:e=>`${A(e).fromNow()}`,sortable:!0},{name:2,label:"ID",align:"left",field:e=>e[3],format:e=>`${e}`,sortable:!0,required:!0},{name:3,label:"Classification",align:"left",field:e=>e[21],format:e=>`${e===""?"Open":e}`,sortable:!0,required:!0},{name:4,label:"Status",align:"left",field:e=>e[17],format:e=>`${e}`,sortable:!0},{name:5,label:"Rate",align:"left",field:e=>e[23],format:e=>`$ ${e.toFixed(2)}`,sortable:!0,required:!0},{name:6,label:"# Requested",align:"right",field:e=>e[18],format:e=>`${e}`},{name:7,label:"Offers",align:"right",field:e=>a(e),format:e=>`${e}`,sortable:!0,required:!0},{name:8,label:"Balance",align:"right",field:e=>m(e),format:e=>`${e}`,sortable:!0,required:!0}]:[]);function a(e){return e.offers.filter(c=>c[21]==="Accepted").length}function m(e){const c=a(e);return e[18]-c}return{columns:s,props:t}}}),ie={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function ce(t,i,l,s,a,m){return d(),C("div",null,[o(W,{columns:t.columns,rows:t.props.rows,"row-key":e=>e[3],class:"q-pa-sm",pagination:{rowsPerPage:10},"table-header-class":"bg-dark text-white","no-data-label":"There are no classifications",dense:""},{header:n(e=>[o(K,{class:"bg-dark text-white",props:e},{default:n(()=>[(d(!0),C(H,null,U(e.cols,c=>(d(),p(X,{key:c.name,props:e},{default:n(()=>[I(v(c.label),1)]),_:2},1032,["props"]))),128)),o(X,{"auto-width":""})]),_:2},1032,["props"])]),body:n(e=>[o(K,{props:e},{default:n(()=>[(d(!0),C(H,null,U(e.cols,c=>(d(),p(G,{key:c.name,props:e},{default:n(()=>[I(v(c.value),1)]),_:2},1032,["props"]))),128)),o(G,{"auto-width":""},{default:n(()=>[e.row[17]==="Pending"&&t.$can("manage","projectRequests")&&!t.$can("read","hireRequests")?(d(),p(z,{key:0,class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"primary",round:"",dense:"",onClick:c=>t.$emit("removeRow",e.row),name:"delete_forever"},null,8,["size","onClick"])):b("",!0)]),_:2},1024)]),_:2},1032,["props"])]),"no-data":n(({message:e})=>[r("div",ie,[o(z,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),r("span",null,v(e),1)])]),_:1},8,["columns","rows","row-key"])])}var de=x(le,[["render",ce]]);const ue=O({props:{data:Object},components:{ClassificationsTable:de},setup(t,i){const l=P(),{getClassifications:s,fetchClassifications:a,removeData:m}=j(),e=q(()=>s(t.data[3]).sort((h,f)=>h[1].$d<f[1].$d?1:-1));async function c(){l.loading.show(),await a({id:t.data[3]}),l.loading.hide()}async function g(h){l.dialog({title:"Confirm",message:`Are you sure you want to remove ${h[12]} from request# ${h[6]}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:f}=await L.upsertRecordsXML({to:"bpzpyqcu4",data:[{3:{value:h[3]},17:{value:"Cancelled"},51:{value:new Date},128:{value:6}}],fieldsToReturn:[220],formatObject:220});m({type:"classifications",key:f[0][220][6],item:f[0][220],storageKey:"storageRequestClassifications"})}catch(f){l.notify({type:"negative",message:"Cannot remove classification"}),console.log(f)}})}return c(),console.log(t.data),{rows:e,removeRow:g}}});function me(t,i,l,s,a,m){const e=R("classifications-table");return d(),C("div",null,[o(e,{rows:t.rows,onRemoveRow:t.removeRow},null,8,["rows","onRemoveRow"])])}var fe=x(ue,[["render",me]]);const pe=O({props:{data:Object},components:{NameRequestDataTable:re},setup(t,i){const l=P(),{capitalize:s}=ee,a=S(""),{getNameRequest:m,fetchNameRequest:e,removeData:c}=j(),{userData:g}=Z(),h=q(()=>m(t.data[3]).sort((_,u)=>_[1].$d<u[1].$d?1:-1));async function f(){l.loading.show(),await e({id:t.data[3]}),l.loading.hide()}function T(_){return`${s(_[6].toLowerCase())} ${s(_[7].toLowerCase())}`}async function k(_){l.dialog({title:"Confirm",message:`Are you sure you want to remove ${T(_)} from request# ${_[18]}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:u}=await L.upsertRecordsXML({to:"bsg4yb4wa",data:[{3:{value:_[3]},11:{value:!0},12:{value:A().tz("America/Chicago")},13:{value:`${g[35]} ${g[37]}`}}],fieldsToReturn:[15],formatObject:15});c({type:"nameRequest",key:u[0][15][18],item:u[0][15],storageKey:"storageNameRequest"})}catch(u){l.notify({type:"negative",message:"Cannot remove name request"}),console.log(u)}})}const w=_=>{l.notify({type:"negative",message:"Feature is not ready yet."})};return f(),{nameRequests:h,search:a,removeName:k,viewEmployee:w}}}),_e={class:"row items-center"},he={class:"col-12 col-md-4"};function be(t,i,l,s,a,m){const e=R("name-request-data-table");return d(),C("div",null,[o(N,{flat:""},{default:n(()=>[o(D,null,{default:n(()=>[r("div",_e,[r("div",he,[o(F,{dense:"",modelValue:t.search,"onUpdate:modelValue":i[0]||(i[0]=c=>t.search=c),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),o(e,{requests:t.nameRequests,status:"Named",onRemoveName:t.removeName,onViewEmployee:t.viewEmployee},null,8,["requests","onRemoveName","onViewEmployee"])])}var qe=x(pe,[["render",be]]);const ge=O({props:{rows:Array},setup(t,i){const l=P();return B(),{columns:q(()=>l.screen.gt.sm?[{name:1,label:"Created",align:"left",field:a=>a[1].$d,format:a=>`${A(a).fromNow()}`,sortable:!0},{name:2,label:"Offered To",align:"left",field:a=>a.employee[24],format:a=>`${a}`,sortable:!0,required:!0},{name:3,label:"Classification",align:"left",field:a=>a[57],format:a=>`${a===""?"Open":a}`,sortable:!0,required:!0},{name:4,label:"Status",align:"left",field:a=>a[21],format:a=>`${a}`,sortable:!0},{name:5,label:"Rate Offered",align:"left",field:a=>a[22],format:a=>`$ ${a.toFixed(2)}`,sortable:!0,required:!0}]:[{name:1,label:"Created",align:"left",field:a=>a[1].$d,format:a=>`${A(a).fromNow()}`,sortable:!0},{name:2,label:"Offered To",align:"left",field:a=>a.employee[24],format:a=>`${a}`,sortable:!0,required:!0},{name:3,label:"Classification",align:"left",field:a=>a[57],format:a=>`${a===""?"Open":a}`,sortable:!0,required:!0},{name:4,label:"Status",align:"left",field:a=>a[21],format:a=>`${a}`,sortable:!0},{name:5,label:"Rate Offered",align:"left",field:a=>a[22],format:a=>`$ ${a.toFixed(2)}`,sortable:!0,required:!0}]),props:t}}}),ye={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function ve(t,i,l,s,a,m){return d(),C("div",null,[o(W,{columns:t.columns,rows:t.props.rows,"row-key":e=>e[3],class:"q-pa-sm",pagination:{rowsPerPage:10},"table-header-class":"bg-dark text-white","no-data-label":"There are no offers",dense:""},{"no-data":n(({message:e})=>[r("div",ye,[o(z,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),r("span",null,v(e),1)])]),_:1},8,["columns","rows","row-key"])])}var we=x(ge,[["render",ve]]);const $e=O({props:{data:Array},components:{OffersDataTable:we},setup(t){const i=S("");return{offers:q(()=>{const s=[];return t.data.forEach(a=>{`${a.employee[24].toLowerCase}`.includes(i.value.toLowerCase())&&s.push(a)}),s}),search:i}}}),Re={class:"row items-center"},Ce={class:"col-12 col-md-4"};function ke(t,i,l,s,a,m){const e=R("offers-data-table");return d(),C("div",null,[o(N,{flat:""},{default:n(()=>[o(D,null,{default:n(()=>[r("div",Re,[r("div",Ce,[o(F,{dense:"",modelValue:t.search,"onUpdate:modelValue":i[0]||(i[0]=c=>t.search=c),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),o(e,{rows:t.offers},null,8,["rows"])])}var De=x($e,[["render",ke]]);const xe={name:"Pipeline",components:{ProjectPipelineTable:ne},props:{request:Object},setup(t){const i=P(),l=S(""),{fetchDeployments:s,fetchInProcess:a,fetchPending:m,getDeployments:e,getInProcess:c,getPending:g}=j(),h=q(()=>e(t.request[3]).filter(u=>u[20]==="Complete")),f=q(()=>{const u=[];return e(t.request[3]).forEach(y=>{y[31].toLowerCase().includes(l.value.toLowerCase())&&u.push(y)}),u}),T=q(()=>{const u=[];return g(t.request[3]).forEach(y=>{y[25].toLowerCase().includes(l.value.toLowerCase())&&u.push(y)}),u}),k=q(()=>{const u=[];return c(t.request[3]).forEach(y=>{y[39].toLowerCase().includes(l.value.toLowerCase())&&u.push(y)}),u}),w=q(()=>k.value.concat(T.value.concat(f.value)));async function _(){i.loading.show(),await s({requestId:t.request[3]}),await a({requestId:t.request[3]}),await m({requestId:t.request[3]}),i.loading.hide()}return _(),J(w,(u,y)=>{console.log(u)}),{arrived:h,allPipeline:w,search:l}}},Pe={class:"q-pt-sm"},Te={class:"text-h5 text-dark"},Ne={class:"text-body2 text-italic q-ml-sm"},Oe=r("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for this request.",-1),Qe={class:"row items-center"},Ve={class:"col-12 col-md-3 q-px-sm"};function Le(t,i,l,s,a,m){const e=R("project-pipeline-table");return d(),p(Y,{style:{"max-width":"100vw"}},{default:n(()=>[r("div",Pe,[o(N,{flat:""},{default:n(()=>[o(D,{class:"q-pb-none"},{default:n(()=>[r("div",Te,[I(" Staffing Pipeline "),r("span",Ne,"("+v(s.allPipeline.length)+" total)",1)]),Oe]),_:1}),o(D,null,{default:n(()=>[r("div",Qe,[r("div",Ve,[o(F,{dense:"",modelValue:s.search,"onUpdate:modelValue":i[0]||(i[0]=c=>s.search=c),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),o(e,{rows:s.allPipeline},null,8,["rows"])])]),_:1})}var Ae=x(xe,[["render",Le]]);const Se={name:"View Request",components:{ClassificationsTab:fe,NamesTab:qe,PipelineTab:Ae,OffersTab:De},setup(){const t=P(),i=ae(),l=B(),s=S(0),{getHireRequest:a,fetchHireRequest:m}=j(),{userData:e}=Z(),c=q(()=>a(i.params.id));async function g(){t.loading.show(),await m({requestId:i.params.id}),t.loading.hide()}function h(){l.go(-1)}g(),J(c,(k,w)=>{console.log(k)});const f=()=>{t.dialog({title:"Confirm",message:"Are you sure you want to cancel this request?",cancel:!0,persistent:!0}).onOk(()=>{T()})},T=async()=>{const k={3:{value:c.value[3]},14:{value:"Cancelled"},84:{value:new Date},147:{value:6},276:{value:e[3]},277:{value:`${e[35]} ${e[37]}`}},w=[];c.value.classes.forEach(_=>{const u={3:{value:_[3]},17:{value:"Cancelled"},51:{value:new Date},128:{value:6}};w.push(u)});try{L.upsertRecordsXML({to:"bpzpyjbuy",data:[k],fieldsToReturn:[3]}),L.upsertRecordsXML({to:"bpzpyqcu4",data:w,fieldsToReturn:[3]}),l.go(-1),t.notify({type:"positive",message:"Request successfully canceled"})}catch(_){throw{error:_,message:"Cannot cancel request"}}};return{hireRequestData:c,tab:s,back:h,confirmCancel:f}}},je={class:"q-pa-sm"},Ee={class:"row"},Ie={class:"col-12 col-md-6"},ze={class:"col-12 col-md-6"},Be={class:"row"},Fe={class:"col-12 col-md-3 q-pr-sm"},He=r("div",{class:"text-h6 text-weight-regular"},"GENERAL INFO",-1),Ue={class:"q-my-sm"},Me=r("div",{class:"text-primary"},"Status:",-1),Xe={class:"text-dark q-pl-sm"},Ke={key:0,class:"q-my-sm"},Ge=r("div",{class:"text-primary"},"Days Open:",-1),Je={class:"text-dark q-pl-sm"},Ye={class:"q-my-sm"},Ze=r("div",{class:"text-primary"},"Project Name:",-1),We={class:"text-dark q-pl-sm"},ea={class:"q-my-sm"},aa=r("div",{class:"text-primary"},"Job Number:",-1),ta={class:"text-dark q-pl-sm"},sa={class:"col-12 col-md-9 q-pl-sm"};function oa(t,i,l,s,a,m){const e=R("classifications-tab"),c=R("names-tab"),g=R("offers-tab"),h=R("pipeline-tab");return d(),p(Y,{style:{"max-width":"100vw"}},{default:n(()=>[r("div",je,[o(N,{flat:""},{default:n(()=>[o(D,{class:"q-pa-none"},{default:n(()=>[r("div",Ee,[r("div",Ie,[o(M,{class:"q-pt-none",align:"left"},{default:n(()=>[o($,{label:"Back",color:"secondary",icon:"keyboard_return",onClick:s.back},null,8,["onClick"])]),_:1})]),r("div",ze,[o(M,{class:"q-pt-none",align:"right"},{default:n(()=>[t.$can("manage","hireRequests")&&s.hireRequestData[14]==="Pending"?(d(),p($,{key:0,label:"Accept Hire Request",color:"accent",icon:"thumb_up"})):b("",!0),t.$can("manage","hireRequests")&&s.hireRequestData[14]==="Pending"?(d(),p($,{key:1,label:"Decline Hire Request",color:"dark",icon:"thumb_down"})):b("",!0),t.$can("manage","hireRequests")&&s.hireRequestData[14]==="Open"?(d(),p($,{key:2,label:"Close Hire Request",color:"dark",icon:"cancel"})):b("",!0),t.$can("manage","hireRequests")&&s.hireRequestData[14]==="Open"?(d(),p($,{key:3,label:"Add Classifications",color:"accent",icon:"add"})):b("",!0),t.$can("manage","hireRequests")&&s.hireRequestData[14]==="Open"?(d(),p($,{key:4,label:"Edit Request",color:"primary",icon:"edit"})):b("",!0),t.$can("manage","hireRequests")&&s.hireRequestData[14]==="Open"?(d(),p($,{key:5,label:"Share Request",color:"info",icon:"ios_share"})):b("",!0),t.$can("manage","projectRequests")&&!t.$can("read","hireRequests")&&s.hireRequestData[14]==="Pending"?(d(),p($,{key:6,label:"Cancel Hire Request",color:"dark",icon:"cancel",onClick:s.confirmCancel},null,8,["onClick"])):b("",!0)]),_:1})])])]),_:1})]),_:1}),r("div",Be,[r("div",Fe,[o(N,{class:"q-mb-md"},{default:n(()=>[o(D,{class:"q-py-sm q-pl-md bg-info text-white"},{default:n(()=>[He]),_:1}),o(D,{class:"text-body2 q-py-xs"},{default:n(()=>[r("div",Ue,[Me,r("div",Xe,v(s.hireRequestData[14]),1)]),o(E),s.hireRequestData[14]!=="Pending"?(d(),C("div",Ke,[Ge,r("div",Je,v(s.hireRequestData[59]),1)])):b("",!0),s.hireRequestData[14]!=="Pending"?(d(),p(E,{key:1})):b("",!0),r("div",Ye,[Ze,r("div",We,v(s.hireRequestData[91]),1)]),o(E),r("div",ea,[aa,r("div",ta,v(s.hireRequestData[27]),1)])]),_:1})]),_:1})]),r("div",sa,[o(oe,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[o(se,{align:"left",modelValue:s.tab,"onUpdate:modelValue":i[0]||(i[0]=f=>s.tab=f),dense:"","indicator-color":"accent"},{default:n(()=>[o(Q,{name:0,label:"Classifications"}),o(Q,{name:1,label:"Names"}),s.hireRequestData[14]!=="Pending"?(d(),p(Q,{key:0,name:2,label:"Offers"})):b("",!0),s.hireRequestData[14]!=="Pending"?(d(),p(Q,{key:1,name:3,label:"Pipeline"})):b("",!0)]),_:1},8,["modelValue"])]),_:1}),o(te,{modelValue:s.tab,"onUpdate:modelValue":i[1]||(i[1]=f=>s.tab=f),animated:"",class:"q-px-none"},{default:n(()=>[o(V,{class:"q-px-xs",name:0},{default:n(()=>[s.hireRequestData[3]?(d(),p(e,{key:0,data:s.hireRequestData},null,8,["data"])):b("",!0)]),_:1}),o(V,{class:"q-px-xs",name:1},{default:n(()=>[o(c,{data:s.hireRequestData},null,8,["data"])]),_:1}),o(V,{class:"q-px-xs",name:2},{default:n(()=>[o(g,{data:s.hireRequestData.offers},null,8,["data"])]),_:1}),o(V,{class:"q-px-xs",name:3},{default:n(()=>[o(h,{request:s.hireRequestData},null,8,["request"])]),_:1})]),_:1},8,["modelValue"])])])])]),_:1})}var Ua=x(Se,[["render",oa]]);export{Ua as default};
