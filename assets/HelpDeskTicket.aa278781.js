import{l as L,_ as O,bV as z,r as W,A as G,aq as H,br as r,d as l,bO as X,cT as h,bS as J,D as o,ac as u,cU as p,bQ as K,ax as Y,cV as Z,bW as E,cS as x,cy as ee}from"./index.c7640e72.js";import{a as P}from"./QSelect.fadf4533.js";import{Q as oe}from"./QTooltip.7d959890.js";import{Q as te}from"./QFile.fa30d338.js";import{Q as se}from"./QForm.17871f7d.js";import{a as ae,u as i}from"./vee-validate.esm.cf3515d2.js";import{a as _,c as d}from"./array.27eafe44.js";import{u as le,q as re}from"./app.8f08130a.js";import{u as ie}from"./use-quasar.0751f5b6.js";const ne=L({setup(){const e=ie(),s=le(),{userData:c,fullName:f}=z(s),q=c.value&&c.value[8]?c.value[8]:"",y=c.value&&c.value[6]?c.value[6]:"",a=["Personal Login Issues","General Help","Data Updates & System Maintenance","Reporting","Security","Integration Maintenance/Failure","Bug"],v=["Worksite Management Portal","Craft Employee Management"],V=W(null),S=_({type:d().required().label("Type"),category:d().required().label("Category"),subject:d().required().label("Subject"),details:d().required().label("Details"),supportingFile:_().nullable().label("Supporting File"),requestedFor:d().required().label("Requested For"),contactPhone:d().matches(/^[+()0-9 .-]+$/,{excludeEmptyString:!0,message:"Valid Phone Number Only!"}).required().label("Contact Phone"),contactEmail:d().email().required().label("Contact Email"),additionalPeople:d().nullable().label("Additional People Affected")}),{meta:w,errors:C,handleSubmit:Q,handleReset:k}=ae({validationSchema:S,initialValues:{type:a[0],category:v[0],requestedFor:f.value?f.value.includes("undefined")?"":f.value:"",contactPhone:q,contactEmail:y}}),{value:T}=i("type"),{value:U}=i("category"),{value:D}=i("subject"),{value:j}=i("details"),{value:R}=i("supportingFile"),{value:A}=i("requestedFor"),{value:$}=i("contactPhone"),{value:M}=i("contactEmail"),{value:B}=i("additionalPeople"),N=t=>new Promise((b,g)=>{const m=new FileReader;m.readAsDataURL(t),m.onload=()=>b(m.result.replace(/^data:.+;base64,/,"")),m.onerror=n=>g(n)}),I=Q(async t=>{try{t.details=t.details?t.details.replace(/(\r\n|\n|\r)/gm," "):null,t.additionalPeople=t.additionalPeople?t.additionalPeople.replace(/(\r\n|\n|\r)/gm," "):null;const b=t.supportingFile&&t.supportingFile[0]?await N(t.supportingFile[0]):null,g=t.supportingFile&&t.supportingFile[0]?t.supportingFile[0].name:null;console.log(t);const m=[{7:{value:t.type},8:{value:t.category},6:{value:t.subject},10:{value:t.details},11:{value:b,filename:g},19:{value:t.requestedFor},21:{value:t.contactPhone},22:{value:t.contactEmail},23:{value:t.additionalPeople?t.additionalPeople:""}}],{data:n}=await re.upsertRecordsXML({to:"btb8bh2ki",fieldsToReturn:[32],data:m,formatObject:32});if(console.log(n),n&&n[0]&&n[0][32]&&n[0][32][3])e.notify({position:"top-right",type:"positive",message:`Support Request ${n[0][32][3]} successfully added`});else throw"Error in adding support request";F()}catch(b){console.log(b),e.notify({position:"top-right",type:"negative",message:"There was a problem submitting request!"})}}),F=()=>{k(),V.value.hide()};return{types:a,categories:v,type:T,category:U,subject:D,details:j,supportingFile:R,requestedFor:A,contactPhone:$,contactEmail:M,additionalPeople:B,formMeta:w,formErrors:C,submitTicket:I,closeAddTicket:F,addTicketDialog:V}}}),de=o("div",{class:"text-h6 text-weight-bold"},"Request Support",-1),ce=o("div",{class:"text-primary text-h6 q-mb-sm"},"Support Details",-1),ue={class:"row"},me={class:"col-12 col-md-6 q-pr-sm"},pe={class:"text-caption"},be={class:"col-12 col-md-6 q-pr-sm"},fe={class:"text-caption"},ge={class:"row"},he={class:"col-12 q-pr-sm"},qe={class:"text-caption q-pt-none"},ye={class:"row"},ve={class:"col-12 q-pr-sm"},Ve={class:"text-caption"},Fe={class:"row"},Ee={class:"col-12 col-md-8 q-pr-sm"},Pe=o("div",{class:"text-primary text-h6 q-mb-sm"},"Contact Information",-1),_e={class:"row"},Se={class:"col-12 col-md-8 q-pr-sm"},we={class:"text-caption"},Ce={class:"row"},Qe={class:"col-12 col-md-6 q-pr-sm"},ke={class:"text-caption"},Te={class:"col-12 col-md-6 q-pr-sm"},Ue={class:"text-caption"},De={class:"row"},je={class:"col-12 q-pr-sm"};function Re(e,s,c,f,q,y){return G(),H(ee,{ref:"addTicketDialog"},{default:r(()=>[l(x,{style:{width:"700px","max-width":"80vw"}},{default:r(()=>[l(se,{onSubmit:X(e.submitTicket,["prevent"])},{default:r(()=>[l(h,{class:"q-pb-xs"},{default:r(()=>[de]),_:1}),l(J,{color:"primary",class:"q-mb-sm"}),l(h,{class:"q-pt-none"},{default:r(()=>[ce,o("div",ue,[o("div",me,[l(P,{class:"q-mb-md",dense:"",outlined:"",label:"Type","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.type,"onUpdate:modelValue":s[0]||(s[0]=a=>e.type=a),options:e.types,"bottom-slots":"",error:!!e.formErrors.type},{error:r(()=>[o("div",pe,u(e.formErrors.type),1)]),_:1},8,["modelValue","options","error"])]),o("div",be,[l(P,{class:"q-mb-md",dense:"",outlined:"",label:"Category","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":s[1]||(s[1]=a=>e.category=a),options:e.categories,"bottom-slots":"",error:!!e.formErrors.category},{error:r(()=>[o("div",fe,u(e.formErrors.category),1)]),_:1},8,["modelValue","options","error"])])]),o("div",ge,[o("div",he,[l(p,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Subject",modelValue:e.subject,"onUpdate:modelValue":s[2]||(s[2]=a=>e.subject=a),"bottom-slots":"",error:!!e.formErrors.subject},{error:r(()=>[o("div",qe,u(e.formErrors.subject),1)]),_:1},8,["modelValue","error"])])]),o("div",ye,[o("div",ve,[l(p,{class:"q-mb-md",dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e.details,"onUpdate:modelValue":s[3]||(s[3]=a=>e.details=a),label:"Details","bottom-slots":"",error:!!e.formErrors.details},{error:r(()=>[o("div",Ve,u(e.formErrors.details),1)]),_:1},8,["modelValue","error"])])]),o("div",Fe,[o("div",Ee,[l(te,{dense:"",outlined:"","bottom-slots":"",modelValue:e.supportingFile,"onUpdate:modelValue":s[4]||(s[4]=a=>e.supportingFile=a),multiple:"",append:"","max-files":"1","use-chips":"",label:"Supporting File"},{prepend:r(()=>[l(K,{name:"attach_file"},{default:r(()=>[l(oe,null,{default:r(()=>[Y("Click in the box to add supporting file")]),_:1})]),_:1})]),_:1},8,["modelValue"])])])]),_:1}),l(h,{class:"q-pt-none"},{default:r(()=>[Pe,o("div",_e,[o("div",Se,[l(p,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Requested For",modelValue:e.requestedFor,"onUpdate:modelValue":s[5]||(s[5]=a=>e.requestedFor=a),error:!!e.formErrors.requestedFor,"bottom-slots":""},{error:r(()=>[o("div",we,u(e.formErrors.requestedFor),1)]),_:1},8,["modelValue","error"])])]),o("div",Ce,[o("div",Qe,[l(p,{class:"q-mb-md",dense:"",outlined:"",maxlength:"15",label:"Contact Phone",modelValue:e.contactPhone,"onUpdate:modelValue":s[6]||(s[6]=a=>e.contactPhone=a),error:!!e.formErrors.contactPhone,"bottom-slots":""},{error:r(()=>[o("div",ke,u(e.formErrors.contactPhone),1)]),_:1},8,["modelValue","error"])]),o("div",Te,[l(p,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Contact Email",modelValue:e.contactEmail,"onUpdate:modelValue":s[7]||(s[7]=a=>e.contactEmail=a),error:!!e.formErrors.contactEmail,"bottom-slots":""},{error:r(()=>[o("div",Ue,u(e.formErrors.contactEmail),1)]),_:1},8,["modelValue","error"])])]),o("div",De,[o("div",je,[l(p,{dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e.additionalPeople,"onUpdate:modelValue":s[8]||(s[8]=a=>e.additionalPeople=a),label:"Additional People Affected"},null,8,["modelValue"])])])]),_:1}),l(Z,{align:"right"},{default:r(()=>[l(E,{color:"primary",label:"Save & Close",type:"submit"}),l(E,{color:"secondary",label:"Cancel",onClick:e.closeAddTicket},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},512)}var We=O(ne,[["render",Re]]);export{We as h};
