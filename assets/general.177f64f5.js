import{Q as de,a as Ee,b as ce}from"./QTabPanels.b409a896.js";import{Q as Pe}from"./QTabs.fea55dbc.js";import{Q as Se}from"./QPage.11d82b17.js";import{u as x}from"./use-quasar.6320e378.js";import{l as Q,r as q,c as A,_ as H,b5 as T,A as c,B as k,d as n,br as i,D as w,ac as V,bW as C,ar as R,cU as z,bO as pe,aq as h,cy as De,G as ae,cT as re,F,b4 as W,cS as ne,bU as ee,cV as ge,w as he,ax as oe,y as ke,bV as Ae}from"./index.dd77155d.js";import{q as g,u as Ne,f as Oe}from"./app.05652b82.js";import{dayjs as Xe}from"./dayjs.6e814a2c.js";import{a as X,c as M}from"./array.59f93f43.js";import{a as B,b as se,u as Te}from"./useQuerySaver.d29ff9ee.js";import{u as te}from"./dataStore.333d40dc.js";import{a as me}from"./QSelect.e46c7380.js";import{Q as fe}from"./QForm.2c5aed2b.js";import{a as ve,u as U}from"./vee-validate.esm.6dfeee42.js";import{A as Ue,a as Me}from"./addNewCustomer.8f1a4c0a.js";import{Q as le}from"./QInnerLoading.62e7ebf6.js";import{Q as Y,a as ie}from"./QTable.cd770be3.js";import{Q as G}from"./QTr.78f4fcf5.js";import{Q as Fe}from"./QTooltip.f6619c32.js";import{Q as K}from"./QTd.86bfdff9.js";import{u as Qe}from"./project.36a7eae6.js";import{s as He}from"./states.03e3d448.js";import{u as Je}from"./dataStore.a79dbc7d.js";import{a as Ie}from"./approveHeadcount.40c35b38.js";import{d as O}from"./decode.3998c82c.js";import"./use-panel.c87e1d23.js";import"./touch.70a9dd44.js";import"./selection.1b0fcc11.js";import"./QResizeObserver.b5542db0.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.a5ce8de1.js";import"./api.9cc8c4bd.js";import"./index.04bc0a32.js";import"./i18n.660e2ed7.js";import"./QChip.8eec8f03.js";import"./QMenu.237258b2.js";import"./position-engine.f42cc476.js";import"./QList.bd0eedab.js";import"./QMarkupTable.888535da.js";import"./use-fullscreen.d86e788f.js";const ze=Q({emits:["cancelEdit"],components:{AddProjectLocationForm:Ue,AddCustomerForm:Me},props:{config:Object},setup(e,{emit:t}){const d=q(null),p=q(null),v=q(!1),b=async()=>{const{type:l,initialValue:m}=e.config;if(l==="options"){const{getter:$}=e.config;p.value=await $(),d.value=p.value,y.value=m(d.value)}else y.value=m},u=A(()=>X({entry:e.config.formRules})),{meta:r,errors:a,handleSubmit:j}=ve({validationSchema:u}),{value:y}=U("entry"),E=(l,m)=>{const{filter:$}=e.config;l===""&&m(()=>{d.value=p.value}),m(()=>{const D=l.toLowerCase();d.value=$(p.value,D)})},s=l=>{v.value=!1,p.value.push(l),d.value.push(l),y.value=l},o=j(async l=>{const{setter:m}=e.config;await m(l.entry),t("cancelEdit")});return b(),{rawOptions:p,options:d,entry:y,formErrors:a,formMeta:r,submit:o,filterOptions:E,addNew:v,newOptionAdded:s}}}),We={key:0,class:"q-pr-xl"},Be={class:"text-caption"},Ye={key:0,class:"text-center bg-info"},Ge={key:0,class:"text-center bg-info"},Ke={key:1,class:"q-pr-xl"},Ze={class:"text-caption"};function _e(e,t,d,p,v,b){const u=T("add-project-location-form"),r=T("add-customer-form");return c(),k("div",null,[n(fe,{onSubmit:pe(e.submit,["prevent"])},{default:i(()=>[e.config.type==="options"?(c(),k("div",We,[n(me,{class:"q-mb-sm",dense:"",label:`Select a ${e.config.fieldLabel}`,"transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":t[3]||(t[3]=a=>e.entry=a),options:e.options,"option-label":e.config.optionLabel,"display-value":`${e.entry?e.entry[e.config.displayValue]:""}`,"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":"","use-input":"","input-debounce":"0",onFilter:e.filterOptions,clearable:"",loading:!e.rawOptions,disable:!e.rawOptions},{error:i(()=>[w("div",Be,V(e.formErrors.entry),1)]),after:i(()=>[n(C,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),n(C,{color:"dark",icon:"close",dense:"",onClick:t[0]||(t[0]=a=>e.$emit("cancelEdit"))})]),"after-options":i(()=>[e.config.allowNew&&e.options&&e.options.length>0?(c(),k("div",Ye,[n(C,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[1]||(t[1]=a=>e.addNew=!0)},null,8,["label"])])):R("",!0)]),"no-option":i(()=>[e.config.allowNew?(c(),k("div",Ge,[n(C,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:t[2]||(t[2]=a=>e.addNew=!0)},null,8,["label"])])):R("",!0)]),_:1},8,["label","modelValue","options","option-label","display-value","error","onFilter","loading","disable"])])):R("",!0),e.config.type==="input"?(c(),k("div",Ke,[n(z,{class:"q-mb-sm",dense:"",label:e.config.fieldLabel,modelValue:e.entry,"onUpdate:modelValue":t[5]||(t[5]=a=>e.entry=a),"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":""},{error:i(()=>[w("div",Ze,V(e.formErrors.entry),1)]),after:i(()=>[n(C,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),n(C,{color:"dark",icon:"close",dense:"",onClick:t[4]||(t[4]=a=>e.$emit("cancelEdit"))})]),_:1},8,["label","modelValue","error"])])):R("",!0)]),_:1},8,["onSubmit"]),n(De,{modelValue:e.addNew,"onUpdate:modelValue":t[8]||(t[8]=a=>e.addNew=a)},{default:i(()=>[e.config.newType==="location"?(c(),h(u,{key:0,onCancelAdd:t[6]||(t[6]=a=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):R("",!0),e.config.newType==="customer"?(c(),h(r,{key:1,onCancelAdd:t[7]||(t[7]=a=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):R("",!0)]),_:1},8,["modelValue"])])}var xe=H(ze,[["render",_e]]);const et=Q({emits:[],props:{item:Object},components:{EditDetailsForm:xe},setup(e,{emit:t}){const d=q(!1),p=A(()=>{const{permission:v}=e.item.editable&&e.item.config?e.item.config:{action:null,subject:null};return v});return{edit:d,permission:p}}}),tt={key:0,class:"row"},at={class:"col-12 col-md-4"},ot={class:"col-12 col-md-8"};function rt(e,t,d,p,v,b){const u=T("edit-details-form");return c(),h(re,{class:"q-py-sm"},{default:i(()=>[e.edit?(c(),h(u,{key:1,type:e.item.label,config:e.item.config,onCancelEdit:t[1]||(t[1]=r=>e.edit=!1)},null,8,["type","config"])):(c(),k("div",tt,[w("div",at,[w("div",null,[w("span",{class:ae(e.$q.screen.gt.lg?"text-body2":"text-caption")},V(e.item.label),3)])]),w("div",ot,[w("div",null,[w("span",{class:ae(["text-weight-light",e.$q.screen.gt.lg?"text-body2":"text-caption"])},V(e.item.value),3),e.item.editable&&e.$can(e.permission.action,e.permission.subject)?(c(),h(C,{key:0,color:"accent",flat:"",dense:"",round:"",icon:"edit",size:"sm",onClick:t[0]||(t[0]=r=>e.edit=!0)})):R("",!0)])])]))]),_:1})}var st=H(et,[["render",rt]]);const nt=Q({props:{title:String,details:Array},components:{DetailsSection:st}}),lt={class:"text-body1 text-white"};function it(e,t,d,p,v,b){const u=T("details-section");return c(),k("div",null,[n(ne,{class:"text-dark q-pb-sm"},{default:i(()=>[e.title&&e.title!==""?(c(),h(re,{key:0,class:"bg-info q-py-sm"},{default:i(()=>[w("div",lt,V(e.title.toUpperCase()),1)]),_:1})):R("",!0),(c(!0),k(F,null,W(e.details,r=>(c(),h(u,{key:r,item:r},null,8,["item"]))),128))]),_:1})])}var ut=H(nt,[["render",it]]);const dt=Q({props:{project:Object},setup(e,t){const d=x(),p=ee(),{getViewedProjects:v,updateViewedProjects:b}=te(),u=A(()=>p.params.id?p.params.id:e.project[3]?e.project[3]:null),r=A(()=>u.value?v(u.value):null),a=A(()=>r.value&&r.value.crafts?r.value.crafts:[]),j=async()=>{if(u.value&&a.value.length===0){const{data:f}=await g.fetchFromProjectsApp({fields:[B({type:"projectCrafts",query:`{'7'.EX.'${u.value}'}`})]});b({id:u.value,dataset:"crafts",data:f})}},y=X({jobNumber:M().required().label("Job Number"),craft:X(),description:M()}),{meta:E,errors:s,handleSubmit:o,handleReset:l}=ve({validationSchema:y}),{value:m}=U("jobNumber"),{value:$}=U("craft"),{value:D}=U("description"),S=o(async f=>{const N={6:{value:u.value},11:{value:f.jobNumber}};f.craft&&Object.assign(N,{14:{value:f.craft[3]}}),f.description&&Object.assign(N,{20:{value:f.description}});try{const{data:P}=await g.upsertRecordsXML({to:"bpzpwr2eh",data:[N],fieldsToReturn:[35],formatObject:35}),J=r.value.jobNumbers;J.push(P[0][35]),b({id:u.value,dataset:"jobNumbers",data:J}),d.notify({type:"positive",message:`Job Number ${P[0][35][11]} successfully added`})}catch(P){console.log(P),d.notify({type:"negative",message:"Something went wrong!"})}t.emit("jobNumberAdded"),l()});return j(),{jobNumber:m,craft:$,description:D,formErrors:s,formMeta:E,submit:S,crafts:a}}}),ct={class:"row"},pt={class:"col-12 col-md-4 q-pr-sm"},mt={class:"text-caption"},ft={class:"col-12 col-md-4 q-pr-sm"},vt={class:"col-12 col-md-4"};function bt(e,t,d,p,v,b){return c(),k("div",null,[n(fe,{onSubmit:pe(e.submit,["prevent"])},{default:i(()=>[n(ne,null,{default:i(()=>[n(re,null,{default:i(()=>[w("div",ct,[w("div",pt,[n(z,{label:"Job Number",dense:"",modelValue:e.jobNumber,"onUpdate:modelValue":t[0]||(t[0]=u=>e.jobNumber=u),error:!!e.formErrors.jobNumber,"bottom-slots":""},{error:i(()=>[w("div",mt,V(e.formErrors.jobNumber),1)]),_:1},8,["modelValue","error"])]),w("div",ft,[n(me,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craft,"onUpdate:modelValue":t[1]||(t[1]=u=>e.craft=u),options:e.crafts,"option-label":"10","display-value":`${e.craft?e.craft[10]:""}`},null,8,["modelValue","options","display-value"])]),w("div",vt,[n(z,{label:"Description",dense:"",modelValue:e.description,"onUpdate:modelValue":t[2]||(t[2]=u=>e.description=u)},null,8,["modelValue"])])])]),_:1}),n(ge,{align:"right"},{default:i(()=>[n(C,{color:"secondary",label:"Cancel",onClick:t[3]||(t[3]=u=>e.$emit("cancelAddJobNumber"))}),n(C,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Re=H(dt,[["render",bt]]);const yt=[{name:0,label:"Job Number",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Craft",align:"left",field:e=>e[15],format:e=>`${e}`,sortable:!0,required:!0}],gt=Q({components:{AddJobNumber:Re},props:{project:String},setup(e){const t=x(),d=ee(),p=q(!0),v=q(!1),{getViewedProjects:b,updateViewedProjects:u}=te(),r=q(d.params.id?d.params.id:e.project);he(()=>d.params.id,o=>{r.value=d.params.id});const a=A(()=>b(r.value)),j=A(()=>{const o=a.value&&a.value.jobNumbers?a.value.jobNumbers:[];return o.length>0?o.sort((l,m)=>l[1].$d>m[1].$d?1:-1):o}),y=async o=>{if(p.value=!0,j.value.length===0||o){const{data:l}=await g.fetchFromProjectsApp({fields:[B({type:"jobNumbers",query:`{'6'.EX.'${r.value}'}AND{'29'.EX.'Active'}`})]});u({id:r.value,dataset:"jobNumbers",data:l})}p.value=!1};function E(o){console.log(o),t.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${o[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{s(o)})}async function s(o){try{const{data:l}=await g.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:o[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35}),m=j.value.filter($=>$[3]!==l[0][35][3]);u({id:r.value,dataset:"jobNumbers",data:m}),t.notify({type:"positive",message:"Job Number Removed"})}catch(l){console.log(l),t.notify({type:"negative",message:"Something went wrong"})}}return y(),{projectData:a,jobNumberColumns:yt,rows:j,initialPagination:{rowsPerPage:q(10)},showAddJobNumber:v,removeRow:E,loadData:y,loading:p}}}),wt={class:"text-caption"};function $t(e,t,d,p,v,b){const u=T("add-job-number");return c(),k("div",null,[e.showAddJobNumber?R("",!0):(c(),h(ie,{key:0,dense:"",title:"Job Numbers","title-class":"text-primary",style:{},columns:e.jobNumberColumns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[n(le,{label:"Loading...","label-class":"text-info"})]),"top-left":i(()=>[e.$can("create","projectJobNumbers")||e.$can("manage","projects")?(c(),h(C,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAddJobNumber=!0)})):R("",!0)]),"top-right":i(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[n(G,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(Y,{class:"text-left",key:a.name},{default:i(()=>[oe(V(a.label),1)]),_:2},1024))),128)),n(Y,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[n(G,{props:r},{default:i(()=>[n(Fe,{anchor:"top middle",self:"top middle"},{default:i(()=>[oe("Description: "+V(r.row[20]),1)]),_:2},1024),(c(!0),k(F,null,W(r.cols,a=>(c(),h(K,{key:a.name,props:r},{default:i(()=>[w("span",wt,V(a.value),1)]),_:2},1032,["props"]))),128)),n(K,{"auto-width":""},{default:i(()=>[e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(c(),h(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJobNumber?(c(),h(u,{key:1,project:e.projectData,onJobNumberAdded:t[2]||(t[2]=r=>e.showAddJobNumber=!1),onCancelAddJobNumber:t[3]||(t[3]=r=>e.showAddJobNumber=!1)},null,8,["project"])):R("",!0)])}var ht=H(gt,[["render",$t]]);const jt=[{name:0,label:"Rule",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Miles",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0,required:!0},{name:2,label:"Amount",align:"left",field:e=>e[10],format:e=>e?`$ ${e.toFixed(2)}`:"",sortable:!0,required:!0}],Ct=Q({components:{AddJobNumber:Re},props:{project:String},setup(e){const t=x(),d=ee(),p=q(!0),{getViewedProjects:v,updateViewedProjects:b}=te(),u=A(()=>d.params.id?d.params.id:e.project),r=A(()=>v(u.value)),a=A(()=>(r.value&&r.value.perDiem?r.value.perDiem:[]).sort((m,$)=>m[1].$d>$[1].$d?1:-1)),j=async l=>{if(p.value=!0,a.value.length===0||l){const{data:m}=await g.fetchFromProjectsApp({fields:[B({type:"perDiemSpecs",query:`{'12'.EX.'${u.value}'}AND{'38'.EX.'Active'}`})]});b({id:u.value,dataset:"perDiem",data:m})}p.value=!1},y=q(!1),{removeObject:E}=Qe();A(()=>(r.value&&r.value.jobNumbers?r.value.jobNumbers:[]).sort((m,$)=>m[1].$d>$[1].$d?1:-1));function s(l){console.log(l),t.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${l[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{o(l)})}async function o(l){try{const{data:m}=await g.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:l[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35});E({array:"jobNumbers",object:m[0][35]})}catch(m){console.log(m),t.notify({type:"negative",message:"Something went wrong"})}}return j(),{projectData:r,columns:jt,rows:a,initialPagination:{rowsPerPage:q(8)},showAddJobNumber:y,removeRow:s,loadData:j,loading:p}}}),kt={class:"text-caption"};function At(e,t,d,p,v,b){const u=T("add-job-number");return c(),k("div",null,[e.showAddJobNumber?R("",!0):(c(),h(ie,{key:0,dense:"",title:"Per-Diem","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[n(le,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":i(()=>[e.$can("create","projectPerDiem")||e.$can("manage","projects")?(c(),h(C,{key:0,disable:"",dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAddJobNumber=!0)})):R("",!0)]),"top-right":i(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[n(G,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(Y,{class:"text-left",key:a.name},{default:i(()=>[oe(V(a.label),1)]),_:2},1024))),128)),n(Y,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[n(G,{props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(K,{key:a.name,props:r},{default:i(()=>[w("span",kt,V(a.value),1)]),_:2},1032,["props"]))),128)),n(K,{"auto-width":""},{default:i(()=>[e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(c(),h(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAddJobNumber?(c(),h(u,{key:1,onJobNumberAdded:t[2]||(t[2]=r=>e.showAddJobNumber=!1),onCancelAddJobNumber:t[3]||(t[3]=r=>e.showAddJobNumber=!1)})):R("",!0)])}var Nt=H(Ct,[["render",At]]);const Rt=Q({emits:["cancelAdd","addComplete"],props:{project:Object},setup(e,{emit:t}){const d=x(),p=ee(),{getViewedProjects:v,updateViewedProjects:b}=te(),u=A(()=>p.params.id?p.params.id:e.project[3]?e.project[3]:null),r=A(()=>u.value?v(u.value):null),a=X({name:M().required().label("Location Name"),street1:M().required().label("Street Address 1"),street2:M(),city:M().required().label("City"),state:M().required().label("State"),postal:M().required().label("Postal Code")}),{meta:j,errors:y,handleSubmit:E,handleReset:s}=ve({validationSchema:a}),{value:o}=U("name"),{value:l}=U("street1"),{value:m}=U("street2"),{value:$}=U("city"),{value:D}=U("state"),{value:S}=U("postal"),f=E(async N=>{const P={6:{value:N.name},8:{value:N.street1},9:{value:N.street2?N.street2:""},10:{value:N.city},11:{value:N.state},12:{value:N.postal},13:{value:"United States"}};r.value[8]&&Object.assign(P,{15:{value:r.value[8]}});try{const{data:J}=await g.upsertRecordsXML({to:"bp5d2twyj",data:[P],fieldsToReturn:[22],formatObject:22}),be=r.value.meetingLocations;be.push(J[0][22]),b({id:u.value,dataset:"meetingLocations",data:be}),d.notify({type:"positive",message:`Meeting location ${J[0][22][6]} successfully added`}),t("addComplete"),s()}catch(J){console.log(J),d.notify({type:"negative",message:"Something went wrong!"})}});return{projectObject:r,formErrors:y,formMeta:j,submit:f,name:o,street1:l,street2:m,city:$,state:D,postal:S,states:He}}}),Vt={class:"row"},Lt={class:"col-6 col-md-12"},qt={class:"text-caption"},Et={class:"text-caption"},Pt={class:"text-caption"},St={class:"text-caption"},Dt={class:"text-caption"};function Ot(e,t,d,p,v,b){return c(),k("div",null,[n(fe,{onSubmit:pe(e.submit,["prevent"])},{default:i(()=>[n(ne,null,{default:i(()=>[n(re,null,{default:i(()=>[w("div",Vt,[w("div",Lt,[n(z,{label:"Location Name",dense:"",modelValue:e.name,"onUpdate:modelValue":t[0]||(t[0]=u=>e.name=u),error:!!e.formErrors.name,"bottom-slots":""},{error:i(()=>[w("div",qt,V(e.formErrors.name),1)]),_:1},8,["modelValue","error"]),n(z,{label:"Street Address 1",dense:"",modelValue:e.street1,"onUpdate:modelValue":t[1]||(t[1]=u=>e.street1=u),error:!!e.formErrors.street1,"bottom-slots":""},{error:i(()=>[w("div",Et,V(e.formErrors.street1),1)]),_:1},8,["modelValue","error"]),n(z,{label:"Street Address 2",dense:"",modelValue:e.street2,"onUpdate:modelValue":t[2]||(t[2]=u=>e.street2=u),error:!!e.formErrors.street2,"bottom-slots":""},{error:i(()=>[w("div",Pt,V(e.formErrors.street2),1)]),_:1},8,["modelValue","error"]),n(z,{label:"City",dense:"",modelValue:e.city,"onUpdate:modelValue":t[3]||(t[3]=u=>e.city=u),error:!!e.formErrors.city,"bottom-slots":""},{error:i(()=>[w("div",St,V(e.formErrors.city),1)]),_:1},8,["modelValue","error"]),n(me,{dense:"",label:"State","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.state,"onUpdate:modelValue":t[4]||(t[4]=u=>e.state=u),options:e.states,"bottom-slots":""},null,8,["modelValue","options"]),n(z,{label:"Postal Code",dense:"",modelValue:e.postal,"onUpdate:modelValue":t[5]||(t[5]=u=>e.postal=u),error:!!e.formErrors.postal,"bottom-slots":""},{error:i(()=>[w("div",Dt,V(e.formErrors.postal),1)]),_:1},8,["modelValue","error"])])])]),_:1}),n(ge,{align:"right"},{default:i(()=>[n(C,{color:"secondary",label:"Cancel",onClick:t[6]||(t[6]=u=>e.$emit("cancelAdd"))}),n(C,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Xt=H(Rt,[["render",Ot]]);const Tt=[{name:0,label:"Location Name",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0},{name:1,label:"Address",align:"left",field:e=>e[8],format:e=>`${e}`,sortable:!1,required:!0}],Ut=Q({components:{AddMeetingLocation:Xt},props:{project:String},setup(e){const t=x(),d=ee(),p=q(!0),v=q(!1),{getViewedProjects:b,updateViewedProjects:u}=te(),r=A(()=>d.params.id?d.params.id:e.project),a=A(()=>b(r.value)),j=A(()=>a.value&&a.value.meetingLocations?a.value.meetingLocations:[]),y=async o=>{if(p.value=!0,(j.value.length===0||o)&&a.value){const{data:l}=await g.fetchFromStructureApp({fields:[se({type:"meetingLocations",query:`{'15'.EX.'${a.value[8]}'}AND{'14'.EX.'Active'}`})]});u({id:r.value,dataset:"meetingLocations",data:l})}p.value=!1};function E(o){console.log(o),t.dialog({title:"Confirm",message:`Are you sure you want to remove location ${o[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{s(o)})}async function s(o){try{const{data:l}=await g.upsertRecordsXML({to:"bp5d2twyj",data:[{3:{value:o[3]},14:{value:"Inactive"}}],fieldsToReturn:[22],formatObject:22}),m=j.value.filter($=>$[3]!==l[0][22][3]);u({id:r.value,dataset:"meetingLocations",data:m}),t.notify({type:"positive",message:"Meeting Location Removed"})}catch(l){console.log(l),t.notify({type:"negative",message:"Something went wrong"})}}return y(),{projectData:a,columns:Tt,rows:j,initialPagination:{rowsPerPage:q(8)},showAdd:v,removeRow:E,loadData:y,loading:p}}}),Mt={class:"text-caption"};function Ft(e,t,d,p,v,b){const u=T("add-meeting-location");return c(),k("div",null,[e.showAdd?R("",!0):(c(),h(ie,{key:0,dense:"",title:"Meeting Locations","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[n(le,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":i(()=>[n(C,{dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAdd=!0)})]),"top-right":i(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[n(G,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(Y,{class:"text-left",key:a.name},{default:i(()=>[oe(V(a.label),1)]),_:2},1024))),128)),n(Y,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[n(G,{props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(K,{key:a.name,props:r},{default:i(()=>[w("span",Mt,V(a.value),1)]),_:2},1032,["props"]))),128)),n(K,{"auto-width":""},{default:i(()=>[n(C,{color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),h(u,{key:1,onAddComplete:t[2]||(t[2]=r=>e.showAdd=!1),onCancelAdd:t[3]||(t[3]=r=>e.showAdd=!1)})):R("",!0)])}var Qt=H(Ut,[["render",Ft]]);const Ht=Q({emits:["addComplete","cancelAdd"],props:{project:Object,current:Array},setup(e,{emit:t}){const d=x(),p=ee(),{capitalize:v}=ke,b=q([]),{setRosters:u,getManpowerData:r}=te(),a=A(()=>p.params.id?p.params.id:e.project&&e.project[3]?e.project[3]:null),j=A(()=>(r({dataset:"rosters",id:a.value})||[]).sort((N,P)=>N[75]>P[75]?1:-1)),y=S=>{const f=S.split(" ");let N="";return f.forEach((P,J)=>{N+=J>0?` ${v(P.toLowerCase())}`:v(P.toLowerCase())}),N},E=async()=>{if(a.value&&j.value.length===0){const S=`{'74'.EX.'${a.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:f}=await g.fetchFromHiringApp({fields:[Te({type:"assignments",query:S})]});u({id:a.value,data:f}),b.value=f}else b.value=j.value},s=X({entry:X().required().label("Contact")}),{errors:o,handleSubmit:l}=ve({validationSchema:s}),{value:m}=U("entry"),$=l(async S=>{if(e.current.filter(f=>f[18]===S.entry[18]).length>0)d.notify({type:"negative",message:"This employee is already a site contact!"}),t("cancelAdd");else try{const{data:f}=await g.upsertRecordsXML({to:"bp5hcce69",data:[{7:{value:a.value},18:{value:S.entry[18]}}],fieldsToReturn:[27],formatObject:27});t("addComplete",f[0][27]),d.notify({type:"positive",message:`Contact ${y(f[0][27][17])} successfully added`})}catch(f){console.log(f),d.notify({type:"negative",message:"Something went wrong!"})}}),D=(S,f)=>{if(S===""){f(()=>{b.value=j.value});return}f(()=>{const N=S.toLowerCase();b.value=j.value.filter(P=>P[75].toLowerCase().indexOf(N)>-1)})};return E(),{entry:m,options:b,formErrors:o,submit:$,filterOptions:D,properValue:y}}}),Jt={class:"text-caption"};function It(e,t,d,p,v,b){return c(),k("div",null,[n(fe,{onSubmit:pe(e.submit,["prevent"])},{default:i(()=>[n(ne,null,{default:i(()=>[n(re,null,{default:i(()=>[n(me,{class:"q-mb-sm",dense:"",label:"Select New Contact","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":t[0]||(t[0]=u=>e.entry=u),options:e.options,"option-label":u=>u?e.properValue(u[75]):"","display-value":e.entry?`${e.entry[75]}`:"","bottom-slots":"",error:!!e.formErrors.entry,"use-input":"","input-debounce":"0",onFilter:e.filterOptions},{error:i(()=>[w("div",Jt,V(e.formErrors.entry),1)]),_:1},8,["modelValue","options","option-label","display-value","error","onFilter"])]),_:1}),n(ge,{align:"right"},{default:i(()=>[n(C,{color:"secondary",label:"Cancel",onClick:t[1]||(t[1]=u=>e.$emit("cancelAdd"))}),n(C,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var zt=H(Ht,[["render",It]]);const{capitalize:Ce}=ke,$e=e=>{const t=e.split(" ");let d="";return t.forEach((p,v)=>{d+=v>0?` ${Ce(p.toLowerCase())}`:Ce(p.toLowerCase())}),d},Wt=[{name:0,label:"Name",align:"left",field:e=>e[17],format:e=>`${$e(e)}`,sortable:!0},{name:1,label:"Phone",align:"left",field:e=>e[20],format:e=>e!==""?`${e}`:"N/A",sortable:!0,required:!0}],Bt=Q({components:{AddSiteContact:zt},props:{project:String},setup(e){const t=x(),d=ee(),p=q(!0),{getViewedProjects:v,updateViewedProjects:b}=te(),u=A(()=>d.params.id?d.params.id:e.project),r=A(()=>v(u.value)),a=A(()=>(r.value&&r.value.siteContacts?r.value.siteContacts:[]).sort((m,$)=>m[17]>$[17]?1:-1)),j=async l=>{if(p.value=!0,a.value.length===0||l){const{data:m}=await g.fetchFromProjectsApp({fields:[B({type:"siteContacts",query:`{'7'.EX.'${u.value}'}AND{'6'.EX.'Active'}`})]});b({id:u.value,dataset:"siteContacts",data:m})}p.value=!1},y=q(!1);function E(l){t.dialog({title:"Confirm",message:`Are you sure you want to remove contact ${$e(l[17])}?`,cancel:!0,persistent:!0}).onOk(()=>{s(l)})}async function s(l){try{const{data:m}=await g.upsertRecordsXML({to:"bp5hcce69",data:[{3:{value:l[3]},6:{value:"Inactive"}}],fieldsToReturn:[27],formatObject:27}),$=a.value.filter(D=>D[3]!==m[0][27][3]);b({id:u.value,dataset:"siteContacts",data:$}),t.notify({type:"positive",message:"Contact Removed"})}catch(m){console.log(m),t.notify({type:"negative",message:"Something went wrong"})}}const o=l=>{b({id:u.value,dataset:"siteContacts",data:[l],push:!0}),y.value=!1};return j(),{projectData:r,columns:Wt,rows:a,initialPagination:{rowsPerPage:q(8)},showAdd:y,removeRow:E,loadData:j,loading:p,properValue:$e,contactAdded:o}}}),Yt={class:"text-caption"};function Gt(e,t,d,p,v,b){const u=T("add-site-contact");return c(),k("div",null,[e.showAdd?R("",!0):(c(),h(ie,{key:0,dense:"",title:"Contacts","title-class":"text-primary",style:{"max-height":"300px"},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[n(le,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":i(()=>[e.$can("create","projectContacts")||e.$can("manage","projects")?(c(),h(C,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAdd=!0)})):R("",!0)]),"top-right":i(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[n(G,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(Y,{class:"text-left",key:a.name},{default:i(()=>[oe(V(a.label),1)]),_:2},1024))),128)),n(Y,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[n(G,{props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(K,{key:a.name,props:r},{default:i(()=>[w("span",Yt,V(a.value),1)]),_:2},1032,["props"]))),128)),n(K,{"auto-width":""},{default:i(()=>[e.$can("manage","projectContacts")||e.$can("manage","projects")?(c(),h(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),h(u,{key:1,current:e.rows,project:e.projectData,onAddComplete:e.contactAdded,onCancelAdd:t[2]||(t[2]=r=>e.showAdd=!1)},null,8,["current","project","onAddComplete"])):R("",!0)])}var Kt=H(Bt,[["render",Gt]]);const Zt=Q({components:{},props:{project:Object},setup(e,t){const d=x(),p=q(10),v=q(null),{getUser:b}=Ae(Ne()),u=q(null),r=A(()=>{const L=new RegExp("^[0-9]{"+p.value+"}","g");return X({firstName:M().required().label("First Name"),lastName:M().required().label("Last Name"),email:M().email().required().label("Email"),phoneNumber:M().matches(L,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),role:X().required().nullable().label("Role"),workdayId:M().required().label("Workday ID")})}),{meta:a,errors:j,handleSubmit:y,handleReset:E}=ve({validationSchema:r}),{value:s}=U("firstName"),{value:o}=U("lastName"),{value:l}=U("email"),{value:m}=U("phoneNumber"),{value:$}=U("role"),{value:D}=U("workdayId");async function S({accessID:L}){const{data:I}=await g.upsertRecordsXML({to:"br598isx6",data:[{3:{value:L},20:{value:!0}}],fieldsToReturn:[28],formatObject:28});t.emit("userAdded",{user:I[0][28]}),d.loading.hide(),E()}async function f(L,I){g.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:L},10:{value:"Active"},11:{value:I}}]});const{data:ue}=await g.fetchFromStructureApp({fields:[{6:{value:"br598isx6"},7:{value:"Table Query"},8:{value:`{'6'.EX.${L}}`},9:{value:1},14:{value:24}}]});if(new Set(ue.filter(_=>_[7]==="Project").map(_=>_[9])).has(e.project[3])){const _=ue.find(we=>we[9]===e.project[3]);S({accessID:_[3]})}else return!1}async function N(L){const I=`{'6'.EX.'${L.email}'}AND{'8'.EX.'${L.phoneNumber}'}AND{'32'.EX.'${L.userType}'}`,ue=[{7:{value:"User Request"},8:{value:I},9:{value:1},14:{value:77}}];if(I==="{'10'.EX.'Active'}AND{'32'.EX.'Candidate'}"||I==="{'10'.EX.'Active'}AND{'32'.EX.'Project User'}")throw{response:{data:{errtext:"Unknown username",errdetail:"Sorry! Something's wrong. Try again."}}};const{data:Z}=await g.fetchFromStructureApp({fields:ue});if(Z.length<1)return null;if(!await f(Z[0][3],L.role))return Z}const P=y(async L=>{d.loading.show();const I={userType:"Project User",phoneNumber:`+${v.value?v.value.dialCode:"1"}${L.phoneNumber}`,email:L.email,role:L.role[3]};if(e.project.users.filter(Z=>Z[6]===I.email||Z[8]===I.phoneNumber).length>0)d.dialog({title:"Alert",message:"Your project already has a user with that phone or email."}).onOk(()=>{t.emit("userCanceled")});else{const Z=await N(I);if(console.log(Z),Z){const{data:_}=await g.upsertRecordsXML({to:"br598isx6",data:[{6:{value:Z[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});_.length>0&&t.emit("userAdded",{user:_[0][28]})}else{const _=l.value.match(/^([^@]*)@/)[1],we=Object.assign({phoneNumber:m.value},v.value),{data:je}=await g.upsertRecordsXML({to:"br4pxrbs6",data:[{6:{value:L.email},7:{value:"temp"},8:{value:`+${v.value?v.value.dialCode:"1"}${L.phoneNumber}`},9:{value:JSON.stringify(we)},10:{value:"Active"},11:{value:L.role[3]},17:{value:!0},23:{value:b.value[3]},24:{value:b.value[3]},25:{value:new Date},26:{value:new Date},32:{value:"Project User"},33:{value:_},35:{value:s.value},37:{value:o.value},49:{value:!0},50:{value:!0},70:{value:L.workdayId}}],fieldsToReturn:[3,96],formatObject:96});if(je[0]!==void 0){const ye=await g.upsertRecordsXML({to:"br598isx6",data:[{6:{value:je[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});ye.data[0]!==void 0&&d.dialog({title:"Confirm",message:"User successfully added. Would you like to send them an invite?",cancel:!0,persistent:!0}).onOk(async()=>{(await g.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:ye.data[0][28][3]},93:{value:new Date}}],fieldsToReturn:[3]})).data[0]!==void 0&&(d.notify({type:"positive",message:"User invite submitted"}),t.emit("userAdded",{user:ye.data[0][28]}))}).onCancel(()=>{t.emit("userAdded",{user:ye.data[0][28]})})}}}E(),d.loading.hide()}),J=A(()=>{const L=e.project.users.map(I=>I[9].phoneNumber);return new Set(L)});he(m,L=>{J.value.has(L)&&d.notify({type:"negative",message:"Phone Number is already in use!",timeout:1e4,position:d.screen.lt.md?"top":"center"})});const be=L=>{v.value=L},Ve=L=>{p.value=L};function Le(){E(),t.emit("userCanceled")}async function qe(){d.loading.show();const{data:L}=await g.fetchFromStructureApp({fields:[{6:{value:"br5v4in72"},7:{value:"Table Query"},8:{value:"{'7'.EX.'Projects'}AND{'15'.EX.'Active'}AND{'17'.EX.true}"},9:{value:1},14:{value:18}}]});u.value=L,d.loading.hide()}return qe(),{updateCountry:be,updatePhoneMaxLength:Ve,firstName:s,lastName:o,email:l,phoneNumber:m,role:$,workdayId:D,formMeta:a,formErrors:j,submitUser:P,roleOptions:u,cancel:Le}}}),_t=w("div",{class:"text-primary text-h6"},"Add a New User",-1),xt=w("div",{class:"text-accent text-body2 text-italic q-mb-md"},"All info is required.",-1),ea={class:"row justify-between"},ta={class:"row justify-between"},aa={class:"text-caption"},oa={class:"row justify-between"},ra={class:"text-caption"},sa={class:"text-caption"};function na(e,t,d,p,v,b){return c(),k("div",null,[n(ne,null,{default:i(()=>[n(fe,{onSubmit:pe(e.submitUser,["prevent"])},{default:i(()=>[n(re,null,{default:i(()=>[_t,xt,w("div",ea,[w("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(z,{dense:"",outlined:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":t[0]||(t[0]=u=>e.firstName=u),error:!!e.formErrors.firstName},null,8,["modelValue","error"])],2),w("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(z,{dense:"",outlined:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":t[1]||(t[1]=u=>e.lastName=u),error:!!e.formErrors.lastName},null,8,["modelValue","error"])],2)]),w("div",ta,[w("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(z,{dense:"",outlined:"",label:"Workday ID",modelValue:e.workdayId,"onUpdate:modelValue":t[2]||(t[2]=u=>e.workdayId=u),error:!!e.formErrors.workdayId},null,8,["modelValue","error"])],2),w("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(z,{dense:"",outlined:"",label:"Phone Number",modelValue:e.phoneNumber,"onUpdate:modelValue":t[3]||(t[3]=u=>e.phoneNumber=u),error:!!e.formErrors.phoneNumber,"bottom-slots":""},{error:i(()=>[w("div",aa,V(e.formErrors.phoneNumber),1)]),_:1},8,["modelValue","error"])],2)]),w("div",oa,[w("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(z,{dense:"",outlined:"",label:"Email","bottom-slots":"",modelValue:e.email,"onUpdate:modelValue":t[4]||(t[4]=u=>e.email=u),error:!!e.formErrors.email},{error:i(()=>[w("div",ra,V(e.formErrors.email),1)]),_:1},8,["modelValue","error"])],2),w("div",{class:ae(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[n(me,{dense:"",outlined:"",label:"Role","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.role,"onUpdate:modelValue":t[5]||(t[5]=u=>e.role=u),options:e.roleOptions,"option-label":"6","display-value":`${e.role?e.role[6]:""}`,"bottom-slots":"",error:!!e.formErrors.role},{error:i(()=>[w("div",sa,V(e.formErrors.role),1)]),_:1},8,["modelValue","options","display-value","error"])],2)])]),_:1}),n(ge,{align:"right"},{default:i(()=>[n(C,{color:"secondary",onClick:e.cancel,label:"Cancel"},null,8,["onClick"]),n(C,{color:"primary",type:"submit",label:"Submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])}var la=H(Zt,[["render",na]]);const ia=[{name:1,label:"Name",align:"left",field:e=>e[35],format:(e,t)=>`${e} ${t[37]}`,sortable:!0},{name:2,label:"Role",align:"left",field:e=>e[44],format:e=>`${e}`,sortable:!0}],ua=Q({components:{AddUser:la},props:{project:String},setup(e){const t=x(),d=ee(),p=q(!0),v=q(!1),{getViewedProjects:b,updateViewedProjects:u}=te(),{userData:r}=Ne(),a=A(()=>d.params.id?d.params.id:e.project),j=A(()=>b(a.value)),y=A(()=>(j.value&&j.value.users?j.value.users:[]).filter($=>$[3]!==r[3]).sort(($,D)=>$[1].$d>D[1].$d?1:-1)),E=async m=>{if(p.value=!0,y.value.length===0||m){const{data:$}=await g.fetchFromStructureApp({fields:[se({type:"userAccess",query:`{'9'.EX.'${a.value}'}AND{'20'.EX.true}`})]});u({id:a.value,dataset:"users",data:$})}p.value=!1};function s(m){console.log(m),t.dialog({title:"Confirm",message:`Are you sure you want to remove user ${m[35]} ${m[37]}?`,cancel:!0,persistent:!0}).onOk(()=>{l(m)})}function o({user:m}){t.notify({type:"positive",message:"User successfully added!"}),v.value=!1;const $=j.value.users;$.push(m),u({id:a.value,dataset:"users",data:$})}async function l(m){const{data:$}=await g.fetchFromStructureApp({fields:[se({type:"userAccessObject",query:`{'6'.EX.'${m[3]}'}AND{'7'.EX.'Project'}AND{'9'.EX.'${a.value}'}`})]}),D=[];$.forEach(f=>{const N={3:{value:f[3]},20:{value:!1},38:{value:!1},39:{value:!1},40:{value:!1},41:{value:!1}};D.push(N)}),g.upsertRecordsXML({to:"br598isx6",data:D,fieldsToReturn:[3]});const S=y.value.filter(f=>f[3]!==m[3]);u({id:a.value,dataset:"users",data:S}),t.notify({type:"positive",message:"User Removed"})}return E(),{projectData:j,columns:ia,rows:y,initialPagination:{rowsPerPage:q(8)},showAdd:v,removeRow:s,loadData:E,loading:p,userAdded:o}}}),da={class:"text-caption"};function ca(e,t,d,p,v,b){const u=T("add-user");return c(),k("div",null,[e.showAdd?R("",!0):(c(),h(ie,{key:0,dense:"",title:"Users","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[n(le,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":i(()=>[e.$can("create","users")?(c(),h(C,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.showAdd=!0)})):R("",!0)]),"top-right":i(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:t[1]||(t[1]=r=>e.loadData(!0))})]),header:i(r=>[n(G,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(Y,{class:"text-left",key:a.name},{default:i(()=>[oe(V(a.label),1)]),_:2},1024))),128)),n(Y,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[n(G,{props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(K,{key:a.name,props:r},{default:i(()=>[w("span",da,V(a.value),1)]),_:2},1032,["props"]))),128)),n(K,{"auto-width":""},{default:i(()=>[e.$can("manage","users")?(c(),h(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(c(),h(u,{key:1,onUserAdded:e.userAdded,onUserCanceled:t[2]||(t[2]=r=>e.showAdd=!1),project:e.projectData},null,8,["onUserAdded","project"])):R("",!0)])}var pa=H(ua,[["render",ca]]);const ma=Q({components:{approveHeadcount:Ie},props:{project:Object},setup(e){const t=x(),d=ee(),p=q(!1),v=q(!0),b=q([]),u=te(),{getApprovedHeadcount:r}=Ae(u),{getAssignments:a,fetchAssignments:j}=Je(),y=A(()=>d.params.id?d.params.id:e.project&&e.project[3]?e.project[3]:null),E=A(()=>[{name:0,label:"Headcount",align:"left",field:f=>f[6],format:f=>`${f}`,sortable:!0},{name:1,label:"Date",align:"left",field:f=>f[7],format:f=>`${Oe.formatDate(new Date(f),"MM/DD/YYYY")}`,sortable:!0}]),s=A(()=>b.value&&b.value[0]&&b.value[0][6]?b.value[0][6]:null),o=async f=>{if(v.value=!0,f||b.value.length===0){const{data:N}=await g.fetchFromProjectsApp({fields:[{14:{value:10},9:{value:1},8:{value:`{'8'.EX.'${y.value}'}AND{'12'.EX.'TRUE'}`},7:{value:"Table Query"},6:{value:"bteqadt9j"}}]});b.value=N.sort((P,J)=>P[7].$d>J[7].$d?-1:1)}v.value=!1},l=A(()=>a(y.value)?a(y.value).filter(f=>!f[112]&&f.latest&&f[102]==="Active").length:"N/A"),m=async f=>{try{a(y.value)&&a(y.value).length===0&&await j({projectId:y.value,refresh:f})}catch(N){console.log(N)}},$=()=>{o(!0),m(!0)};function D(f){t.dialog({title:"Confirm",message:`Are you sure you want to remove Client Contracted Headcount ${f[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{S(f)})}async function S(f){try{const N=[{3:{value:f[3]},6:{value:f[6]},7:{value:f[7]},8:{value:f[8]},12:{value:!1}}],{data:P}=await g.upsertRecordsXML({to:"bteqadt9j",fieldsToReturn:[3,6,7,8,12],data:N,formatObject:10});if(P&&P[0]&&P[0][3])$(),t.notify({position:"top-right",type:"positive",message:"Client Contracted Headcount successfully removed"});else throw"Error in removing Client Contracted Headcount"}catch(N){console.log(N),t.notify({position:"top-right",type:"negative",message:"Error removing Client Contracted Headcount"})}}return he(r,()=>{$()}),o(!1),m(!1),{props:e,addHeadcount:p,loading:v,rows:b,columns:E,initialPagination:{rowsPerPage:q(10)},approvedHeadcount:s,activeHeadcount:l,refreshHeadcount:$,removeRow:D}}}),fa={class:"q-mt-xs"},va={class:"text-body1 text-white text-uppercase"},ba={key:0,class:"q-px-xs"},ya={key:1,class:"text-caption text-dark text-italic q-px-md"},ga={class:"text-caption"};function wa(e,t,d,p,v,b){const u=T("approveHeadcount");return c(),k(F,null,[w("div",fa,[n(ne,{class:"text-dark q-pb-sm"},{default:i(()=>[n(re,{class:"bg-info q-py-sm"},{default:i(()=>[w("div",va,[oe(" Client Contracted Headcount "),e.approvedHeadcount?(c(),k("span",ba,"("+V(e.approvedHeadcount)+")",1)):R("",!0)])]),_:1})]),_:1})]),w("div",null,[n(ie,{dense:"",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[7],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:i(()=>[n(le,{label:"Loading...","label-class":"text-info"})]),"top-left":i(()=>[w("div",null,[e.$can("create","projectHeadcount")||e.$can("manage","projects")?(c(),h(C,{key:0,dense:"",color:"accent",label:"Add New",onClick:t[0]||(t[0]=r=>e.addHeadcount=!0)})):R("",!0),e.activeHeadcount!==null?(c(),k("span",ya,"Active Headcount: "+V(e.activeHeadcount),1)):R("",!0)])]),"top-right":i(()=>[n(C,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:e.refreshHeadcount},null,8,["onClick"])]),header:i(r=>[n(G,{class:"bg-dark text-white",props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(Y,{class:"text-left",key:a.name},{default:i(()=>[oe(V(a.label),1)]),_:2},1024))),128)),n(Y,{"auto-width":""})]),_:2},1032,["props"])]),body:i(r=>[n(G,{props:r},{default:i(()=>[(c(!0),k(F,null,W(r.cols,a=>(c(),h(K,{key:a.name,props:r},{default:i(()=>[w("span",ga,V(a.value),1)]),_:2},1032,["props"]))),128)),n(K,{"auto-width":""},{default:i(()=>[e.$can("manage","projectHeadcount")||e.$can("manage","projects")?(c(),h(C,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:a=>e.removeRow(r.row)},null,8,["onClick"])):R("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),n(u,{project:e.props.project,modelValue:e.addHeadcount,"onUpdate:modelValue":t[1]||(t[1]=r=>e.addHeadcount=r)},null,8,["project","modelValue"])])],64)}var $a=H(ma,[["render",wa]]);const ha=Q({components:{DetailsCard:ut,JobNumbers:ht,PerDiem:Nt,MeetingLocations:Qt,SiteContacts:Kt,Users:pa,ApprovedHeadcount:$a},setup(e,{emit:t}){const d=x(),p=q(0),v=ee(),{getViewedProjects:b,updateViewedProjects:u,setViewedProjects:r}=te(),a=A(()=>b(v.params.id));(async()=>{if(!a.value){const{data:s}=await g.fetchFromProjectsApp({fields:[B({type:"projects",id:v.params.id})]});r({id:v.params.id,data:s})}})();const y=s=>{const o=[];for(const[l,m]of Object.entries(s)){const $={fid:l,value:m};o.push($)}u({id:a.value[3],props:o})};return{details:A(()=>a.value?[{label:"Date Created",value:Xe(a.value[1].$d).format("MM/DD/YYYY hh:mm:ss a"),editable:!1},{label:"Project Name",value:a.value[20],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:a.value[20],formRules:M().required().label("Project Name"),fieldLabel:"Enter the Project Name",getter:null,setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},20:{value:s}}],fieldsToReturn:[20,43]});y(o[0]),d.notify({type:"positive",message:"Project Name successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Name"})}}}},{label:"Project Alias",value:a.value[44],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:a.value[44],formRules:M().required().label("Project Alias"),fieldLabel:"Enter the Project Alias",getter:null,setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},44:{value:s}}],fieldsToReturn:[44]});y(o[0]),d.notify({type:"positive",message:"Project Alias successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Alias"})}}}},{label:"Customer",value:a.value[25],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"customer",initialValue:s=>s.find(o=>o[3]===a.value[9]),formRules:X().required().label("Customer").nullable(),fieldLabel:"Customer",optionLabel:"6",displayValue:6,getter:async()=>{const{data:s}=await g.fetchFromStructureApp({fields:[se({type:"projectCustomers",query:"{'7'.EX.'Active'}"})]});return s.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},9:{value:s[3]}}],fieldsToReturn:[9,25]});y(o[0]),d.notify({type:"positive",message:"Customer successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Customer"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1)}},{label:"Job Site",value:a.value[24],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"location",initialValue:s=>s.find(o=>o[3]===a.value[8]),formRules:X().required().label("Job Site").nullable(),fieldLabel:"Job Site",optionLabel:"6",displayValue:6,getter:async()=>{const{data:s}=await g.fetchFromStructureApp({fields:[se({type:"projectLocations",query:"{'51'.EX.true}"})]});return s.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},8:{value:s[3]}}],fieldsToReturn:[8,24,43,67,69,136]});y(o[0]),d.notify({type:"positive",message:"Job Site successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Job Site"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1)}},{label:"Address",value:a.value[67]},{label:"Sup Org Manager",value:a.value[245]},{label:"Primary Hiring Center",value:a.value[76],editable:!0,config:{permission:{action:"manage",subject:"hiringCenters"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[12]),formRules:X().required().label("Primary Hiring Center").nullable(),fieldLabel:"Hiring Center",optionLabel:"60",displayValue:60,getter:async()=>{const{data:s}=await g.fetchFromStructureApp({fields:[se({type:"hiringCenters",query:"{'51'.EX.'Active'}"})]});return s.sort((o,l)=>o[60]>l[60]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},12:{value:s[3]}}],fieldsToReturn:[12,26,76]});y(o[0]),d.notify({type:"positive",message:"Hiring Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Hiring Center"})}},filter:(s,o)=>s.filter(l=>l[60].toLowerCase().indexOf(o)>-1)}},{label:"Workday Location",value:`${a.value[241]} (${a.value[242]})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[240]),formRules:X().required().label("Workday Location").nullable(),fieldLabel:"Workday Location",optionLabel:s=>`${s[6]} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await g.fetchFromProjectsApp({fields:[B({type:"workdayLocations",query:`{'14'.EX.true}AND{'45'.EX.'${a.value[136]}'}`})]});return s.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},240:{value:s[40]}}],fieldsToReturn:[240,241,242,257,258]});return y(o[0]),d.notify({type:"positive",message:"Workday Location successfully updated"}),!0}catch{d.notify({type:"negative",message:"Error updating Workday Location"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Supervisory Org",value:`${O(a.value[259])} (${O(a.value[244])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[243]),formRules:X().required().label("Supervisory Organization").nullable(),fieldLabel:"Supervisory Organization",optionLabel:s=>`${s[42]} (${s[6]}) - ${O(s[26])}`,displayValue:42,getter:async()=>{const{data:s}=await g.fetchFromProjectsApp({fields:[B({type:"supOrgs",query:`{'32'.EX.'Active'}AND{'44'.EX.'${a.value[272]}'}`})]});return s.sort((o,l)=>o[42]>l[42]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},243:{value:s[16]}}],fieldsToReturn:[243,244,245,259]});y(o[0]),d.notify({type:"positive",message:"Supervisory Organization successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Supervisory Organization"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[26].toLowerCase().indexOf(o)>-1||l[41].toLowerCase().indexOf(o)>-1||l[42].toLowerCase().indexOf(o)>-1)}},{label:"Company",value:`${O(a.value[286])} (${O(a.value[287])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[285]),formRules:X().required().label("Company").nullable(),fieldLabel:"Company",optionLabel:s=>`${O(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await g.fetchFromProjectsApp({fields:[B({type:"companies",query:`{'8'.EX.true}AND{'14'.EX.'${a.value[136]}'}`})]});return s.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},285:{value:s[10]}}],fieldsToReturn:[285,286,287]});y(o[0]),d.notify({type:"positive",message:"Company successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Company"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Workday Region",value:`${O(a.value[283])} (${O(a.value[284])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[282]),formRules:X().required().label("Workday Region").nullable(),fieldLabel:"Workday Region",optionLabel:s=>`${O(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await g.fetchFromProjectsApp({fields:[B({type:"workdayRegions",query:"{'8'.EX.true}"})]});return s.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},282:{value:s[9]}}],fieldsToReturn:[282,283,284]});y(o[0]),d.notify({type:"positive",message:"Region successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Region"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Workday Branch",value:`${O(a.value[289])} (${O(a.value[290])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[288]),formRules:X().required().label("Workday Branch").nullable(),fieldLabel:"Workday Branch",optionLabel:s=>`${O(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const s=a.value[264]===""?"Weekly":a.value[264],{data:o}=await g.fetchFromProjectsApp({fields:[B({type:"workdayBranches",query:`{'8'.EX.true}AND{'9'.EX.'${s}'}AND{'16'.EX.'${a.value[136]}'}`})]});return o.sort((l,m)=>l[6]>m[6]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},288:{value:s[12]}}],fieldsToReturn:[288,289,290]});y(o[0]),d.notify({type:"positive",message:"Branch successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Branch"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Pay Group",value:`${O(a.value[261])} (${O(a.value[262])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[260]),formRules:X().required().label("Workday Pay Group").nullable(),fieldLabel:"Workday Pay Group",optionLabel:s=>`${O(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await g.fetchFromProjectsApp({fields:[B({type:"workdayPayGroups",query:`{'8'.EX.'TRUE'}AND{'11'.EX.'Weekly'}AND{'21'.EX.'${a.value[136]}'}`})]});return s.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},260:{value:s[16]}}],fieldsToReturn:[260,261,262,263,264,272]});y(o[0]),d.notify({type:"positive",message:"Pay Group successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Pay Group"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}},{label:"Cost Center",value:`${O(a.value[276])} (${O(a.value[275])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:s=>s.find(o=>o[3]===a.value[274]),formRules:X().required().label("Workday Cost Center").nullable(),fieldLabel:"Workday Cost Center",optionLabel:s=>`${O(s[6])} (${s[7]})`,displayValue:6,getter:async()=>{const{data:s}=await g.fetchFromProjectsApp({fields:[B({type:"workdayCostCenters",query:`{'8'.EX.true}AND{'11'.EX.'${a.value[287]}'}`})]});return s.sort((o,l)=>o[6]>l[6]?1:-1)},setter:async s=>{try{const{data:o}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:a.value[3]},274:{value:s[22]}}],fieldsToReturn:[274,275,276]});y(o[0]),d.notify({type:"positive",message:"Cost Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Cost Center"})}},filter:(s,o)=>s.filter(l=>l[6].toLowerCase().indexOf(o)>-1||l[7].toLowerCase().indexOf(o)>-1)}}]:[]),tab:p,project:a}}}),ja={class:"q-pa-sm"},Ca={class:"row"},ka={class:"col-12 col-sm-7 q-px-xs"},Aa={class:"col-12 col-sm-5 q-px-xs"};function Na(e,t,d,p,v,b){const u=T("details-card"),r=T("job-numbers"),a=T("meeting-locations"),j=T("site-contacts"),y=T("per-diem"),E=T("users"),s=T("approved-headcount");return c(),h(Se,{style:{"max-width":"100vw"}},{default:i(()=>[w("div",ja,[w("div",Ca,[w("div",ka,[n(u,{details:e.details,title:"Details"},null,8,["details"])]),w("div",Aa,[n(Pe,{class:"q-py-xs bg-info text-white shadow-2 rounded-borders",align:"left",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=o=>e.tab=o),dense:"","indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:i(()=>[n(de,{name:0,label:"Job Numbers"}),n(de,{name:1,label:"Locations"}),n(de,{name:2,label:"Contacts"}),n(de,{name:3,label:"Per Diem"}),n(de,{name:4,label:"Users"})]),_:1},8,["modelValue"]),n(Ee,{modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=o=>e.tab=o),animated:"",class:"q-px-none"},{default:i(()=>[n(ce,{class:"q-px-xs",name:0},{default:i(()=>[n(r)]),_:1}),n(ce,{class:"q-px-xs",name:1},{default:i(()=>[n(a)]),_:1}),n(ce,{class:"q-px-xs",name:2},{default:i(()=>[n(j)]),_:1}),n(ce,{class:"q-px-xs",name:3},{default:i(()=>[n(y)]),_:1}),n(ce,{class:"q-px-xs",name:4},{default:i(()=>[n(E)]),_:1})]),_:1},8,["modelValue"]),n(s,{project:e.project},null,8,["project"])])])])]),_:1})}var vo=H(ha,[["render",Na]]);export{vo as default};
