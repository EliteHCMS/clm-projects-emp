import{Q as B}from"./QSelect.152777d1.js";import{h as j,bP as se,c_ as oe,c$ as re,k as q,r as D,c as f,_ as M,A as c,an as k,bi as y,B as b,F as I,aY as R,au as K,ab as P,bI as x,ao as A,aZ as E,d as h,D as v,y as H,G as ne,aV as le,aT as ie,w as ce,cw as ue,cx as de,cz as me}from"./index.544726d2.js";import{Q as X,b as G,a as pe}from"./QTabPanels.13de2856.js";import{Q as fe}from"./QTabs.c4173b25.js";import{Q as ye}from"./QToolbar.78ca99db.js";import{Q as ge}from"./QPage.2113fa42.js";import{u as he}from"./use-quasar.de9b4251.js";import{O as ve,q as z,u as we}from"./quickbase.dc759386.js";import{dayjs as S}from"./dayjs.18653603.js";import{u as O,b as W}from"./dataStore.44b34602.js";import{u as F}from"./dataStore.e510ce04.js";import{a as J}from"./QTable.1089518a.js";import{Q as N}from"./QTd.c0f5d399.js";import{Q as Z}from"./QTr.22581203.js";import"./QChip.2eb47deb.js";import"./QItemLabel.9df651b6.js";import"./QMenu.afaf079f.js";import"./position-engine.9b566ae2.js";import"./selection.019ae5ac.js";import"./rtl.cf9bbe47.js";import"./use-panel.8495f84c.js";import"./touch.60582172.js";import"./QResizeObserver.271a1872.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.cf0f4dd4.js";import"./i18n.95b8f7c4.js";import"./api.c454b805.js";import"./QList.8b6cd145.js";import"./QMarkupTable.871b0fab.js";import"./use-fullscreen.6fa96420.js";const be=[j("defs",[j("linearGradient",{x1:"8.042%",y1:"0%",x2:"65.682%",y2:"23.865%",id:"a"},[j("stop",{"stop-color":"currentColor","stop-opacity":"0",offset:"0%"}),j("stop",{"stop-color":"currentColor","stop-opacity":".631",offset:"63.146%"}),j("stop",{"stop-color":"currentColor",offset:"100%"})])]),j("g",{transform:"translate(1 1)",fill:"none","fill-rule":"evenodd"},[j("path",{d:"M36 18c0-9.94-8.06-18-18-18",stroke:"url(#a)","stroke-width":"2"},[j("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.9s",repeatCount:"indefinite"})]),j("circle",{fill:"currentColor",cx:"36",cy:"18",r:"1"},[j("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.9s",repeatCount:"indefinite"})])])];var Ce=se({name:"QSpinnerTail",props:oe,setup(e){const{cSize:t,classes:r}=re(e);return()=>j("svg",{class:r.value,width:t.value,height:t.value,viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg"},be)}});const $e=({assignment:e,employee:t,project:r})=>{const u=t[556]&&t[556][1].$d?t[556][1].$d:null;if(u?S(u).isSameOrAfter(S().subtract(S.duration({days:2})),"day"):!1){const{setDisaStatusChecks:g}=O(),{setDisaStatus:o}=F();g({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:t[556][10]}),o({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:t[556]})}else ee({assignment:e,employee:t,project:r})},ee=async({assignment:e,employee:t,project:r})=>new Promise((u,i)=>{const g={ownerId:r[322],socialSecurityNumbers:[t[188]]};ve.justChecking(g).then(async o=>{const a=o.results?o.results[0]:null;a&&(a.dateChecked=S(),r[321][36]&&a.dccStatus==="ACTIVE"||a.dccStatus==="ACTIVE"?a.ownerStatus="Active":a.ownerStatus="Inactive");const{data:n}=await z.upsertRecordsXML({to:"bsfjg3kz9",data:[{6:{value:t[3]},10:{value:JSON.stringify(a)}}],fieldsToReturn:[15],formatObject:15}),{setDisaStatusChecks:C}=O(),{setDisaStatus:d}=F();C({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:n[0][15][10]}),d({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:n[0][15]}),u(n[0][15])}).catch(o=>{console.log(o),i(o)})}),_e=async({roster:e,project:t})=>{const r=[];e.forEach(async i=>{const g=new Promise((o,a)=>{const n=i.employee[556]&&i.employee[556][1].$d?i.employee[556][1].$d:null;(n?S(n).isSameOrAfter(S().subtract(S.duration({days:2})),"day"):!1)?o(i.employee[556]):ee({assignment:i,employee:i.employee,project:t}).then(d=>{o(d)}).catch(d=>{a(d)})});r.push(g)}),await Promise.allSettled(r);const{setDisaReady:u}=F();u({id:t[3]})},je=q({props:{row:Object,columns:Array},setup(e){const{getMatrixInputs:t,setMatrixInputs:r}=F(),u=D(!0),i=f(()=>t(e.row.employee[3]).sort((C,d)=>C[1].$d>d[1].$d?-1:1)),g=async()=>{i.value.length===0&&r({id:e.row.employee[3],data:e.row.employee[561]}),u.value=!1},o=({col:C})=>{const d=i.value.find(l=>l[21]===C.name);return d?C.type==="date"?S(d.value,"MM-DD-YYYY").format("MM/DD/YYYY"):d.value:null},a=f(()=>e.columns.filter(d=>d.dynamic)),n=f(()=>e.columns.filter(d=>!d.dynamic));return g(),{props:e,stored:i,loading:u,calculateValue:o,dynamicColumns:a,staticColumns:n}}}),ke={key:0},Se={key:0},De={key:1},Pe={key:1},Ve={key:1};function Te(e,t,r,u,i,g){return c(),k(Z,null,{default:y(()=>[e.loading?A("",!0):(c(),b(I,{key:0},[(c(!0),b(I,null,R(e.staticColumns,o=>(c(),k(N,{key:o.name},{default:y(()=>[K(P(o.value),1)]),_:2},1024))),128)),(c(!0),b(I,null,R(e.dynamicColumns,o=>(c(),k(N,{class:"text-center",key:o.name},{default:y(()=>[o.type!=="checkbox"?(c(),b("div",ke,[e.calculateValue({col:o})?(c(),b("span",Se,P(e.calculateValue({col:o})),1)):(c(),b("span",De,"-"))])):(c(),b("div",Pe,[e.calculateValue({col:o})?(c(),k(x,{key:0,size:"sm",name:e.calculateValue({col:o})?"done":"check_box_outline_blank",color:e.calculateValue({col:o})?"positive":"negative"},null,8,["name","color"])):(c(),b("span",Ve,"-"))]))]),_:2},1024))),128))],64))]),_:1})}var Ae=M(je,[["render",Te]]);const Qe=q({props:{project:Number,roster:Array},components:{TrainingMatrixRow:Ae},setup(e){const{capitalize:t}=H,r=l=>{const m=l[20]!==""?t(l[20].toLowerCase().trim()):"",w=l[22]!==""?t(l[22].toLowerCase().trim()):"",$=l[21]!==""?` ${t(l[21].toLowerCase().trim())}`:"",V=l[23]!==""?` ${t(l[23])}`:"";return`${w}${V}, ${m}${$}`},u=l=>{const m=l.split(" "),w=[];return m.forEach(($,V)=>{const Q=t($);w[V]=Q}),w.join(" ")},i=[{name:0,label:"Name",align:"left",field:l=>r(l.employee),format:l=>l,sortable:!0,sortOrder:"ad"}],{getMatrixColumns:g,setMatrixColumns:o}=F(),a=f(()=>g(e.project)),n=f(()=>{const l=[];return i.forEach(m=>{l.push(m)}),a.value.forEach(m=>{const w=m.default?{name:m[12],label:u(m[6]),align:"center",dynamic:!0,default:!0,type:m[8],sortable:!0}:{name:m[18],label:u(m[7]),align:"center",dynamic:!0,default:!1,type:m[13],sortable:!0};l.push(w)}),l.sort((m,w)=>m.name>w.name?1:-1)});async function C(){if(a.value.length===0&&e.project){const{data:l}=await z.fetchFromProjectsApp({fields:[W({type:"matrixColumns",query:`{'10'.EX.'${e.project}'}AND{'8'.EX.'false'}`})]}),m=await d(),w=[];l.forEach($=>{w.push($)}),m.forEach($=>{w.push($)}),o({id:e.project,data:w})}}async function d(){const{data:l}=await z.fetchFromProjectsApp({fields:[W({type:"availableMatrixColumns",query:"{'14'.EX.'true'}"})]});return l}return C(),{props:e,tableColumns:n,initialPagination:D({rowsPerPage:e.roster.length})}}}),Ie={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function Fe(e,t,r,u,i,g){const o=E("training-matrix-row");return c(),b("div",null,[h(J,{columns:e.tableColumns,rows:e.props.roster,"row-key":a=>a.employee[3],"title-class":e.$q.screen.gt.sm?"text-primary text-h6":"text-primary text-body1",title:"Training Matrix",class:"q-pa-sm",pagination:e.initialPagination,"onUpdate:pagination":t[0]||(t[0]=a=>e.initialPagination=a),"rows-per-page-options":[0],separator:"vertical","table-header-class":"bg-dark text-white","no-data-label":"There are no employees",grid:e.$q.screen.lt.sm,dense:""},{body:y(a=>[h(o,{columns:a.cols,row:a.row},null,8,["columns","row"])]),"no-data":y(({message:a})=>[v("div",Ie,[h(x,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),v("span",null,P(a),1)])]),_:1},8,["columns","rows","row-key","title-class","pagination","grid"])])}var xe=M(Qe,[["render",Fe],["__scopeId","data-v-5ac68272"]]);const qe=q({props:{row:Object,columns:Array,project:Object},setup(e){const{getDisaStatusChecks:t}=O(),r=D(!0),u=async()=>{$e({assignment:e.row,employee:e.row.employee,project:e.project}),r.value=!1},i=({col:a})=>{const n=t({id:e.row.employee[3],key:a.dataKey});return a.dataKey==="hasPendingRandom"?n?"Yes":"No":a.dataKey==="daysUntilWindowCloses"?n||"N/A":n?S(n).isValid()?S(n).format("MM/DD/YYYY"):n:null},g=f(()=>e.columns.filter(n=>n.dynamic)),o=f(()=>e.columns.filter(n=>!n.dynamic));return u(),{props:e,loading:r,calculateValue:i,dynamicColumns:g,staticColumns:o}}});function Me(e,t,r,u,i,g){return c(),k(Z,null,{default:y(()=>[e.loading?A("",!0):(c(),b(I,{key:0},[(c(!0),b(I,null,R(e.staticColumns,o=>(c(),k(N,{key:o.name},{default:y(()=>[K(P(o.value),1)]),_:2},1024))),128)),(c(!0),b(I,null,R(e.dynamicColumns,o=>(c(),k(N,{class:"text-center",key:o.name},{default:y(()=>[v("div",null,[v("span",null,P(e.calculateValue({col:o})||"?"),1)])]),_:2},1024))),128))],64))]),_:1})}var Re=M(qe,[["render",Me]]);const Ee=q({props:{project:Object,roster:Array},components:{DisaMatrixRow:Re},setup(e){const t=D({sortBy:null,descending:!1,page:1,rowsPerPage:25}),{capitalize:r}=H,{getProjectDisaRoster:u}=O(),i=s=>{const p=s[20]!==""?r(s[20].toLowerCase().trim()):"",T=s[22]!==""?r(s[22].toLowerCase().trim()):"",Y=s[21]!==""?` ${r(s[21].toLowerCase().trim())}`:"",U=s[23]!==""?` ${r(s[23])}`:"";return`${T}${U}, ${p}${Y}`},g=s=>s.split(" ").join("_"),o=s=>{const p=s.split(" "),T=[];return p.forEach((Y,U)=>{const ae=r(Y);T[U]=ae}),T.join(" ")},a=s=>{const p=s.toLowerCase().trim();return p.includes("dccha")||p.includes("dcceo")||p.includes("upstream")?"lastUrineTest":p.includes("dccht")?"lastHairTest":p.includes("nasap")?"lastNASAPTest":p.includes("dccof")?"lastOralFluidTest":""},n=[{name:0,label:"Name",align:"left",field:s=>i(s.employee),format:s=>s,sortable:!0,sortOrder:"ad"},{name:1,dataKey:"ownerStatus",label:"Status",align:"center",dynamic:!0},{name:2,dataKey:"hasPendingRandom",label:"On Random",align:"center",dynamic:!0},{name:3,dataKey:"daysUntilWindowCloses",label:"Days Left",align:"center",dynamic:!0}],C=f(()=>e.project[321][10].split(",")),d=f(()=>{const s=[];return n.forEach(p=>{s.push(p)}),C.value.forEach(p=>{const T={name:g(p),dataKey:a(p),label:`${o(p)} Last Test`,align:"center",dynamic:!0};s.push(T)}),e.project[321][36]&&s.push({name:"bg",label:"Background Status",dataKey:"backgrounds",align:"center",dynamic:!0},{name:"bg_exp",label:"Background Expires",dataKey:"backgroundsExpDate",align:"center",dynamic:!0}),s.sort((p,T)=>p.name>T.name?1:-1)}),l=f(()=>e.project),m=f(()=>l.value[321]),w=f(()=>m.value?decodeURI(m.value[14]):""),$=f(()=>u(l.value[3])),V=f(()=>$.value.filter(s=>s.hasPendingRandom)),Q=f(()=>$.value.filter(s=>s.ownerStatus!=="Active")),L=f(()=>Q.value.length===0);console.log(e.roster);const _=s=>{console.log(s),t.value=s};return{props:e,tableColumns:d,initialPagination:D({rowsPerPage:e.roster.length}),projectData:l,ownerData:m,totalRoster:$,randoms:V,notActive:Q,specialRules:w,rosterCompliant:L,pageUpdated:_,pagination:t}}}),te=e=>(le("data-v-c645e706"),e=e(),ie(),e),Ne={key:0},Oe=te(()=>v("span",{class:"text-positive text-body1 q-pr-md"},"Roster is in compliance.",-1)),Le={key:1},Ye={class:"text-negative text-body1 q-pr-md"},Ue={class:"text-right"},ze=te(()=>v("div",{class:"text-body1 text-info"},"Owner Special Rules",-1)),Ke={class:"text-body2 text-italic text-info"},Be={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function Xe(e,t,r,u,i,g){const o=E("disa-matrix-row");return c(),b("div",null,[h(J,{columns:e.tableColumns,rows:e.props.roster,"row-key":a=>a.employee[3],class:"q-pa-sm sticky-header-table",pagination:e.initialPagination,"onUpdate:pagination":t[0]||(t[0]=a=>e.initialPagination=a),"rows-per-page-options":[0],separator:"vertical","table-header-class":"bg-dark text-white","no-data-label":"There are no employees",grid:e.$q.screen.lt.sm,dense:""},{"top-left":y(()=>[e.rosterCompliant?(c(),b("div",Ne,[Oe,h(x,{color:"positive",name:"task_alt",size:"sm"})])):(c(),b("div",Le,[v("span",Ye,P(e.notActive.length)+" out of compliance.",1),h(x,{color:"negative",name:"error",size:"sm"})])),v("div",null,[v("div",{class:ne(["text-body2 text-italic",e.randoms.length>0?"text-negative":"text-positive"])},P(e.randoms.length)+" pending randoms",3)])]),"top-right":y(()=>[v("div",Ue,[ze,v("div",Ke,P(e.specialRules),1)])]),body:y(a=>[h(o,{columns:a.cols,row:a.row,project:e.projectData},null,8,["columns","row","project"])]),"no-data":y(({message:a})=>[v("div",Be,[h(x,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),v("span",null,P(a),1)])]),_:1},8,["columns","rows","row-key","pagination","grid"])])}var Ge=M(Ee,[["render",Xe],["__scopeId","data-v-c645e706"]]);const We=q({name:"Compliance",components:{MatrixTab:xe,DisaTab:Ge},setup(){const e=he(),t=D(0),r=D(null),u=D(""),i=D(null),{userProjects:g}=we(),{getAssignments:o,fetchAllAssignments:a,fetchAssignments:n,getDisaReady:C}=F(),d=f(()=>o($.value).sort((s,p)=>s[1].$d<p[1].$d?1:-1).filter(s=>!s[112]&&s.latest&&s[102]==="Active")),l=f(()=>{let _=[];return d.value.forEach(s=>{s[75].toLowerCase().includes(u.value.toLowerCase())&&_.push(s)}),_=i.value?_.filter(s=>s[68]===i.value):_,_.sort((s,p)=>s.employee[22]>p.employee[22]?1:-1)}),m=f(()=>[...new Map(d.value.map(_=>[_[68],_[68]])).values()]),w=f(()=>g()),$=f(()=>r.value?r.value[9]:null),V=f(()=>r.value?r.value.project[322]!==null:!1);async function Q(){e.loading.show(),r.value?(await n({projectId:$.value}),V.value&&_e({roster:d.value,project:r.value.project})):await a(),e.loading.hide()}function L(){r.value=w.value[0]}return ce(r,(_,s)=>{console.log(r.value),Q()}),L(),{tab:t,projectOptions:w,projectFilter:r,projectFilterValue:$,search:u,isDisaProject:V,rows:l,craftOptions:m,craftFilter:i,getDisaReady:C}}}),He={class:"q-pa-md"},Je={class:"row items-center"},Ze={key:0,class:"col-12 col-md-3"},et={class:"col-12 col-md-3 q-px-sm"},tt={class:"col-12 col-md-3 q-px-sm"},at={key:0};function st(e,t,r,u,i,g){const o=E("matrix-tab"),a=E("disa-tab");return c(),k(ge,{style:{"max-width":"100vw"}},{default:y(()=>[v("div",He,[h(me,{flat:""},{default:y(()=>[h(ue,null,{default:y(()=>[v("div",Je,[e.projectOptions.length>1?(c(),b("div",Ze,[h(B,{dense:"",label:"Select a Project","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.projectFilter,"onUpdate:modelValue":t[0]||(t[0]=n=>e.projectFilter=n),options:e.projectOptions,"option-value":"9","option-label":"12","display-value":e.projectFilter?e.projectFilter[12]:"","use-chips":""},null,8,["modelValue","options","display-value"])])):A("",!0),v("div",et,[h(de,{dense:"",modelValue:e.search,"onUpdate:modelValue":t[1]||(t[1]=n=>e.search=n),label:"Search"},null,8,["modelValue"])]),v("div",tt,[h(B,{dense:"",label:"Filter by Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":t[2]||(t[2]=n=>e.craftFilter=n),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),e.projectFilter?(c(),b("div",at,[h(ye,{class:"bg-info text-white shadow-2 rounded-borders"},{default:y(()=>[h(fe,{modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=n=>e.tab=n),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:y(()=>[h(X,{name:0,label:"Matrix"}),e.isDisaProject?(c(),k(X,{key:0,name:1,disable:!e.getDisaReady(e.projectFilterValue)},{default:y(()=>[v("div",null,[K(" Disa "),e.getDisaReady(e.projectFilterValue)?A("",!0):(c(),k(Ce,{key:0,color:"white",size:"2em"}))])]),_:1},8,["disable"])):A("",!0)]),_:1},8,["modelValue"])]),_:1}),h(pe,{modelValue:e.tab,"onUpdate:modelValue":t[4]||(t[4]=n=>e.tab=n),animated:""},{default:y(()=>[h(G,{name:0},{default:y(()=>[h(o,{project:e.projectFilterValue,roster:e.rows},null,8,["project","roster"])]),_:1}),e.isDisaProject?(c(),k(G,{key:0,name:1},{default:y(()=>[h(a,{project:e.projectFilter.project,roster:e.rows},null,8,["project","roster"])]),_:1})):A("",!0)]),_:1},8,["modelValue"])])):A("",!0)])]),_:1})}var xt=M(We,[["render",st]]);export{xt as default};
