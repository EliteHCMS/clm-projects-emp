import{Q as J,a as _e,b as G}from"./QTabPanels.a593c625.js";import{Q as he}from"./QTabs.5155923d.js";import{Q as De}from"./QToolbar.8126606b.js";import{Q as qe}from"./QPage.205fb9c2.js";import{bW as X,bV as re,r as v,bX as ee,c as _,w as Z,B as j,C as M,d as s,bt as i,cW as L,E as u,aa as F,at as T,cX as z,cV as ae,o as Ve,bS as de,ae as oe,bY as ce,z as Pe,az as Ae,as as K}from"./index.cf7d0d08.js";import{a as fe}from"./QSelect.82477e9e.js";import{u as te}from"./use-quasar.b8d84810.js";import{u as ne}from"./dataStore.6e06cc70.js";import{u as ie}from"./dataStore.7ebfc18b.js";import{c as le,q as pe,u as je,i as me}from"./app.3beb99b9.js";import{dayjs as V}from"./dayjs.c84cb7a6.js";import{u as ve}from"./useQuerySaver.d29ff9ee.js";import{R as be,g as xe}from"./quickbaseDataHelpers.ae0c518f.js";import{_ as se}from"./projectSelector.112c53be.js";import{Q as Ye}from"./QTd.c654371a.js";import{Q as Ce}from"./QInnerLoading.2af21ee6.js";import{Q as Se}from"./QTable.71a5f950.js";import{e as Re}from"./export-file.dc78ba05.js";import{P as ke}from"./projectPipeline.3af039ff.js";import"./use-panel.c38b3b23.js";import"./touch.3df10340.js";import"./selection.91083131.js";import"./QResizeObserver.2b7ac126.js";import"./rtl.b51694b1.js";import"./QChip.9b6ccfb5.js";import"./QMenu.fa307e11.js";import"./position-engine.e46721cf.js";import"./localForage.b61520e5.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.04bc0a32.js";import"./i18n.36b2cf04.js";import"./QTr.75054d72.js";import"./index.07c34529.js";import"./arrivalDate.0d01fd59.js";import"./QTooltip.f86f61e7.js";import"./QForm.8349aee9.js";import"./vee-validate.esm.10226477.js";import"./array.164cfe36.js";import"./QList.0865afef.js";import"./QMarkupTable.2ea503b6.js";import"./use-fullscreen.59f721ab.js";const Qe={class:"row items-center"},Ie={key:0,class:"col-12 col-md-3"},Ne={class:"col-12 col-md-3 q-px-sm"},Me={class:"col-12 col-md-3 q-px-sm"},Ee={class:"col-12 col-md-3 q-px-sm"},Ue={__name:"roster",setup(W){const b=te(),r=X(),m=re(),w=le(),f=v(""),D=v(null),q=v(null),{getSelectedProject:h}=ee(w),{getAssignments:x,fetchAllAssignments:I,fetchAssignments:N}=ne(),{getManpowerData:C,setRosters:E}=ie(),n=_(()=>r.params.id?r.params.id:null),g=_(()=>h.value?h.value[3]:null);if(r.query){const t=Object.assign({},r.query);delete t.tab,m.replace({query:t})}const P=_(()=>{let t;return n.value?t=(C({dataset:"rosters",id:n.value})||[]).sort((l,k)=>l[1].$d<k[1].$d?1:-1):t=x(g.value).sort((a,l)=>a[1].$d<l[1].$d?1:-1),t.filter(a=>!a[112]&&a.latest&&a[102]==="Active")}),Y=_(()=>{let t=[];return P.value.forEach(a=>{a[75].toLowerCase().includes(f.value.toLowerCase())&&t.push(a)}),t=D.value?t.filter(a=>V(a[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===V(D.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=q.value?t.filter(a=>a[68]===q.value):t,t.sort((a,l)=>a.employee[22]>l.employee[22]?1:-1)}),S=_(()=>[...new Map(P.value.map(t=>[t[68],t[68]])).values()]),d=async t=>{b.loading.show(),r.query&&r.query.refresh&&(t=!0,m.push({query:{}})),n.value?(t||!C({dataset:"rosters",id:n.value}))&&await R():g.value?await N({projectId:g.value,refresh:t}):await I({refresh:t}),b.loading.hide()},R=async()=>{const t=`{'173'.EX.'${n.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:a}=await pe.fetchFromHiringApp({fields:[ve({type:"assignments",query:t})]});E({id:n.value,data:a})};return Z(g,()=>{d()}),d(),(t,a)=>(j(),M("div",null,[s(ae,{flat:""},{default:i(()=>[s(L,null,{default:i(()=>[u("div",Qe,[F(r).params.id?T("",!0):(j(),M("div",Ie,[s(se,{dense:""})])),u("div",Ne,[s(z,{dense:"",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=l=>f.value=l),label:"Search"},null,8,["modelValue"])]),u("div",Me,[s(z,{dense:"",modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=l=>D.value=l),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Ee,[s(fe,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=l=>q.value=l),options:S.value,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),s(be,{rows:Y.value,onRefreshData:a[3]||(a[3]=l=>d(!0)),title:"Active Roster"},null,8,["rows"])]))}},Te={class:"row items-center"},ze={key:0,class:"col-12 col-md-3"},Oe={class:"col-12 col-md-3 q-px-sm"},Be={class:"col-12 col-md-3 q-px-sm"},Le={class:"col-12 col-md-3 q-px-sm"},Fe={__name:"newArrivals",setup(W){const b=te(),r=re(),m=X(),w=le(),f=v(""),D=v(null),q=v(null),{getSelectedProject:h}=ee(w),{getAssignments:x,fetchAllAssignments:I,fetchAssignments:N}=ne(),{getManpowerData:C,setRosters:E}=ie(),n=_(()=>m.params.id?m.params.id:null),g=_(()=>h.value?h.value[3]:null);if(m.query){const t=Object.assign({},m.query);t.tab="newArrivals",r.replace({query:t})}const P=_(()=>{let t;const a=V().subtract(14,"day");return n.value?t=(C({dataset:"rosters",id:n.value})||[]).sort((k,O)=>k[1].$d<O[1].$d?1:-1):t=x(g.value).sort((l,k)=>l[1].$d<k[1].$d?1:-1),t.filter(l=>!l[112]&&l.latest&&l[102]==="Active"&&V(l[1].$d).isSameOrAfter(a)&&V(l[1].$d).isSameOrBefore(V()))}),Y=_(()=>{let t=[];return P.value.forEach(a=>{a[75].toLowerCase().includes(f.value.toLowerCase())&&t.push(a)}),t=D.value?t.filter(a=>V(a[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===V(D.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=q.value?t.filter(a=>a[68]===q.value):t,t.sort((a,l)=>a.employee[22]>l.employee[22]?1:-1)}),S=_(()=>[...new Map(P.value.map(t=>[t[68],t[68]])).values()]),d=async t=>{b.loading.show(),n.value?(t||!C({dataset:"rosters",id:n.value}))&&await R():g.value?await N({projectId:g.value,refresh:t}):await I({refresh:t}),b.loading.hide()},R=async()=>{const t=`{'173'.EX.'${n.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:a}=await pe.fetchFromProjectsApp({fields:[ve({type:"assignments",query:t})]});E({id:n.value,data:a})};return(t,a)=>(j(),M("div",null,[s(ae,{flat:""},{default:i(()=>[s(L,null,{default:i(()=>[u("div",Te,[F(m).params.id?T("",!0):(j(),M("div",ze,[s(se,{dense:""})])),u("div",Oe,[s(z,{dense:"",modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=l=>f.value=l),label:"Search"},null,8,["modelValue"])]),u("div",Be,[s(z,{dense:"",modelValue:D.value,"onUpdate:modelValue":a[1]||(a[1]=l=>D.value=l),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Le,[s(fe,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:q.value,"onUpdate:modelValue":a[2]||(a[2]=l=>q.value=l),options:S.value,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),s(be,{rows:Y.value,onRefreshData:a[3]||(a[3]=l=>d(!0)),title:"New Arrivals"},null,8,["rows"])]))}},Xe={class:"row items-center"},We={key:0,class:"col-12 col-md-3"},He={class:"col-12 col-md-3 q-px-sm"},Je={class:"col-12 col-md-3 q-px-sm"},Ge=u("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),Ke={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Ze={class:"text-dark text-caption text-italic"},ea={__name:"releases",setup(W){const b=re(),r=X(),m=te(),w=le(),{getUserType:f,getUser:D}=je(),{getProjects:q,getSelectedProject:h,getSelectedOffice:x}=ee(w),{capitalize:I}=Pe,N=v(x.value?x.value[8]:null),C=v(h.value?h.value[3]:null),E=v(f==="Project User"?D[3]:N),n=v(),g=v([]),P=v(""),Y=v(""),S=v(!1),d=v({sortBy:"effectiveDate",descending:!0,page:1,rowsPerPage:25,rowsNumber:0});if(r.query){const e=Object.assign({},r.query);e.tab="releases",b.replace({query:e})}f==="QuickBase User"&&Z(x,()=>{N.value=x.value?x.value[8]:null,O()}),f==="Project User"&&Z(h,()=>{C.value=h.value?h.value[3]:null,O()}),Z(Y,()=>{O()});const R=v([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${a(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0}]),t=v([{name:"action",label:"",align:"left",field:e=>e[1],sortable:!1},{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${a(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:"effectiveDate",label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0},{name:"releaseDateCreated",label:"Date Submitted",align:"left",field:e=>e[1].$d,format:e=>`${V(e).format("MM/DD/YYYY")}`,sortable:!0}]),a=e=>{const y=e.split(" ");let o="";return y.forEach((c,Q)=>{o+=Q>0?` ${I(c.toLowerCase())}`:I(c.toLowerCase())}),o},l=({page:e,pageSize:y,descending:o,filter:c,sortBy:Q})=>{try{let A="";c&&(A=c.trim());let U=null;h.value?U=h.value[3]:(U=[],q.value({userType:f,selectedId:E.value,can:"read"}).forEach(p=>{U.push(p[3])}));const $={...c&&{$or:[{fullName:{$containsi:`${A}`}},{classification:{$containsi:`${A}`}},{jobNumber:{$containsi:`${A}`}},{workdayId:{$containsi:`${A}`}},{phoneNumber:{$containsi:`${A}`}},{payrollId:{$containsi:`${A}`}}]},...Y.value&&{effectiveDate:{$eq:Y.value}},projectRID:{$eq:U}};return me.getReleases({pagination:{page:e,pageSize:y},sort:`${Q||"releaseDateCreated"}:${o?"desc":"asc"}`,filters:$}).then(p=>{const{data:B,meta:we}=p,ue=[];return B.forEach($e=>{ue.push(me.formatObject($e.syncObject))}),S.value=!1,{data:ue,meta:we}})}catch{S.value=!1}},k=async e=>{const{page:y,rowsPerPage:o,sortBy:c,descending:Q}=e.pagination,A=e.filter,U=o===0?d.value.rowsNumber:o;S.value=!0;const $=await l({page:y,sortBy:c,descending:Q,pageSize:U,filter:A});if(S.value=!1,$){const{data:p,meta:B}=$;g.value.splice(0,g.value.length,...p),d.value.page=B.pagination.page,d.value.sortBy=c,d.value.descending=Q,d.value.rowsPerPage=B.pagination.pageSize,d.value.rowsPerPage=B.pagination.pageSize,d.value.rowsNumber=B.pagination.total}};Ve(()=>{n.value.requestServerInteraction()});const O=()=>{n.value.requestServerInteraction()};function H(e,y,o){let c=y!==void 0?y(e,o):e;return c=c==null?"":String(c),c=c.split('"').join('""'),`"${c}"`}const ge=async()=>{const{page:e,rowsNumber:y,sortBy:o,descending:c}=d.value,Q=await l({page:e,sortBy:o,descending:c,pageSize:y,filter:P.value});let A=[R.value.map($=>H($.label))].concat(g.value.map($=>R.value.map(p=>H(typeof p.field=="function"?p.field($):$[p.field===void 0?p.name:p.field],p.format,$)).join(","))).join(`\r
`);Q&&Q.data&&(A=[t.value.map($=>H($.label))].concat(Q.data.map($=>t.value.map(p=>H(typeof p.field=="function"?p.field($):$[p.field===void 0?p.name:p.field],p.format,$)).join(","))).join(`\r
`)),Re(`${V().format("MM.DD.YYYY")} Releases-Export.csv`,A,"text/csv")!==!0&&m.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};function ye(e){b.push({name:"view-release",params:{release:e[3]}})}return(e,y)=>(j(),M("div",null,[s(ae,{flat:""},{default:i(()=>[s(L,null,{default:i(()=>[u("div",Xe,[e.$route.params.id?T("",!0):(j(),M("div",We,[s(se,{debounce:"300",dense:""})])),u("div",He,[s(z,{dense:"",debounce:"300",modelValue:P.value,"onUpdate:modelValue":y[0]||(y[0]=o=>P.value=o),label:"Search"},null,8,["modelValue"])]),u("div",Je,[s(z,{dense:"",debounce:"300",modelValue:Y.value,"onUpdate:modelValue":y[1]||(y[1]=o=>Y.value=o),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])]),Ge])]),_:1})]),_:1}),u("div",null,[s(Se,{title:"Releases","title-class":"text-h5 text-primary",ref_key:"tableRef",ref:n,columns:R.value,rows:g.value,"row-key":o=>o[3],class:"q-pa-sm",pagination:d.value,"onUpdate:pagination":y[2]||(y[2]=o=>d.value=o),"table-header-class":"bg-dark text-white","no-data-label":"There are no releases",dense:"","binary-state-sort":"",filter:P.value,onRequest:k},{"body-cell-action":i(o=>[s(Ye,{props:o},{default:i(()=>[s(de,{class:"cursor-pointer",size:F(m).screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:c=>ye(o.row),name:o.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1032,["props"])]),"no-data":i(({message:o})=>[u("div",Ke,[s(de,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),u("span",null,oe(o),1)])]),"top-right":i(()=>[u("div",Ze,"(Total: "+oe(d.value.rowsNumber)+" releases)",1),s(ce,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:O}),s(ce,{dense:F(m).screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:ge,disable:d.value.rowsNumber<1},null,8,["dense","disable"])]),loading:i(()=>[s(Ce,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","filter"])])]))}},aa={class:"text-h5 text-dark"},ta={class:"text-body2 text-italic q-ml-sm"},la=u("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),sa={class:"row items-center"},oa={key:0,class:"col-12 col-md-3 q-px-sm"},ra={class:"col-12 col-md-3 q-px-sm"},na={__name:"pipeline",setup(W){const b=te(),r=X(),m=le(),w=v(""),{getSelectedProject:f}=ee(m),{fetchAllDeployments:D,fetchAllInProcess:q,fetchAllPending:h,getDeployments:x,getInProcess:I,getPending:N}=ne(),{getManpowerData:C,setPipelines:E}=ie(),n=_(()=>r.params.id?r.params.id:null),g=_(()=>f.value?f.value[3]:null),P=_(()=>{const a=[];return x(g.value).forEach(l=>{l[31].toLowerCase().includes(w.value.toLowerCase())&&a.push(l)}),a}),Y=_(()=>{const a=[];return N(g.value).forEach(l=>{l[25].toLowerCase().includes(w.value.toLowerCase())&&a.push(l)}),a}),S=_(()=>{const a=[];return I(g.value).forEach(l=>{l[39].toLowerCase().includes(w.value.toLowerCase())&&a.push(l)}),a}),d=_(()=>{let a;return n.value?a=C({dataset:"pipelines",id:n.value})||[]:a=S.value.concat(Y.value.concat(P.value)),a}),R=async a=>{b.loading.show(),n.value?(a||!C({dataset:"pipelines",id:n.value}))&&await t():(await D(a),await q(a),await h(a)),b.loading.hide()},t=async()=>{const a=await xe(n.value);E({id:n.value,data:a})};return R(),(a,l)=>(j(),M("div",null,[s(ae,{flat:""},{default:i(()=>[s(L,{class:"q-pb-none"},{default:i(()=>[u("div",aa,[Ae(" Staffing Pipeline "),u("span",ta,"("+oe(d.value.length)+" total)",1)]),la]),_:1}),s(L,null,{default:i(()=>[u("div",sa,[F(r).params.id?T("",!0):(j(),M("div",oa,[s(se,{dense:""})])),u("div",ra,[s(z,{dense:"",modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=k=>w.value=k),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),s(ke,{rows:d.value,onRefresh:l[1]||(l[1]=k=>R(!0))},null,8,["rows"])]))}},ia={class:"q-pa-md"},Ja={__name:"index",setup(W){const b=X(),r=v(null);return b.query&&b.query.tab?b.query.tab==="releases"||b.query.tab==="release"?r.value=2:(b.query.tab==="newArrivals"||b.query.tab==="new-arrivals")&&(r.value=1):r.value=0,(m,w)=>(j(),K(qe,{style:{"max-width":"100vw"}},{default:i(()=>[u("div",ia,[s(De,{class:"bg-info text-white shadow-2 rounded-borders"},{default:i(()=>[s(he,{modelValue:r.value,"onUpdate:modelValue":w[0]||(w[0]=f=>r.value=f),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:i(()=>[s(J,{name:0,label:m.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),s(J,{name:1,label:"New Arrivals"}),m.$route.name==="project-manpower"?(j(),K(J,{key:0,name:3,label:"Pipeline"})):T("",!0),m.$can("read","releases")?(j(),K(J,{key:1,name:2,label:"Releases"})):T("",!0)]),_:1},8,["modelValue"])]),_:1}),s(_e,{modelValue:r.value,"onUpdate:modelValue":w[1]||(w[1]=f=>r.value=f),animated:""},{default:i(()=>[s(G,{name:0},{default:i(()=>[s(Ue)]),_:1}),s(G,{name:1},{default:i(()=>[s(Fe)]),_:1}),s(G,{name:3},{default:i(()=>[s(na)]),_:1}),m.$can("read","releases")?(j(),K(G,{key:0,name:2},{default:i(()=>[s(ea)]),_:1})):T("",!0)]),_:1},8,["modelValue"])])]),_:1}))}};export{Ja as default};
