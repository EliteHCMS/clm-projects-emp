import{k as T,bL as z,c as w,_ as L,y as B,A as $,B as C,d as r,bi as c,F as Q,aY as V,an as j,au as S,ab as v,bI as q,D as b,bO as x,r as D,bN as O,w as P,aZ as M,cw as U,cx as N,cz as J}from"./index.c128cd1f.js";import{Q as W}from"./QSelect.a24ba41d.js";import{u as R}from"./use-quasar.9316a7a9.js";import{u as Z}from"./dataStore.59a169c4.js";import{I as G}from"./quickbase.d587f7dc.js";import{dayjs as h}from"./dayjs.5224b9d1.js";import{Q as E,a as H}from"./QTable.45d1fcc6.js";import{Q as F}from"./QTr.5e95dcf0.js";import{Q as I}from"./QTd.b8d00d04.js";import{Q as K}from"./QInnerLoading.57e434a2.js";import{e as X}from"./export-file.eb604dd4.js";import{_ as ee}from"./projectSelector.7fdb30f5.js";const te=T({props:{rows:Array},setup(t,s){const g=R(),y=z(),{capitalize:u}=B,p=w(()=>g.screen.gt.sm?[{name:1,label:"Name",align:"left",field:e=>e.employee[22],format:(e,d)=>`${a(d.employee)}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e.employee[378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e.employee[213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Arrival Date",align:"left",field:e=>e[63].$d,format:e=>`${h(e).format("MM/DD/YYYY")}`,sortable:!0}]:[{name:1,label:"Name",align:"left",field:e=>e.employee[22],format:(e,d)=>`${a(d.employee)}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e.employee[378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e.employee[213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Arrival Date",align:"left",field:e=>e[63].$d,format:e=>`${h(e).format("MM/DD/YYYY")}`,sortable:!0}]),a=e=>{const d=e[20]!==""?u(e[20].toLowerCase().trim()):"",m=e[22]!==""?u(e[22].toLowerCase().trim()):"",o=e[21]!==""?` ${u(e[21].toLowerCase().trim())}`:"",A=e[23]!==""?` ${u(e[23])}`:"";return`${m}${A}, ${d}${o}`};function i(e){y.push({name:"ee-summary",params:{id:e[18]}})}function f(e,d,m){let o=d!==void 0?d(e,m):e;return o=o==null?"":String(o),o=o.split('"').join('""'),`"${o}"`}function Y(){const e=[p.value.map(m=>f(m.label))].concat(t.rows.map(m=>p.value.map(o=>f(typeof o.field=="function"?o.field(m):m[o.field===void 0?o.name:o.field],o.format,m)).join(","))).join(`\r
`);X(`${h().format("MM.DD.YYYY")} Employees-Export.csv`,e,"text/csv")!==!0&&g.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return{columns:p,props:t,exportAllEmployees:Y,viewEmployee:i}}}),ae={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},oe={class:"text-dark text-caption text-italic"};function re(t,s,g,y,u,p){return $(),C("div",null,[r(H,{title:"Active Roster","title-class":"text-h5 text-primary",columns:t.columns,rows:t.props.rows,"row-key":a=>a[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no employees in the roster",dense:""},{header:c(a=>[r(F,{class:"bg-dark text-white",props:a},{default:c(()=>[r(E,{"auto-width":""}),($(!0),C(Q,null,V(a.cols,i=>($(),j(E,{key:i.name,props:a},{default:c(()=>[S(v(i.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:c(a=>[r(F,{props:a},{default:c(()=>[r(I,{"auto-width":""},{default:c(()=>[r(q,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:i=>t.viewEmployee(a.row),name:a.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),($(!0),C(Q,null,V(a.cols,i=>($(),j(I,{key:i.name,props:a},{default:c(()=>[S(v(i.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":c(({message:a})=>[b("div",ae,[r(q,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),b("span",null,v(a),1)])]),"top-right":c(()=>[b("div",oe,"(Total: "+v(t.props.rows.length)+" employees)",1),r(x,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:s[0]||(s[0]=a=>t.$emit("refreshData"))}),r(x,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllEmployees,disable:t.props.rows.length<1},null,8,["dense","onClick","disable"])]),loading:c(()=>[r(K,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])}var se=L(te,[["render",re]]);const le=T({props:{},components:{RosterTable:se,projectSelector:ee},setup(t){const s=R(),g=G(),y=D(null),u=D(""),p=D(null),a=D(null),{getSelectedProject:i}=O(g),{getAssignments:f,fetchAllAssignments:Y,fetchAssignments:e}=Z(),d=w(()=>i.value?i.value[3]:null),m=w(()=>f(d.value).sort((n,_)=>n[1].$d<_[1].$d?1:-1).filter(n=>!n[112]&&n.latest&&n[102]==="Active")),o=w(()=>{let l=[];return m.value.forEach(n=>{n[75].toLowerCase().includes(u.value.toLowerCase())&&l.push(n)}),l=p.value?l.filter(n=>h(n[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===h(p.value).tz("America/Chicago").format("MM/DD/YYYY")):l,l=a.value?l.filter(n=>n[68]===a.value):l,l.sort((n,_)=>n.employee[22]>_.employee[22]?1:-1)}),A=w(()=>[...new Map(m.value.map(l=>[l[68],l[68]])).values()]);async function k(l){s.loading.show(),y.value?await e({projectId:d.value,refresh:l}):await Y({refresh:l}),s.loading.hide()}return P(y,()=>{k(!1)}),k(!1),{allAssignments:m,projectFilter:y,search:u,startDateFilter:p,craftFilter:a,craftOptions:A,rows:o,loadData:k}}}),ne={class:"row items-center"},ie={class:"col-12 col-md-3"},me={class:"col-12 col-md-3 q-px-sm"},de={class:"col-12 col-md-3 q-px-sm"},ce={class:"col-12 col-md-3 q-px-sm"};function fe(t,s,g,y,u,p){const a=M("projectSelector"),i=M("roster-table");return $(),C("div",null,[r(J,{flat:""},{default:c(()=>[r(U,null,{default:c(()=>[b("div",ne,[b("div",ie,[r(a,{dense:""})]),b("div",me,[r(N,{dense:"",modelValue:t.search,"onUpdate:modelValue":s[0]||(s[0]=f=>t.search=f),label:"Search"},null,8,["modelValue"])]),b("div",de,[r(N,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":s[1]||(s[1]=f=>t.startDateFilter=f),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),b("div",ce,[r(W,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":s[2]||(s[2]=f=>t.craftFilter=f),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),r(i,{rows:t.rows,onRefreshData:s[3]||(s[3]=f=>t.loadData(!0))},null,8,["rows"])])}var Ae=L(le,[["render",fe]]);export{Ae as E,se as R};
