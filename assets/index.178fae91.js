import{Q as B}from"./QSpace.a66fa792.js";import{bX as Z,r as c,w as ee,aV as te,c as y,B as Q,C as S,d as e,bt as t,cW as ae,E as d,H as L,aa as m,ae as p,cV as le,cX as oe,bS as x,bY as N,az as v,bT as E,bR as b}from"./index.52451644.js";import{Q as j}from"./QTooltip.1a821f35.js";import{Q as A}from"./QTd.9de883f6.js";import{Q as Y}from"./QSelect.adcb4524.js";import{Q as se}from"./QList.d49c043d.js";import{Q as re}from"./QBtnDropdown.7b568cfd.js";import{u as ie}from"./use-quasar.6cc770ef.js";import{e as ne}from"./export-file.dc78ba05.js";import{u as ce,c as de,b as me,q as H}from"./app.4a1e4074.js";import{dayjs as ue}from"./dayjs.3886e7b6.js";import{_ as fe}from"./hiringTabs.7595d1c1.js";import{_ as pe}from"./officeSelector.83f4a70a.js";import{_ as ve}from"./aTable.3f1aae66.js";import{u as O}from"./useQuerySaver.d29ff9ee.js";import"./position-engine.20a5bad0.js";import"./selection.74f79ead.js";import"./QChip.f4f09ec6.js";import"./QMenu.32294ecc.js";import"./rtl.b51694b1.js";import"./QBtnGroup.99e7cb59.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.b959fbb7.js";import"./index.04bc0a32.js";import"./i18n.d1d95905.js";import"./QBadge.61effd3a.js";import"./QRouteTab.986366a1.js";import"./QTabs.ca4a6834.js";import"./QResizeObserver.0d9b95a0.js";import"./QTable.55c57da0.js";import"./QMarkupTable.7564be81.js";import"./use-fullscreen.1c055a51.js";const be={class:"q-pa-md"},_e={class:"row items-center"},ge={class:"col-12 col-md-5 q-px-sm"},we={class:"col-12 col-md-3 q-px-sm"},he={class:"col-12 col-md-5 q-px-sm"},ye={key:0},Qe={key:1},ot={__name:"index",setup(Se){const u=ie(),{userOffices:R,getUser:xe}=ce(),k=de(),{openWindow:U}=me(),{fetchProfiles:z,fetchAllProfiles:F,setProfiles:C}=k,{getProfiles:_,getSelectedOffice:i,getLoadingState:V}=Z(k),r=c(i.value?i.value[8]:null),g=c("Profiles"),P=c("profiles"),w=c(""),D=c({sortBy:"1",descending:!1,rowsPerPage:150}),M=async l=>{const{data:o}=await H.fetchFromHiringApp({fields:[O({type:"profiles",useQuery:{id:l}})]});return{id:l,data:o}},W=async l=>{if(l||_.value().length===0)if(r.value){const{data:o}=await H.fetchFromHiringApp({fields:[O({type:"profiles",useQuery:{id:r.value}})]});C({selectedId:r.value,data:o})}else{const o=[];R().forEach(n=>{const K=M(n[8]);o.push(K)}),(await Promise.allSettled(o)).map(n=>n.value).forEach(n=>{C({selectedId:n.id,data:n.data})})}else return _.value(r.value)},I=l=>{r.value?z({selectedId:r.value,refresh:l}):F({can:"read",refresh:l})};I(),ee(i,()=>{r.value=i.value?i.value[8]:null,I()});const X=c(new Date),G=setInterval(()=>{X.value=new Date},1e3);te(()=>{clearInterval(G)});const J=y(()=>["index","submissionTime","name","phoneNumber","craft","latestScore","employmentStatus","action",...i.value?[]:["office"]]),h=y(()=>[{name:"index",align:"left",label:"#",sortable:!1},{name:"submissionTime",align:"left",label:"Time",field:"78",sortable:!1},{name:"name",align:"left",label:"Name",field:"24",sortable:!1},{name:"phoneNumber",align:"center",label:"Phone Number",field:"25",sortable:!1},{name:"craft",align:"center",label:"Craft",field:"52",sortable:!1},{name:"latestScore",align:"center",label:"Latest Score",field:"155",sortable:!1},{name:"employmentStatus",align:"center",label:"Employment Status",field:"56",sortable:!1},{name:"office",align:"center",label:"Office",field:"191",sortable:!1},{name:"action",align:"center",label:"",sortable:!1}]),f=y(()=>_.value(r.value).filter(l=>!0).sort((l,o)=>D.value.descending?l[1].isBefore(o[1]):l[1].isAfter(o[1]))),T=(l,o,a)=>{let s=o!==void 0?o(l,a):l;return s=s==null?"":String(s),s=s.split('"').join('""'),`"${s}"`},$=l=>{U(null,{url:`https://elitehcms.quickbase.com/db/bs7qsu6wh?a=dbpage&pageID=6&ee=${l[3]}`,name:"View Profile"})},q=()=>{const l=[h.value.map(a=>T(a.label))].concat(f.value.map(a=>h.value.map(s=>T(typeof s.field=="function"?s.field(a):a[s.field===void 0?s.name:s.field],s.format,a)).join(","))).join(`\r
`);ne(`${g.value} ${ue().format("MM.DD.YYYY")}.csv`,l,"text/csv")!==!0&&u.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};return(l,o)=>(Q(),S("div",be,[e(fe),e(le,{flat:"",class:"q-pt-none"},{default:t(()=>[e(ae,null,{default:t(()=>[d("div",_e,[d("div",ge,[d("div",{class:L(["text-dark",m(u).screen.lt.md?"text-body1":"text-h5"])},p(g.value),3)]),e(B),d("div",we,[e(pe,{styleSelection:!0})])])]),_:1})]),_:1}),e(ve,{rows:f.value,columns:h.value,pagination:D.value,filter:w.value,title:g.value,separator:"vertical","row-key":"3",loading:m(V)(P.value),"visible-columns":J.value,downloadButton:!0,onDownload:q},{top:t(()=>[d("div",he,[e(oe,{dense:m(u).screen.lt.md,modelValue:w.value,"onUpdate:modelValue":o[0]||(o[0]=a=>w.value=a),label:"Search...",clearable:""},{prepend:t(()=>[e(x,{name:"search"})]),_:1},8,["dense","modelValue"])]),e(B),d("div",{class:L(["text-dark text-caption text-italic",m(u).screen.lt.md?"offset-xs-5":""])},"(Total: "+p(f.value.length)+")",3),e(N,{flat:"",round:"",color:"primary",icon:"download",disable:f.value.length<1,onClick:q},{default:t(()=>[e(j,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:t(()=>[v(" Download ")]),_:1})]),_:1},8,["disable"]),e(N,{flat:"",round:"",color:"primary",icon:"refresh",onClick:o[1]||(o[1]=a=>W(!0)),loading:m(V)(P.value)},{default:t(()=>[e(j,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:t(()=>[v(" Refresh ")]),_:1})]),_:1},8,["loading"])]),"body-cell-submissionTime":t(a=>[e(A,{props:a},{default:t(()=>[l.$dayjs(a.value).isValid()?(Q(),S("div",ye,p(a.value.format("L LT")),1)):(Q(),S("div",Qe,p(a.row[1].format("L LT")),1))]),_:2},1032,["props"])]),"body-cell-action":t(a=>[e(A,{props:a},{default:t(()=>[e(re,{split:"",color:"primary",label:"View Profile","menu-anchor":"bottom right",onClick:s=>$(a.row),size:".75rem"},{default:t(()=>[e(se,{class:"text-primary",separator:"",bordered:""},{default:t(()=>[e(E,{clickable:"",onClick:s=>$(a.row)},{default:t(()=>[e(b,{avatar:""},{default:t(()=>[e(x,{name:"person"})]),_:1}),e(b,null,{default:t(()=>[e(Y,null,{default:t(()=>[v("CEM View Profile")]),_:1})]),_:1})]),_:2},1032,["onClick"]),e(E,{clickable:"",to:{name:"ee-hiring",params:{id:a.row[3]}}},{default:t(()=>[e(b,{avatar:""},{default:t(()=>[e(x,{name:"badge"})]),_:1}),e(b,null,{default:t(()=>[e(Y,null,{default:t(()=>[v("Full Employee")]),_:1})]),_:1})]),_:2},1032,["to"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination","filter","title","loading","visible-columns"])]))}};export{ot as default};
