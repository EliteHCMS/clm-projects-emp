import{bX as ce,r as D,c as I,d1 as de,aQ as fe,ct as me,h as F,g as ve,bW as g,a5 as pe,bT as ie,A as h,B as S,d as l,br as r,D as p,E as G,cS as O,G as Z,a8 as x,cT as q,ax as w,ac as V,aq as B,cU as U,bO as ee,bS as be,F as ae,b4 as te,bR as ge,bP as le,bQ as ye,cV as J,cy as K,dn as we,bt as _e,_ as he,bV as De,b5 as oe}from"./index.dd77155d.js";import{Q as re,a as ke}from"./QSelect.e46c7380.js";import{Q as Ce}from"./QPage.11d82b17.js";import{u as ue}from"./use-quasar.6320e378.js";import{f as ne,g as xe,q as N}from"./app.05652b82.js";import{dayjs as _}from"./dayjs.6e814a2c.js";import{u as Ae}from"./dataStore.a79dbc7d.js";import{Q as T}from"./QTooltip.f6619c32.js";import{Q as Me}from"./QMenu.237258b2.js";import{Q as Ye}from"./QList.bd0eedab.js";import{Q as $e}from"./QTd.86bfdff9.js";import{Q as Se}from"./QTr.78f4fcf5.js";import{Q as Ve}from"./QInnerLoading.62e7ebf6.js";import{a as qe}from"./QTable.cd770be3.js";import{C as Qe}from"./ClosePopup.0af03f27.js";import"./arrivalDate.45dd2e45.js";import{_ as je}from"./projectSelector.68d2f057.js";import"./QChip.8eec8f03.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.a5ce8de1.js";import"./api.9cc8c4bd.js";import"./index.04bc0a32.js";import"./i18n.660e2ed7.js";import"./useQuerySaver.d29ff9ee.js";import"./position-engine.f42cc476.js";import"./selection.1b0fcc11.js";import"./QMarkupTable.888535da.js";import"./use-fullscreen.d86e788f.js";import"./QForm.2c5aed2b.js";import"./vee-validate.esm.6dfeee42.js";import"./array.59f93f43.js";function L(o,i=new WeakMap){if(Object(o)!==o)return o;if(i.has(o))return i.get(o);const c=o instanceof Date?new Date(o):o instanceof RegExp?new RegExp(o.source,o.flags):o instanceof Set?new Set:o instanceof Map?new Map:typeof o.constructor!="function"?Object.create(null):o.prototype!==void 0&&typeof o.prototype.constructor=="function"?o:new o.constructor;if(typeof o.constructor=="function"&&typeof o.valueOf=="function"){const n=o.valueOf();if(Object(n)!==n){const y=new o.constructor(n);return i.set(o,y),y}}return i.set(o,c),o instanceof Set?o.forEach(n=>{c.add(L(n,i))}):o instanceof Map&&o.forEach((n,y)=>{c.set(y,L(n,i))}),Object.assign(c,...Object.keys(o).map(n=>({[n]:L(o[n],i)})))}var se=ce({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(o,{slots:i,emit:c}){const{proxy:n}=ve(),{$q:y}=n,v=D(null),m=D(""),u=D("");let f=!1;const A=I(()=>de({initialValue:m.value,validate:o.validate,set:C,cancel:d,updatePosition:M},"value",()=>u.value,b=>{u.value=b}));function C(){o.validate(u.value)!==!1&&(Y()===!0&&(c("save",u.value,m.value),c("update:modelValue",u.value)),j())}function d(){Y()===!0&&c("cancel",u.value,m.value),j()}function M(){fe(()=>{v.value.updatePosition()})}function Y(){return me(u.value,m.value)===!1}function j(){f=!0,v.value.hide()}function R(){f=!1,m.value=L(o.modelValue),u.value=L(o.modelValue),c("beforeShow")}function P(){c("show")}function z(){f===!1&&Y()===!0&&(o.autoSave===!0&&o.validate(u.value)===!0?(c("save",u.value,m.value),c("update:modelValue",u.value)):c("cancel",u.value,m.value)),c("beforeHide")}function $(){c("hide")}function Q(){const b=i.default!==void 0?[].concat(i.default(A.value)):[];return o.title&&b.unshift(F("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},o.title)),o.buttons===!0&&b.push(F("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[F(g,{flat:!0,color:o.color,label:o.labelCancel||y.lang.label.cancel,onClick:d}),F(g,{flat:!0,color:o.color,label:o.labelSet||y.lang.label.set,onClick:C})])),b}return Object.assign(n,{set:C,cancel:d,show(b){v.value!==null&&v.value.show(b)},hide(b){v.value!==null&&v.value.hide(b)},updatePosition:M}),()=>{if(o.disable!==!0)return F(Me,{ref:v,class:"q-popup-edit",cover:o.cover,onBeforeShow:R,onShow:P,onBeforeHide:z,onHide:$,onEscapeKey:d},Q)}}});const Re={class:"q-px-sm"},Pe={key:0,class:"float-right q-card__actions--horiz"},Ne={key:1,class:"float-right q-card__actions--horiz"},Te={key:0},Ie={key:1},ze={key:2,class:"text-caption"},Ee={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Fe=p("div",{class:"text-h6"},"Arrival Date",-1),Oe=p("span",{class:"q-ml-sm"},"Release as No Show!",-1),Be=p("div",{class:"text-h6"},"Has not arrived.",-1),Ue=p("br",null,null,-1),Le={__name:"markArrivals",props:{rows:Array,selected:Array},emits:["arrivalMarked","updateArrival","arrivalRelease"],setup(o,{emit:i}){const c=o,{rows:n,selected:y}=pe(c),v=ue();ie();const m=D(_().format("YYYY-MM-DD")),u=D(!1),f=D(!1),A=D(!1),C=D(!1),d=D(null),M=D(0),Y=I(()=>v.screen.gt.sm?[{name:207,label:"Arrival Date",align:"left",field:219,format:e=>`${e&&e.$d&&e.$d.format?e.$d.format("MM/DD/YYYY"):""}`,sortable:!0,style:"text-align: center !important;"},{name:7,label:"Expected Date",align:"left",field:e=>e[33].$d,format:e=>`${ne.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,t)=>t[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]:[{name:227,label:"Arrival Date",align:"left",field:219,format:e=>`${e&&e.$d&&e.$d.format?e.$d.format("MM/DD/YYYY"):""}`,sortable:!0},{name:7,label:"Expected Date",align:"left",field:e=>e[33].$d,format:e=>`${ne.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,t)=>t[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]),j=({rows:e,added:t,evt:a})=>{u.value=!0,i("arrivalMarked",{record:e[0],added:t}),setTimeout(function(){u.value=!1},1500)},R=e=>{u.value=!0,i("arrivalMarked",{record:d.value,added:e}),e?f.value=!1:C.value=!1,setTimeout(function(){u.value=!1},1500)},P=e=>{d.value=e,d.value[227]=m.value,f.value=!0},z=()=>{d.value=null,f.value=!1},$=e=>{d.value=e,C.value=!0},Q=()=>{d.value=null,C.value=!1},b=e=>{d.value=e,A.value=!0},W=()=>{i("arrivalRelease",{record:d.value,added:!0})},H=e=>{e.target.showPicker()},X=async(e,t)=>{t[219]=_(e),M.value+=1,i("updateArrivalDate",{record:t,value:e})};return(e,t)=>(h(),S("div",Re,[l(qe,{dense:"",columns:Y.value,rows:x(n),"row-key":a=>a[3],class:"q-pa-sm",pagination:{rowsPerPage:x(v).screen.gt.sm?25:100},separator:"vertical",onSelection:j,selected:x(y),"table-header-class":"bg-dark text-white","no-data-label":"There are no expected arrivals",loading:u.value,grid:x(v).screen.lt.md},{item:r(a=>[p("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:G(a.selected?"transform: scale(0.95);":"")},[l(O,{bordered:"",flat:"",class:Z(a.selected?x(v).dark.isActive?"bg-grey-9":"bg-grey-2":"")},{default:r(()=>[l(q,null,{default:r(()=>[w(V(a.row[31])+" ",1),a.row[20]!=="Complete"||!a.row[207]?(h(),S("span",Pe,[l(g,{round:"",color:"positive",icon:"done",size:"xs",onClick:s=>P(a.row)},{default:r(()=>[l(T,{class:"bg-primary"},{default:r(()=>[w("Arrived")]),_:1})]),_:2},1032,["onClick"]),l(g,{round:"",color:"negative",icon:"close",size:"xs",onClick:s=>b(a.row)},{default:r(()=>[l(T,{class:"bg-primary"},{default:r(()=>[w("No Show")]),_:1})]),_:2},1032,["onClick"])])):(h(),S("span",Ne,[w(V(x(_)(a.row[219]).format("MM/DD/YYYY"))+" ",1),l(g,{icon:"edit",color:"accent",flat:"",size:"xs",class:"q-px-none q-pr-xs"}),(h(),B(se,{key:M.value,"model-value":x(_)(a.row[219]).format("YYYY-MM-DD"),title:"Arrival Date"},{default:r(s=>[l(U,{autofocus:"",onFocus:t[0]||(t[0]=k=>H(k)),dense:"","model-value":s.value,type:"date",max:m.value,rules:[k=>!!k||"Field is required"],"onUpdate:modelValue":k=>X(k,a.row)},null,8,["model-value","max","rules","onUpdate:modelValue"])]),_:2},1032,["model-value"])),l(g,{round:"",color:"white",icon:"history",size:"xs",onClick:ee(s=>$(a.row),["stop"])},{default:r(()=>[l(T,{class:"bg-primary"},{default:r(()=>[w("Revert Back - Has not arrived yet.")]),_:1})]),_:2},1032,["onClick"])]))]),_:2},1024),l(be),l(Ye,{dense:""},{default:r(()=>[(h(!0),S(ae,null,te(a.cols.filter(s=>s.name!=="action"),s=>(h(),B(ge,{key:s.name},{default:r(()=>[l(le,null,{default:r(()=>[l(re,null,{default:r(()=>[w(V(s.label),1)]),_:2},1024)]),_:2},1024),l(le,{side:""},{default:r(()=>[l(re,{caption:""},{default:r(()=>[w(V(s.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),body:r(a=>[l(Se,{"no-hover":"",props:a,class:Z(a.row[33]&&a.row[33].$d&&e.$dayjs().businessDiff(e.$dayjs(a.row[33].$d),"day",!0)>5&&a.row[20]!=="Complete"?"bg-red-11":"")},{default:r(()=>[(h(!0),S(ae,null,te(a.cols,s=>(h(),B($e,{key:s.name,props:a,classes:s.name===207&&a.row[20]!=="Complete"||!a.row[207]?"q-card__actions--horiz":"",style:G(s.style)},{default:r(()=>[s.name===207&&(a.row[20]!=="Complete"||!a.row[207])?(h(),S("span",Te,[l(g,{round:"",color:"positive",icon:"done",size:"xs",onClick:k=>P(a.row)},{default:r(()=>[l(T,{class:"bg-primary"},{default:r(()=>[w("Arrived")]),_:1})]),_:2},1032,["onClick"]),l(g,{round:"",color:"negative",icon:"close",size:"xs",onClick:k=>b(a.row)},{default:r(()=>[l(T,{class:"bg-primary"},{default:r(()=>[w("No Show")]),_:1})]),_:2},1032,["onClick"])])):s.name===207?(h(),S("span",Ie,[w(V(x(_)(a.row[219]).format("MM/DD/YYYY"))+" ",1),(h(),B(se,{key:M.value,"model-value":x(_)(a.row[219]).format("YYYY-MM-DD"),title:"Arrival Date"},{default:r(k=>[l(U,{autofocus:"",onFocus:t[1]||(t[1]=E=>H(E)),dense:"","model-value":k.value,type:"date",max:m.value,rules:[E=>!!E||"Field is required"],"onUpdate:modelValue":E=>X(E,a.row)},null,8,["model-value","max","rules","onUpdate:modelValue"])]),_:2},1032,["model-value"])),l(g,{round:"",color:"negative",icon:"history",size:"xs",onClick:ee(k=>$(a.row),["stop"])},{default:r(()=>[l(T,{class:"bg-primary"},{default:r(()=>[w("Revert Back - Has not arrived yet.")]),_:1})]),_:2},1032,["onClick"])])):(h(),S("span",ze,V(s.value),1))]),_:2},1032,["props","classes","style"]))),128))]),_:2},1032,["props","class"])]),"no-data":r(({message:a})=>[p("div",Ee,[l(ye,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),p("span",null,V(a),1)])]),loading:r(()=>[l(Ve,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","selected","loading","grid"]),l(K,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=a=>f.value=a),persistent:""},{default:r(()=>[l(O,{style:{"min-width":"350px"}},{default:r(()=>[l(q,null,{default:r(()=>[Fe]),_:1}),l(q,{class:"q-pt-none"},{default:r(()=>[l(U,{dense:"",modelValue:d.value[227],"onUpdate:modelValue":t[2]||(t[2]=a=>d.value[227]=a),autofocus:"",type:"date",max:m.value,rules:[a=>!!a||"Field is required"]},null,8,["modelValue","max","rules"])]),_:1}),l(J,{align:"right",class:"text-primary"},{default:r(()=>[l(g,{flat:"",label:"Cancel",onClick:t[3]||(t[3]=a=>z())}),l(g,{flat:"",label:"Confirm",onClick:t[4]||(t[4]=a=>R(!0))})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:A.value,"onUpdate:modelValue":t[7]||(t[7]=a=>A.value=a),persistent:""},{default:r(()=>[l(O,null,{default:r(()=>[l(q,{class:"row items-center"},{default:r(()=>[l(we,{icon:"person_remove",color:"primary","text-color":"white"}),Oe]),_:1}),l(J,{align:"right"},{default:r(()=>[_e(l(g,{flat:"",label:"Cancel",color:"primary"},null,512),[[Qe]]),l(g,{flat:"",label:"Release",color:"primary",onClick:t[6]||(t[6]=a=>W())})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:C.value,"onUpdate:modelValue":t[10]||(t[10]=a=>C.value=a),persistent:""},{default:r(()=>[l(O,{style:{"min-width":"350px"}},{default:r(()=>[l(q,null,{default:r(()=>[Be]),_:1}),l(q,{class:"q-pt-none"},{default:r(()=>[w(" You are about to erase the arrival date."),Ue,w(" Are you sure you want to do this? ")]),_:1}),l(J,{align:"right",class:"text-primary"},{default:r(()=>[l(g,{label:"No",onClick:t[8]||(t[8]=a=>Q())}),l(g,{flat:"",label:"Yes",onClick:t[9]||(t[9]=a=>R(!1))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},He={name:"Arrivals",components:{MarkArrivalsTable:Le,projectSelector:je},setup(){const o=ue(),i=xe(),c=ie(),n=D(null),y=D(""),v=D(""),{getSelectedProject:m}=De(i),{fetchAllDeployments:u,updateDeployment:f,getDeployments:A,fetchDeployments:C}=Ae(),d=I(()=>m.value?m.value[3]:null),M=I(()=>A(d.value).filter(e=>e[20]==="Complete")),Y=I(()=>{let e=[];return A(d.value).forEach(t=>{t[31].toLowerCase().includes(v.value.toLowerCase())&&e.push(t)}),e=y.value?e.filter(t=>_(t[33].$d).tz("America/Chicago").format("MM/DD/YYYY")===_(y.value).tz("America/Chicago").format("MM/DD/YYYY")):e,e=n.value?e.filter(t=>t[132]===n.value):e,e.sort((t,a)=>t[219]-a[219]||t[33]-a[33])}),j=I(()=>[...new Map(Y.value.map(e=>[e[132],e[132]])).values()]);async function R(e){o.loading.show(),d.value?await C({projectId:d.value,refresh:e}):await u({refresh:e}),o.loading.hide()}async function P({record:e,added:t}){if(t){const a=await z(e);await $({id:e[21],status:7,assignment:a});const s=await Q(e[3],"Complete");f({projectId:s[134],key:s[3],record:s})}else{await b(e),await $({id:e[21],status:6});const a=await Q(e[3],"In Process");f({projectId:a[134],key:a[3],record:a})}}async function z(e){try{const t=e[207]?_(e[207]):_(),{data:a}=await N.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:e[3]},13:{value:e[15]},18:{value:e[21]},60:{value:""},125:{value:t},145:{value:t},165:{value:"Active"}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return a[0][108]}catch(t){throw{message:"Cannot add assignment",error:t}}}async function $({id:e,status:t,assignment:a}){try{const s={3:{value:e},79:{value:t}};a&&(s[609]={value:a[3]});const{data:k}=await N.upsertRecordsXML({to:"bp3gb7ng2",data:[s],fieldsToReturn:[3]});return k[0][3]}catch(s){throw{message:"Cannot edit employee",error:s}}}async function Q(e,t){try{const{data:a}=await N.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:e},20:{value:t},22:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return a[0][204]}catch(a){throw{message:"Cannot edit deployment",error:a}}}async function b(e){try{const{data:t}=await N.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:e.assignment[3]},22:{value:new Date},21:{value:"Canceled"},19:{value:""},60:{value:""},165:{value:"Inactive"}}],fieldsToReturn:[108],formatObject:108});return t[0][108]}catch(t){throw{message:"Cannot cancel assignment",error:t}}}async function W(e){try{const t=e.value?_(e.value):_();if(e.record.assignment&&e.record.assignment[3]){const{data:a}=await N.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:e.record.assignment[3]},125:{value:t},145:{value:t}}],fieldsToReturn:[3]});return a[0][3]}}catch(t){throw{message:"Cannot edit Assignment",error:t}}}async function H({record:e,added:t}){if(t){const a=await X(e);c.push({name:"ee-termination",params:{id:e[21]},query:{reason:"no-show",hc:e[15],aid:a[3],did:e[3]}})}else{await b(e),await $({id:e[21],status:6});const a=await Q(e[3],"In Process");f({projectId:a[134],key:a[3],record:a})}}async function X(e){try{const t=e[207]?_(e[207]):_(),{data:a}=await N.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:e[3]},13:{value:e[15]},18:{value:e[21]},60:{value:""},21:{value:"DNC"},112:{value:!0},165:{value:"Inactive"}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return a[0][108]}catch(t){throw{message:"Cannot release assignment",error:t}}}return R(!0),{arrived:M,allDeployments:Y,arrivalMarked:P,updateArrivalDate:W,arrivalRelease:H,craftOptions:j,craftFilter:n,startDateFilter:y,search:v}}},Xe={class:"q-pt-sm"},We={class:"text-h5 text-dark"},Je={class:"text-body2 text-italic q-ml-sm"},Ke=p("div",{class:"text-subtitle2 text-accent"},"Please click on the green checkmark as employees arrive to the job site.",-1),Ge={class:"row items-center"},Ze={class:"col-12 col-md-3 q-px-sm"},ea={class:"col-12 col-md-3 q-px-sm"},aa={class:"col-12 col-md-3 q-px-sm"},ta={class:"col-12 col-md-3 q-px-sm"};function la(o,i,c,n,y,v){const m=oe("projectSelector"),u=oe("mark-arrivals-table");return h(),B(Ce,{style:{"max-width":"100vw"}},{default:r(()=>[p("div",Xe,[l(O,{flat:""},{default:r(()=>[l(q,{class:"q-pb-none"},{default:r(()=>[p("div",We,[w(" Expected Arrivals "),p("span",Je,"("+V(n.allDeployments.length)+" total)",1)]),Ke]),_:1}),l(q,null,{default:r(()=>[p("div",Ge,[p("div",Ze,[l(m,{dense:""})]),p("div",ea,[l(U,{dense:"",modelValue:n.search,"onUpdate:modelValue":i[0]||(i[0]=f=>n.search=f),label:"Search"},null,8,["modelValue"])]),p("div",aa,[l(U,{dense:"",modelValue:n.startDateFilter,"onUpdate:modelValue":i[1]||(i[1]=f=>n.startDateFilter=f),label:"Expected Date",type:"date","stack-label":""},null,8,["modelValue"])]),p("div",ta,[l(ke,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:n.craftFilter,"onUpdate:modelValue":i[2]||(i[2]=f=>n.craftFilter=f),options:n.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(u,{rows:n.allDeployments,selected:n.arrived,onArrivalRelease:n.arrivalRelease,onArrivalMarked:n.arrivalMarked,onUpdateArrivalDate:n.updateArrivalDate},null,8,["rows","selected","onArrivalRelease","onArrivalMarked","onUpdateArrivalDate"])])]),_:1})}var Pa=he(He,[["render",la]]);export{Pa as default};
