import{Q as B}from"./QPage.cce46bf2.js";import{k as w,c as b,_ as S,A as n,B as v,d as c,bi as i,D as a,ab as y,bJ as F,bH as A,au as L,cy as P,bO as U,bF as H,r as N,aZ as Y,an as m,cw as h,cz as O,ao as $,w as V,F as C,aY as M,bk as x,bI as z,cZ as T,bM as J,G}from"./index.d156221a.js";import{u as j,a as I}from"./dataStore.1eb23ba8.js";import{q as Q}from"./quickbase.000914fc.js";import{Q as Z}from"./QSelect.3b2aebcc.js";import{Q as W}from"./QForm.6d48a03b.js";import{a as E,b as X,u as K}from"./array.804de1eb.js";import{u as ee}from"./use-quasar.17bfadd8.js";import{u as se}from"./dataStore.dd90100b.js";import{dayjs as f}from"./dayjs.42389116.js";import{d as te}from"./decode.593c6ccc.js";import{Q as ae}from"./QRating.beded5ae.js";import{Q as oe}from"./QList.31fef766.js";import{a as le}from"./index.7dbe61ef.js";import"./localForage.5c9cf61e.js";import"./_commonjsHelpers.a26ce4be.js";import"./i18n.6b65d4f8.js";import"./api.8f52ca6d.js";import"./QChip.53326447.js";import"./QItemLabel.71527ca8.js";import"./QMenu.27cad430.js";import"./position-engine.b27ef5cb.js";import"./selection.03c1209a.js";import"./rtl.cf9bbe47.js";const ne=w({emits:["supUpdated"],props:{record:Object},setup(e,{emit:r}){const d=ee(),{getAssignments:o,fetchAssignments:l}=se(),u=b(()=>o(e.record[74]).filter(_=>_[138]&&_[3]!==e.record[3]).sort((_,g)=>_[75]>g[75]?1:-1)),t=b(()=>E({selection:E().required().nullable().label("Supervisor")})),{errors:s,handleSubmit:p,handleReset:q}=X({validationSchema:t}),{value:R}=K("selection"),k=p(async D=>{const _=[{3:{value:e.record[3]},133:{value:D.selection[3]}}];try{const{data:g}=await Q.upsertRecordsXML({to:"bp3gazpqj",data:_,fieldsToReturn:[110],formatObject:110});console.log(g),r("supUpdated",g[0][110]),d.notify({type:"positive",message:"Supervisor successfully updated!"})}catch(g){console.log(g),d.notify({type:"negative",message:"Cannot save supervisor."}),q()}});return l({projectId:e.record[74],refresh:!0}),{props:e,options:u,selection:R,submit:k,formErrors:s,handleReset:q}}}),ie={class:"text-caption"};function re(e,r,d,o,l,u){return n(),v("div",null,[c(W,{onSubmit:H(e.submit,["prevent"])},{default:i(()=>[c(Z,{dense:"",clearable:"",label:"Select a Supervisor","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":r[0]||(r[0]=t=>e.selection=t),options:e.options,"option-label":t=>`${t[75]} - ${t[20]}`,"display-value":`${e.selection?e.selection[75]:""}`,"bottom-slots":"",error:!!e.formErrors.selection},{error:i(()=>[a("div",ie,y(e.formErrors.selection),1)]),"no-option":i(()=>[c(F,null,{default:i(()=>[c(A,{class:"text-grey"},{default:i(()=>[L(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","error"]),c(P,{align:"right"},{default:i(()=>[c(U,{color:"info",label:"Submit",type:"submit"}),c(U,{color:"secondary",label:"Cancel",onClick:e.handleReset},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var de=S(ne,[["render",re]]);const ce=w({props:{employee:Object,assignment:Object},components:{UpdateSupervisor:de},setup(e){const r=N(!1),{setAssignmentsByEmployee:d}=j();return{props:e,supUpdated:l=>{r.value=!1,d({id:l[18],data:l})},editSup:r}}}),ue=a("div",{class:"text-h6 q-pb-sm"},"Assign a Supervisor",-1),me={class:"row text-body2"},pe={class:"col-12 col-md-6"},ve=a("div",{class:"q-mb-xs"},"Current Location",-1),ye={class:"q-pl-sm"},fe={class:"col-12 col-md-6"},be=a("div",{class:"q-mb-xs"},"Current Supervisor",-1),_e={class:"q-pl-sm"};function ge(e,r,d,o,l,u){const t=Y("update-supervisor");return n(),v("div",null,[e.assignment&&e.assignment[3]?(n(),m(O,{key:0,class:"text-dark"},{default:i(()=>[e.editSup?(n(),m(h,{key:0},{default:i(()=>[ue,c(t,{record:e.assignment,onSupUpdated:e.supUpdated},null,8,["record","onSupUpdated"])]),_:1})):(n(),m(h,{key:1},{default:i(()=>[a("div",me,[a("div",pe,[ve,a("div",ye,y(e.assignment[141]),1)]),a("div",fe,[be,a("div",_e,y(e.assignment[140]===""?"N/A":e.assignment[140]),1)])])]),_:1}))]),_:1})):$("",!0)])}var he=S(ce,[["render",ge]]);const $e=w({props:{employee:Object,assignment:Object},components:{},setup(e){const{getWorkdayData:r}=j(),d=({id:s,idType:p})=>p.includes("J&amp;E")?s.slice(-5):s,o=b(()=>[]),l=b(()=>{const s=r(e.employee[3]);let p;if(s&&!e.employee[207]){const{employmentData:q,personalData:R}=s,{positionData:k,workerStatus:D}=q,{jobProfile:_}=k,{identificationData:g}=R;p=[{label:"Position",value:`${k.positionId} ${k.positionTitle}`},{label:"Job Profile",value:`${_.jobProfileId} - ${_.jobProfileName}`},{label:te(g.customIds[0].idType),value:d(g.customIds[0])},{label:"Hire Date",value:f(D.hireDate).format("MM/DD/YYYY")},{label:"Original Hire Date",value:f(D.originalHireDate).format("MM/DD/YYYY")},{label:"Years Since Last Hire",value:f().diff(D.hireDate,"year",!0).toFixed(2)}]}else p=[];return p}),u=b(()=>{let s;return e.assignment[3]?s=[{label:"Project",value:e.assignment[94]},{label:"Job Title",value:e.assignment[20]}]:s=[],s}),t=b(()=>o.value.concat(u.value).concat(l.value));return V(l,(s,p)=>{console.log(r(e.employee[3]))}),{props:e,details:t}}}),De=a("div",{class:"text-h6 text-weight-bold"},"Job Details",-1),ke=a("div",{class:"text-body1 text-primary text-italic"},"Employee has a pending release.",-1),we={class:"row"},Se={class:"col-12 col-md-4"},qe={class:"text-body2"},Ye={class:"col-12 col-md-8"},Ce={class:"text-body2 text-weight-light"};function je(e,r,d,o,l,u){return n(),v("div",null,[c(O,{class:"text-dark"},{default:i(()=>[c(h,{class:"q-pb-sm"},{default:i(()=>[De]),_:1}),e.employee[581]?(n(),m(h,{key:0,class:"q-py-sm"},{default:i(()=>[ke]),_:1})):$("",!0),(n(!0),v(C,null,M(e.details,t=>(n(),m(h,{key:t,class:"q-py-sm"},{default:i(()=>[a("div",we,[a("div",Se,[a("div",qe,y(t.label),1)]),a("div",Ye,[a("div",Ce,y(t.value),1)])])]),_:2},1024))),128))]),_:1})])}var Qe=S($e,[["render",je]]);const Re=async e=>{console.log(e);const r=await Q.getFileAttachmentUrl(e);console.log(r),le.get(r).then(d=>d.blob()).then(d=>{const o=URL.createObjectURL(d),l=document.createElement("a");l.href=o,l.download=r.replace(/^.*[\\/]/,""),document.body.appendChild(l),l.click(),URL.revokeObjectURL(o),l.remove()})},Ae=w({props:{employee:Object},components:{},setup(e){const{getReleases:r,setReleases:d}=j(),o=b(()=>r(e.employee[581])),l=b(()=>{let s;return o.value&&o.value[3]?s=[{label:"Reason",value:o.value[32]},{label:"Last Hire Date",value:f(e.employee[397].$d).format("MM/DD/YYYY")},{label:"Last Day On Site",value:f(o.value[36].$d).format("MM/DD/YYYY")},{label:"Returned Equipment",value:o.value[72]?"Yes":"No"},{label:"Pay Deduct Needed",value:!o.value[72]&&f.duration(f(o.value[36].$d).diff(f(e.employee[397].$d))).asDays()<30?"Yes":"No"},{label:"CAAP Rating",value:o.value[59][37],type:"rating"},{label:"Submitted By",value:`${o.value[38][35]} ${o.value[38][37]}`},{label:"Submitted On",value:f(o.value[1].$d).tz(f.tz.guess()).format("MM/DD/YYYY hh:mm a")},{label:"Comments",value:o.value[60],type:"comments"}]:s=[],s}),u=async()=>{if(!o.value&&e.employee[581]){const{data:s}=await Q.fetchFromHiringApp({fields:[I({type:"releases",query:"",id:e.employee[581]})]},{action:"read",type:"release"});console.log(s),d({id:s[3],data:s})}},t=s=>{console.log(s)};return u(),{releaseDetails:l,release:o,downloadFile:Re,getFile:t}}}),Ue={class:"row items-center"},Me=a("div",{class:"col-12 col-md-7"},[a("div",{class:"text-h6 text-weight-bold"},"Pending Release Details")],-1),Oe={key:0,class:"col-12 col-md-5"},Ee={class:"row"},Fe={class:"col-12 col-md-5"},Le={class:"text-body2"},Pe={class:"col-12 col-md-7"},Ve={key:1,class:"text-body2 text-weight-light"},Ie={class:"text-body1 text-weight-bold q-mb-xs"},Be={class:"text-body2 text-italic text-primary q-pl-md"},He=a("div",{class:"text-body1 text-weight-bold q-mb-xs"},"Supporting Docs",-1);function Ne(e,r,d,o,l,u){return n(),v("div",null,[c(O,{class:"text-dark"},{default:i(()=>[c(h,{class:"q-pb-sm"},{default:i(()=>[a("div",Ue,[Me,e.release?(n(),v("div",Oe,[c(P,{align:"right"},{default:i(()=>[c(U,{size:"md",flat:"",dense:"",label:"View Release",color:"info",to:{name:"view-ee-release",params:{id:e.release[25],release:e.release[3]}}},null,8,["to"])]),_:1})])):$("",!0)])]),_:1}),(n(!0),v(C,null,M(e.releaseDetails,t=>(n(),v(C,{key:t},[t.type!=="comments"?(n(),m(h,{key:0,class:"q-py-sm"},{default:i(()=>[a("div",Ee,[a("div",Fe,[a("div",Le,y(t.label),1)]),a("div",Pe,[t.type==="rating"?(n(),m(ae,{key:0,modelValue:t.value,"onUpdate:modelValue":s=>t.value=s,max:"5",size:"sm",color:"accent",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"])):(n(),v("div",Ve,y(t.value),1))])])]),_:2},1024)):t.value!==""?(n(),m(h,{key:1},{default:i(()=>[a("div",Ie,y(t.label),1),a("div",Be,y(t.value),1)]),_:2},1024)):$("",!0)],64))),128)),e.release&&e.release[70].length>0?(n(),m(h,{key:0},{default:i(()=>[He,c(oe,null,{default:i(()=>[(n(!0),v(C,null,M(e.release[70],(t,s)=>x((n(),m(F,{key:s,clickable:"",class:"text-body2",onClick:p=>e.downloadFile(t.url)},{default:i(()=>[c(A,null,{default:i(()=>[L(y(s+1)+". "+y(t[7]),1)]),_:2},1024),c(A,{avatar:""},{default:i(()=>[c(z,{color:"info",name:"file_download"})]),_:1})]),_:2},1032,["onClick"])),[[T]])),128))]),_:1})]),_:1})):$("",!0)]),_:1})])}var xe=S(Ae,[["render",Ne]]);const ze=w({components:{LocationAndManager:he,EmployeeJobDetails:Qe,PendingReleaseDetails:xe},setup(){const e=J(),{getEmployee:r,getAssignmentsByEmployee:d,setAssignmentsByEmployee:o}=j(),l=b(()=>r(e.params.id)),u=b(()=>l.value?d(l.value[3]):null),t=async()=>{if(!u.value&&l.value[577]){const{data:s}=await Q.fetchFromHiringApp({fields:[I({type:"assignments",query:"",id:l.value[577]})]});console.log(s),o({id:l.value[3],data:s})}};return V(l,(s,p)=>{s&&t()}),{employee:l,assignment:u}}}),Te={class:"q-pa-sm"},Je={class:"row"},Ge={class:"col-12 col-md-6 q-px-xs"},Ze={key:1},We={key:0};function Xe(e,r,d,o,l,u){const t=Y("location-and-manager"),s=Y("employee-job-details"),p=Y("pending-release-details");return n(),m(B,{style:{"max-width":"100vw"}},{default:i(()=>[a("div",Te,[a("div",Je,[a("div",Ge,[e.employee&&e.employee[408]==="Active"?(n(),m(t,{key:0,employee:e.employee,assignment:e.assignment},null,8,["employee","assignment"])):$("",!0),e.employee&&e.assignment?(n(),v("div",Ze,[e.assignment[21]==="In Process"?(n(),m(s,{key:0,class:"q-mt-md",assignment:e.assignment,employee:e.employee},null,8,["assignment","employee"])):$("",!0)])):$("",!0)]),a("div",{class:G(["col-12 col-md-6 q-px-xs",(e.employee&&e.employee[581],"")])},[e.employee&&e.employee[581]?(n(),v("div",We,[c(p,{employee:e.employee},null,8,["employee"])])):$("",!0)],2)])])]),_:1})}var ks=S(ze,[["render",Xe]]);export{ks as default};
