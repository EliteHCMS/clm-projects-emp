import{Q as H}from"./QImg.e23a7baf.js";import{_ as X,bM as J,bL as K,r as c,c as W,w as V,A as n,an as D,bi as d,a7 as j,B as m,d as v,ao as u,D as _,cw as k,ab as Q,au as N,bF as Z,cx as ee,b as te,bO as ae,cz as oe,aV as se,aT as re}from"./index.a6af2ed6.js";import{Q as le}from"./QForm.c3d9e9b3.js";import{Q as ne}from"./QPage.ea80cfd6.js";import{u as ue}from"./use-quasar.de97a6d6.js";import{u as ie}from"./vee-validate.esm.beb6cc31.js";import{c as ce}from"./array.776f4a45.js";import{u as de,q as b}from"./quickbase.5c4d1e3b.js";import{c as me}from"./carousel.6e0476d6.js";import{api as pe}from"./api.1540b7c0.js";import{dayjs as C}from"./dayjs.21c0286e.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.d0ee8dfa.js";import"./i18n.8aa3fcd4.js";import"./use-panel.75472aff.js";import"./touch.9d375472.js";import"./selection.38996208.js";import"./use-fullscreen.533860fb.js";const O=I=>(se("data-v-824a748e"),I=I(),re(),I),ve={key:0,class:"col-md-7 col-lg-8 col-lx-8"},fe={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ge={key:0,class:"text-dark"},ye={key:1,class:"text-dark"},he={key:2,class:"text-dark"},be={key:3,class:"text-dark"},_e=O(()=>_("br",null,null,-1)),xe={key:4,class:"text-dark"},we=O(()=>_("br",null,null,-1)),qe={key:2,class:"text-grey-6 text-right"},ke={key:3,class:"text-grey-6 text-right"},Ce={__name:"codeConfirmation",setup(I){const f=ue(),E=de(),a=J(),p=K(),M=c(""),L=c(""),s=c("phone number"),r=c("code-confirmation"),i=c(Math.floor(1e5+Math.random()*9e5)),x=c(null),g=c(!1),q=c(!1),w=c(0),l=c(null),{value:y}=ie("codeConfirmation",ce().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:"Code Not Valid!"}).required().oneOf([i.value],"Code Not Valid!")),T=W(()=>y.value===i.value),$=t=>{const e=Math.floor(t/6e4),o=(t%6e4/1e3).toFixed(0);return e+":"+(o<10?"0":"")+o};V(s,t=>{i.value=null,y.value=null,q.value=!1,i.value=null,x.value=null,r.value="code-confirmation"}),V(w,t=>{t===0?(q.value=!0,i.value=null,x.value=null):q.value=!1}),V(y,async t=>{Number(t)===i.value&&(f.notify({position:"top-right",type:"positive",message:"Code Verified!"}),s.value==="phone number"?F():s.value==="email"&&P())});const S=async()=>{if(g.value=!0,i.value=Math.floor(1e5+Math.random()*9e5),y.value=null,x.value=C().add(5,"minute").toISOString(),s.value==="phone number")try{await pe.createMessage({contact:M.value,to:M.value,message:`Your Brandsafway Verification Code is: ${i.value}`,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",send:!0,readBy:[],status:"pending"}),f.notify({position:"top-right",type:"info",message:"Text message sent!"}),x.value=C().add(1,"minute"),g.value=!1,g.value=!1,U(),r.value="code-sent"}catch(t){console.log(t),g.value=!1}else s.value==="email"&&(await A(),g.value=!1,f.notify({position:"top-right",type:"info",message:"Email sent!"}),x.value=C().add(2,"minute"),g.value=!1,U(),r.value="code-sent")},U=()=>{const t=setInterval(()=>{w.value=C(x.value).valueOf()-C().valueOf(),w.value<=0&&(w.value=0,clearInterval(t))},1e3)},A=async()=>{if(!l.value||l.value==="")return!1;const t=await b.isUserLoggedIn(),e=new Date;i.value||(i.value=Math.floor(1e5+Math.random()*9e5));const o={3:{value:l.value},26:{value:e},87:{value:e},88:{value:i.value},47:{value:!0}};try{return t?await b.updateUserData({fields:o}):await b.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[o],formatObject:76})}catch(h){f.notify({position:"top-right",type:"negative",message:h.message||"Error updating Verification!"})}},F=async()=>{if(!l.value||l.value==="")return!1;const t=await b.isUserLoggedIn(),e=new Date,o={3:{value:l.value},26:{value:e},50:{value:!0}};try{await b.updateUserData({fields:o}),t?p.push({path:"/",query:{code:!0}}):p.push({name:"password-update",query:{rid:l.value,ac:!0}})}catch(h){f.notify({position:"top-right",type:"negative",message:h.message||"Error updating Verification!"})}},P=async()=>{if(!l.value||l.value==="")return!1;const t=await b.isUserLoggedIn(),e=new Date,o={3:{value:l.value},26:{value:e},49:{value:!0}};try{await b.updateUserData({fields:o}),t?p.push({path:"/",query:{code:!0}}):p.push({name:"password-update",query:{rid:l.value,ac:!0}})}catch(h){f.notify({position:"top-right",type:"negative",message:h.message||"Error updating Verification!"})}},z=()=>{E.logout().then(()=>{p.replace({name:"login"})})},Y=()=>M.value.replace(/(\d{3})(\d{3})(\d{4})/,"******$3"),G=()=>(E.userLoggedIn?E.user[34]:L.value||"").replace(/(.{2})(.*)(?=@)/,function(e,o,h){for(let B=0;B<h.length;B++)o+="*";return o});V(()=>a.query,()=>{R(!1)});const R=async t=>{if(a.query.p&&a.query.rid){r.value="code-confirmation",M.value=a.query.p,l.value=a.query.rid,a.query.p=null,a.query.rid=null;const e=Object.assign({},a.query);delete e.p,delete e.rid,(a.query.send==="true"||a.query.send===!0)&&S(),delete e.send,p.replace({query:e})}else if(a.query.e&&a.query.rid){r.value="code-confirmation",s.value="email",L.value=a.query.e,l.value=a.query.rid,a.query.e=null,a.query.rid=null;const e=Object.assign({},a.query);delete e.p,delete e.rid,(a.query.send==="true"||a.query.send===!0)&&S(),delete e.send,p.replace({query:e})}else t&&p.push("/login")};return R(!0),(t,e)=>(n(),D(ne,{class:"window-height window-width row"},{default:d(()=>[j(f).screen.lt.md?u("",!0):(n(),m("div",ve,[v(me)])),_("div",fe,[v(oe,{class:"auth-card",flat:""},{default:d(()=>[v(k,{style:{"padding-left":"30px","padding-right":"30px"}},{default:d(()=>[v(H,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),v(k,{class:"text-center auth-description"},{default:d(()=>[r.value==="code-sent"&&s.value==="phone number"?(n(),m("p",ge,"A text message with a verification code has been sent to your phone.")):u("",!0),r.value==="code-sent"&&s.value==="email"?(n(),m("p",ye,"A verification code has been sent to your email. ")):u("",!0),r.value==="code-confirmation"?(n(),m("p",he,"Your "+Q(s.value)+" needs to be verified click the button below to verify.",1)):u("",!0),r.value==="code-confirmation"&&s.value==="phone number"?(n(),m("p",be,[_e,N(Q(Y()),1)])):u("",!0),r.value==="code-confirmation"&&s.value==="email"?(n(),m("p",xe,[we,N(Q(G()),1)])):u("",!0)]),_:1}),v(k,null,{default:d(()=>[v(le,{class:"q-px-sm q-pt-sm",onSubmit:e[3]||(e[3]=Z(()=>{},["prevent"]))},{default:d(()=>[r.value==="code-sent"?(n(),D(ee,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",clearable:"",outlined:"",disable:q.value,loading:q.value,modelValue:j(y),"onUpdate:modelValue":e[0]||(e[0]=o=>te(y)?y.value=o:null),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:"Code",tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!j(T),"error-message":"Code does not match!"},{append:d(()=>[N(Q($(w.value))+"\xA0 ",1)]),_:1},8,["disable","loading","modelValue","error"])):u("",!0),r.value==="code-confirmation"?(n(),D(ae,{key:1,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Send Code",tabindex:"1",loading:g.value,onClick:S},null,8,["loading"])):u("",!0),s.value==="phone number"?(n(),m("p",qe,[_("a",{href:"javascript:void(0);",onClick:e[1]||(e[1]=o=>s.value="email")},"Use Email")])):u("",!0),s.value==="email"?(n(),m("p",ke,[_("a",{href:"javascript:void(0);",onClick:e[2]||(e[2]=o=>s.value="phone number")},"Use Phone Number")])):u("",!0),r.value==="code-sent"?(n(),D(k,{key:4,class:"q-py-none row justify-center"},{default:d(()=>[w.value===0?(n(),m("a",{key:0,onClick:S,class:"text-grey-6",href:"javascript:void(0);",tabindex:"2"},"Resend Code")):u("",!0)]),_:1})):u("",!0)]),_:1})]),_:1}),v(k,{class:"text-center q-pa-sm"},{default:d(()=>[_("p",{class:"text-grey-6"},[_("a",{onClick:z,class:"text-grey-6",href:"javascript:void(0);",tabindex:"3"},"Logout")])]),_:1})]),_:1})])]),_:1}))}};var ze=X(Ce,[["__scopeId","data-v-824a748e"]]);export{ze as default};
