import{u as p,q as n}from"./quickbase.76c41fac.js";import{dayjs as v}from"./dayjs.1b825f16.js";import{u as T}from"./dataStore.708e0494.js";import{u as L}from"./dataStore.beef04c5.js";import{k as M}from"./index.b48bafa3.js";const J=async({employee:t,assignment:e,effectiveNow:a,values:s,attachments:c,ratings:u,supervisor:o})=>{const{userData:f,getUserType:j}=p(),l=f;l.access&&delete l.access,l.permissions&&delete l.permissions;const y=[{25:{value:t[3]},28:{value:e[3]},30:{value:s.selection[10]},35:{value:e[142]},36:{value:s.effective},38:{value:JSON.stringify(l)},39:{value:j!=="QuickBase User"},60:{value:u.comments?u.comments:""},72:{value:s.equipment.value}}];if(a){const{ee:d,assign:r}=await S({assignment:e,supervisor:o}),{data:m}=await n.upsertRecordsXML({to:"bp3ga39ut",data:y,fieldsToReturn:[37],formatObject:37},{action:"create",type:"release"}),{release:i}=await g({release:m[0][37][3],employee:m[0][37][25],ratings:u,user:l,supervisor:o});if(c.length>0){const{docs:R}=await O({release:i,attachments:c,user:l});return i[70]=R.map(w=>w[12]),{release:i,employee:d,assignment:r,attachments:R}}else return{release:i,employee:d,assignment:r,attachments:[]}}else{const{data:d}=await n.upsertRecordsXML({to:"bp3ga39ut",data:y,fieldsToReturn:[37],formatObject:37},{action:"create",type:"release"});o&&X({assignment:e,supervisor:o});const{release:r}=await g({release:d[0][37][3],employee:d[0][37][25],ratings:u,user:l,supervisor:o});if(c.length>0){const{docs:m}=await O({release:r,attachments:c,user:l});return r[70]=m.map(i=>i[12]),{release:r,employee:t,assignment:e,attachments:m}}else return{release:r,employee:t,assignment:e,attachments:[]}}},g=async({release:t,employee:e,ratings:a,user:s,supervisor:c})=>{const u={6:{value:a.attendance},8:{value:a.attitude},10:{value:a.capability},12:{value:a.promotable},14:{value:a.comments?a.comments:""},16:{value:e},34:{value:t},36:{value:JSON.stringify(s)}};c&&Object.assign(u,{42:{value:c[18]}});const{data:o}=await n.upsertRecordsXML({to:"bqzkbcxup",data:[u],fieldsToReturn:[35],formatObject:35});return{release:o[0][35]}},O=async({release:t,attachments:e,user:a})=>{const s=[];e.forEach(u=>{Object.assign(u,{8:{value:JSON.stringify(a)},9:{value:t[3]},10:{value:t[25]}}),s.push(u)});const{data:c}=await n.upsertRecordsXML({to:"bsstsai5d",data:s,fieldsToReturn:[12],formatObject:12});return{docs:c}},S=async({assignment:t,supervisor:e,id:a})=>{const{removeData:s}=T(),{removeFromRoster:c}=L(),u={3:{value:a||t[3]},21:{value:"Complete"},22:{value:v()}};e&&Object.assign(u,{133:{value:e[3]}});const{data:o}=await n.upsertRecordsXML({to:"bp3gazpqj",data:[u],fieldsToReturn:[110],formatObject:110});return c({id:o[0][110][74],data:o[0]}),s({type:"assignments",key:o[0][110][74],item:o[0][110],storageKey:M.storageAssignments}),{ee:await b({3:{value:o[0][110][18]},79:{value:19}}),assign:o[0][110]}},b=async t=>{const{data:e}=await n.upsertRecordsXML({to:"bp3gb7ng2",data:[t],fieldsToReturn:[549],formatObject:549});return e[0][549]},X=async({assignment:t,supervisor:e})=>{n.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:t[3]},133:{value:e[3]}}],fieldsToReturn:[110],formatObject:110})},N=async({release:t,disp:e})=>{const{userData:a}=p(),s=a;s.access&&delete s.access,s.permissions&&delete s.permissions;const c={3:{value:t[3]},42:{value:e.value==="Terminate"?"Reviewed":"Complete"},43:{value:e.value},73:{value:e.value==="Terminate"?"Pending":"Cancelled"},75:{value:JSON.stringify(s)},77:{value:v()}},u=e.value==="Terminate"?19:15,o=await b({3:{value:t[25]},79:{value:u},16:{value:t[35]}}),{data:f}=await n.upsertRecordsXML({to:"bp3ga39ut",data:[c],fieldsToReturn:[37],formatObject:37},{action:"update",type:"release"});return{release:f[0][37],employee:o}},z=async({release:t})=>{const{userData:e}=p(),a=e;a.access&&delete a.access,a.permissions&&delete a.permissions;const s=[{3:{value:t[3]},42:{value:"Complete"},73:{value:"Processed"},76:{value:JSON.stringify(a)},78:{value:v()}}];b({3:{value:t[25]},79:{value:""},122:{value:""}});const{data:c}=await n.upsertRecordsXML({to:"bp3ga39ut",data:s,fieldsToReturn:[37],formatObject:37},{action:"update",type:"release"});return{data:c[0][37]}};export{N as f,S as r,J as s,z as t};
