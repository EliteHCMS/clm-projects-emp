import{k as J,r as Q,bL as W,c as A,w as G,_ as Z,A as k,B as pe,d as l,bi as u,D as o,ab as C,bJ as F,bH as j,au as I,cx as L,cz as Y,cw as x,dp as n,cy as ce,bO as M,bF as be,bM as ve,aZ as fe,an as P,ao as ye}from"./index.df995f5f.js";import{Q as Ve}from"./QPage.4a1eacda.js";import{u as _}from"./use-quasar.e1d67d94.js";import{u as ee,a as ae}from"./dataStore.63aa5812.js";import{u as ge,q as S}from"./quickbase.95274e2f.js";import{Q as X}from"./QSelect.08716fd1.js";import{Q as we}from"./QForm.bd2f8d44.js";import{a as z,f as Re,c as H,e as N,b as qe,u as g}from"./array.c3373e59.js";import{dayjs as B}from"./dayjs.2c96dcd3.js";import"./localForage.3844ce44.js";import"./_commonjsHelpers.dfee5925.js";import"./index.7dbe61ef.js";import"./i18n.bd13b955.js";import"./api.c05f3e59.js";import"./QChip.20ea4134.js";import"./QItemLabel.937e07e9.js";import"./QMenu.de16f5ac.js";import"./position-engine.ed057110.js";import"./selection.15ff2c8a.js";import"./rtl.cf9bbe47.js";const Se=async({employee:e,assignment:a,effectiveNow:i,values:p,attachments:b,ratings:v})=>{const{userData:t,getUserType:w}=ge(),f=t;f.access&&delete f.access,f.permissions&&delete f.permissions;const q=[{25:{value:e[3]},28:{value:a[3]},30:{value:p.selection[10]},35:{value:a[142]},36:{value:p.effective},38:{value:JSON.stringify(f)},39:{value:w!=="QuickBase User"},60:{value:v.comments?v.comments:""}}];if(i){const{ee:y,assign:c}=await Ue({assignment:a}),{data:V}=await S.upsertRecordsXML({to:"bp3ga39ut",data:q,fieldsToReturn:[37],formatObject:37}),{release:U}=await K({release:V[0][37][3],employee:V[0][37][25],ratings:v,user:f});return{release:U,employee:y,assignment:c,attachments:null}}else{const{data:y}=await S.upsertRecordsXML({to:"bp3ga39ut",data:q,fieldsToReturn:[37],formatObject:37}),{release:c}=await K({release:y[0][37][3],employee:y[0][37][25],ratings:v,user:f});return{release:c,employee:e,assignment:a,attachments:null}}},K=async({release:e,employee:a,ratings:i,user:p})=>{const{data:b}=await S.upsertRecordsXML({to:"bqzkbcxup",data:[{6:{value:i.attendance},8:{value:i.attitude},10:{value:i.capability},12:{value:i.promotable},14:{value:i.comments?i.comments:""},16:{value:a},34:{value:e},36:{value:JSON.stringify(p)}}],fieldsToReturn:[35],formatObject:35});return{release:b[0][35]}},Ue=async({assignment:e})=>{const a=[{3:{value:e[3]},21:{value:"Complete"},22:{value:B().tz("America/Chicago")}}],{data:i}=await S.upsertRecordsXML({to:"bp3gazpqj",data:a,fieldsToReturn:[110],formatObject:110});return{ee:await he(e[18]),assign:i[0][110]}},he=async e=>{const a=[{3:{value:e},79:{value:19}}],{data:i}=await S.upsertRecordsXML({to:"bp3gb7ng2",data:a,fieldsToReturn:[549],formatObject:549});return i[0][549]},Ae=J({emits:["releaseSubmitted"],props:{record:Object,employee:Object},setup(e,{emit:a}){const i=Q(!1),p=Q(null),b=Q([]),v=_(),t=W(),{getTermReasons:w,setTermReasons:f}=ee(),q=A(()=>z({selection:z().required().nullable().label("Reason"),effective:Re().required().label("Last Day On Site"),category:H().nullable(),attendance:N().required().label("Attendance"),capability:N().required().label("Capability"),attitude:N().required().label("Attitude"),promotable:N().required().label("Promotability"),comments:H().nullable().label("Comments")})),{errors:y,handleSubmit:c,handleReset:V}=qe({validationSchema:q,initialValues:{}}),{value:U}=g("selection"),{value:$}=g("effective"),{value:d}=g("category"),{value:r}=g("attachments"),{value:D}=g("capability"),{value:E}=g("attendance"),{value:te}=g("attitude"),{value:le}=g("promotable"),{value:oe}=g("comments"),se=A(()=>{const s=w();return d.value?s.filter(m=>m[6]===d.value).sort((m,R)=>m[12]>R[12]?1:-1):s.sort((m,R)=>m[12]>R[12]?1:-1)}),ne=c(async s=>{console.log(s);const m={capability:s.capability,attendance:s.attendance,attitude:s.attitude,promotable:s.promotable,comments:s.comments};v.dialog({title:"Confirm",message:"Are you sure you want to release this employee?",cancel:!0,persistent:!0}).onOk(async()=>{try{const{release:R,employee:h,assignment:O}=await Se({employee:e.employee,assignment:e.record,values:s,effectiveNow:!T.value,attachments:null,ratings:m});a("releaseSubmitted",{release:R,employee:h,assignment:O,effectiveNow:!T.value}),V()}catch{v.notify({type:"negative",message:"Cannot submit release."})}})}),ie=()=>{v.dialog({title:"Confirm",message:"Are you sure you want to cancel?",cancel:!0,persistent:!0}).onOk(()=>{V(),t.go(-1)})};G(U,(s,m)=>{s&&s[19]?(i.value=!0,r.value=!0,console.log(r.value)):(r.value=!1,i.value=!1)});const de=A(()=>{const s=w();return[...new Map(s.map(m=>[m[6],m[6]])).values()]}),T=A(()=>$.value&&$.value!==""?B().isBefore(B($.value)):!1),re=s=>new Promise((m,R)=>{const h=new FileReader;h.readAsDataURL(s),h.onload=()=>m(h.result.replace(/^data:.+;base64,/,"")),h.onerror=O=>R(O)}),ue=()=>{p.value&&p.value.forEach(async s=>{const m={6:{value:await re(s),filename:s.name}};b.value.push(m),p.value=null}),console.log(b.value)},me=s=>{console.log(b.value[s]),b.value.splice(s,1)};return(async()=>{if(w().length===0){const{data:s}=await S.fetchFromHiringApp({fields:[ae({type:"termReasons",query:"{'11'.EX.'true'}"})]});f({reasons:s})}})(),{props:e,options:se,primaryReasons:de,category:d,selection:U,effective:$,attachments:r,capability:D,attendance:E,attitude:te,promotable:le,comments:oe,attachmentsRequired:i,fileAttachment:p,attachedFiles:b,submit:ne,formErrors:y,handleReset:V,cancelRelease:ie,showFiles:ue,deleteFile:me}}}),$e={class:"row"},De={class:"col-4 q-px-xs"},Ce=o("div",{class:"text-caption"},"Is this release voluntary or involuntary?",-1),Ne={class:"text-caption"},Qe={class:"col-5 q-px-xs"},Ee={class:"text-caption"},Oe={class:"text-caption"},ke={class:"col-3 q-px-xs"},Be=o("div",{class:"text-caption"},"When is the employee's last day on site?",-1),Te={class:"text-caption"},Fe={class:"row q-mb-md"},je={class:"col-12"},Ie=o("div",{class:"q-pa-sm"},[o("div",{class:"text-h6 text-primary text-bold"},"CAAP Rating"),o("div",{class:"text-subtitle1 text-accent text-italic"},"Capability, Attendance, Attitude, and Promotability"),o("div",{class:"text-body1 text-dark q-mt-sm"},"Select how much you agree with each of the following statements.")],-1),Le={class:"q-pb-sm"},Me=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee is capable of performing their assigned job.",-1),Pe={class:"q-pb-sm"},Xe=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee regularly shows up to work on time.",-1),ze={class:"q-pb-sm"},He=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee has a good attitude.",-1),Ke={class:"q-pb-sm"},Je=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"I am confident that this employee can be promoted in the future.",-1),We={class:"row q-py-sm"},Ge={class:"col-12"};function Ze(e,a,i,p,b,v){return k(),pe("div",null,[l(we,{onSubmit:be(e.submit,["prevent"])},{default:u(()=>[o("div",$e,[o("div",De,[Ce,l(X,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":a[0]||(a[0]=t=>e.category=t),options:e.primaryReasons},{error:u(()=>[o("div",Ne,C(e.formErrors.selection),1)]),"no-option":u(()=>[l(F,null,{default:u(()=>[l(j,{class:"text-grey"},{default:u(()=>[I(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),o("div",Qe,[o("div",Ee,"What is the reason for this "+C(e.category)+" release?",1),l(X,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":a[1]||(a[1]=t=>e.selection=t),options:e.options,"option-label":"12","display-value":`${e.selection?e.selection[12]:""}`,"bottom-slots":"",error:!!e.formErrors.selection,disable:!e.category},{error:u(()=>[o("div",Oe,C(e.formErrors.selection),1)]),"no-option":u(()=>[l(F,null,{default:u(()=>[l(j,{class:"text-grey"},{default:u(()=>[I(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","display-value","error","disable"])]),o("div",ke,[Be,l(L,{dense:"",type:"date",modelValue:e.effective,"onUpdate:modelValue":a[2]||(a[2]=t=>e.effective=t),error:!!e.formErrors.effective,"bottom-slots":""},{error:u(()=>[o("div",Te,C(e.formErrors.effective),1)]),_:1},8,["modelValue","error"])])]),o("div",Fe,[o("div",je,[Ie,l(Y,null,{default:u(()=>[l(x,null,{default:u(()=>[o("div",null,[o("div",Le,[Me,l(n,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[3]||(a[3]=t=>e.capability=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(n,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[4]||(a[4]=t=>e.capability=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(n,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[5]||(a[5]=t=>e.capability=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(n,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[6]||(a[6]=t=>e.capability=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(n,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[7]||(a[7]=t=>e.capability=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(n,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[8]||(a[8]=t=>e.capability=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",Pe,[Xe,l(n,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[9]||(a[9]=t=>e.attendance=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(n,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[10]||(a[10]=t=>e.attendance=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(n,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[11]||(a[11]=t=>e.attendance=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(n,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[12]||(a[12]=t=>e.attendance=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(n,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[13]||(a[13]=t=>e.attendance=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(n,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[14]||(a[14]=t=>e.attendance=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",ze,[He,l(n,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[15]||(a[15]=t=>e.attitude=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(n,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[16]||(a[16]=t=>e.attitude=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(n,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[17]||(a[17]=t=>e.attitude=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(n,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[18]||(a[18]=t=>e.attitude=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(n,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[19]||(a[19]=t=>e.attitude=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(n,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[20]||(a[20]=t=>e.attitude=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",Ke,[Je,l(n,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[21]||(a[21]=t=>e.promotable=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(n,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[22]||(a[22]=t=>e.promotable=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(n,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[23]||(a[23]=t=>e.promotable=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(n,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[24]||(a[24]=t=>e.promotable=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(n,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[25]||(a[25]=t=>e.promotable=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(n,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[26]||(a[26]=t=>e.promotable=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])])])]),_:1})]),_:1})])]),o("div",We,[o("div",Ge,[l(L,{filled:"",type:"textarea",modelValue:e.comments,"onUpdate:modelValue":a[27]||(a[27]=t=>e.comments=t),label:"Comments"},null,8,["modelValue"])])]),l(ce,{align:"right"},{default:u(()=>[l(M,{color:"info",label:"Submit",type:"submit"}),l(M,{color:"secondary",label:"Cancel",onClick:e.cancelRelease},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var Ye=Z(Ae,[["render",Ze]]);const xe=J({components:{ReleaseForm:Ye},setup(){const e=Q(0),a=ve(),i=W(),p=_(),{getEmployee:b,getAssignmentsByEmployee:v,setAssignmentsByEmployee:t,setEmployees:w,setReleases:f,setReleasesByAssignment:q,setReleasesByEmployee:y}=ee(),c=A(()=>b(a.params.id)),V=A(()=>c.value?v(c.value[3]):null),U=async()=>{if(!V.value&&c.value[577]){const{data:d}=await S.fetchFromHiringApp({fields:[ae({type:"assignments",query:"",id:c.value[577]})]});console.log(d),t({id:c.value[3],data:d})}};return G(c,(d,r)=>{d&&U()}),{employee:c,assignment:V,releaseSubmitted:({employee:d,release:r,assignment:D,effectiveNow:E})=>{p.notify({type:"positive",message:"Release successfully submitted."}),E?(d[581]=r[3],f({id:r[3],data:r}),w({id:d[3],data:d}),t({id:d[3],assignment:D}),q({id:D[3],data:r}),y({id:d[3],data:r})):(d[581]=r[3],w({id:d[3],data:d}),f({id:r[3],data:r}),q({id:D[3],data:r}),y({id:d[3],data:r})),i.replace({name:"ee-summary",params:{id:d[3]}})},step:e}}}),_e={class:"q-px-sm q-py-md"},ea={class:"row"},aa={class:"col-12"},ta=o("div",{class:"text-h6 q-mb-md"},"Please fill out the following information.",-1);function la(e,a,i,p,b,v){const t=fe("release-form");return k(),P(Ve,{style:{"max-width":"100vw"}},{default:u(()=>[o("div",_e,[o("div",ea,[o("div",aa,[l(Y,null,{default:u(()=>[e.assignment?(k(),P(x,{key:0},{default:u(()=>[ta,l(t,{record:e.assignment,employee:e.employee,onReleaseSubmitted:e.releaseSubmitted},null,8,["record","employee","onReleaseSubmitted"])]),_:1})):ye("",!0)]),_:1})])])])]),_:1})}var ha=Z(xe,[["render",la]]);export{ha as default};
