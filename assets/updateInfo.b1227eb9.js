import{Q as he}from"./QImg.64a2acc7.js";import{_ as le,a3 as X,r as p,c as oe,w as O,z as l,A as _,d as b,bh as g,a6 as e,an as u,at as ee,aa as T,c2 as U,bE as re,bD as se,am as E,b as ae,cx as ue,c6 as ie,C as R,aU as ge,aS as ye,c5 as be,c4 as _e,E as qe,bX as xe,cy as we,c3 as Ne}from"./index.8f32f12d.js";import{Q as ne}from"./QForm.0aebbfc2.js";import{Q as $e}from"./QPage.66c1fb9d.js";import{u as de}from"./use-quasar.a5692936.js";import{u as H,c as I,a as G,b as ke}from"./array.967068df.js";import{u as Ce}from"./i18n.4811e7d4.js";import{u as me,q as P,c as Se}from"./quickbase.8936bef7.js";import{api as ce}from"./api.513a61f9.js";import{_ as Ie}from"./languageSelector.defe5a17.js";import{p as Ee}from"./VueTelInput.aaa44e80.js";import{dayjs as L}from"./dayjs.22253e14.js";import{c as Re}from"./carousel.d0c57eca.js";import"./_commonjsHelpers.dfee5925.js";import"./localForage.1af4f1a9.js";import"./index.7dbe61ef.js";import"./QSelect.129af288.js";import"./QChip.d6e68241.js";import"./QMenu.e618646e.js";import"./position-engine.d72c2bb6.js";import"./selection.758fed1b.js";import"./rtl.65b79c69.js";import"./use-panel.cd5af8ab.js";import"./touch.d8ab472d.js";import"./use-fullscreen.eedfb7ee.js";const ve=Q=>(ge("data-v-76d215d7"),Q=Q(),ye(),Q),De={key:0,class:"text-dark"},Me={key:1,class:"text-dark"},Ue={key:2,class:"text-dark"},Ve={key:3,class:"text-dark"},Pe={key:4,class:"text-dark"},Qe=ve(()=>R("br",null,null,-1)),Ae={key:5,class:"text-dark"},je=ve(()=>R("br",null,null,-1)),Le={key:2,class:"text-grey-6 text-right"},Oe={key:3,class:"text-grey-6 text-right"},Te={__name:"codeComponent",props:{phoneNumber:String,email:String,type:String,rid:String},emits:["verified"],setup(Q,{emit:k}){const D=Q,M=de(),q=me(),C=X(D,"phoneNumber"),a=X(D,"email"),t=X(D,"type"),o=p("code-confirmation"),y=p(Math.floor(1e5+Math.random()*9e5)),i=p(null),h=p(!1),n=p(!1),d=p(!1),f=p(0),c=X(D,"rid"),{value:S}=H("codeConfirmation",I().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:"Code Not Valid!"}).required().oneOf([y.value],"Code Not Valid!")),te=oe(()=>S.value===y.value),B=m=>{const r=Math.floor(m/6e4),v=(m%6e4/1e3).toFixed(0);return r+":"+(v<10?"0":"")+v};O(t,m=>{y.value=null,S.value=null,h.value=!1,y.value=null,i.value=null,o.value="code-confirmation"}),O(f,m=>{m===0?(h.value=!0,y.value=null,i.value=null):h.value=!1}),O(S,async m=>{Number(m)===y.value&&(M.notify({position:"top-right",type:"positive",message:"Code Verified!"}),t.value==="phone-number"?W():t.value==="email"&&F())});const N=async()=>{d.value=!0,o.value==="code-confirmation"?(y.value=Math.floor(1e5+Math.random()*9e5),S.value=null,i.value=L().add(5,"minute").toISOString(),t.value==="phone-number"?(await ce.createMessageQueue({to:C.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",message:`Your Brandsafway Verification Code is: ${y.value}`,extRef:null,massText:!1}),d.value=!1,M.notify({position:"top-right",type:"info",message:"Text message sent!"}),i.value=L().add(1,"minute")):t.value==="email"&&(await A(),d.value=!1,M.notify({position:"top-right",type:"info",message:"Email sent!"}),i.value=L().add(2,"minute")),d.value=!1,x(),o.value="code-sent"):d.value=!1},x=()=>{const m=setInterval(()=>{f.value=L(i.value).valueOf()-L().valueOf(),f.value<=0&&(f.value=0,clearInterval(m))},1e3)},A=async()=>{if(!c.value||c.value==="")return!1;const m=await P.isUserLoggedIn(),r=new Date;y.value||(y.value=Math.floor(1e5+Math.random()*9e5));const v={3:{value:c.value},26:{value:r},87:{value:r},88:{value:y.value},47:{value:!0}};try{return m?await P.updateUserData({fields:v}):await P.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[v],formatObject:76})}catch(j){M.notify({position:"top-right",type:"negative",message:j.message||"Error updating Verification!"})}},W=async()=>{if(n.value=!0,!c.value||c.value==="")return n.value=!1,!1;const m=new Date,r={3:{value:c.value},26:{value:m},50:{value:!0}};try{await P.updateUserData({fields:r}),n.value=!1,k("verified")}catch(v){n.value=!1,M.notify({position:"top-right",type:"negative",message:v.message||"Error updating Verification!"})}},F=async()=>{if(n.value=!0,!c.value||c.value==="")return n.value=!1,!1;const m=new Date,r={3:{value:c.value},26:{value:m},49:{value:!0}};try{await P.updateUserData({fields:r}),n.value=!1,k("verified")}catch(v){n.value=!1,M.notify({position:"top-right",type:"negative",message:v.message||"Error updating Verification!"})}},$=()=>C.value.replace(/(\d{3})(\d{3})(\d{4})/,"******$3"),K=()=>(q.userLoggedIn?q.user[34]:a.value||"").replace(/(.{2})(.*)(?=@)/,function(r,v,j){for(let z=0;z<j.length;z++)v+="*";return v});return O(()=>D.phoneNumber,()=>{console.log(D)}),(m,r)=>(l(),_("div",null,[b(U,{class:"text-center auth-description"},{default:g(()=>[o.value==="code-sent"&&e(t)==="phone-number"?(l(),_("p",De,"A text message with a verification code has been sent to your phone.")):u("",!0),o.value==="code-sent"&&e(t)==="email"?(l(),_("p",Me,"A verification code has been sent to your email. ")):u("",!0),o.value==="code-confirmation"&&e(t)==="phone-number"?(l(),_("p",Ue,"Your Phone Number needs to be verified click the button below to verify.")):u("",!0),o.value==="code-confirmation"&&e(t)==="email"?(l(),_("p",Ve,"Your Email needs to be verified click the button below to verify.")):u("",!0),o.value==="code-confirmation"&&e(t)==="phone-number"?(l(),_("p",Pe,[Qe,ee(T($()),1)])):u("",!0),o.value==="code-confirmation"&&e(t)==="email"?(l(),_("p",Ae,[je,ee(T(K()),1)])):u("",!0)]),_:1}),b(U,null,{default:g(()=>[b(ne,{class:"q-px-sm q-pt-sm",onSubmit:r[3]||(r[3]=re(()=>{},["prevent"])),onKeyup:se(N,["enter"])},{default:g(()=>[o.value==="code-sent"?(l(),E(ue,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",clearable:!n.value,outlined:"",disable:h.value,loading:n.value,modelValue:e(S),"onUpdate:modelValue":r[0]||(r[0]=v=>ae(S)?S.value=v:null),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:"Code",tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!e(te),"error-message":"Code does not match!"},{append:g(()=>[ee(T(B(f.value))+"\xA0 ",1)]),_:1},8,["clearable","disable","loading","modelValue","error"])):u("",!0),o.value==="code-confirmation"?(l(),E(ie,{key:1,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Send Code",tabindex:"1",loading:d.value,onClick:N},null,8,["loading"])):u("",!0),e(t)==="phone-number"&&e(a)!==""?(l(),_("p",Le,[R("a",{href:"javascript:void(0);",onClick:r[1]||(r[1]=v=>t.value="email")},"Use Email")])):u("",!0),e(t)==="email"&&e(C)!==""?(l(),_("p",Oe,[R("a",{href:"javascript:void(0);",onClick:r[2]||(r[2]=v=>t.value="phone-number")},"Use Phone Number")])):u("",!0),o.value==="code-sent"?(l(),E(U,{key:4,class:"q-py-none row justify-center"},{default:g(()=>[f.value===0?(l(),_("a",{key:0,onClick:N,class:"text-grey-6",href:"javascript:void(0);",tabindex:"2"},"Resend Code")):u("",!0)]),_:1})):u("",!0)]),_:1},8,["onKeyup"])]),_:1})]))}};var Be=le(Te,[["__scopeId","data-v-76d215d7"]]);const Fe={key:0,class:"col-md-7 col-lg-8 col-lx-8"},Ke={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ze={class:"text-dark"},Ye={key:0,class:"row q-col-gutter-xs"},Je={key:1,class:"row q-col-gutter-xs"},Xe={class:"text-grey-6"},Ge={class:"row justify-center"},He={__name:"updateInfo",setup(Q){const k=de(),D=me(),{currentUserType:M}=Se(),q=be(),C=_e(),{t:a}=Ce(),t=p(!1),o=p("update-information"),y=p(10),i=p(!1),h=p(!1),n=p(null),d=p(null),f=p(!1),c=p(!1),S=oe(()=>{const s=new RegExp("^[0-9]{"+y.value+"}","g");return h.value&&i.value?G({email:I().email(`${a("validEmailIsRequired")}`).required().label(`${a("email")}`),phoneNumber:I().matches(s,{excludeEmptyString:!0,message:`${a("validPhoneIsRequired")}`}).required().label(`${a("phoneNumber")}`)}):h.value&&!i.value?G({email:I().email(`${a("validEmailIsRequired")}`).required().label(`${a("email")}`),phoneNumber:I().matches(s,{excludeEmptyString:!0,message:`${a("validPhoneIsRequired")}`}).label(`${a("phoneNumber")}`)}):!h.value&&i.value?G({email:I().email(`${a("validEmailIsRequired")}`).label(`${a("email")}`),phoneNumber:I().matches(s,{excludeEmptyString:!0,message:`${a("validPhoneIsRequired")}`}).required().label(`${a("phoneNumber")}`)}):G({email:I().email(`${a("validEmailIsRequired")}`).required().label(`${a("email")}`),phoneNumber:I().matches(s,{excludeEmptyString:!0,message:`${a("validPhoneIsRequired")}`}).required().label(`${a("phoneNumber")}`)})}),{errors:te,meta:B}=ke({validationSchema:S,initialValues:{phoneNumber:"",email:""}}),{value:N}=H("userRID"),{value:x,errorMessage:A,setErrors:W,meta:F}=H("phoneNumber"),{value:$,errorMessage:K,setErrors:m,meta:r}=H("email");p(!0),q.query.rid?(N.value=q.query.rid,q.query.emailRequired&&(h.value=!0),q.query.phoneNumberRequired&&(i.value=!0),C.replace({query:{}})):C.push("/"),O(()=>q.query,()=>{q.query.rid&&(N.value=q.query.rid,q.query.emailRequired&&(h.value=!0),q.query.phoneNumberRequired&&(i.value=!0),C.replace({query:{}}))});const v=s=>{y.value=s},j=s=>{n.value=s},z=()=>{D.logout().then(()=>{C.replace({name:"login"})})},Z=async()=>{if(t.value=!0,!B.value.valid)return t.value=!1,!1;if(!N.value||N.value==="")return t.value=!0,!1;const s=new Date;let w={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1};if(i.value){if(d.value=await ce.twilioLookup({phoneNumber:x.value}),d.value&&(x.e164=d.value.phoneNumber,delete d.value.url,delete d.value.price,delete d.value.phoneNumber,delete d.value.addOns),d.value&&d.value.validPhoneNumber===!1)return W(`${a("validPhoneIsRequired")}`),k.notify({type:"negative",message:`${a("validPhoneIsRequired")}`,timeout:7e3,position:k.screen.lt.md?"top":"top-right"}),t.value=!1,null;w=Object.assign({phoneNumber:x.value},n.value,d.value||{})}if(h.value&&$.value===""&&d.value&&d.value.validPhoneNumber===!1)return m(`${a("validEmailIsRequired")}`),k.notify({type:"negative",message:`${a("validEmailIsRequired")}`,timeout:7e3,position:k.screen.lt.md?"top":"top-right"}),t.value=!1,null;const V={...i.value&&{8:{value:`+${n.value?n.value.dialCode:"1"}${x.value}`}},...i.value&&{9:{value:JSON.stringify(w)}},...i.value&&{111:{value:!1}},...h.value&&{6:{value:$.value}},...h.value&&{112:{value:!1}},26:{value:s}};try{await P.updateUserData({fields:V}),t.value=!1,C.push({path:"/",query:{rid:N.value,...i.value&&{phoneNumber:`+${n.value?n.value.dialCode:"1"}${x.value}`},...h.value&&{email:$.value}}})}catch(Y){c.value=!1,f.value=!1,Y.lineErrors&&Y.lineErrors.forEach(J=>{J.includes('is not unique for unique formula field with ID "27"')&&(c.value=!0),J.includes('The field named "uniqueEmail" with field id 27 requires a unique value.')&&(c.value=!0),J.includes('is not unique for unique formula field with ID "28"')&&(f.value=!0),J.includes('The field named "uniquePhoneNumber" with field id 28 requires a unique value.')&&(f.value=!0)}),f.value||c.value?o.value="code-confirmation":k.notify({position:"top-right",type:"negative",message:Y.message||"Error updating Information!"})}},pe=async()=>{try{const s=new Date,w={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1},V=[{...f.value&&{8:{value:""}},...f.value&&{9:{value:JSON.stringify(w)}},...f.value&&{50:{value:!1}},...f.value&&{111:{value:!0}},26:{value:s},...c.value&&{6:{value:""}},...c.value&&{49:{value:!1}},...c.value&&{112:{value:!0}}}];return await P.findAndUpdateUser({...f.value&&{phoneNumber:`+${n.value?n.value.dialCode:"1"}${x.value}`},...c.value&&{email:$.value},userType:M,fields:V})}catch(s){console.log(s)}},fe=async()=>{o.value="update-information",await pe(),await Z()};return(s,w)=>(l(),E($e,{class:"window-height window-width row"},{default:g(()=>[e(k).screen.lt.md?u("",!0):(l(),_("div",Fe,[b(Re)])),R("div",Ke,[b(Ne,{class:"auth-card",flat:""},{default:g(()=>[b(U,{style:{"padding-left":"30px","padding-right":"30px"}},{default:g(()=>[b(he,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),o.value==="update-information"?(l(),E(U,{key:0,class:"text-center auth-description"},{default:g(()=>[R("p",ze,T(s.$t("pleaseUpdateInformation")),1)]),_:1})):u("",!0),o.value==="update-information"?(l(),E(U,{key:1},{default:g(()=>[b(ne,{class:"q-px-sm q-pt-sm",onSubmit:w[2]||(w[2]=re(()=>{},["prevent"])),onKeyup:se(Z,["enter"])},{default:g(()=>[i.value?(l(),_("div",Ye,[b(Ee,{name:"phoneNumber",class:qe(["col-xs-12 col-sm-12",{"q-pb-lg":e(A)&&e(F).validated}]),outlined:"",modelValue:e(x),"onUpdate:modelValue":w[0]||(w[0]=V=>ae(x)?x.value=V:null),label:s.$t("phoneNumber"),tabindex:"3",onMaxLengthChanged:v,error:!!(e(A)&&e(F).validated),"error-message":e(A),onCountryChanged:j},null,8,["class","modelValue","label","error","error-message"])])):u("",!0),h.value?(l(),_("div",Je,[b(ue,{class:"col-xs-12 col-sm-12 q-pb-lg",clearable:"",outlined:"",modelValue:e($),"onUpdate:modelValue":w[1]||(w[1]=V=>ae($)?$.value=V:null),type:"email",autocomplete:"email",label:s.$t("email"),tabindex:"4",name:"email",error:!!(e(K)&&e(r).validated),"error-message":e(K)},{prepend:g(()=>[b(xe,{name:"email"})]),_:1},8,["modelValue","label","error","error-message"])])):u("",!0)]),_:1},8,["onKeyup"])]),_:1})):u("",!0),o.value==="code-confirmation"?(l(),E(Be,{key:2,onVerified:fe,phoneNumber:e(x),email:e($),type:i.value?"phone-number":"email",rid:e(N)},null,8,["phoneNumber","email","type","rid"])):u("",!0),o.value==="update-information"?(l(),E(we,{key:3,class:"q-px-lg"},{default:g(()=>[o.value==="update-information"?(l(),E(ie,{key:0,ref:"confirm",loading:t.value,disable:!e(B).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:s.$t("confirm"),tabindex:"3",onClick:Z},null,8,["loading","disable","label"])):u("",!0)]),_:1})):u("",!0),b(U,{class:"text-center q-pa-sm"},{default:g(()=>[R("p",Xe,[R("a",{onClick:z,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},T(s.$t("logout")),1)])]),_:1}),b(U,{class:"q-pl-lg q-pa-sm"},{default:g(()=>[R("div",Ge,[b(Ie,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var wa=le(He,[["__scopeId","data-v-711f1fb5"]]);export{wa as default};
