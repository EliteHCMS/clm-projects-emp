import{l as R,bL as B,c as w,_ as T,y as O,A as y,B as h,d as r,bi as u,F as _,aY as V,an as j,au as M,ab as D,bI as N,D as $,bO as S,bM as P,r as C,bN as U,w as J,aZ as q,cw as W,ao as Z,cx as x,cz as G}from"./index.9762efb3.js";import{Q as H}from"./QSelect.4c250828.js";import{u as L}from"./use-quasar.1a2013e3.js";import{u as K}from"./dataStore.f9b24e1e.js";import{I as X}from"./quickbase.0330480d.js";import{dayjs as v}from"./dayjs.b06c0c0b.js";import{Q as E,a as ee}from"./QTable.0077212c.js";import{Q as F}from"./QTr.d46e16b6.js";import{Q as I}from"./QTd.337029ba.js";import{Q as te}from"./QInnerLoading.9f020a3c.js";import{e as ae}from"./export-file.eb604dd4.js";import{_ as oe}from"./projectSelector.16b0eb4a.js";const re=R({props:{rows:Array},setup(t,s){const b=L(),g=B(),{capitalize:f}=O,p=w(()=>b.screen.gt.sm?[{name:1,label:"Name",align:"left",field:e=>e.employee[22],format:(e,c)=>`${a(c.employee)}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e.employee[378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e.employee[213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Arrival Date",align:"left",field:e=>e[63].$d,format:e=>`${v(e).format("MM/DD/YYYY")}`,sortable:!0}]:[{name:1,label:"Name",align:"left",field:e=>e.employee[22],format:(e,c)=>`${a(c.employee)}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e.employee[378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e.employee[213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Arrival Date",align:"left",field:e=>e[63].$d,format:e=>`${v(e).format("MM/DD/YYYY")}`,sortable:!0}]),a=e=>{const c=e[20]!==""?f(e[20].toLowerCase().trim()):"",d=e[22]!==""?f(e[22].toLowerCase().trim()):"",o=e[21]!==""?` ${f(e[21].toLowerCase().trim())}`:"",A=e[23]!==""?` ${f(e[23])}`:"";return`${d}${A}, ${c}${o}`};function n(e){g.push({name:"ee-summary",params:{id:e[18]}})}function m(e,c,d){let o=c!==void 0?c(e,d):e;return o=o==null?"":String(o),o=o.split('"').join('""'),`"${o}"`}function Y(){const e=[p.value.map(d=>m(d.label))].concat(t.rows.map(d=>p.value.map(o=>m(typeof o.field=="function"?o.field(d):d[o.field===void 0?o.name:o.field],o.format,d)).join(","))).join(`\r
`);ae(`${v().format("MM.DD.YYYY")} Employees-Export.csv`,e,"text/csv")!==!0&&b.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}return{columns:p,props:t,exportAllEmployees:Y,viewEmployee:n}}}),se={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},le={class:"text-dark text-caption text-italic"};function ne(t,s,b,g,f,p){return y(),h("div",null,[r(ee,{title:"Active Roster","title-class":"text-h5 text-primary",columns:t.columns,rows:t.props.rows,"row-key":a=>a[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no employees in the roster",dense:""},{header:u(a=>[r(F,{class:"bg-dark text-white",props:a},{default:u(()=>[r(E,{"auto-width":""}),(y(!0),h(_,null,V(a.cols,n=>(y(),j(E,{key:n.name,props:a},{default:u(()=>[M(D(n.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:u(a=>[r(F,{props:a},{default:u(()=>[r(I,{"auto-width":""},{default:u(()=>[r(N,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:n=>t.viewEmployee(a.row),name:a.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(y(!0),h(_,null,V(a.cols,n=>(y(),j(I,{key:n.name,props:a},{default:u(()=>[M(D(n.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":u(({message:a})=>[$("div",se,[r(N,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),$("span",null,D(a),1)])]),"top-right":u(()=>[$("div",le,"(Total: "+D(t.props.rows.length)+" employees)",1),r(S,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:s[0]||(s[0]=a=>t.$emit("refreshData"))}),r(S,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllEmployees,disable:t.props.rows.length<1},null,8,["dense","onClick","disable"])]),loading:u(()=>[r(te,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])}var ie=T(re,[["render",ne]]);const me=R({props:{},components:{RosterTable:ie,projectSelector:oe},setup(t){const s=L(),b=P(),g=X(),f=C(null),p=C(""),a=C(null),n=C(null),{getSelectedProject:m}=U(g),{getAssignments:Y,fetchAllAssignments:e,fetchAssignments:c}=K(),d=w(()=>b.params.id?b.params.id:m.value?m.value[3]:null),o=w(()=>Y(d.value).sort((i,Q)=>i[1].$d<Q[1].$d?1:-1).filter(i=>!i[112]&&i.latest&&i[102]==="Active")),A=w(()=>{let l=[];return o.value.forEach(i=>{i[75].toLowerCase().includes(p.value.toLowerCase())&&l.push(i)}),l=a.value?l.filter(i=>v(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===v(a.value).tz("America/Chicago").format("MM/DD/YYYY")):l,l=n.value?l.filter(i=>i[68]===n.value):l,l.sort((i,Q)=>i.employee[22]>Q.employee[22]?1:-1)}),z=w(()=>[...new Map(o.value.map(l=>[l[68],l[68]])).values()]);async function k(l){s.loading.show(),f.value?await c({projectId:d.value,refresh:l}):await e({refresh:l}),s.loading.hide()}return J(f,()=>{k(!1)}),k(!1),{allAssignments:o,projectFilter:f,search:p,startDateFilter:a,craftFilter:n,craftOptions:z,rows:A,loadData:k}}}),de={class:"row items-center"},ue={key:0,class:"col-12 col-md-3"},ce={class:"col-12 col-md-3 q-px-sm"},fe={class:"col-12 col-md-3 q-px-sm"},pe={class:"col-12 col-md-3 q-px-sm"};function be(t,s,b,g,f,p){const a=q("projectSelector"),n=q("roster-table");return y(),h("div",null,[r(G,{flat:""},{default:u(()=>[r(W,null,{default:u(()=>[$("div",de,[t.$route.params.id?Z("",!0):(y(),h("div",ue,[r(a,{dense:""})])),$("div",ce,[r(x,{dense:"",modelValue:t.search,"onUpdate:modelValue":s[0]||(s[0]=m=>t.search=m),label:"Search"},null,8,["modelValue"])]),$("div",fe,[r(x,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":s[1]||(s[1]=m=>t.startDateFilter=m),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),$("div",pe,[r(H,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":s[2]||(s[2]=m=>t.craftFilter=m),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),r(n,{rows:t.rows,onRefreshData:s[3]||(s[3]=m=>t.loadData(!0))},null,8,["rows"])])}var _e=T(me,[["render",be]]);export{_e as E,ie as R};
