import{k as g,r as h,i as k,f as v,l as d}from"./index.38f8dfd6.js";import{o as w,z as q,a as p,q as t}from"./quickbase.903e372a.js";import"./_commonjsHelpers.dfee5925.js";import"./dayjs.de2acfea.js";import"./localForage.b7ae1ca9.js";import"./index.7dbe61ef.js";import"./i18n.e703f900.js";import"./api.bd3e7620.js";function I(e){if(e.hasOwnProperty("possibleRulesFor"))return e;var a=h(!0);e.on("updated",function(){a.value=!a.value});var i=e.possibleRulesFor.bind(e);return e.possibleRulesFor=function(o,r){return a.value=a.value,i(o,r)},e.can=e.can.bind(e),e.cannot=e.cannot.bind(e),e}var m=Symbol("ability");function S(){var e=k(m);if(!e)throw new Error("Cannot inject Ability instance because it was not provided");return e}function P(e){return"a"in e?"a":"this"in e?"this":"an"in e?"an":""}g({name:"Can",props:{I:String,do:String,a:[String,Function],an:[String,Function],this:[String,Function,Object],on:[String,Function,Object],not:Boolean,passThrough:Boolean,field:String},setup:function(a,i){var o=i.slots,r=a,n="do",u="on";if(n in a||(n="I",u=P(a)),!r[n])throw new Error("Neither `I` nor `do` prop was passed in <Can>");if(!o.default)throw new Error("Expects to receive default slot");var c=S();return function(){var f=c.can(r[n],r[u],r.field),s=a.not?!f:f;return a.passThrough?o.default({allowed:s,ability:c}):s?o.default():null}}});function C(e,a,i){if(!a||!(a instanceof w))throw new Error("Please provide an Ability instance to abilitiesPlugin plugin");e.provide(m,I(a)),i&&i.useGlobalProperties&&(e.config.globalProperties.$ability=a,e.config.globalProperties.$can=a.can.bind(a))}const R=e=>e.matched.some(a=>p.can(a.meta.action||"read",a.meta.resource));var U=v(({app:e,router:a})=>{e.config.globalProperties.$subject=q,e.use(C,p,{useGlobalProperties:!0}),a.beforeEach(async(i,o,r)=>{const n=await t.isUserLoggedIn(),u=Object.assign({},i.query);if(n||t.logout(),u.office_id&&(t.setOfficeLocation({rid:u.office_id}),u.qr&&t.setCheckIn(!0)),o.fullPath==="/"&&!o.name&&(n?await t.reloadUserInfo({reAuthenticate:!0}):d.pageType==="Candidate Kiosk"&&await t.updateStore()),!R(i)){const l=i.path!=="/";return!n&&d.pageType==="Candidate Kiosk"&&d.startPage?r({name:"start"}):r(n?{name:"not-authorized"}:{name:"login",query:{...l&&{redirect:i.path}}})}if(d.pageType==="Candidate Kiosk"&&i.name!=="bookmarks"&&i.name!=="start"){const l=await t.bookmarksValid(),b=await t.bookMarksOnly();if(l&&b)return r({name:"bookmarks"})}if(i.name==="bookmarks"&&!await t.bookmarksValid())return t.clearBookmarks(),r("/");if(i.meta.redirectIfLoggedIn&&n)return r("/");const c=await t.verifyRequired(n),f=await t.employeeLinkRequired(n),s=await t.getUserFromStore(n),y=await t.getSocialRequired(n);if(c)return o.name==="code-confirmation"&&n&&i.query.code?(await t.setVerified(!0),r({path:"/"})):i.name!=="code-confirmation"?r({name:"code-confirmation",query:{p:s[9]?s[9].phoneNumber:s[8].replace(/[^0-9]/g,""),rid:s[3]}}):r();if(f||y)return o.name==="verify-identity"&&n&&i.query.verify?(i.query.rid?await t.setIdentityVerified(i.query.rid):await t.setIdentityVerified(!1),r({path:"/",query:{}})):i.name!=="verify-identity"?r({name:"verify-identity",query:{rid:s[3]}}):r();if(i.name==="verify-identity"){if(!f)return r({path:"/"})}else if(i.name==="code-confirmation")return!n&&i.query.ac?r():r({path:"/"});return r()}),a.afterEach(async(i,o)=>{const r=await t.isUserLoggedIn();o.fullPath==="/"&&!o.name&&r&&await t.updateStore({reAuthenticate:!1})})});export{U as default};
