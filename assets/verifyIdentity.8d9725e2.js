import{Q as z}from"./QImg.6786d215.js";import{_ as H,c5 as G,c4 as J,r as x,c as K,w as W,z as v,am as b,bh as o,A as Z,d as r,an as w,C as u,c2 as g,aa as N,bE as ee,cB as $,a6 as l,b as E,bX as I,cC as te,c6 as ae,c3 as se}from"./index.9ababbc3.js";import{Q as re}from"./QForm.ee06b7d2.js";import{Q as oe}from"./QPage.80c10dab.js";import{a as le,e as ie,c as M,d as ne,b as ue,u as U}from"./array.0d1aaa22.js";import{u as ce}from"./i18n.b874c408.js";import{u as de,e as me,c as pe,q as n}from"./quickbase.0b7939ef.js";import{_ as fe}from"./languageSelector.76a7f748.js";import{c as ve}from"./carousel.88da947e.js";import"./_commonjsHelpers.dfee5925.js";import"./dayjs.0e9acdcb.js";import"./localForage.bd392413.js";import"./index.7dbe61ef.js";import"./api.51016025.js";import"./QSelect.51eca79e.js";import"./QMenu.85d9648b.js";import"./position-engine.af50392f.js";import"./selection.c128e84c.js";import"./rtl.65b79c69.js";import"./use-quasar.862199cc.js";import"./use-panel.22c867bb.js";import"./touch.d8ab472d.js";import"./use-fullscreen.3152eb6e.js";const ge={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ye={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},he={class:"text-dark"},be={class:"row"},we={class:"row"},_e={class:"text-grey-6"},qe={class:"row justify-center"},xe={__name:"verifyIdentity",setup(Ie){const t=de(),{employeeData:C,socialRequired:k,updateEmployeeData:Q,setEmployee:V}=me(),L=pe(),d=G(),m=J(),{t:D}=ce(),y=x(!1),_=x("confirm-identity"),j=K(()=>le({userRID:ie().required(),ssn:M().required().matches(/^[0-9]{9}/g,{excludeEmptyString:!0,message:`${D("nineDigitsRequired")}`}).nullable(),ssnConfirmation:M().oneOf([ne("ssn"),null],`${D("socialSecurityNumberMustMatch")}`).required().nullable()})),{errors:Ue,meta:B}=ue({validationSchema:j,initialValues:{ssn:"",ssnConfirmation:""}}),{value:p}=U("userRID"),{value:i,errorMessage:R,meta:A}=U("ssn"),{value:f,errorMessage:S,meta:O}=U("ssnConfirmation"),h=x(!0);d.query.rid?(p.value=d.query.rid,i.value="",f.value="",m.replace({query:{}})):m.push("/"),W(()=>d.query,()=>{d.query.rid&&(p.value=d.query.rid,i.value="",f.value="",m.replace({query:{}}))});const X=async()=>{const e=n.getOfficeLocation(),a=[{20:{value:t.getUser[35]},22:{value:t.getUser[37]},109:{value:i.value},25:{value:t.getUser[9]?t.getUser[9].phoneNumber:t.getUser[8].replace(/[^0-9]/g,"")},28:{value:t.getUser[50]?"Yes":"No"},26:{value:t.getUser[6]},34:{value:t.getUser[49]?"Yes":"No"},16:{value:e?e.rid:""}}],{data:s}=await n.upsertRecordsXML({to:"bp3gb7ng2",fieldsToReturn:[500],data:a,formatObject:500}),c=s[0][500];return t.userLoggedIn&&V(c,!0),c[3]},q=async e=>{const a=n.getOfficeLocation(),s={3:{value:e},20:{value:t.getUser[35]},22:{value:t.getUser[37]},109:{value:i.value},25:{value:t.getUser[9]?t.getUser[9].phoneNumber:t.getUser[8].replace(/[^0-9]/g,"")},28:{value:t.getUser[50]?"Yes":"No"},26:{value:t.getUser[6]},34:{value:t.getUser[49]?"Yes":"No"},...a&&{16:{value:a.rid}}};return(await Q({fields:s}))[3]},F=async e=>{const a=[{3:{value:t.getUser[86]},16:{value:e}}],{data:s}=await n.upsertRecordsXML({to:"br26nivmr",fieldsToReturn:[76],data:a,formatObject:76});return n.setCheckInData(s[0][76]),s[3]},Y=async()=>{const a=[{8:{value:`{'188'.EX.'${i.value}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:s}=await n.fetchFromHiringApp({fields:a});return s[0]?s[0][3]:null},P=async()=>{if(!p.value||p.value==="")return!1;y.value=!0;let e=await Y();const a=new Date,s={3:{value:Number(p.value)},26:{value:a}};k&&e?(await n.softDeleteEmployee(C[3]),await q(e)):k&&!e?e=await q(C[3]):e?await q(e):e||(e=await X()),L.checkedIn&&F(e),s[80]={value:e},s[85]={value:!1};try{await n.updateUserData({fields:s}),y.value=!1,m.push({path:"/",query:{verify:!0,...e&&{rid:e}}})}catch(c){y.value=!1,console.log(c)}},T=()=>{t.logout().then(()=>{m.replace({name:"login"})})};return(e,a)=>(v(),b(oe,{class:"window-height window-width row"},{default:o(()=>[e.$q.screen.lt.md?w("",!0):(v(),Z("div",ge,[r(ve)])),u("div",ye,[r(se,{class:"auth-card",flat:""},{default:o(()=>[r(g,{style:{"padding-left":"30px","padding-right":"30px"}},{default:o(()=>[r(z,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),r(g,{class:"text-center auth-description"},{default:o(()=>[u("p",he,N(e.$t("pleaseVerifyInfoToCompleteRegistration")),1)]),_:1}),r(g,null,{default:o(()=>[r(re,{class:"q-px-sm q-pt-sm",onSubmit:a[3]||(a[3]=ee(()=>{},["prevent"]))},{default:o(()=>[u("div",be,[_.value==="confirm-identity"?(v(),b($,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:l(i),"onUpdate:modelValue":a[0]||(a[0]=s=>E(i)?i.value=s:null),maxlength:"9",minlength:"9",type:"password",label:e.$t("socialSecurityNumber"),tabindex:"1",error:!!(l(R)&&l(A).validated),"error-message":l(R)},{prepend:o(()=>[r(I,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):w("",!0)]),u("div",we,[_.value==="confirm-identity"?(v(),b($,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:l(f),"onUpdate:modelValue":a[2]||(a[2]=s=>E(f)?f.value=s:null),maxlength:"9",minlength:"9",type:h.value?"password":"text",label:e.$t("confirmSSN"),tabindex:"2",error:!!(l(S)&&l(O).validated),"error-message":l(S)},{prepend:o(()=>[r(I,{name:"lock"})]),append:o(()=>[r(I,{name:h.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:a[1]||(a[1]=s=>h.value=!h.value)},null,8,["name"])]),_:1},8,["modelValue","type","label","error","error-message"])):w("",!0)])]),_:1})]),_:1}),r(te,{class:"q-px-lg"},{default:o(()=>[_.value==="confirm-identity"?(v(),b(ae,{key:0,loading:y.value,disable:!l(B).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:e.$t("confirm"),tabindex:"3",onClick:P},null,8,["loading","disable","label"])):w("",!0)]),_:1}),r(g,{class:"text-center q-pa-sm"},{default:o(()=>[u("p",_e,[u("a",{onClick:T,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},N(e.$t("logout")),1)])]),_:1}),r(g,{class:"q-pl-lg q-pa-sm"},{default:o(()=>[u("div",qe,[r(fe,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var Ge=H(xe,[["__scopeId","data-v-4fc3a8d3"]]);export{Ge as default};
