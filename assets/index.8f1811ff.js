import{Q as L,b as M,a as me}from"./QTabPanels.c6a0ab04.js";import{Q as fe}from"./QTabs.dae2502b.js";import{Q as ve}from"./QToolbar.85ee1da8.js";import{Q as be}from"./QPage.f2628afe.js";import{E as we}from"./roster.4db33adf.js";import{l as H,bM as G,r as D,bN as J,c as b,_ as B,aZ as A,A as h,B as Q,d as a,bi as i,cw as x,D as d,ao as U,cx as N,cz as W,bL as ge,w as $e,F as oe,aY as se,an as O,au as X,ab as Y,bI as le,bO as re,y as he}from"./index.b48bafa3.js";import{Q as ye}from"./QSelect.b8f07e1a.js";import{u as Z}from"./use-quasar.ed3977b0.js";import{u as K}from"./dataStore.708e0494.js";import{I as ee,q as ce}from"./quickbase.76c41fac.js";import{u as te}from"./dataStore.beef04c5.js";import{dayjs as C}from"./dayjs.1b825f16.js";import{u as ue}from"./useQuerySaver.b8f46e72.js";import{R as _e}from"./rosterTable.2fdc0062.js";import{_ as ae}from"./projectSelector.e9985509.js";import{Q as ne,a as De}from"./QTable.a5b8e509.js";import{Q as ie}from"./QTr.a2300b34.js";import{Q as de}from"./QTd.cb00d1da.js";import{Q as je}from"./QInnerLoading.7b168168.js";import{e as Ve}from"./export-file.eb604dd4.js";import{g as Pe}from"./quickbaseDataHelpers.965058c7.js";import{P as Ae}from"./projectPipeline.73bb50f7.js";import"./use-panel.96b32d19.js";import"./touch.60582172.js";import"./selection.880c234f.js";import"./QResizeObserver.1d221316.js";import"./rtl.cf9bbe47.js";import"./QChip.a60f92f6.js";import"./QItemLabel.6755a8b9.js";import"./QMenu.c9ecf4aa.js";import"./position-engine.859102af.js";import"./localForage.81a16957.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./i18n.469ad19f.js";import"./api.004b0e8a.js";import"./arrivalDate.cceb9cd2.js";import"./QTooltip.b1ab7884.js";import"./QForm.fc9a358b.js";import"./vee-validate.esm.caf1489b.js";import"./array.b59bb1b2.js";import"./QList.fb685d10.js";import"./QMarkupTable.971575d1.js";import"./use-fullscreen.0ef5a5d5.js";const Se=H({props:{},components:{RosterTable:_e,projectSelector:ae},setup(t){const o=Z(),j=G(),f=ee(),w=D(null),y=D(""),v=D(null),l=D(null),{getSelectedProject:n}=J(f),{getAssignments:S,fetchAllAssignments:_,fetchAssignments:F}=K(),{getManpowerData:R,setRosters:T}=te(),u=b(()=>j.params.id?j.params.id:null),V=b(()=>n.value?n.value[3]:null),g=b(()=>{let r;const p=C().subtract(14,"day");return u.value?r=(R({dataset:"rosters",id:u.value})||[]).sort((m,z)=>m[1].$d<z[1].$d?1:-1):r=S(V.value).sort((s,m)=>s[1].$d<m[1].$d?1:-1),r.filter(s=>!s[112]&&s.latest&&s[102]==="Active"&&C(s[1].$d).isSameOrAfter(p)&&C(s[1].$d).isSameOrBefore(C()))}),q=b(()=>{let r=[];return g.value.forEach(p=>{p[75].toLowerCase().includes(y.value.toLowerCase())&&r.push(p)}),r=v.value?r.filter(p=>C(p[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===C(v.value).tz("America/Chicago").format("MM/DD/YYYY")):r,r=l.value?r.filter(p=>p[68]===l.value):r,r.sort((p,s)=>p.employee[22]>s.employee[22]?1:-1)}),k=b(()=>[...new Map(g.value.map(r=>[r[68],r[68]])).values()]),I=async r=>{o.loading.show(),u.value?(r||!R({dataset:"rosters",id:u.value}))&&await E():w.value?await F({projectId:V.value,refresh:r}):await _({refresh:r}),o.loading.hide()},E=async()=>{const r=`{'74'.EX.'${u.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:p}=await ce.fetchFromProjectsApp({fields:[ue({type:"assignments",query:r})]});T({id:u.value,data:p})};return{allAssignments:g,projectFilter:w,search:y,startDateFilter:v,craftFilter:l,craftOptions:k,rows:q,loadData:I}}}),Ce={class:"row items-center"},Qe={key:0,class:"col-12 col-md-3"},Re={class:"col-12 col-md-3 q-px-sm"},qe={class:"col-12 col-md-3 q-px-sm"},ke={class:"col-12 col-md-3 q-px-sm"};function Fe(t,o,j,f,w,y){const v=A("projectSelector"),l=A("roster-table");return h(),Q("div",null,[a(W,{flat:""},{default:i(()=>[a(x,null,{default:i(()=>[d("div",Ce,[t.$route.params.id?U("",!0):(h(),Q("div",Qe,[a(v,{dense:""})])),d("div",Re,[a(N,{dense:"",modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),label:"Search"},null,8,["modelValue"])]),d("div",qe,[a(N,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=n=>t.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),d("div",ke,[a(ye,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=n=>t.craftFilter=n),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(l,{rows:t.rows,onRefresh:o[3]||(o[3]=n=>t.loadData(!0))},null,8,["rows"])])}var Te=B(Se,[["render",Fe]]);const Ie=H({props:{},components:{projectSelector:ae},setup(t){const o=Z(),j=ge(),f=G(),{capitalize:w}=he,y=ee(),v=D(null),l=D(""),n=D(null),S=D(null),{getSelectedProject:_}=J(y),{getReleases:F,fetchReleases:R,fetchAllReleases:T}=K(),{getManpowerData:u,setDepartures:V}=te(),g=b(()=>f.params.id?f.params.id:null),q=b(()=>_.value?_.value[3]:null),k=[{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${I(e)}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Depature Date",align:"left",field:e=>e[36].$d,format:e=>`${C(e).format("MM/DD/YYYY")}`,sortable:!0}],I=e=>{const P=e.split(" ");let $="";return P.forEach((c,pe)=>{$+=pe>0?` ${w(c.toLowerCase())}`:w(c.toLowerCase())}),$};function E(e){j.push({name:"view-release",params:{release:e[3]}})}function r(e,P,$){let c=P!==void 0?P(e,$):e;return c=c==null?"":String(c),c=c.split('"').join('""'),`"${c}"`}function p(){const e=[k.value.map($=>r($.label))].concat(s.value.map($=>k.value.map(c=>r(typeof c.field=="function"?c.field($):$[c.field===void 0?c.name:c.field],c.format,$)).join(","))).join(`\r
`);Ve(`${C().format("MM.DD.YYYY")} Releases-Export.csv`,e,"text/csv")!==!0&&o.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const s=b(()=>{let e;return g.value?e=u({dataset:"departures",id:g.value})||[]:e=F(q.value).sort((P,$)=>P[1].$d<$[1].$d?1:-1),e}),m=async e=>{o.loading.show(),g.value?(e||!u({dataset:"departures",id:g.value}))&&await z():v.value?await R({projectId:q.value}):await T(),o.loading.hide()},z=async()=>{const e=`{'41'.EX.'${g.value}'}AND{'42'.XEX.'Complete'}AND({'36'.OAF.'today'}OR{'36'.IR.'last 30 d'}OR{'1'.IR.'last 30 d'})`,{data:P}=await ce.fetchFromHiringApp({fields:[ue({type:"releases",query:e})]});V({id:g.value,data:P})};return $e(_,()=>{m()}),m(),{projectFilterValue:q,search:l,dateFilter:n,craftFilter:S,loadData:m,getReleases:F,columns:k,viewRelease:E,exportAllReleases:p,rows:s}}}),Ee={class:"row items-center"},Ye={key:0,class:"col-12 col-md-3"},Ne={class:"col-12 col-md-3 q-px-sm"},Le={class:"col-12 col-md-3 q-px-sm"},Me=d("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),xe={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Oe={class:"text-dark text-caption text-italic"};function Be(t,o,j,f,w,y){const v=A("projectSelector");return h(),Q("div",null,[a(W,{flat:""},{default:i(()=>[a(x,null,{default:i(()=>[d("div",Ee,[t.$route.params.id?U("",!0):(h(),Q("div",Ye,[a(v,{dense:""})])),d("div",Ne,[a(N,{dense:"",modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=l=>t.search=l),label:"Search"},null,8,["modelValue"])]),d("div",Le,[a(N,{dense:"",modelValue:t.dateFilter,"onUpdate:modelValue":o[1]||(o[1]=l=>t.dateFilter=l),label:"Departure Date",type:"date","stack-label":""},null,8,["modelValue"])]),Me])]),_:1})]),_:1}),d("div",null,[a(De,{title:"Recent Departures","title-class":"text-h5 text-primary",columns:t.columns,rows:t.rows,"row-key":l=>l[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent departures",dense:""},{header:i(l=>[a(ie,{class:"bg-dark text-white",props:l},{default:i(()=>[a(ne,{"auto-width":""}),(h(!0),Q(oe,null,se(l.cols,n=>(h(),O(ne,{key:n.name,props:l},{default:i(()=>[X(Y(n.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:i(l=>[a(ie,{props:l},{default:i(()=>[a(de,{"auto-width":""},{default:i(()=>[a(le,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:n=>t.viewRelease(l.row),name:l.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(h(!0),Q(oe,null,se(l.cols,n=>(h(),O(de,{key:n.name,props:l},{default:i(()=>[X(Y(n.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":i(({message:l})=>[d("div",xe,[a(le,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),d("span",null,Y(l),1)])]),"top-right":i(()=>[d("div",Oe,"(Total: "+Y(t.getReleases(t.projectFilterValue).length)+" departures)",1),a(re,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[2]||(o[2]=l=>t.loadData(!0))}),a(re,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllReleases,disable:t.getReleases(t.projectFilterValue).length<1},null,8,["dense","onClick","disable"])]),loading:i(()=>[a(je,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Ue=B(Ie,[["render",Be]]);const ze={name:"Pipeline",components:{ProjectPipelineTable:Ae,projectSelector:ae},setup(){const t=Z(),o=G(),j=ee(),f=D(null),w=D(""),{getSelectedProject:y}=J(j),{fetchAllDeployments:v,fetchAllInProcess:l,fetchAllPending:n,getDeployments:S,getInProcess:_,getPending:F}=K(),{getManpowerData:R,setPipelines:T}=te(),u=b(()=>o.params.id?o.params.id:null),V=b(()=>y.value?y.value[3]:null),g=b(()=>S(V.value).filter(s=>s[20]==="Complete")),q=b(()=>{const s=[];return S(V.value).forEach(m=>{m[31].toLowerCase().includes(w.value.toLowerCase())&&s.push(m)}),s}),k=b(()=>{const s=[];return F(V.value).forEach(m=>{m[25].toLowerCase().includes(w.value.toLowerCase())&&s.push(m)}),s}),I=b(()=>{const s=[];return _(V.value).forEach(m=>{m[39].toLowerCase().includes(w.value.toLowerCase())&&s.push(m)}),s}),E=b(()=>{let s;return u.value?s=R({dataset:"pipelines",id:u.value})||[]:s=I.value.concat(k.value.concat(q.value)),s}),r=async s=>{t.loading.show(),u.value?(s||!R({dataset:"pipelines",id:u.value}))&&await p():(await v(s),await l(s),await n(s)),t.loading.hide()},p=async()=>{const s=await Pe(u.value);T({id:u.value,data:s})};return r(),{projectFilter:f,arrived:g,allPipeline:E,search:w,loadData:r}}},Xe={class:"text-h5 text-dark"},He={class:"text-body2 text-italic q-ml-sm"},Ge=d("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Je={class:"row items-center"},We={key:0,class:"col-12 col-md-3 q-px-sm"},Ze={class:"col-12 col-md-3 q-px-sm"};function Ke(t,o,j,f,w,y){const v=A("projectSelector"),l=A("project-pipeline-table");return h(),Q("div",null,[a(W,{flat:""},{default:i(()=>[a(x,{class:"q-pb-none"},{default:i(()=>[d("div",Xe,[X(" Staffing Pipeline "),d("span",He,"("+Y(f.allPipeline.length)+" total)",1)]),Ge]),_:1}),a(x,null,{default:i(()=>[d("div",Je,[t.$route.params.id?U("",!0):(h(),Q("div",We,[a(v,{dense:""})])),d("div",Ze,[a(N,{dense:"",modelValue:f.search,"onUpdate:modelValue":o[0]||(o[0]=n=>f.search=n),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(l,{rows:f.allPipeline,onRefresh:o[1]||(o[1]=n=>f.loadData(!0))},null,8,["rows"])])}var et=B(ze,[["render",Ke]]);const tt=H({name:"Employees",components:{RosterTab:we,NewArrivalsTab:Te,ReleasesTab:Ue,PipelineTab:et},setup(){return{tab:D(0)}}}),at={class:"q-pa-md"};function ot(t,o,j,f,w,y){const v=A("roster-tab"),l=A("new-arrivals-tab"),n=A("pipeline-tab"),S=A("releases-tab");return h(),O(be,{style:{"max-width":"100vw"}},{default:i(()=>[d("div",at,[a(ve,{class:"bg-info text-white shadow-2 rounded-borders"},{default:i(()=>[a(fe,{modelValue:t.tab,"onUpdate:modelValue":o[0]||(o[0]=_=>t.tab=_),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:i(()=>[a(L,{name:0,label:t.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),a(L,{name:1,label:"New Arrivals"}),t.$route.name==="project-manpower"?(h(),O(L,{key:0,name:3,label:"Pipeline"})):U("",!0),a(L,{name:2,label:"Departures"})]),_:1},8,["modelValue"])]),_:1}),a(me,{modelValue:t.tab,"onUpdate:modelValue":o[1]||(o[1]=_=>t.tab=_),animated:""},{default:i(()=>[a(M,{name:0},{default:i(()=>[a(v)]),_:1}),a(M,{name:1},{default:i(()=>[a(l)]),_:1}),a(M,{name:3},{default:i(()=>[a(n)]),_:1}),a(M,{name:2},{default:i(()=>[a(S)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var Ht=B(tt,[["render",ot]]);export{Ht as default};
