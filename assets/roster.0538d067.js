import{l as M,bU as Q,r as g,bV as k,c,w as I,_ as N,b5 as $,A as b,B as y,d as r,br as S,cF as B,D as f,ar as P,cG as C,cE as U}from"./index.e8fb2253.js";import{a as X}from"./QSelect.c4b0a406.js";import{u as z}from"./use-quasar.0aa2fc3d.js";import{u as G}from"./dataStore.4cb31a18.js";import{u as H}from"./dataStore.0af02e2e.js";import{I as L,q as O}from"./app.00bf1e10.js";import{dayjs as _}from"./dayjs.d1250a8a.js";import{u as T}from"./useQuerySaver.d29ff9ee.js";import{R as J}from"./rosterTable.2f202c41.js";import{_ as K}from"./projectSelector.e66d4c95.js";const W=M({props:{},components:{RosterTable:J,projectSelector:K},setup(a){const o=z(),v=Q(),h=L(),w=g(""),u=g(null),n=g(null),{getSelectedProject:d}=k(h),{getAssignments:s,fetchAllAssignments:j,fetchAssignments:F}=G(),{getManpowerData:A,setRosters:R}=H(),l=c(()=>v.params.id?v.params.id:null),m=c(()=>d.value?d.value[3]:null),p=c(()=>{let e;return l.value?e=(A({dataset:"rosters",id:l.value})||[]).sort((i,q)=>i[1].$d<q[1].$d?1:-1):e=s(m.value).sort((t,i)=>t[1].$d<i[1].$d?1:-1),e.filter(t=>!t[112]&&t.latest&&t[102]==="Active")}),V=c(()=>{let e=[];return p.value.forEach(t=>{t[75].toLowerCase().includes(w.value.toLowerCase())&&e.push(t)}),e=u.value?e.filter(t=>_(t[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===_(u.value).tz("America/Chicago").format("MM/DD/YYYY")):e,e=n.value?e.filter(t=>t[68]===n.value):e,e.sort((t,i)=>t.employee[22]>i.employee[22]?1:-1)});console.log(p.value),console.log(V.value);const E=c(()=>[...new Map(p.value.map(e=>[e[68],e[68]])).values()]),D=async e=>{o.loading.show(),l.value?(e||!A({dataset:"rosters",id:l.value}))&&await Y():m.value?await F({projectId:m.value,refresh:e}):await j({refresh:e}),o.loading.hide()},Y=async()=>{const e=`{'74'.EX.'${l.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:t}=await O.fetchFromHiringApp({fields:[T({type:"assignments",query:e})]});R({id:l.value,data:t})};return I(m,()=>{D()}),D(),{allAssignments:p,search:w,startDateFilter:u,craftFilter:n,craftOptions:E,rows:V,loadData:D}}}),Z={class:"row items-center"},x={key:0,class:"col-12 col-md-3"},ee={class:"col-12 col-md-3 q-px-sm"},te={class:"col-12 col-md-3 q-px-sm"},ae={class:"col-12 col-md-3 q-px-sm"};function oe(a,o,v,h,w,u){const n=$("projectSelector"),d=$("roster-table");return b(),y("div",null,[r(U,{flat:""},{default:S(()=>[r(B,null,{default:S(()=>[f("div",Z,[a.$route.params.id?P("",!0):(b(),y("div",x,[r(n,{dense:""})])),f("div",ee,[r(C,{dense:"",modelValue:a.search,"onUpdate:modelValue":o[0]||(o[0]=s=>a.search=s),label:"Search"},null,8,["modelValue"])]),f("div",te,[r(C,{dense:"",modelValue:a.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=s=>a.startDateFilter=s),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),f("div",ae,[r(X,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=s=>a.craftFilter=s),options:a.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),r(d,{rows:a.rows,onRefreshData:o[3]||(o[3]=s=>a.loadData(!0)),title:"Active Roster"},null,8,["rows"])])}var fe=N(W,[["render",oe]]);export{fe as E};
