import{l as Le,r as f,bU as Ve,bT as ge,bV as Pe,c as g,w as R,_ as Ye,A as h,B as U,d as l,br as n,cS as se,cT as ne,D as s,ac as S,bR as Y,bP as I,ax as M,cU as oe,bW as z,F as ve,b4 as Me,bS as fe,ar as he,dA as u,cV as _e,bO as He,aq as be}from"./index.a8594182.js";import{Q as We}from"./QPage.ea1eb714.js";import{u as qe}from"./use-quasar.150e9d23.js";import{u as O}from"./useQuerySaver.d29ff9ee.js";import{c as Xe,q as A}from"./app.0d6b5a44.js";import{u as we}from"./dataStore.7f5d81df.js";import{a as _,Q as Ke}from"./QSelect.61afed81.js";import{Q as ze}from"./QFile.1a0c4a2a.js";import{Q as Ge}from"./QList.40f773a0.js";import{Q as Je}from"./QForm.fc4076cc.js";import{a as Ze,u as v}from"./vee-validate.esm.04690319.js";import{a as G,b as ye,c as le,e as J}from"./array.59f93f43.js";import{dayjs as H}from"./dayjs.3e9de836.js";import{b as xe}from"./submitRelease.c88a3226.js";import{b as et,a as tt}from"./helpers.e8cd56d5.js";import{u as at}from"./dataStore.c4565561.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.cae5c4e5.js";import"./api.e0860994.js";import"./index.04bc0a32.js";import"./i18n.039f44c6.js";import"./QChip.1005a1e4.js";import"./QMenu.7aeeb4c0.js";import"./position-engine.50d2ebdf.js";import"./selection.f3574640.js";import"./rtl.b51694b1.js";const ot=Le({emits:["releaseSubmitted"],props:{record:Object,employee:Object},setup(e,{emit:a}){const E=f(!1),C=f(!1),y=f(null),q=f(!1),t=f([]),w=f([]),j=f(H().add(1,"Month").format("YYYY-MM-DD")),k=qe(),V=Ve(),W=ge(),B=Xe(),{getTermReasons:N,setTermReasons:X}=we(),{getAssignments:p,fetchAssignments:F}=at(),{fetchProjectUsers:Z}=B,{getProjectUsers:x}=Pe(B),ee=g(()=>["Without Reservation","With Some Reservation","Would Not Recommend"]),i=g(()=>p(e.record[74]).length>0?p(e.record[74]).filter(o=>o[3]!==e.record[3]).sort((o,r)=>o[75]>r[75]?1:-1):[]),d=g(()=>[...i.value,...w.value]),c=g(()=>x.value(e.record[74])),$=f(d.value);R(c,o=>{o&&o.length>0&&Oe()});const De=g(()=>G({selection:G().required().nullable().label("Reason"),lastDay:ye().required().label("Last Day On Site"),effective:ye().required().label("Effective Date"),category:le().nullable(),attendance:J().required().label("Attendance"),capability:J().required().label("Capability"),attitude:J().required().label("Attitude"),promotable:J().required().label("Promotability"),comments:le().nullable().label("Comments"),equipment:G().required().nullable().label("Equipment Returned"),supervisor:G().nullable().label("Supervisor").required(),recommendation:le().nullable().label("Recommendation").required()})),{errors:Se,handleSubmit:Ae,handleReset:te}=Ze({validationSchema:De,initialValues:{}}),{value:T}=v("selection"),{value:Q}=v("lastDay"),{value:D}=v("effective"),{value:L}=v("category"),{value:ae}=v("attachments"),{value:ie}=v("capability"),{value:re}=v("attendance"),{value:de}=v("attitude"),{value:ue}=v("promotable"),{value:Ue}=v("comments"),{value:me}=v("equipment"),{value:Re}=v("supervisor"),{value:Ee}=v("recommendation"),P=g(()=>{const o=N();return L.value?o.filter(r=>r[6]===L.value).sort((r,m)=>r[12]>m[12]?1:-1):o.sort((r,m)=>r[12]>m[12]?1:-1)});V.query&&V.query.reason==="no-show"&&(L.value="Voluntary",P.value.length>0&&(q.value=!0,T.value=P.value.find(o=>o[3]===6)),Q.value=H().format("YYYY-MM-DD"),D.value=H().format("YYYY-MM-DD"),me.value={value:!0,label:"None Issued"},ie.value="0",re.value="0",de.value="0",ue.value="0"),R(P,(o,r)=>{V.query&&V.query.reason==="no-show"&&q.value===!1&&(q.value=!0,T.value=P.value.find(m=>m[3]===6))}),R(L,(o,r)=>{T.value=null}),R(D,o=>{(!Q.value||Q.value==="")&&(Q.value=o)}),R(Q,o=>{(!D.value||D.value==="")&&(D.value=o)});const Ce=Ae(async o=>{if(C.value&&t.value.length===0)k.dialog({title:"Alert",message:"Supporting documents are required for this reason!"});else{const r={capability:o.capability,attendance:o.attendance,attitude:o.attitude,promotable:o.promotable,comments:o.comments?o.comments.replace(/(\r\n|\n|\r)/gm," "):null};k.dialog({title:"Confirm",message:"Are you sure you want to release this employee?",cancel:!0,persistent:!0}).onOk(async()=>{try{E.value=!0;const{release:m,employee:b,assignment:K}=await xe({employee:e.employee,assignment:e.record,values:o,effectiveNow:!pe.value,attachments:t.value,ratings:r,supervisor:o.supervisor});a("releaseSubmitted",{release:m,employee:b,assignment:K,effectiveNow:!pe.value}),te()}catch{E.value=!1,k.notify({type:"negative",message:"Cannot submit release."})}})}}),Fe=()=>{k.dialog({title:"Confirm",message:"Are you sure you want to cancel?",cancel:!0,persistent:!0}).onOk(()=>{te(),W.go(-1)})};R(T,(o,r)=>{o&&o[19]?(C.value=!0,ae.value=!0):(ae.value=!1,C.value=!1)});const $e=g(()=>{const o=N();return[...new Map(o.map(r=>[r[6],r[6]])).values()]}),pe=g(()=>D.value&&D.value!==""?H().isBefore(H(D.value)):!1),ke=o=>new Promise((r,m)=>{const b=new FileReader;b.readAsDataURL(o),b.onload=()=>r(b.result.replace(/^data:.+;base64,/,"")),b.onerror=K=>m(K)});R(y,o=>{o&&ce()});const ce=()=>{y.value&&y.value.forEach(async o=>{const r={6:{value:await ke(o),filename:o.name},7:{value:o.name}};t.value.push(r),y.value=null})},Ne=o=>{t.value.splice(o,1)},Qe=async()=>{if(Z({selectedId:e.record[74]}),N().length===0){const{data:o}=await A.fetchFromHiringApp({fields:[O({type:"termReasons",query:"{'11'.EX.'true'}"})]});X({reasons:o})}F({projectId:e.record[74]})},Ie=async o=>{const r=await et(o[6].value);tt(r,o[6].filename)},Oe=async()=>{c.value.forEach(async o=>{if(o[65]&&o[63]&&o[63]!=="")i.value.find(m=>m[18]===o[65])||w.value.push({18:o[65],3:null,75:o[66],104:o[63]});else if(o[63]&&o[63]!==""){const r=[{9:{value:o[63]},7:{value:"Table Query"},8:{value:`{378.EX.'${o[63]}'}OR{26.EX.'${o[10]}'}`},14:{value:549},6:{value:"bp3gb7ng2"}}],{data:m}=await A.fetchFromHiringApp({fields:r});if(m&&m.length===1){const b=m[0][378]!==""?m[0][378]:o[63];i.value.find(Te=>Te[18]===m[0][3])||w.value.push({18:m[0][3],3:null,75:o[66].trim(),104:b});const Be={3:{value:o[6]},80:{value:m[0][3]},70:{value:b}};await A.upsertRecordsXML({to:"br4pxrbs6",data:[Be],fieldsToReturn:[3]})}}})},je=(o,r)=>{if(o===""){r(()=>{$.value=d.value});return}r(()=>{const m=o.toLowerCase();$.value=d.value.filter(b=>b[75].toLowerCase().indexOf(m)>-1||b[104].toLowerCase().indexOf(m)>-1)})};return Qe(),{props:e,options:P,primaryReasons:$e,category:L,selection:T,effective:D,lastDay:Q,attachments:ae,capability:ie,attendance:re,attitude:de,promotable:ue,comments:Ue,equipment:me,supervisor:Re,attachmentsRequired:C,fileAttachment:y,attachedFiles:t,recommendation:Ee,recommendationOptions:ee,maxDate:j,submit:Ce,formErrors:Se,handleReset:te,cancelRelease:Fe,showFiles:ce,deleteFile:Ne,getAssignments:p,disableSubmit:E,downloadFile:Ie,supervisorOptions:$,projectUsers:c,filterFn:je}}}),lt={class:"row"},st={class:"col-12 col-md-4 q-px-sm"},nt=s("div",{class:"text-caption"},"Is this release voluntary or involuntary?",-1),it={class:"text-caption"},rt={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},dt=s("div",{class:"text-caption"},"What is the reason for this release?",-1),ut={class:"text-caption"},mt={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},pt=s("div",{class:"text-caption"},"Effective Date",-1),ct={class:"text-caption"},vt={class:"row"},ft={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},bt=s("div",{class:"text-caption"},"When is the employee's last day on site?",-1),yt={class:"text-caption"},Vt={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},gt=s("div",{class:"text-caption"},"Has all Company Equipment been returned?",-1),ht={class:"text-caption"},qt={class:"row items-top justify-between q-mt-sm"},wt={class:"col-4 q-pl-xs q-pr-sm"},Dt={key:0,class:"text-body2 text-negative text-italic"},St={key:0},At={key:1},Ut={key:1,class:"text-body2 text-dark text-italic"},Rt=s("span",null,"**Supporting documents are optional for this reason.",-1),Et=[Rt],Ct={key:0,class:"col-6 q-pl-xs q-pr-sm"},Ft=s("div",{class:"text-body1 text-info q-mb-sm"},"Attached Documents",-1),$t=["onClick"],kt={class:"row q-my-md"},Nt={class:"col-12"},Qt=s("div",{class:"q-pa-sm"},[s("div",{class:"text-h6 text-bold"},"CAAP Rating"),s("div",{class:"text-body1 text-dark text-italic"},"Capability, Attendance, Attitude, and Promotability"),s("div",{class:"text-body2 text-accent q-mt-sm"},"Select how much you agree with each of the following statements.")],-1),It={class:"q-pb-sm"},Ot=s("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee is capable of performing their assigned job.",-1),jt={class:"q-pb-sm"},Bt=s("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee regularly shows up to work on time.",-1),Tt={class:"q-pb-sm"},Lt=s("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee has a good attitude.",-1),Pt={class:"q-pb-sm"},Yt=s("div",{class:"text-body2 text-info text-bold q-mb-sm"},"I am confident that this employee can be promoted in the future.",-1),Mt={class:"row q-mt-md"},_t={class:"col-12 col-md-5"},Ht=s("div",{class:"text-body2 text-weight-bold text-info"}," Who conducted this evaluation? ",-1),Wt={class:"text-caption"},Xt={class:"row q-mt-md"},Kt={class:"col-12 col-md-5"},zt=s("div",{class:"text-body2 text-weight-bold text-info"}," Supervisor Recommendation for Rehire ",-1),Gt={class:"text-caption"},Jt={class:"row q-py-sm"},Zt={class:"col-12"};function xt(e,a,E,C,y,q){return h(),U("div",null,[l(Je,{onSubmit:He(e.submit,["prevent"])},{default:n(()=>[l(se,null,{default:n(()=>[l(ne,null,{default:n(()=>[s("div",lt,[s("div",st,[nt,l(_,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":a[0]||(a[0]=t=>e.category=t),options:e.primaryReasons},{error:n(()=>[s("div",it,S(e.formErrors.selection),1)]),"no-option":n(()=>[l(Y,null,{default:n(()=>[l(I,{class:"text-grey"},{default:n(()=>[M(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),s("div",rt,[dt,l(_,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":a[1]||(a[1]=t=>e.selection=t),options:e.options,"option-label":"12","display-value":`${e.selection?e.selection[12]:""}`,"bottom-slots":"",error:!!e.formErrors.selection,disable:!e.category},{error:n(()=>[s("div",ut,S(e.formErrors.selection),1)]),"no-option":n(()=>[l(Y,null,{default:n(()=>[l(I,{class:"text-grey"},{default:n(()=>[M(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","display-value","error","disable"])]),s("div",mt,[pt,l(oe,{dense:"",type:"date",modelValue:e.effective,"onUpdate:modelValue":a[2]||(a[2]=t=>e.effective=t),error:!!e.formErrors.effective,"bottom-slots":""},{error:n(()=>[s("div",ct,S(e.formErrors.effective),1)]),_:1},8,["modelValue","error"])])]),s("div",vt,[s("div",ft,[bt,l(oe,{dense:"",type:"date",max:e.maxDate,modelValue:e.lastDay,"onUpdate:modelValue":a[3]||(a[3]=t=>e.lastDay=t),error:!!e.formErrors.lastDay,"bottom-slots":""},{error:n(()=>[s("div",yt,S(e.formErrors.lastDay),1)]),_:1},8,["max","modelValue","error"])]),s("div",Vt,[gt,l(_,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.equipment,"onUpdate:modelValue":a[4]||(a[4]=t=>e.equipment=t),options:[{value:!0,label:"Yes"},{value:!1,label:"No"},{value:!0,label:"None Issued"}],"bottom-slots":"",error:!!e.formErrors.equipment},{error:n(()=>[s("div",ht,S(e.formErrors.equipment),1)]),_:1},8,["modelValue","error"])])]),s("div",qt,[s("div",wt,[l(ze,{dense:"","bottom-slots":"",modelValue:e.fileAttachment,"onUpdate:modelValue":a[5]||(a[5]=t=>e.fileAttachment=t),multiple:"",append:"",label:"Attach Supporting Documents"},{append:n(()=>[l(z,{dense:"",color:"info",round:"",flat:"",icon:"attach_file"})]),_:1},8,["modelValue"]),e.attachmentsRequired?(h(),U("div",Dt,[M("!! "),e.selection[12].toLowerCase().includes("attendance")?(h(),U("span",St,"Supporting attendance records must be attached.")):(h(),U("span",At,"Supporting documents are required for this reason."))])):(h(),U("div",Ut,Et))]),e.attachedFiles.length>0?(h(),U("div",Ct,[Ft,l(Ge,{dense:""},{default:n(()=>[(h(!0),U(ve,null,Me(e.attachedFiles,(t,w)=>(h(),U(ve,{key:t},[l(Y,null,{default:n(()=>[l(I,null,{default:n(()=>[l(Ke,null,{default:n(()=>[s("a",{href:"javascript:void(0);",onClick:j=>e.downloadFile(t)},S(w+1)+". "+S(t[6].filename),9,$t)]),_:2},1024)]),_:2},1024),l(I,{side:""},{default:n(()=>[l(z,{color:"accent",round:"",flat:"",class:"cursor-pointer",icon:"delete",size:"md",onClick:j=>e.deleteFile(w)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),l(fe)],64))),128))]),_:1})])):he("",!0)])]),_:1})]),_:1}),l(fe),s("div",kt,[s("div",Nt,[Qt,l(se,null,{default:n(()=>[l(ne,null,{default:n(()=>[s("div",null,[s("div",It,[Ot,l(u,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[6]||(a[6]=t=>e.capability=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(u,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[7]||(a[7]=t=>e.capability=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(u,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[8]||(a[8]=t=>e.capability=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(u,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[9]||(a[9]=t=>e.capability=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(u,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[10]||(a[10]=t=>e.capability=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(u,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":a[11]||(a[11]=t=>e.capability=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),s("div",jt,[Bt,l(u,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[12]||(a[12]=t=>e.attendance=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(u,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[13]||(a[13]=t=>e.attendance=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(u,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[14]||(a[14]=t=>e.attendance=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(u,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[15]||(a[15]=t=>e.attendance=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(u,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[16]||(a[16]=t=>e.attendance=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(u,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":a[17]||(a[17]=t=>e.attendance=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),s("div",Tt,[Lt,l(u,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[18]||(a[18]=t=>e.attitude=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(u,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[19]||(a[19]=t=>e.attitude=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(u,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[20]||(a[20]=t=>e.attitude=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(u,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[21]||(a[21]=t=>e.attitude=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(u,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[22]||(a[22]=t=>e.attitude=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(u,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":a[23]||(a[23]=t=>e.attitude=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),s("div",Pt,[Yt,l(u,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[24]||(a[24]=t=>e.promotable=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),l(u,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[25]||(a[25]=t=>e.promotable=t),val:"2",label:"Disagree"},null,8,["modelValue"]),l(u,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[26]||(a[26]=t=>e.promotable=t),val:"3",label:"Neutral"},null,8,["modelValue"]),l(u,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[27]||(a[27]=t=>e.promotable=t),val:"4",label:"Agree"},null,8,["modelValue"]),l(u,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[28]||(a[28]=t=>e.promotable=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),l(u,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":a[29]||(a[29]=t=>e.promotable=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])])]),s("div",Mt,[s("div",_t,[Ht,l(_,{"use-input":"",dense:"","input-debounce":"0",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.supervisor,"onUpdate:modelValue":a[30]||(a[30]=t=>e.supervisor=t),options:e.supervisorOptions,"option-label":t=>`${t[75]} - ${t[104]}`,"display-value":`${e.supervisor?e.supervisor[75]:""}`,onFilter:e.filterFn,"bottom-slots":"",error:!!e.formErrors.supervisor,hint:"Ex: Employee's Supervisor"},{error:n(()=>[s("div",Wt,S(e.formErrors.supervisor),1)]),"no-option":n(()=>[l(Y,null,{default:n(()=>[l(I,{class:"text-grey"},{default:n(()=>[M(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","onFilter","error"])])]),s("div",Xt,[s("div",Kt,[zt,l(_,{dense:"",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.recommendation,"onUpdate:modelValue":a[31]||(a[31]=t=>e.recommendation=t),options:e.recommendationOptions,"bottom-slots":"",error:!!e.formErrors.recommendation},{error:n(()=>[s("div",Gt,S(e.formErrors.recommendation),1)]),"no-option":n(()=>[l(Y,null,{default:n(()=>[l(I,{class:"text-grey"},{default:n(()=>[M(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","error"])])])]),_:1})]),_:1})])]),s("div",Jt,[s("div",Zt,[l(oe,{filled:"",type:"textarea",modelValue:e.comments,"onUpdate:modelValue":a[32]||(a[32]=t=>e.comments=t),label:"Comments"},null,8,["modelValue"])])]),l(_e,{align:"right"},{default:n(()=>[l(z,{disable:e.disableSubmit,color:"info",label:"Submit",type:"submit"},null,8,["disable"]),l(z,{color:"secondary",label:"Cancel",onClick:e.cancelRelease},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var ea=Ye(ot,[["render",xt]]);const ta={class:"q-pa-sm"},aa={class:"row"},oa={class:"col-12"},la=s("div",{class:"text-h6 text-weight-bold q-mb-md"},"Please complete the following to submit this release.",-1),$a={__name:"terminate",setup(e){f(0);const a=Ve(),E=ge(),C=qe(),y=f("employee"),q=f(null),t=f(null),w=f(0);y.value=a.query.reason==="no-show"?"arrivals":"employee",y.value==="no-show"&&(q.value=a.query.aid,t.value=a.query.did);const{getEmployee:j,getAssignmentsByEmployee:k,setAssignmentsByEmployee:V,setEmployees:W,setReleases:B,setReleasesByAssignment:N,setReleasesByEmployee:X}=we(),p=g(()=>j(a.params.id)),F=g(()=>p.value?k(a.params.id):null),Z=async()=>{if(!F.value&&p.value[577]&&p.value[577]>0){const{data:i}=await A.fetchFromHiringApp({fields:[O({type:"assignments",query:"",id:p.value[577]})]});V({id:p.value[3],data:i})}else if(p.value[577]&&p.value[577]>0)await A.fetchFromHiringApp({fields:[O({type:"assignments",query:"",id:p.value[577]})]});else if(!F.value&&q.value&&q.value>0){const{data:i}=await A.fetchFromHiringApp({fields:[O({type:"assignments",query:"",id:q.value})]});V({id:p.value[3],data:i})}else if(!F.value&&p.value[608]&&p.value[608]>0){const{data:i}=await A.fetchFromHiringApp({fields:[O({type:"assignments",query:"",id:p.value[608]})]});V({id:p.value[3],data:i})}else{const i=O({type:"assignments",query:"",id:p.value[577]});i[8]={value:`{3.EX.${a.query.aid}}`};const{data:d}=await A.fetchFromHiringApp({fields:[i]});V({id:p.value[3],data:d})}};R(p,(i,d)=>{i&&w.value===0&&(Z(),w.value++)});const x=async({employee:i,release:d,assignment:c,effectiveNow:$})=>{y.value==="arrivals"&&a.query.did&&await ee(a.query.did,d),C.notify({type:"positive",message:"Release successfully submitted."}),$?(i[581]=d[3],B({id:d[3],data:d}),W({id:i[3],data:i}),V({id:i[3],assignment:c}),N({id:c[3],data:d}),X({id:i[3],data:d})):(i[581]=d[3],W({id:i[3],data:i}),B({id:d[3],data:d}),N({id:c[3],data:d}),X({id:i[3],data:d})),y.value==="arrivals"?E.replace({name:"arrivals"}):E.replace({name:"view-ee-release",params:{id:i[3],release:d[3]}})};async function ee(i,d){try{let c=7;d[33]==="Terminate_Employee_Voluntary_Never_Started_Working"?c=7:(d[33]==="Terminate_Employee_Involuntary_Lack_of_Work_End_of_Contract_Project"||d[33]==="Terminate_Employee_Involuntary_Project_Cancelled_Before_Employee_Started")&&(c=8);const{data:$}=await A.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:i},20:{value:"DNC"},61:{value:c},63:{value:d[33]},74:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return $[0][204]}catch(c){throw{message:"Cannot edit deployment",error:c}}}return(i,d)=>(h(),be(We,{style:{"max-width":"100vw"}},{default:n(()=>[s("div",ta,[s("div",aa,[s("div",oa,[l(se,{flat:""},{default:n(()=>[F.value?(h(),be(ne,{key:0},{default:n(()=>[la,l(ea,{record:F.value,employee:p.value,onReleaseSubmitted:x},null,8,["record","employee"])]),_:1})):he("",!0)]),_:1})])])])]),_:1}))}};export{$a as default};
