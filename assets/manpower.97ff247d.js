import{Q as R,a as se,b as E}from"./QTabPanels.e822e3db.js";import{Q as L}from"./QTabs.eebbc433.js";import{Q as le}from"./QToolbar.2a84513c.js";import{Q as re}from"./QPage.5ec04786.js";import{q as X,u as ne}from"./app.613d4acb.js";import{l as M,bU as N,r as _,c as g,_ as U,b5 as Q,A as y,B as Y,d as t,br as n,cT as F,D as u,cU as P,cS as S,bT as ie,F as x,b4 as H,aq as q,ax as B,ac as j,bQ as W,bW as G,y as de,ar as J}from"./index.d4eae66d.js";import{a as ae}from"./QSelect.031fcf1a.js";import{u as I}from"./use-quasar.bcab4131.js";import{u as O}from"./dataStore.1c488d7d.js";import{dayjs as V}from"./dayjs.623dcd01.js";import{u as z}from"./useQuerySaver.d29ff9ee.js";import{R as te,g as ue}from"./quickbaseDataHelpers.25bca17c.js";import{a as K,Q as pe}from"./QTable.12045531.js";import{Q as Z}from"./QTr.fb3ac2d2.js";import{Q as ee}from"./QTd.d2ccd994.js";import{Q as me}from"./QInnerLoading.252eeb0c.js";import{e as ce}from"./export-file.dc78ba05.js";import{P as fe}from"./projectPipeline.d36d50d9.js";import"./use-panel.535b1c2c.js";import"./touch.3df10340.js";import"./selection.0cbecac7.js";import"./QResizeObserver.4921fc3a.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.8903a003.js";import"./api.1778fb80.js";import"./index.04bc0a32.js";import"./i18n.686f34be.js";import"./QChip.41616f02.js";import"./QMenu.7266e205.js";import"./position-engine.0aae880f.js";import"./index.36c6fd7e.js";import"./arrivalDate.40cfcc65.js";import"./QTooltip.642cbb8f.js";import"./QForm.55d7c310.js";import"./vee-validate.esm.58b5b94d.js";import"./array.59f93f43.js";import"./QList.bc659d96.js";import"./QMarkupTable.483f898b.js";import"./use-fullscreen.22e35b6e.js";const be=M({props:{},components:{RosterTable:te},setup(e){const a=I(),v=N(),d=_(""),c=_(null),p=_(null),{getManpowerData:s,setRosters:r}=O(),b=g(()=>v.params.id?v.params.id:null),m=g(()=>(s({dataset:"rosters",id:b.value})||[]).sort(($,h)=>$[1].$d<h[1].$d?1:-1).filter($=>!$[112]&&$.latest&&$[102]==="Active")),w=g(()=>{let l=[];return m.value.forEach(i=>{i[75].toLowerCase().includes(d.value.toLowerCase())&&l.push(i)}),l=c.value?l.filter(i=>V(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===V(c.value).tz("America/Chicago").format("MM/DD/YYYY")):l,l=p.value?l.filter(i=>i[68]===p.value):l,l.sort((i,$)=>i.employee[22]>$.employee[22]?1:-1)}),T=g(()=>[...new Map(m.value.map(l=>[l[68],l[68]])).values()]),k=async l=>{(l||!s({dataset:"rosters",id:b.value}))&&(a.loading.show(),await C(),a.loading.hide())},C=async()=>{const l=`{'74'.EX.'${b.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:i}=await X.fetchFromHiringApp({fields:[z({type:"assignments",query:l})]});r({id:b.value,data:i})};return k(!1),{allAssignments:m,search:d,startDateFilter:c,craftFilter:p,craftOptions:T,rows:w,loadData:k}}}),ve={class:"row items-center"},we={class:"col-12 col-md-3 q-px-sm"},$e={class:"col-12 col-md-3 q-px-sm"},ye={class:"col-12 col-md-3 q-px-sm"};function ge(e,a,v,d,c,p){const s=Q("roster-table");return y(),Y("div",null,[t(S,{flat:""},{default:n(()=>[t(F,null,{default:n(()=>[u("div",ve,[u("div",we,[t(P,{dense:"",modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=r=>e.search=r),label:"Search"},null,8,["modelValue"])]),u("div",$e,[t(P,{dense:"",modelValue:e.startDateFilter,"onUpdate:modelValue":a[1]||(a[1]=r=>e.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",ye,[t(ae,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":a[2]||(a[2]=r=>e.craftFilter=r),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),t(s,{rows:e.rows,onRefreshData:a[3]||(a[3]=r=>e.loadData(!0)),title:"Active Roster"},null,8,["rows"])])}var he=U(be,[["render",ge]]);const De=M({props:{},components:{RosterTable:te},setup(e){const a=I(),v=N(),d=_(""),c=_(null),p=_(null),{getManpowerData:s,setRosters:r}=O(),b=g(()=>v.params.id?v.params.id:null),m=g(()=>{const l=V().subtract(14,"day");return(s({dataset:"rosters",id:b.value})||[]).sort((h,o)=>h[1].$d<o[1].$d?1:-1).filter(h=>!h[112]&&h.latest&&h[102]==="Active"&&V(h[1].$d).isSameOrAfter(l)&&V(h[1].$d).isSameOrBefore(V()))}),w=g(()=>{let l=[];return m.value.forEach(i=>{i[75].toLowerCase().includes(d.value.toLowerCase())&&l.push(i)}),l=c.value?l.filter(i=>V(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===V(c.value).tz("America/Chicago").format("MM/DD/YYYY")):l,l=p.value?l.filter(i=>i[68]===p.value):l,l.sort((i,$)=>i.employee[22]>$.employee[22]?1:-1)}),T=g(()=>[...new Map(m.value.map(l=>[l[68],l[68]])).values()]),k=async l=>{(l||!s({dataset:"rosters",id:b.value}))&&(a.loading.show(),await C(),a.loading.hide())},C=async()=>{const l=`{'74'.EX.'${b.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:i}=await X.fetchFromProjectsApp({fields:[z({type:"assignments",query:l})]});r({id:b.value,data:i})};return{allAssignments:m,search:d,startDateFilter:c,craftFilter:p,craftOptions:T,rows:w,loadData:k}}}),Ve={class:"row items-center"},_e={class:"col-12 col-md-3 q-px-sm"},Ae={class:"col-12 col-md-3 q-px-sm"},Re={class:"col-12 col-md-3 q-px-sm"};function qe(e,a,v,d,c,p){const s=Q("roster-table");return y(),Y("div",null,[t(S,{flat:""},{default:n(()=>[t(F,null,{default:n(()=>[u("div",Ve,[u("div",_e,[t(P,{dense:"",modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=r=>e.search=r),label:"Search"},null,8,["modelValue"])]),u("div",Ae,[t(P,{dense:"",modelValue:e.startDateFilter,"onUpdate:modelValue":a[1]||(a[1]=r=>e.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Re,[t(ae,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":a[2]||(a[2]=r=>e.craftFilter=r),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),t(s,{rows:e.rows,onRefresh:a[3]||(a[3]=r=>e.loadData(!0)),title:"New Arrivals"},null,8,["rows"])])}var Qe=U(De,[["render",qe]]);const Pe=M({props:{},components:{},setup(e){const a=I(),v=ie(),d=N(),{capitalize:c}=de,p=_(""),s=_(null),{getManpowerData:r,setDepartures:b}=O(),m=g(()=>d.params.id?d.params.id:null),w=[{name:1,label:"Name",align:"left",field:o=>o[49],format:o=>`${T(o)}`,sortable:!0,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:o=>o[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:o=>o[50],format:o=>`${o}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:o=>o[51],format:o=>o===""?"not available":o,sortable:!0},{name:4,label:"Classification",align:"left",field:o=>o[82],format:o=>`${!o||o===""?"Not Assigned":o}`,sortable:!0},{name:5,label:"Job #",align:"left",field:o=>o[81],format:o=>`${o===""||!o?"Not Assigned":o}`,sortable:!0},{name:6,label:"Release Date",align:"left",field:o=>o[36].$d,format:o=>`${V(o).format("MM/DD/YYYY")}`,sortable:!0}],T=o=>{const A=o.split(" ");let D="";return A.forEach((f,oe)=>{D+=oe>0?` ${c(f.toLowerCase())}`:c(f.toLowerCase())}),D};function k(o){v.push({name:"view-release",params:{release:o[3]}})}function C(o,A,D){let f=A!==void 0?A(o,D):o;return f=f==null?"":String(f),f=f.split('"').join('""'),`"${f}"`}function l(){const o=[w.value.map(D=>C(D.label))].concat(i.value.map(D=>w.value.map(f=>C(typeof f.field=="function"?f.field(D):D[f.field===void 0?f.name:f.field],f.format,D)).join(","))).join(`\r
`);ce(`${V().format("MM.DD.YYYY")} Releases-Export.csv`,o,"text/csv")!==!0&&a.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const i=g(()=>r({dataset:"departures",id:m.value})||[]),$=async o=>{(o||!r({dataset:"departures",id:m.value}))&&(a.loading.show(),await h(),a.loading.hide())},h=async()=>{const o=`{'41'.EX.'${m.value}'}AND{'42'.XEX.'Complete'}AND({'36'.OAF.'today'}OR{'36'.IR.'last 30 d'}OR{'1'.IR.'last 30 d'})`,{data:A}=await X.fetchFromHiringApp({fields:[z({type:"releases",query:o})]});b({id:m.value,data:A})};return $(),{search:p,dateFilter:s,loadData:$,columns:w,viewRelease:k,exportAllReleases:l,rows:i}}}),ke={class:"row items-center"},Ce={class:"col-12 col-md-3 q-px-sm"},Ye={class:"col-12 col-md-3 q-px-sm"},Te={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},je={class:"text-dark text-caption text-italic"};function Fe(e,a,v,d,c,p){return y(),Y("div",null,[t(S,{flat:""},{default:n(()=>[t(F,null,{default:n(()=>[u("div",ke,[u("div",Ce,[t(P,{dense:"",modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=s=>e.search=s),label:"Search"},null,8,["modelValue"])]),u("div",Ye,[t(P,{dense:"",modelValue:e.dateFilter,"onUpdate:modelValue":a[1]||(a[1]=s=>e.dateFilter=s),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])])])]),_:1})]),_:1}),u("div",null,[t(pe,{title:"Recent Releases","title-class":"text-h5 text-primary",columns:e.columns,rows:e.rows,"row-key":s=>s[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent Releases",dense:""},{header:n(s=>[t(Z,{class:"bg-dark text-white",props:s},{default:n(()=>[t(K,{"auto-width":""}),(y(!0),Y(x,null,H(s.cols,r=>(y(),q(K,{key:r.name,props:s},{default:n(()=>[B(j(r.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:n(s=>[t(Z,{props:s},{default:n(()=>[t(ee,{"auto-width":""},{default:n(()=>[t(W,{class:"cursor-pointer",size:e.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:r=>e.viewRelease(s.row),name:s.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(y(!0),Y(x,null,H(s.cols,r=>(y(),q(ee,{key:r.name,props:s},{default:n(()=>[B(j(r.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":n(({message:s})=>[u("div",Te,[t(W,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),u("span",null,j(s),1)])]),"top-right":n(()=>[u("div",je,"(Total: "+j(e.rows.length)+" releases)",1),t(G,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:a[2]||(a[2]=s=>e.loadData(!0))}),t(G,{dense:e.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:e.exportAllReleases,disable:e.rows.length<1},null,8,["dense","onClick","disable"])]),loading:n(()=>[t(me,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Ue=U(Pe,[["render",Fe]]);const Ee={name:"Pipeline",components:{ProjectPipelineTable:fe},setup(){const e=I(),a=N(),v=_(""),{getManpowerData:d,setPipelines:c}=O(),p=g(()=>a.params.id?a.params.id:null),s=g(()=>d({dataset:"pipelines",id:p.value})||[]),r=async m=>{(m||!d({dataset:"pipelines",id:p.value}))&&(e.loading.show(),await b(),e.loading.hide())},b=async()=>{const m=await ue(p.value);c({id:p.value,data:m})};return r(),{allPipeline:s,search:v,loadData:r}}},Me={class:"text-h5 text-dark"},Ne={class:"text-body2 text-italic q-ml-sm"},Se=u("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Ie={class:"row items-center"},Oe={class:"col-12 col-md-3 q-px-sm"};function Be(e,a,v,d,c,p){const s=Q("project-pipeline-table");return y(),Y("div",null,[t(S,{flat:""},{default:n(()=>[t(F,{class:"q-pb-none"},{default:n(()=>[u("div",Me,[B(" Staffing Pipeline "),u("span",Ne,"("+j(d.allPipeline.length)+" total)",1)]),Se]),_:1}),t(F,null,{default:n(()=>[u("div",Ie,[u("div",Oe,[t(P,{dense:"",modelValue:d.search,"onUpdate:modelValue":a[0]||(a[0]=r=>d.search=r),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),t(s,{rows:d.allPipeline,onRefresh:a[1]||(a[1]=r=>d.loadData(!0))},null,8,["rows"])])}var Xe=U(Ee,[["render",Be]]);const ze=M({name:"Employees",components:{RosterTab:he,NewArrivalsTab:Qe,ReleasesTab:Ue,PipelineTab:Xe},setup(){const e=_(0),{getUserType:a}=ne();return a==="QuickBase User"&&(e.value=3),{tab:e,getUserType:a}}}),Le={class:"q-pa-md"};function xe(e,a,v,d,c,p){const s=Q("roster-tab"),r=Q("new-arrivals-tab"),b=Q("pipeline-tab"),m=Q("releases-tab");return y(),q(re,{style:{"max-width":"100vw"}},{default:n(()=>[u("div",Le,[t(le,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[e.getUserType==="QuickBase User"?(y(),q(L,{key:0,modelValue:e.tab,"onUpdate:modelValue":a[0]||(a[0]=w=>e.tab=w),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:n(()=>[e.$route.name==="project-manpower"?(y(),q(R,{key:0,name:3,label:"Pipeline"})):J("",!0),t(R,{name:2,label:"Releases"}),t(R,{name:0,label:e.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"])]),_:1},8,["modelValue"])):(y(),q(L,{key:1,modelValue:e.tab,"onUpdate:modelValue":a[1]||(a[1]=w=>e.tab=w),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:n(()=>[t(R,{name:0,label:e.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),t(R,{name:1,label:"New Arrivals"}),e.$route.name==="project-manpower"?(y(),q(R,{key:0,name:3,label:"Pipeline"})):J("",!0),t(R,{name:2,label:"Releases"})]),_:1},8,["modelValue"]))]),_:1}),t(se,{modelValue:e.tab,"onUpdate:modelValue":a[2]||(a[2]=w=>e.tab=w),animated:""},{default:n(()=>[t(E,{name:0},{default:n(()=>[t(s)]),_:1}),t(E,{name:1},{default:n(()=>[t(r)]),_:1}),t(E,{name:3},{default:n(()=>[t(b)]),_:1}),t(E,{name:2},{default:n(()=>[t(m)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var ja=U(ze,[["render",xe]]);export{ja as default};
