import{Q as S}from"./QSpace.e92c613d.js";import{bL as M,bN as U,r as i,w as G,aL as E,c as _,A as W,B as X,d as t,bi as l,cw as F,D as c,G as C,a7 as r,ab as q,cz as H,cx as J,bI as K,bO as m,au as w}from"./index.323fc631.js";import{Q as x}from"./QTooltip.fe7f775f.js";import{Q as Z}from"./QTd.a6fb5135.js";import{u as ee}from"./use-quasar.3f2121a5.js";import{e as te}from"./export-file.751205c9.js";import{I as ae,u as oe,b as se,q as le}from"./quickbase.6ac4f30e.js";import{dayjs as re}from"./dayjs.06dd814d.js";import{_ as ne,a as ie}from"./aTable.0910e818.js";import{_ as ce}from"./projectsTab.95ac9d15.js";import"./position-engine.e825e98f.js";import"./selection.f718deb7.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.dd9802e5.js";import"./api.b50a8157.js";import"./i18n.3a003f1d.js";import"./QSelect.33612d66.js";import"./QChip.b617217b.js";import"./QItemLabel.ef02ff6c.js";import"./QMenu.9da69efa.js";import"./rtl.d0f7624c.js";import"./QTable.1a240931.js";import"./QList.13743bc9.js";import"./QMarkupTable.96fcc235.js";import"./use-fullscreen.e74ce5f2.js";import"./QBadge.509f5f33.js";import"./QRouteTab.01305a1f.js";import"./QTabs.26487d2a.js";import"./QResizeObserver.1d6a3a03.js";const de={class:"q-pa-md"},ue={class:"row"},me={class:"col-12 col-md-6 q-px-sm"},pe={class:"col-12 col-md-4 q-px-sm"},fe={class:"col-12 col-md-5 q-px-sm"},Ee={__name:"index",setup(ve){const p=ee(),P=M(),h=ae(),Q=oe(),{openWindow:B}=se(),{primaryOffice:I}=Q,{fetchProjects:R,fetchAllProjects:O}=h,{getProjects:V,getSelectedOffice:n,getLoadingState:j}=U(h),d=i(n.value?n.value[8]:null),f=i("Projects"),k=i("projects"),v=i(""),$=i({sortBy:"13",descending:!1,rowsPerPage:150}),b=e=>{d.value?R({selectedId:d.value,refresh:e}):O({can:"read",refresh:e})};b(),G(n,()=>{d.value=n.value?n.value[8]:null,b()});const N=i(new Date),T=setInterval(()=>{N.value=new Date},1e3);E(()=>{clearInterval(T)});const z=_(()=>["id","name","avgDRO","openRequests","action",...n.value?[]:["office"]]),g=_(()=>[{name:"id",align:"left",label:"ID",field:"3",sortable:!1},{name:"name",align:"left",label:"Name",field:"298",sortable:!0},{name:"office",align:"center",label:"Office",field:"76",sortable:!1},{name:"avgDRO",align:"center",label:"AVG DRO",field:"208",sortable:!0},{name:"openRequests",align:"center",label:"Open Request",field:"31",sortable:!0},{name:"action",align:"center",label:"",sortable:!1}]),u=_(()=>V.value({selectedId:d.value,can:"read"}).filter(e=>!0).sort((e,s)=>e[298].localeCompare(s[298]))),A=e=>{P.push({name:"project-general",params:{id:e[3]}})},y=(e,s,o)=>{let a=s!==void 0?s(e,o):e;return a=a==null?"":String(a),a=a.split('"').join('""'),`"${a}"`},D=()=>{const e=[g.value.map(o=>y(o.label))].concat(u.value.map(o=>g.value.map(a=>y(typeof a.field=="function"?a.field(o):o[a.field===void 0?a.name:a.field],a.format,o)).join(","))).join(`\r
`);te(`${f.value} ${re().format("MM.DD.YYYY")}.csv`,e,"text/csv")!==!0&&p.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})},L=async()=>{const e=[{12:{value:d.value||I[8]}}],{data:s}=await le.upsertRecordsXML({to:"bpzpwr2c7",fieldsToReturn:[315],data:e,formatObject:315});Y(s[0][315][3])},Y=e=>{B(null,{url:`https://elitehcms.quickbase.com/db/bpz457c9d?a=dbpage&pageID=204&proj_id=${e}&ut=hc`,name:"Project Build"})};return(e,s)=>(W(),X("div",de,[t(ce),t(H,{flat:"",class:"q-pt-none"},{default:l(()=>[t(F,null,{default:l(()=>[c("div",ue,[c("div",me,[c("div",{class:C(["text-dark",r(p).screen.lt.md?"text-body1":"text-h5"])},q(f.value),3)]),t(S),c("div",pe,[t(ne,{can:"read",styleSelection:!0})])])]),_:1})]),_:1}),t(ie,{rows:r(u),columns:r(g),pagination:$.value,filter:v.value,title:f.value,separator:"vertical","row-key":"3",loading:r(j)(k.value),"visible-columns":r(z),downloadButton:!0,onDownload:D},{top:l(()=>[c("div",fe,[t(J,{dense:"",modelValue:v.value,"onUpdate:modelValue":s[0]||(s[0]=o=>v.value=o),label:"Search...",clearable:""},{prepend:l(()=>[t(K,{name:"search"})]),_:1},8,["modelValue"])]),t(S),c("div",{class:C(["text-dark text-caption text-italic",r(p).screen.lt.md?"offset-xs-5":""])},"(Total: "+q(r(u).length)+")",3),t(m,{flat:"",round:"",color:"primary",icon:"download",disable:r(u).length<1,onClick:D},{default:l(()=>[t(x,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:l(()=>[w(" Download ")]),_:1})]),_:1},8,["disable"]),t(m,{flat:"",round:"",color:"primary",icon:"add_circle",disable:r(u).length<1,onClick:L},{default:l(()=>[t(x,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:l(()=>[w(" Add New Project ")]),_:1})]),_:1},8,["disable"]),t(m,{flat:"",round:"",color:"primary",icon:"refresh",onClick:s[1]||(s[1]=o=>b(!0)),loading:r(j)(k.value)},{default:l(()=>[t(x,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:l(()=>[w(" Refresh ")]),_:1})]),_:1},8,["loading"])]),"body-cell-action":l(o=>[t(Z,{props:o},{default:l(()=>[t(m,{color:"primary",label:"View Project",onClick:a=>A(o.row),size:"sm"},null,8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination","filter","title","loading","visible-columns"])]))}};export{Ee as default};
