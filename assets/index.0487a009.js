import{Q as U,a as pe,b as x}from"./QTabPanels.5776e1dd.js";import{Q as me}from"./QTabs.8f995d1b.js";import{Q as fe}from"./QToolbar.c26a8fb4.js";import{Q as ve}from"./QPage.4d3a0dd4.js";import{E as be}from"./roster.be65acc4.js";import{l as X,bU as H,r as S,bV as W,c as b,_ as B,b5 as A,A as g,B as k,d as a,br as n,cT as O,D as d,ar as I,cU as M,cS as G,bT as we,w as ge,F as ae,b4 as oe,aq as E,ax as z,ac as L,bQ as le,bW as se,y as $e}from"./index.ed1cd1a8.js";import{a as he}from"./QSelect.d18b0263.js";import{u as J}from"./use-quasar.0680e35f.js";import{u as K}from"./dataStore.fa4960b2.js";import{g as Z,q as de}from"./app.58c96d85.js";import{u as ee}from"./dataStore.112f1173.js";import{dayjs as Q}from"./dayjs.d6c6127f.js";import{u as ce}from"./useQuerySaver.d29ff9ee.js";import{R as ye}from"./rosterTable.72ed214b.js";import{_ as te}from"./projectSelector.9c6f493f.js";import{Q as re,a as _e}from"./QTable.d845a145.js";import{Q as ne}from"./QTr.d6da9795.js";import{Q as ie}from"./QTd.a02323b5.js";import{Q as De}from"./QInnerLoading.273de71a.js";import{e as je}from"./export-file.dc78ba05.js";import{g as Ve}from"./quickbaseDataHelpers.bbe9fb5f.js";import{P as Pe}from"./projectPipeline.571b90ac.js";import"./use-panel.21d7cf21.js";import"./touch.70a9dd44.js";import"./selection.e39b2fce.js";import"./QResizeObserver.e28f4cf4.js";import"./rtl.b51694b1.js";import"./QChip.8da1fa28.js";import"./QMenu.d23a604a.js";import"./position-engine.df0f0bff.js";import"./localForage.830ce567.js";import"./_commonjsHelpers.a26ce4be.js";import"./api.e0fdf09c.js";import"./index.04bc0a32.js";import"./i18n.9212c305.js";import"./index.89794de1.js";import"./arrivalDate.376a1405.js";import"./QTooltip.8a03cb8d.js";import"./QForm.a26f0b73.js";import"./vee-validate.esm.9e016e91.js";import"./array.59f93f43.js";import"./QList.1713c134.js";import"./QMarkupTable.9e572f7b.js";import"./use-fullscreen.862858a0.js";const Re=X({props:{},components:{RosterTable:ye,projectSelector:te},setup(t){const o=J(),j=H(),p=Z(),w=S(""),$=S(null),m=S(null),{getSelectedProject:l}=W(p),{getAssignments:i,fetchAllAssignments:V,fetchAssignments:P}=K(),{getManpowerData:T,setRosters:F}=ee(),D=b(()=>j.params.id?j.params.id:null),h=b(()=>l.value?l.value[3]:null),f=b(()=>{let r;const c=Q().subtract(14,"day");return D.value?r=(T({dataset:"rosters",id:D.value})||[]).sort((s,y)=>s[1].$d<y[1].$d?1:-1):r=i(h.value).sort((v,s)=>v[1].$d<s[1].$d?1:-1),r.filter(v=>!v[112]&&v.latest&&v[102]==="Active"&&Q(v[1].$d).isSameOrAfter(c)&&Q(v[1].$d).isSameOrBefore(Q()))}),C=b(()=>{let r=[];return f.value.forEach(c=>{c[75].toLowerCase().includes(w.value.toLowerCase())&&r.push(c)}),r=$.value?r.filter(c=>Q(c[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Q($.value).tz("America/Chicago").format("MM/DD/YYYY")):r,r=m.value?r.filter(c=>c[68]===m.value):r,r.sort((c,v)=>c.employee[22]>v.employee[22]?1:-1)}),q=b(()=>[...new Map(f.value.map(r=>[r[68],r[68]])).values()]),Y=async r=>{o.loading.show(),D.value?(r||!T({dataset:"rosters",id:D.value}))&&await N():h.value?await P({projectId:h.value,refresh:r}):await V({refresh:r}),o.loading.hide()},N=async()=>{const r=`{'74'.EX.'${D.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:c}=await de.fetchFromProjectsApp({fields:[ce({type:"assignments",query:r})]});F({id:D.value,data:c})};return{allAssignments:f,search:w,startDateFilter:$,craftFilter:m,craftOptions:q,rows:C,loadData:Y}}}),Ae={class:"row items-center"},Se={key:0,class:"col-12 col-md-3"},Ce={class:"col-12 col-md-3 q-px-sm"},Qe={class:"col-12 col-md-3 q-px-sm"},ke={class:"col-12 col-md-3 q-px-sm"};function qe(t,o,j,p,w,$){const m=A("projectSelector"),l=A("roster-table");return g(),k("div",null,[a(G,{flat:""},{default:n(()=>[a(O,null,{default:n(()=>[d("div",Ae,[t.$route.params.id?I("",!0):(g(),k("div",Se,[a(m,{dense:""})])),d("div",Ce,[a(M,{dense:"",modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=i=>t.search=i),label:"Search"},null,8,["modelValue"])]),d("div",Qe,[a(M,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=i=>t.startDateFilter=i),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),d("div",ke,[a(he,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=i=>t.craftFilter=i),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(l,{rows:t.rows,onRefreshData:o[3]||(o[3]=i=>t.loadData(!0)),title:"New Arrivals"},null,8,["rows"])])}var Te=B(Re,[["render",qe]]);const Fe=X({props:{},components:{projectSelector:te},setup(t){const o=J(),j=we(),p=H(),{capitalize:w}=$e,$=Z(),m=S(""),l=S(null),i=S(null),{getSelectedProject:V}=W($),{getReleases:P,fetchReleases:T,fetchAllReleases:F}=K(),{getManpowerData:D,setDepartures:h}=ee(),f=b(()=>p.params.id?p.params.id:null),C=b(()=>V.value?V.value[3]:null),q=[{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${Y(e)}`,sortable:!0,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Q(e).format("MM/DD/YYYY")}`,sortable:!0}],Y=e=>{const R=e.split(" ");let _="";return R.forEach((u,ue)=>{_+=ue>0?` ${w(u.toLowerCase())}`:w(u.toLowerCase())}),_};function N(e){j.push({name:"view-release",params:{release:e[3]}})}function r(e,R,_){let u=R!==void 0?R(e,_):e;return u=u==null?"":String(u),u=u.split('"').join('""'),`"${u}"`}function c(){const e=[q.value.map(_=>r(_.label))].concat(v.value.map(_=>q.value.map(u=>r(typeof u.field=="function"?u.field(_):_[u.field===void 0?u.name:u.field],u.format,_)).join(","))).join(`\r
`);je(`${Q().format("MM.DD.YYYY")} Releases-Export.csv`,e,"text/csv")!==!0&&o.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const v=b(()=>{let e;return f.value?e=D({dataset:"departures",id:f.value})||[]:e=P(C.value).sort((R,_)=>R[1].$d<_[1].$d?1:-1),e}),s=async e=>{o.loading.show(),f.value?(e||!D({dataset:"departures",id:f.value}))&&await y():C.value?await T({projectId:C.value,refresh:e}):await F({refresh:e}),o.loading.hide()},y=async()=>{const e=`{'41'.EX.'${f.value}'}AND{'42'.XEX.'Complete'}AND({'36'.OAF.'today'}OR{'36'.IR.'last 30 d'}OR{'1'.IR.'last 30 d'})`,{data:R}=await de.fetchFromHiringApp({fields:[ce({type:"releases",query:e})]});h({id:f.value,data:R})};return ge(V,()=>{s()}),s(!0),{projectFilterValue:C,search:m,dateFilter:l,craftFilter:i,loadData:s,getReleases:P,columns:q,viewRelease:N,exportAllReleases:c,rows:v}}}),Ee={class:"row items-center"},Ie={key:0,class:"col-12 col-md-3"},Ye={class:"col-12 col-md-3 q-px-sm"},Ne={class:"col-12 col-md-3 q-px-sm"},Le=d("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),Me={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Ue={class:"text-dark text-caption text-italic"};function xe(t,o,j,p,w,$){const m=A("projectSelector");return g(),k("div",null,[a(G,{flat:""},{default:n(()=>[a(O,null,{default:n(()=>[d("div",Ee,[t.$route.params.id?I("",!0):(g(),k("div",Ie,[a(m,{dense:""})])),d("div",Ye,[a(M,{dense:"",modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=l=>t.search=l),label:"Search"},null,8,["modelValue"])]),d("div",Ne,[a(M,{dense:"",modelValue:t.dateFilter,"onUpdate:modelValue":o[1]||(o[1]=l=>t.dateFilter=l),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])]),Le])]),_:1})]),_:1}),d("div",null,[a(_e,{title:"Recent Releases","title-class":"text-h5 text-primary",columns:t.columns,rows:t.rows,"row-key":l=>l[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent releases",dense:""},{header:n(l=>[a(ne,{class:"bg-dark text-white",props:l},{default:n(()=>[a(re,{"auto-width":""}),(g(!0),k(ae,null,oe(l.cols,i=>(g(),E(re,{key:i.name,props:l},{default:n(()=>[z(L(i.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:n(l=>[a(ne,{props:l},{default:n(()=>[a(ie,{"auto-width":""},{default:n(()=>[a(le,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:i=>t.viewRelease(l.row),name:l.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(g(!0),k(ae,null,oe(l.cols,i=>(g(),E(ie,{key:i.name,props:l},{default:n(()=>[z(L(i.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":n(({message:l})=>[d("div",Me,[a(le,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),d("span",null,L(l),1)])]),"top-right":n(()=>[d("div",Ue,"(Total: "+L(t.getReleases(t.projectFilterValue).length)+" releases)",1),a(se,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[2]||(o[2]=l=>t.loadData(!0))}),a(se,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllReleases,disable:t.getReleases(t.projectFilterValue).length<1},null,8,["dense","onClick","disable"])]),loading:n(()=>[a(De,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Oe=B(Fe,[["render",xe]]);const Be={name:"Pipeline",components:{ProjectPipelineTable:Pe,projectSelector:te},setup(){const t=J(),o=H(),j=Z(),p=S(null),w=S(""),{getSelectedProject:$}=W(j),{fetchAllDeployments:m,fetchAllInProcess:l,fetchAllPending:i,getDeployments:V,getInProcess:P,getPending:T}=K(),{getManpowerData:F,setPipelines:D}=ee(),h=b(()=>o.params.id?o.params.id:null),f=b(()=>$.value?$.value[3]:null),C=b(()=>V(f.value).filter(s=>s[20]==="Complete")),q=b(()=>{const s=[];return V(f.value).forEach(y=>{y[31].toLowerCase().includes(w.value.toLowerCase())&&s.push(y)}),s}),Y=b(()=>{const s=[];return T(f.value).forEach(y=>{y[25].toLowerCase().includes(w.value.toLowerCase())&&s.push(y)}),s}),N=b(()=>{const s=[];return P(f.value).forEach(y=>{y[39].toLowerCase().includes(w.value.toLowerCase())&&s.push(y)}),s}),r=b(()=>{let s;return h.value?s=F({dataset:"pipelines",id:h.value})||[]:s=N.value.concat(Y.value.concat(q.value)),s}),c=async s=>{t.loading.show(),h.value?(s||!F({dataset:"pipelines",id:h.value}))&&await v():(await m(s),await l(s),await i(s)),t.loading.hide()},v=async()=>{const s=await Ve(h.value);D({id:h.value,data:s})};return c(),{projectFilter:p,arrived:C,allPipeline:r,search:w,loadData:c}}},ze={class:"text-h5 text-dark"},Xe={class:"text-body2 text-italic q-ml-sm"},He=d("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),We={class:"row items-center"},Ge={key:0,class:"col-12 col-md-3 q-px-sm"},Je={class:"col-12 col-md-3 q-px-sm"};function Ke(t,o,j,p,w,$){const m=A("projectSelector"),l=A("project-pipeline-table");return g(),k("div",null,[a(G,{flat:""},{default:n(()=>[a(O,{class:"q-pb-none"},{default:n(()=>[d("div",ze,[z(" Staffing Pipeline "),d("span",Xe,"("+L(p.allPipeline.length)+" total)",1)]),He]),_:1}),a(O,null,{default:n(()=>[d("div",We,[t.$route.params.id?I("",!0):(g(),k("div",Ge,[a(m,{dense:""})])),d("div",Je,[a(M,{dense:"",modelValue:p.search,"onUpdate:modelValue":o[0]||(o[0]=i=>p.search=i),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(l,{rows:p.allPipeline,onRefresh:o[1]||(o[1]=i=>p.loadData(!0))},null,8,["rows"])])}var Ze=B(Be,[["render",Ke]]);const et=X({name:"Employees",components:{RosterTab:be,NewArrivalsTab:Te,ReleasesTab:Oe,PipelineTab:Ze},setup(){return{tab:S(0)}}}),tt={class:"q-pa-md"};function at(t,o,j,p,w,$){const m=A("roster-tab"),l=A("new-arrivals-tab"),i=A("pipeline-tab"),V=A("releases-tab");return g(),E(ve,{style:{"max-width":"100vw"}},{default:n(()=>[d("div",tt,[a(fe,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[a(me,{modelValue:t.tab,"onUpdate:modelValue":o[0]||(o[0]=P=>t.tab=P),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:n(()=>[a(U,{name:0,label:t.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),a(U,{name:1,label:"New Arrivals"}),t.$route.name==="project-manpower"?(g(),E(U,{key:0,name:3,label:"Pipeline"})):I("",!0),t.$can("read","releases")?(g(),E(U,{key:1,name:2,label:"Releases"})):I("",!0)]),_:1},8,["modelValue"])]),_:1}),a(pe,{modelValue:t.tab,"onUpdate:modelValue":o[1]||(o[1]=P=>t.tab=P),animated:""},{default:n(()=>[a(x,{name:0},{default:n(()=>[a(m)]),_:1}),a(x,{name:1},{default:n(()=>[a(l)]),_:1}),a(x,{name:3},{default:n(()=>[a(i)]),_:1}),t.$can("read","releases")?(g(),E(x,{key:0,name:2},{default:n(()=>[a(V)]),_:1})):I("",!0)]),_:1},8,["modelValue"])])]),_:1})}var Xt=B(et,[["render",at]]);export{Xt as default};
