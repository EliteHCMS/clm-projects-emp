import{l as Q,bU as k,bT as N,r as D,bV as U,c as d,w as B,_ as I,b5 as A,A as V,B as $,d as r,br as b,cT as P,D as m,ar as T,cU as S,cS as X}from"./index.429672c4.js";import{a as z}from"./QSelect.4d6ed681.js";import{u as H}from"./use-quasar.e6ca1583.js";import{u as L}from"./dataStore.3d312598.js";import{u as O}from"./dataStore.59ac3960.js";import{g as G,q as J}from"./app.d59c0f43.js";import{dayjs as C}from"./dayjs.cdbadc74.js";import{u as K}from"./useQuerySaver.d29ff9ee.js";import{R as W}from"./rosterTable.91834651.js";import{_ as Z}from"./projectSelector.cd095ba1.js";const x=Q({props:{},components:{RosterTable:W,projectSelector:Z},setup(a){const s=H(),n=k(),h=N(),y=G(),f=D(""),i=D(null),u=D(null),{getSelectedProject:o}=U(y),{getAssignments:_,fetchAllAssignments:j,fetchAssignments:q}=L(),{getManpowerData:g,setRosters:R}=O(),l=d(()=>n.params.id?n.params.id:null),p=d(()=>o.value?o.value[3]:null),v=d(()=>{let e;return l.value?e=(g({dataset:"rosters",id:l.value})||[]).sort((c,M)=>c[1].$d<M[1].$d?1:-1):e=_(p.value).sort((t,c)=>t[1].$d<c[1].$d?1:-1),e.filter(t=>!t[112]&&t.latest&&t[102]==="Active")}),F=d(()=>{let e=[];return v.value.forEach(t=>{t[75].toLowerCase().includes(f.value.toLowerCase())&&e.push(t)}),e=i.value?e.filter(t=>C(t[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===C(i.value).tz("America/Chicago").format("MM/DD/YYYY")):e,e=u.value?e.filter(t=>t[68]===u.value):e,e.sort((t,c)=>t.employee[22]>c.employee[22]?1:-1)}),Y=d(()=>[...new Map(v.value.map(e=>[e[68],e[68]])).values()]),w=async e=>{s.loading.show(),n.query&&n.query.refresh&&(e=!0,h.push({query:{}})),l.value?(e||!g({dataset:"rosters",id:l.value}))&&await E():p.value?await q({projectId:p.value,refresh:e}):await j({refresh:e}),s.loading.hide()},E=async()=>{const e=`{'74'.EX.'${l.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:t}=await J.fetchFromHiringApp({fields:[K({type:"assignments",query:e})]});R({id:l.value,data:t})};return B(p,()=>{w()}),w(),{allAssignments:v,search:f,startDateFilter:i,craftFilter:u,craftOptions:Y,rows:F,loadData:w}}}),ee={class:"row items-center"},te={key:0,class:"col-12 col-md-3"},ae={class:"col-12 col-md-3 q-px-sm"},se={class:"col-12 col-md-3 q-px-sm"},oe={class:"col-12 col-md-3 q-px-sm"};function re(a,s,n,h,y,f){const i=A("projectSelector"),u=A("roster-table");return V(),$("div",null,[r(X,{flat:""},{default:b(()=>[r(P,null,{default:b(()=>[m("div",ee,[a.$route.params.id?T("",!0):(V(),$("div",te,[r(i,{dense:""})])),m("div",ae,[r(S,{dense:"",modelValue:a.search,"onUpdate:modelValue":s[0]||(s[0]=o=>a.search=o),label:"Search"},null,8,["modelValue"])]),m("div",se,[r(S,{dense:"",modelValue:a.startDateFilter,"onUpdate:modelValue":s[1]||(s[1]=o=>a.startDateFilter=o),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),m("div",oe,[r(z,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.craftFilter,"onUpdate:modelValue":s[2]||(s[2]=o=>a.craftFilter=o),options:a.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),r(u,{rows:a.rows,onRefreshData:s[3]||(s[3]=o=>a.loadData(!0)),title:"Active Roster"},null,8,["rows"])])}var we=I(x,[["render",re]]);export{we as E};
