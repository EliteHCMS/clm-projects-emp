import{Q as g,b as q,a as F}from"./QTabPanels.c6a0ab04.js";import{Q as S}from"./QTabs.dae2502b.js";import{Q as O}from"./QToolbar.85ee1da8.js";import{Q as B}from"./QPage.f2628afe.js";import{l as P,r as X,c as $,_ as Q,aZ as N,A as i,B as d,d as t,ao as y,y as L,bM as U,an as z,bi as n,D as H}from"./index.b48bafa3.js";import{u as M,q as j}from"./quickbase.76c41fac.js";import{dayjs as G}from"./dayjs.1b825f16.js";import{u as V}from"./dataStore.beef04c5.js";import{u as K}from"./use-quasar.ed3977b0.js";import{a as R,u as Z}from"./useQuerySaver.b8f46e72.js";import{u as I}from"./dataStore.708e0494.js";import{R as J}from"./requestData.69478950.js";import{N as W}from"./nameRequestData.0f4cc8e2.js";import"./use-panel.96b32d19.js";import"./touch.60582172.js";import"./selection.880c234f.js";import"./QResizeObserver.1d221316.js";import"./rtl.cf9bbe47.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.81a16957.js";import"./i18n.469ad19f.js";import"./api.004b0e8a.js";import"./QTable.a5b8e509.js";import"./QList.fb685d10.js";import"./QMarkupTable.971575d1.js";import"./QSelect.b8f07e1a.js";import"./QChip.a60f92f6.js";import"./QItemLabel.6755a8b9.js";import"./QMenu.c9ecf4aa.js";import"./position-engine.859102af.js";import"./use-fullscreen.0ef5a5d5.js";import"./QTr.a2300b34.js";import"./QTd.cb00d1da.js";import"./NameRequestGetEmployee.5673c53d.js";import"./QTooltip.b1ab7884.js";import"./workday.102c955e.js";import"./syncEmployeeWithWorkday.1c71591d.js";import"./workdayAPI.2451b62c.js";const Y=P({props:{type:String,project:Number,dataset:String},components:{RequestDataTable:J,NameRequestDataTable:W},setup(e){const a=K(),{capitalize:u}=L,{getOpenRequest:p,getPendingRequest:w,getClosedRequest:D,getNameRequest:r,setNameRequest:l,setOpenRequest:c,setPendingRequest:le,setClosedRequest:ie,removeData:A}=I(),{userData:C}=M(),v=X(!0),{getViewedProjects:E,updateViewedProjects:k}=V(),b=$(()=>E(e.project)),m=$(()=>b.value?b.value[e.dataset]?b.value[e.dataset]:[]:[]),h=s=>{v.value=!0;let o;e.type==="open"?(m.value.length===0||s)&&(o=[R({type:"requests",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'3'}`})],f(o)):e.type==="pending"?(m.value.length===0||s)&&(o=[R({type:"requests",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'2'}`})],f(o)):e.type==="closed"?(m.value.length===0||s)&&(o=[R({type:"requests",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'5'}`})],f(o)):e.type==="named"&&(m.value.length===0||s)&&(o=[Z({type:"names",query:`{'38'.EX.'${e.project}'}AND{'31'.XEX.'Cancelled'}AND{'31'.XEX.'Closed'}AND{'11'.XEX.true}`})],f(o))},f=async s=>{const{data:o}=e.type==="named"?await j.fetchFromHiringApp({fields:s}):await j.fetchFromProjectsApp({fields:s});k({id:e.project,dataset:e.dataset,data:o}),v.value=!1};function T(s){return`${u(s[6].toLowerCase())} ${u(s[7].toLowerCase())}`}async function _(s){a.dialog({title:"Confirm",message:`Are you sure you want to remove ${T(s)} from request# ${s[18]}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:o}=await j.upsertRecordsXML({to:"bsg4yb4wa",data:[{3:{value:s[3]},11:{value:!0},12:{value:G().tz("America/Chicago")},13:{value:`${C[35]} ${C[37]}`}}],fieldsToReturn:[15],formatObject:15});A({type:"nameRequest",key:o[0][15][38],item:o[0][15],storageKey:"storageNameRequest"})}catch(o){a.notify({type:"negative",message:"Cannot remove name request"}),console.log(o)}})}return h(),{configureFetch:h,removeName:_,loading:v,rows:m}}}),x={key:0},ee={key:1},te={key:2},ae={key:3};function oe(e,a,u,p,w,D){const r=N("request-data-table"),l=N("name-request-data-table");return i(),d("div",null,[e.type==="open"?(i(),d("div",x,[t(r,{loading:e.loading,requests:e.rows,status:"Open",onRefreshData:a[0]||(a[0]=c=>e.configureFetch(!0))},null,8,["loading","requests"])])):y("",!0),e.type==="pending"?(i(),d("div",ee,[t(r,{loading:e.loading,requests:e.rows,status:"Pending",onRefreshData:a[1]||(a[1]=c=>e.configureFetch(!0))},null,8,["loading","requests"])])):y("",!0),e.type==="closed"?(i(),d("div",te,[t(r,{loading:e.loading,requests:e.rows,status:"Closed",onRefreshData:a[2]||(a[2]=c=>e.configureFetch(!0))},null,8,["loading","requests"])])):y("",!0),e.type==="named"?(i(),d("div",ae,[t(l,{loading:e.loading,requests:e.rows,status:"Named",onRemoveName:e.removeName,onRefreshData:a[3]||(a[3]=c=>e.configureFetch(!0))},null,8,["loading","requests","onRemoveName"])])):y("",!0)])}var se=Q(Y,[["render",oe]]);const re=P({components:{RequestPanel:se},setup(){const e=X(0),a=U(),{getViewedProjects:u}=V(),p=$(()=>u(a.params.id));return{tab:e,project:p}}}),ne={class:"q-pa-sm"};function ue(e,a,u,p,w,D){const r=N("request-panel");return i(),z(B,{style:{"max-width":"100vw"}},{default:n(()=>[H("div",ne,[t(O,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[t(S,{align:"left",modelValue:e.tab,"onUpdate:modelValue":a[0]||(a[0]=l=>e.tab=l),dense:"","indicator-color":"accent"},{default:n(()=>[t(g,{name:0,label:"Open"}),t(g,{name:1,label:"Names"}),t(g,{name:2,label:"Pending"}),t(g,{name:3,label:"Complete"})]),_:1},8,["modelValue"])]),_:1}),t(F,{modelValue:e.tab,"onUpdate:modelValue":a[1]||(a[1]=l=>e.tab=l),animated:""},{default:n(()=>[t(q,{class:"q-pt-none",name:0},{default:n(()=>[t(r,{project:e.project[3],type:"open",dataset:"openRequests"},null,8,["project"])]),_:1}),t(q,{class:"q-pt-none",name:1},{default:n(()=>[t(r,{project:e.project[3],type:"named",dataset:"namedRequests"},null,8,["project"])]),_:1}),t(q,{class:"q-pt-none",name:2},{default:n(()=>[t(r,{project:e.project[3],type:"pending",dataset:"pendingRequests"},null,8,["project"])]),_:1}),t(q,{class:"q-pt-none",name:3},{default:n(()=>[t(r,{project:e.project[3],type:"closed",dataset:"closedRequests"},null,8,["project"])]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var Ie=Q(re,[["render",ue]]);export{Ie as default};
