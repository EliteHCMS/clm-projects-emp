var P=Object.defineProperty;var h=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var q=(i,a,e)=>a in i?P(i,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[a]=e,l=(i,a)=>{for(var e in a||(a={}))E.call(a,e)&&q(i,e,a[e]);if(h)for(var e of h(a))R.call(a,e)&&q(i,e,a[e]);return i};import{k as S,r as C,i as N,f as O,P as w,l as m}from"./index.5e954c71.js";import{s as j,S as F,a as v,q as t}from"./quickbase.80655e8b.js";import"./_commonjsHelpers.a26ce4be.js";import"./dayjs.73f0a33b.js";import"./index.7dbe61ef.js";import"./localForage.411e436b.js";import"./i18n.41ab3751.js";import"./api.840f2934.js";function L(i){if(i.hasOwnProperty("possibleRulesFor"))return i;var a=C(!0);i.on("updated",function(){a.value=!a.value});var e=i.possibleRulesFor.bind(i);return i.possibleRulesFor=function(o,r){return a.value=a.value,e(o,r)},i.can=i.can.bind(i),i.cannot=i.cannot.bind(i),i}var k=Symbol("ability");function T(){var i=N(k);if(!i)throw new Error("Cannot inject Ability instance because it was not provided");return i}function V(i){return"a"in i?"a":"this"in i?"this":"an"in i?"an":""}S({name:"Can",props:{I:String,do:String,a:[String,Function],an:[String,Function],this:[String,Function,Object],on:[String,Function,Object],not:Boolean,passThrough:Boolean,field:String},setup:function(a,e){var o=e.slots,r=a,n="do",s="on";if(n in a||(n="I",s=V(a)),!r[n])throw new Error("Neither `I` nor `do` prop was passed in <Can>");if(!o.default)throw new Error("Expects to receive default slot");var c=T();return function(){var d=c.can(r[n],r[s],r.field),y=a.not?!d:d;return a.passThrough?o.default({allowed:y,ability:c}):y?o.default():null}}});function A(i,a,e){if(!a||!(a instanceof j))throw new Error("Please provide an Ability instance to abilitiesPlugin plugin");i.provide(k,L(a)),e&&e.useGlobalProperties&&(i.config.globalProperties.$ability=a,i.config.globalProperties.$can=a.can.bind(a))}const U=i=>i.matched.some(a=>v.can(a.meta.action||"read",a.meta.resource));var H=O(({app:i,router:a})=>{try{const o=new DeviceUUID().get();w.has("clm-qb-id")||w.set("clm-qb-id",o,{expires:"365d",secure:!0,sameSite:"Strict"})}catch(e){console.log(e)}i.config.globalProperties.$subject=F,i.use(A,v,{useGlobalProperties:!0}),a.beforeEach(async(e,o,r)=>{const n=await t.isUserLoggedIn(),s=Object.assign({},e.query);if(n||t.logout(),s.office_id?(t.setOfficeLocation({rid:s.office_id}),!!s.qr&(s.qr==="3422"||s.qr===3422)&&t.setCheckIn(!0)):s.qr&&s.type&&t.setEvent(s,!0),o.fullPath==="/"&&!o.name){const f=await t.getIpInfo();if(f){if(f.country!==m.country)try{t.fetchIpInfo()}catch{}}else try{t.fetchIpInfo()}catch{}if(n){if(await t.reloadUserInfo({reAuthenticate:!0}),e.path==="/login"&&await t.startPageEnabled()&&m.pageType==="Candidate Kiosk")return await t.logout(),r({name:"start"})}else if(m.pageType==="Candidate Kiosk"&&(await t.updateStore(),e.path==="/login"&&await t.startPageEnabled()&&m.pageType==="Candidate Kiosk"))return r({name:"start"})}if(!U(e)){const f=e.path!=="/",p=await t.startPageEnabled();return!n&&m.pageType==="Candidate Kiosk"&&p?r({name:"start"}):r(n?{name:"not-authorized"}:{name:"login",query:l({},f&&{redirect:e.path})})}if(m.pageType==="Candidate Kiosk"&&e.name!=="bookmarks"&&e.name!=="start"){const f=await t.bookmarksValid(),p=await t.bookMarksOnly();if(f&&p)return r({name:"bookmarks"})}if(e.name==="bookmarks"&&!await t.bookmarksValid())return t.clearBookmarks(),r("/");if(e.meta.redirectIfLoggedIn&&n)return r("/");const c=await t.phoneNumberRequired(n),d=await t.emailRequired(n),y=await t.verifyRequired(n),b=await t.employeeLinkRequired(n),u=await t.getUserFromStore(n),I=await t.getSocialRequired(n),g=await t.getEvent(n);if(c||d)return o.name==="update-information"&&n&&e.query.rid?(e.query.phoneNumber&&await t.setPhoneNumber(e.query.phoneNumber),e.query.email&&await t.setEmail(e.query.email),r({path:"/",query:{}})):e.name!=="update-information"?r({name:"update-information",query:l(l({rid:u[3]},c&&{phoneNumberRequired:!0}),d&&{emailRequired:!0})}):Object.keys(e.query).length===0&&o.name!=="update-information"?r({name:"update-information",query:l(l({rid:u[3]},c&&{phoneNumberRequired:!0}),d&&{emailRequired:!0})}):r();if(o.name==="update-information"&&Object.keys(e.query).length>=1)return r({path:"/",query:{}});if(y)return o.name==="code-confirmation"&&n&&e.query.code?(await t.setVerified(!0),r({path:"/"})):e.name!=="code-confirmation"?r({name:"code-confirmation",query:{p:u[9]?u[9].phoneNumber:u[8].replace(/[^0-9]/g,""),rid:u[3]}}):Object.keys(e.query).length===0&&o.name!=="code-confirmation"?r({name:"code-confirmation",query:{p:u[9]?u[9].phoneNumber:u[8].replace(/[^0-9]/g,""),rid:u[3]}}):r();if(b||I)return o.name==="verify-identity"&&n&&e.query.verify?(e.query.rid?await t.setIdentityVerified(e.query.rid):await t.setIdentityVerified(!1),r({path:"/",query:{}})):e.name!=="verify-identity"?r({name:"verify-identity",query:{rid:u[3]}}):Object.keys(e.query).length===0&&o.name!=="verify-identity"?r({name:"verify-identity",query:{rid:u[3]}}):r();if(e.name==="verify-identity"){if(!b)return r({path:"/"})}else if(e.name==="code-confirmation")return!n&&e.query.ac?r():r({path:"/"});return n&&g&&g.type==="Training"&&g.qr&&e.name!=="training"?r({name:"training",query:g}):r()}),a.afterEach(async(e,o)=>{const r=await t.isUserLoggedIn();o.fullPath==="/"&&!o.name&&r&&await t.updateStore({reAuthenticate:!1})})});export{H as default};
