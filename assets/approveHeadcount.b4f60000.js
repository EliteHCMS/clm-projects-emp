import{l as Q,bU as k,r as b,c as w,_,A,aq as R,br as r,d as o,cS as B,bO as F,cT as v,cU as D,D as i,ac as g,cV as M,bW as h,cy as N}from"./index.d4eae66d.js";import{Q as O}from"./QForm.55d7c310.js";import{a as Y,u as y}from"./vee-validate.esm.58b5b94d.js";import{a as I,e as T,b as X}from"./array.59f93f43.js";import{g as G,q as C}from"./app.613d4acb.js";import{u as L}from"./use-quasar.bcab4131.js";import{u as P}from"./dataStore.1c488d7d.js";const W=Q({props:{project:Object},setup(e){const s=k(),c=L(),u=b(null),n=b(null),p=P(),{setApprovedHeadcount:d}=p,m=w(()=>s.params.id?s.params.id:e.project&&e.project[3]?e.project[3]:null),H=I({headcount:T().required().positive().integer().typeError("Headcount must be a positive integer").label("Headcount"),lastUpdateDate:X().required().typeError("Valid Date Only!").label("Date")}),{errors:U,handleSubmit:$,handleReset:E}=Y({validationSchema:H,initialValues:{lastUpdateDate:G.formatDate(new Date,"YYYY-MM-DD")}}),{value:S}=y("headcount"),{value:V}=y("lastUpdateDate"),j=$(async l=>{try{console.log(l),await q(l.lastUpdateDate),console.log(n.value);const t=[{6:{value:Number(l.headcount)},7:{value:l.lastUpdateDate},8:{value:m.value},12:{value:!0}}];n.value&&(t[0][3]={value:n.value});const{data:a}=await C.upsertRecordsXML({to:"bteqadt9j",fieldsToReturn:[3,6,7,8],data:t,formatObject:10});if(console.log(a),a&&a[0]&&a[0][3])d(`${a[0][3]} ${a[0][6]?a[0][6]:""} ${a[0][7]?a[0][7]:""} ${a[0][8]?a[0][8]:""}`),c.notify({position:"top-right",type:"positive",message:"Client Contracted Headcount successfully added"});else throw"Error in adding Client Contracted Headcount";f()}catch(t){console.log(t),c.notify({position:"top-right",type:"negative",message:"Error adding Client Contracted Headcount"})}}),q=async l=>{console.log(l);const{data:t}=await C.fetchFromProjectsApp({fields:[{14:{value:10},9:{value:1},8:{value:`{'8'.EX.'${m.value}'}AND{'7'.EX.'${l}'}`},7:{value:"Table Query"},6:{value:"bteqadt9j"}}]});console.log(t),n.value=t&&t[0]&&t[0][3]?t[0][3]:null},f=()=>{E(),u.value.hide()};return{approveHeadcountDialog:u,headcount:S,lastUpdateDate:V,formErrors:U,addHeadcount:j,closeHeadcountDialog:f}}}),x=i("div",{class:"text-h6 text-info"},"Add Client Contracted Headcount",-1),z={class:"text-caption"},J={class:"text-caption"};function K(e,s,c,u,n,p){return A(),R(N,{ref:"approveHeadcountDialog"},{default:r(()=>[o(B,{flat:"",style:{width:"400px"}},{default:r(()=>[o(O,{onSubmit:F(e.addHeadcount,["prevent"])},{default:r(()=>[o(v,null,{default:r(()=>[x]),_:1}),o(v,null,{default:r(()=>[o(D,{dense:"",label:"Headcount",type:"number",modelValue:e.headcount,"onUpdate:modelValue":s[0]||(s[0]=d=>e.headcount=d),"bottom-slots":"","stack-label":"",error:!!e.formErrors.headcount},{error:r(()=>[i("div",z,g(e.formErrors.headcount),1)]),_:1},8,["modelValue","error"]),o(D,{class:"q-mt-sm",dense:"",label:"Date",type:"date",modelValue:e.lastUpdateDate,"onUpdate:modelValue":s[1]||(s[1]=d=>e.lastUpdateDate=d),"bottom-slots":"","stack-label":"",error:!!e.formErrors.lastUpdateDate},{error:r(()=>[i("div",J,g(e.formErrors.lastUpdateDate),1)]),_:1},8,["modelValue","error"])]),_:1}),o(M,{class:"q-px-xs",align:"right"},{default:r(()=>[o(h,{color:"secondary",label:"Cancel",onClick:e.closeHeadcountDialog},null,8,["onClick"]),o(h,{color:"primary",label:"Submit",type:"submit",onClick:e.addHeadcount},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},512)}var le=_(W,[["render",K]]);export{le as a};
