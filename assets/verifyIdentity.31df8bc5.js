var ae=Object.defineProperty,te=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var F=(u,e,r)=>e in u?ae(u,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):u[e]=r,w=(u,e)=>{for(var r in e||(e={}))re.call(e,r)&&F(u,r,e[r]);if(B)for(var r of B(e))le.call(e,r)&&F(u,r,e[r]);return u},U=(u,e)=>te(u,se(e));import{Q as oe}from"./QImg.a66ee9ac.js";import{_ as ie,bN as ne,bM as ue,bL as ce,r as D,c as de,w as me,A as _,an as N,bi as o,B as pe,d as l,ao as x,D as f,cw as C,ab as O,bF as fe,bE as ve,cx as X,a7 as n,b as T,bI as R,cy as ge,bO as ye,cz as be}from"./index.b924195f.js";import{Q as he}from"./QForm.4f9bb515.js";import{Q as we}from"./QPage.2847b5f7.js";import{a as _e,u as M}from"./vee-validate.esm.873b912d.js";import{u as Ce}from"./i18n.41d907b6.js";import{u as Ie,F as qe,b as Ue,q as d}from"./quickbase.ba4c97f5.js";import{_ as Ne}from"./languageSelector.72acc2e0.js";import{a as xe,e as Se,c as Y,d as $e}from"./array.2e615be9.js";import{c as ke}from"./carousel.527829ff.js";import"./_commonjsHelpers.a26ce4be.js";import"./dayjs.db01f29f.js";import"./index.7dbe61ef.js";import"./localForage.2a99fead.js";import"./api.7991594d.js";import"./QSelect.4bb61d02.js";import"./QChip.a6d4ea6e.js";import"./QMenu.c4074360.js";import"./position-engine.d8e3a79c.js";import"./selection.92f3c7fa.js";import"./rtl.d0f7624c.js";import"./use-quasar.b47a00b3.js";import"./use-panel.8bee501f.js";import"./touch.9d375472.js";import"./use-fullscreen.58353ef7.js";const De={key:0,class:"col-md-7 col-lg-8 col-lx-8"},Re={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},Me={class:"text-dark"},Ee={class:"row"},Ae={class:"row"},Qe={class:"text-grey-6"},Ve={class:"row justify-center"},Le={__name:"verifyIdentity",setup(u){const e=Ie(),{employeeData:r,socialRequired:E,updateEmployeeData:K,setEmployee:z}=qe(),A=Ue(),{getCountry:c,currentLang:I}=ne(A),g=ue(),y=ce(),{t:m}=Ce(),p=D(!1),S=D("confirm-identity"),H=de(()=>xe({userRID:Se().required(),ssn:Y().required().matches(/^[0-9]{9}/g,{excludeEmptyString:!0,message:`${m("nineDigitsRequired")}`}).nullable().label(`${c.value==="CA"?m("socialInsuranceNumber"):m("socialSecurityNumber")}`),ssnConfirmation:Y().oneOf([$e("ssn"),null],`${c.value==="CA",m("socialInsuranceNumberMustMatch")}`).required().nullable().label(`${c.value==="CA"?m("socialInsuranceNumberConfirmation"):m("socialSecurityNumberConfirmation")}`)})),{errors:je,meta:Q}=_e({validationSchema:H,initialValues:{ssn:"",ssnConfirmation:""}}),{value:b}=M("userRID"),{value:i,errorMessage:V,meta:P}=M("ssn"),{value:h,errorMessage:L,meta:G}=M("ssnConfirmation"),q=D(!0);g.query.rid?(b.value=g.query.rid,i.value="",h.value="",y.replace({query:{}})):y.push("/"),me(()=>g.query,()=>{g.query.rid&&(b.value=g.query.rid,i.value="",h.value="",y.replace({query:{}}))});const J=async()=>{const a=d.getOfficeLocation();let t=1;I.value==="en-US"?t=1:I.value==="es"&&(t=2);const s=[U(w({20:{value:e.getUser[35]},22:{value:e.getUser[37]}},c.value==="CA"?{564:{value:i.value}}:{109:{value:i.value}}),{25:{value:e.getUser[9]?e.getUser[9].phoneNumber:e.getUser[8].replace(/[^0-9]/g,"")},28:{value:e.getUser[50]?"Yes":"No"},26:{value:e.getUser[6]},34:{value:e.getUser[49]?"Yes":"No"},16:{value:a?a.rid:""},339:{value:t}})],{data:v}=await d.upsertRecordsXML({to:"bp3gb7ng2",fieldsToReturn:[500],data:s,formatObject:500}),k=v[0][500];return e.userLoggedIn&&z(k,!0),k[3]},$=async a=>{const t=d.getOfficeLocation();let s=1;I.value==="en-US"?s=1:I.value==="es"&&(s=2);const v=U(w(U(w({3:{value:a},20:{value:e.getUser[35]},22:{value:e.getUser[37]}},c.value==="CA"?{564:{value:i.value}}:{109:{value:i.value}}),{25:{value:e.getUser[9]?e.getUser[9].phoneNumber:e.getUser[8].replace(/[^0-9]/g,"")},28:{value:e.getUser[50]?"Yes":"No"},26:{value:e.getUser[6]},34:{value:e.getUser[49]?"Yes":"No"}}),t&&{16:{value:t.rid}}),{339:{value:s}});return(await K({fields:v}))[3]},W=async a=>{const t=[{3:{value:e.getUser[86]},16:{value:a}}],{data:s}=await d.upsertRecordsXML({to:"br26nivmr",fieldsToReturn:[76],data:t,formatObject:76});return d.setCheckInData(s[0][76]),s[3]},Z=async()=>{const t=[{8:{value:`${c.value==="CA"?`{'564'.EX.'${i.value}'}`:`{'188'.EX.'${i.value}'}`}AND{'509'.EX.'false'} `},7:{value:"Employees"},9:{value:12}}],{data:s}=await d.fetchFromHiringApp({fields:t});return s[0]?s[0][3]:null},j=async()=>{if(p.value=!0,!Q.value.valid||!b.value||b.value==="")return p.value=!1,!1;let a=await Z();const t=new Date,s={3:{value:Number(b.value)},26:{value:t}};E&&a?(r[3]&&await d.softDeleteEmployee(r[3]),await $(a)):E&&!a&&r[3]?a=await $(r[3]):a?await $(a):a||(a=await J()),A.checkedIn&&W(a),s[80]={value:a},s[85]={value:!1};try{await d.updateUserData({fields:s}),p.value=!1,y.push({path:"/",query:w({verify:!0},a&&{rid:a})})}catch(v){p.value=!1,console.log(v)}p.value=!1},ee=()=>{e.logout().then(()=>{y.replace({name:"login"})})};return(a,t)=>(_(),N(we,{class:"window-height window-width row"},{default:o(()=>[a.$q.screen.lt.md?x("",!0):(_(),pe("div",De,[l(ke)])),f("div",Re,[l(be,{class:"auth-card",flat:""},{default:o(()=>[l(C,{style:{"padding-left":"30px","padding-right":"30px"}},{default:o(()=>[l(oe,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),l(C,{class:"text-center auth-description"},{default:o(()=>[f("p",Me,O(a.$t("pleaseVerifyInfoToCompleteRegistration")),1)]),_:1}),l(C,null,{default:o(()=>[l(he,{class:"q-px-sm q-pt-sm",onSubmit:t[3]||(t[3]=fe(()=>{},["prevent"])),onKeyup:ve(j,["enter"])},{default:o(()=>[f("div",Ee,[S.value==="confirm-identity"?(_(),N(X,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:n(i),"onUpdate:modelValue":t[0]||(t[0]=s=>T(i)?i.value=s:null),maxlength:"9",minlength:"9",type:"password",label:n(c)==="CA"?a.$t("socialInsuranceNumber"):a.$t("socialSecurityNumber"),tabindex:"1",error:!!(n(V)&&n(P).validated),"error-message":n(V)},{prepend:o(()=>[l(R,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):x("",!0)]),f("div",Ae,[S.value==="confirm-identity"?(_(),N(X,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:n(h),"onUpdate:modelValue":t[2]||(t[2]=s=>T(h)?h.value=s:null),maxlength:"9",minlength:"9",type:q.value?"password":"text",label:n(c)==="CA"?a.$t("confirmSIN"):a.$t("confirmSSN"),tabindex:"2",error:!!(n(L)&&n(G).validated),"error-message":n(L)},{prepend:o(()=>[l(R,{name:"lock"})]),append:o(()=>[l(R,{name:q.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:t[1]||(t[1]=s=>q.value=!q.value)},null,8,["name"])]),_:1},8,["modelValue","type","label","error","error-message"])):x("",!0)])]),_:1},8,["onKeyup"])]),_:1}),l(ge,{class:"q-px-lg"},{default:o(()=>[S.value==="confirm-identity"?(_(),N(ye,{key:0,loading:p.value,disable:!n(Q).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:a.$t("confirm"),tabindex:"3",onClick:j},null,8,["loading","disable","label"])):x("",!0)]),_:1}),l(C,{class:"text-center q-pa-sm"},{default:o(()=>[f("p",Qe,[f("a",{onClick:ee,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},O(a.$t("logout")),1)])]),_:1}),l(C,{class:"q-pl-lg q-pa-sm"},{default:o(()=>[f("div",Ve,[l(Ne,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var ma=ie(Le,[["__scopeId","data-v-83795308"]]);export{ma as default};
