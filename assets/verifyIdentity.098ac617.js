import{Q as T}from"./QImg.abde5195.js";import{_ as z,c5 as H,c4 as G,r as q,c as J,w as W,z as g,am as b,bh as o,A as Z,d as r,an as w,C as c,c2 as y,aa as E,bE as ee,bD as te,cx as M,a6 as l,b as Q,bX as I,cy as ae,c6 as se,c3 as re}from"./index.edfa0c83.js";import{Q as oe}from"./QForm.8e810a05.js";import{Q as le}from"./QPage.e761d77d.js";import{a as ie,e as ne,c as V,d as ue,b as ce,u as U}from"./array.f5eb0993.js";import{u as de}from"./i18n.043056eb.js";import{u as me,e as pe,c as fe,q as n}from"./quickbase.616d4b7a.js";import{_ as ve}from"./languageSelector.ac790bbc.js";import{c as ge}from"./carousel.ae98d503.js";import"./_commonjsHelpers.dfee5925.js";import"./dayjs.16167bfd.js";import"./localForage.569c3ab0.js";import"./index.7dbe61ef.js";import"./api.2b739922.js";import"./QSelect.2772f645.js";import"./QChip.9c229856.js";import"./QMenu.49b05e0d.js";import"./position-engine.e007a72a.js";import"./selection.8cdd1aa1.js";import"./rtl.65b79c69.js";import"./use-quasar.1a564e2d.js";import"./use-panel.cb82d623.js";import"./touch.d8ab472d.js";import"./use-fullscreen.4e661131.js";const ye={key:0,class:"col-md-7 col-lg-8 col-lx-8"},he={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},be={class:"text-dark"},we={class:"row"},_e={class:"row"},xe={class:"text-grey-6"},qe={class:"row justify-center"},Ie={__name:"verifyIdentity",setup(Ue){const t=me(),{employeeData:k,socialRequired:C,updateEmployeeData:L,setEmployee:j}=pe(),A=fe(),m=H(),p=G(),{t:D}=de(),u=q(!1),_=q("confirm-identity"),B=J(()=>ie({userRID:ne().required(),ssn:V().required().matches(/^[0-9]{9}/g,{excludeEmptyString:!0,message:`${D("nineDigitsRequired")}`}).nullable(),ssnConfirmation:V().oneOf([ue("ssn"),null],`${D("socialSecurityNumberMustMatch")}`).required().nullable()})),{errors:ke,meta:R}=ce({validationSchema:B,initialValues:{ssn:"",ssnConfirmation:""}}),{value:f}=U("userRID"),{value:i,errorMessage:S,meta:O}=U("ssn"),{value:v,errorMessage:N,meta:X}=U("ssnConfirmation"),h=q(!0);m.query.rid?(f.value=m.query.rid,i.value="",v.value="",p.replace({query:{}})):p.push("/"),W(()=>m.query,()=>{m.query.rid&&(f.value=m.query.rid,i.value="",v.value="",p.replace({query:{}}))});const F=async()=>{const e=n.getOfficeLocation(),a=[{20:{value:t.getUser[35]},22:{value:t.getUser[37]},109:{value:i.value},25:{value:t.getUser[9]?t.getUser[9].phoneNumber:t.getUser[8].replace(/[^0-9]/g,"")},28:{value:t.getUser[50]?"Yes":"No"},26:{value:t.getUser[6]},34:{value:t.getUser[49]?"Yes":"No"},16:{value:e?e.rid:""}}],{data:s}=await n.upsertRecordsXML({to:"bp3gb7ng2",fieldsToReturn:[500],data:a,formatObject:500}),d=s[0][500];return t.userLoggedIn&&j(d,!0),d[3]},x=async e=>{const a=n.getOfficeLocation(),s={3:{value:e},20:{value:t.getUser[35]},22:{value:t.getUser[37]},109:{value:i.value},25:{value:t.getUser[9]?t.getUser[9].phoneNumber:t.getUser[8].replace(/[^0-9]/g,"")},28:{value:t.getUser[50]?"Yes":"No"},26:{value:t.getUser[6]},34:{value:t.getUser[49]?"Yes":"No"},...a&&{16:{value:a.rid}}};return(await L({fields:s}))[3]},Y=async e=>{const a=[{3:{value:t.getUser[86]},16:{value:e}}],{data:s}=await n.upsertRecordsXML({to:"br26nivmr",fieldsToReturn:[76],data:a,formatObject:76});return n.setCheckInData(s[0][76]),s[3]},K=async()=>{const a=[{8:{value:`{'188'.EX.'${i.value}'}AND{'509'.EX.'false'}`},7:{value:"Employees"},9:{value:12}}],{data:s}=await n.fetchFromHiringApp({fields:a});return s[0]?s[0][3]:null},$=async()=>{if(u.value=!0,!R.value.valid||!f.value||f.value==="")return u.value=!1,!1;let e=await K();const a=new Date,s={3:{value:Number(f.value)},26:{value:a}};C&&e?(await n.softDeleteEmployee(k[3]),await x(e)):C&&!e?e=await x(k[3]):e?await x(e):e||(e=await F()),A.checkedIn&&Y(e),s[80]={value:e},s[85]={value:!1};try{await n.updateUserData({fields:s}),u.value=!1,p.push({path:"/",query:{verify:!0,...e&&{rid:e}}})}catch(d){u.value=!1,console.log(d)}u.value=!1},P=()=>{t.logout().then(()=>{p.replace({name:"login"})})};return(e,a)=>(g(),b(le,{class:"window-height window-width row"},{default:o(()=>[e.$q.screen.lt.md?w("",!0):(g(),Z("div",ye,[r(ge)])),c("div",he,[r(re,{class:"auth-card",flat:""},{default:o(()=>[r(y,{style:{"padding-left":"30px","padding-right":"30px"}},{default:o(()=>[r(T,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),r(y,{class:"text-center auth-description"},{default:o(()=>[c("p",be,E(e.$t("pleaseVerifyInfoToCompleteRegistration")),1)]),_:1}),r(y,null,{default:o(()=>[r(oe,{class:"q-px-sm q-pt-sm",onSubmit:a[3]||(a[3]=ee(()=>{},["prevent"])),onKeyup:te($,["enter"])},{default:o(()=>[c("div",we,[_.value==="confirm-identity"?(g(),b(M,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:l(i),"onUpdate:modelValue":a[0]||(a[0]=s=>Q(i)?i.value=s:null),maxlength:"9",minlength:"9",type:"password",label:e.$t("socialSecurityNumber"),tabindex:"1",error:!!(l(S)&&l(O).validated),"error-message":l(S)},{prepend:o(()=>[r(I,{name:"lock"})]),_:1},8,["modelValue","label","error","error-message"])):w("",!0)]),c("div",_e,[_.value==="confirm-identity"?(g(),b(M,{key:0,class:"col-xs-12",outlined:"",mask:"#########",modelValue:l(v),"onUpdate:modelValue":a[2]||(a[2]=s=>Q(v)?v.value=s:null),maxlength:"9",minlength:"9",type:h.value?"password":"text",label:e.$t("confirmSSN"),tabindex:"2",error:!!(l(N)&&l(X).validated),"error-message":l(N)},{prepend:o(()=>[r(I,{name:"lock"})]),append:o(()=>[r(I,{name:h.value?"visibility_off":"visibility",class:"cursor-pointer",onClick:a[1]||(a[1]=s=>h.value=!h.value)},null,8,["name"])]),_:1},8,["modelValue","type","label","error","error-message"])):w("",!0)])]),_:1},8,["onKeyup"])]),_:1}),r(ae,{class:"q-px-lg"},{default:o(()=>[_.value==="confirm-identity"?(g(),b(se,{key:0,loading:u.value,disable:!l(R).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:e.$t("confirm"),tabindex:"3",onClick:$},null,8,["loading","disable","label"])):w("",!0)]),_:1}),r(y,{class:"text-center q-pa-sm"},{default:o(()=>[c("p",xe,[c("a",{onClick:P,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},E(e.$t("logout")),1)])]),_:1}),r(y,{class:"q-pl-lg q-pa-sm"},{default:o(()=>[c("div",qe,[r(ve,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var Je=z(Ie,[["__scopeId","data-v-6ab66e94"]]);export{Je as default};
