import{Q as N}from"./QPage.85fd4be8.js";import{k as w,c as b,_ as S,A as n,B as u,d as c,bi as i,D as o,ab as y,bJ as F,bH as A,au as L,cy as P,bO as U,bF as B,r as H,aZ as Y,an as p,cw as h,cz as O,ao as $,w as V,F as C,aY as M,bk as x,bI as z,cZ as T,bM as J,G}from"./index.3bd8bff3.js";import{u as j,a as I}from"./dataStore.d626384f.js";import{q as Q}from"./quickbase.7e9e049d.js";import{Q as Z}from"./QSelect.8411b3cd.js";import{Q as W}from"./QForm.3d814e67.js";import{a as E,b as X,u as K}from"./array.836c569d.js";import{u as ee}from"./use-quasar.94e7f076.js";import{u as te}from"./dataStore.8ec64a1e.js";import{dayjs as f}from"./dayjs.238de433.js";import{d as se}from"./decode.593c6ccc.js";import{Q as ae}from"./QRating.335815be.js";import{Q as oe}from"./QList.3180ed89.js";import{a as le}from"./index.7dbe61ef.js";import"./localForage.cfd98bcf.js";import"./_commonjsHelpers.a26ce4be.js";import"./i18n.475c5698.js";import"./api.a28dd52c.js";import"./QChip.fff575e1.js";import"./QItemLabel.349706c0.js";import"./QMenu.ade1759f.js";import"./position-engine.6bd25d23.js";import"./selection.d55c238c.js";import"./rtl.cf9bbe47.js";const ne=w({emits:["supUpdated"],props:{record:Object},setup(e,{emit:r}){const d=ee(),{getAssignments:a,fetchAssignments:l}=te(),m=b(()=>a(e.record[74]).filter(_=>_[138]&&_[3]!==e.record[3]).sort((_,g)=>_[75]>g[75]?1:-1)),t=b(()=>E({selection:E().required().nullable().label("Supervisor")})),{errors:s,handleSubmit:v,handleReset:q}=X({validationSchema:t}),{value:R}=K("selection"),k=v(async D=>{const _=[{3:{value:e.record[3]},133:{value:D.selection[3]}}];try{const{data:g}=await Q.upsertRecordsXML({to:"bp3gazpqj",data:_,fieldsToReturn:[110],formatObject:110});console.log(g),r("supUpdated",g[0][110]),d.notify({type:"positive",message:"Supervisor successfully updated!"})}catch(g){console.log(g),d.notify({type:"negative",message:"Cannot save supervisor."}),q()}});return l({projectId:e.record[74],refresh:!0}),{props:e,options:m,selection:R,submit:k,formErrors:s,handleReset:q}}}),ie={class:"text-caption"};function re(e,r,d,a,l,m){return n(),u("div",null,[c(W,{onSubmit:B(e.submit,["prevent"])},{default:i(()=>[c(Z,{dense:"",clearable:"",label:"Select a Supervisor","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":r[0]||(r[0]=t=>e.selection=t),options:e.options,"option-label":t=>`${t[75]} - ${t[20]}`,"display-value":`${e.selection?e.selection[75]:""}`,"bottom-slots":"",error:!!e.formErrors.selection},{error:i(()=>[o("div",ie,y(e.formErrors.selection),1)]),"no-option":i(()=>[c(F,null,{default:i(()=>[c(A,{class:"text-grey"},{default:i(()=>[L(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","error"]),c(P,{align:"right"},{default:i(()=>[c(U,{color:"info",label:"Submit",type:"submit"}),c(U,{color:"secondary",label:"Cancel",onClick:e.handleReset},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var de=S(ne,[["render",re]]);const ce=w({props:{employee:Object,assignment:Object},components:{UpdateSupervisor:de},setup(e){const r=H(!1),{setAssignmentsByEmployee:d}=j();return{props:e,supUpdated:l=>{r.value=!1,d({id:l[18],data:l})},editSup:r}}}),ue=o("div",{class:"text-h6 q-pb-sm"},"Assign a Supervisor",-1),me={class:"row text-body2"},pe={class:"col-12 col-md-6"},ve=o("div",{class:"q-mb-xs"},"Current Location",-1),ye={class:"q-pl-sm"},fe={class:"col-12 col-md-6"},be=o("div",{class:"q-mb-xs"},"Current Supervisor",-1),_e={class:"q-pl-sm"};function ge(e,r,d,a,l,m){const t=Y("update-supervisor");return n(),u("div",null,[e.assignment&&e.assignment[3]?(n(),p(O,{key:0,class:"text-dark"},{default:i(()=>[e.editSup?(n(),p(h,{key:0},{default:i(()=>[ue,c(t,{record:e.assignment,onSupUpdated:e.supUpdated},null,8,["record","onSupUpdated"])]),_:1})):(n(),p(h,{key:1},{default:i(()=>[o("div",me,[o("div",pe,[ve,o("div",ye,y(e.assignment[141]),1)]),o("div",fe,[be,o("div",_e,y(e.assignment[140]===""?"N/A":e.assignment[140]),1)])])]),_:1}))]),_:1})):$("",!0)])}var he=S(ce,[["render",ge]]);const $e=w({props:{employee:Object,assignment:Object},components:{},setup(e){const{getWorkdayData:r}=j(),d=({id:s,idType:v})=>v.includes("J&amp;E")?s.slice(-5):s,a=b(()=>[]),l=b(()=>{const s=r(e.employee[3]);let v;if(s&&!e.employee[207]){const{employmentData:q,personalData:R}=s,{positionData:k,workerStatus:D}=q,{jobProfile:_}=k,{identificationData:g}=R;v=[{label:"Position",value:`${k.positionId} ${k.positionTitle}`},{label:"Job Profile",value:`${_.jobProfileId} - ${_.jobProfileName}`},{label:se(g.customIds[0].idType),value:d(g.customIds[0])},{label:"Hire Date",value:f(D.hireDate).format("MM/DD/YYYY")},{label:"Original Hire Date",value:f(D.originalHireDate).format("MM/DD/YYYY")},{label:"Years Since Last Hire",value:f().diff(D.hireDate,"year",!0).toFixed(2)}]}else v=[];return v}),m=b(()=>{let s;return e.assignment[3]?s=[{label:"Project",value:e.assignment[94]},{label:"Job Title",value:e.assignment[20]}]:s=[],s}),t=b(()=>a.value.concat(m.value).concat(l.value));return V(l,(s,v)=>{console.log(r(e.employee[3]))}),{props:e,details:t}}}),De=o("div",{class:"text-h6 text-weight-bold"},"Job Details",-1),ke=o("div",{class:"text-body1 text-primary text-italic"},"Employee has a pending release.",-1),we={class:"row"},Se={class:"col-12 col-md-4"},qe={class:"text-body2"},Ye={class:"col-12 col-md-8"},Ce={class:"text-body2 text-weight-light"};function je(e,r,d,a,l,m){return n(),u("div",null,[c(O,{class:"text-dark"},{default:i(()=>[c(h,{class:"q-pb-sm"},{default:i(()=>[De]),_:1}),e.employee[581]?(n(),p(h,{key:0,class:"q-py-sm"},{default:i(()=>[ke]),_:1})):$("",!0),(n(!0),u(C,null,M(e.details,t=>(n(),p(h,{key:t,class:"q-py-sm"},{default:i(()=>[o("div",we,[o("div",Se,[o("div",qe,y(t.label),1)]),o("div",Ye,[o("div",Ce,y(t.value),1)])])]),_:2},1024))),128))]),_:1})])}var Qe=S($e,[["render",je]]);const Re=async e=>{console.log(e);const r=await Q.getFileAttachmentUrl(e);console.log(r),le.get(r).then(d=>d.blob()).then(d=>{const a=URL.createObjectURL(d),l=document.createElement("a");l.href=a,l.download=r.replace(/^.*[\\/]/,""),document.body.appendChild(l),l.click(),URL.revokeObjectURL(a),l.remove()})},Ae=w({props:{employee:Object},components:{},setup(e){const{getReleases:r,setReleases:d}=j(),a=b(()=>r(e.employee[581])),l=b(()=>{let s;return a.value&&a.value[3]?s=[{label:"Reason",value:a.value[32]},{label:"Last Hire Date",value:f(e.employee[397].$d).format("MM/DD/YYYY")},{label:"Last Day On Site",value:f(a.value[36].$d).format("MM/DD/YYYY")},{label:"Returned Equipment",value:a.value[72]?"Yes":"No"},{label:"Pay Deduct Needed",value:!a.value[72]&&f.duration(f(a.value[36].$d).diff(f(e.employee[397].$d))).asDays()<30?"Yes":"No"},{label:"CAAP Rating",value:a.value[59]&&a.value[59].length>0?a.value[59][0][37]:0,type:"rating"},{label:"Submitted By",value:`${a.value[38][35]} ${a.value[38][37]}`},{label:"Submitted On",value:f(a.value[1].$d).tz(f.tz.guess()).format("MM/DD/YYYY hh:mm a")},{label:"Comments",value:a.value[60],type:"comments"}]:s=[],s}),m=async()=>{if(!a.value&&e.employee[581]){const{data:s}=await Q.fetchFromHiringApp({fields:[I({type:"releases",query:"",id:e.employee[581]})]},{action:"read",type:"release"});console.log(s),d({id:s[3],data:s})}},t=s=>{console.log(s)};return m(),{releaseDetails:l,release:a,downloadFile:Re,getFile:t}}}),Ue={class:"row items-center"},Me=o("div",{class:"col-12 col-md-7"},[o("div",{class:"text-h6 text-weight-bold"},"Pending Release Details")],-1),Oe={key:0,class:"col-12 col-md-5"},Ee={class:"row"},Fe={class:"col-12 col-md-5"},Le={class:"text-body2"},Pe={class:"col-12 col-md-7"},Ve={key:0},Ie={key:1,class:"text-body2 text-weight-light"},Ne={key:1,class:"text-body2 text-weight-light"},Be={class:"text-body1 text-weight-bold q-mb-xs"},He={class:"text-body2 text-italic text-primary q-pl-md"},xe=o("div",{class:"text-body1 text-weight-bold q-mb-xs"},"Supporting Docs",-1);function ze(e,r,d,a,l,m){return n(),u("div",null,[c(O,{class:"text-dark"},{default:i(()=>[c(h,{class:"q-pb-sm"},{default:i(()=>[o("div",Ue,[Me,e.release?(n(),u("div",Oe,[c(P,{align:"right"},{default:i(()=>[c(U,{size:"md",flat:"",dense:"",label:"View Release",color:"info",to:{name:"view-ee-release",params:{id:e.release[25],release:e.release[3]}}},null,8,["to"])]),_:1})])):$("",!0)])]),_:1}),(n(!0),u(C,null,M(e.releaseDetails,t=>(n(),u(C,{key:t},[t.type!=="comments"?(n(),p(h,{key:0,class:"q-py-sm"},{default:i(()=>[o("div",Ee,[o("div",Fe,[o("div",Le,y(t.label),1)]),o("div",Pe,[t.type==="rating"?(n(),u("div",Ve,[t.value>0?(n(),p(ae,{key:0,modelValue:t.value,"onUpdate:modelValue":s=>t.value=s,max:"5",size:"sm",color:"accent",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"])):(n(),u("div",Ie,"Not Available"))])):(n(),u("div",Ne,y(t.value),1))])])]),_:2},1024)):t.value!==""?(n(),p(h,{key:1},{default:i(()=>[o("div",Be,y(t.label),1),o("div",He,y(t.value),1)]),_:2},1024)):$("",!0)],64))),128)),e.release&&e.release[70].length>0?(n(),p(h,{key:0},{default:i(()=>[xe,c(oe,null,{default:i(()=>[(n(!0),u(C,null,M(e.release[70],(t,s)=>x((n(),p(F,{key:s,clickable:"",class:"text-body2",onClick:v=>e.downloadFile(t.url)},{default:i(()=>[c(A,null,{default:i(()=>[L(y(s+1)+". "+y(t[7]),1)]),_:2},1024),c(A,{avatar:""},{default:i(()=>[c(z,{color:"info",name:"file_download"})]),_:1})]),_:2},1032,["onClick"])),[[T]])),128))]),_:1})]),_:1})):$("",!0)]),_:1})])}var Te=S(Ae,[["render",ze]]);const Je=w({components:{LocationAndManager:he,EmployeeJobDetails:Qe,PendingReleaseDetails:Te},setup(){const e=J(),{getEmployee:r,getAssignmentsByEmployee:d,setAssignmentsByEmployee:a}=j(),l=b(()=>r(e.params.id)),m=b(()=>l.value?d(l.value[3]):null),t=async()=>{if(!m.value&&l.value[577]){const{data:s}=await Q.fetchFromHiringApp({fields:[I({type:"assignments",query:"",id:l.value[577]})]});console.log(s),a({id:l.value[3],data:s})}};return V(l,(s,v)=>{s&&t()}),{employee:l,assignment:m}}}),Ge={class:"q-pa-sm"},Ze={class:"row"},We={class:"col-12 col-md-6 q-px-xs"},Xe={key:1},Ke={key:0};function et(e,r,d,a,l,m){const t=Y("location-and-manager"),s=Y("employee-job-details"),v=Y("pending-release-details");return n(),p(N,{style:{"max-width":"100vw"}},{default:i(()=>[o("div",Ge,[o("div",Ze,[o("div",We,[e.employee&&e.employee[408]==="Active"?(n(),p(t,{key:0,employee:e.employee,assignment:e.assignment},null,8,["employee","assignment"])):$("",!0),e.employee&&e.assignment?(n(),u("div",Xe,[e.assignment[21]==="In Process"?(n(),p(s,{key:0,class:"q-mt-md",assignment:e.assignment,employee:e.employee},null,8,["assignment","employee"])):$("",!0)])):$("",!0)]),o("div",{class:G(["col-12 col-md-6 q-px-xs",(e.employee&&e.employee[581],"")])},[e.employee&&e.employee[581]?(n(),u("div",Ke,[c(v,{employee:e.employee},null,8,["employee"])])):$("",!0)],2)])])]),_:1})}var St=S(Je,[["render",et]]);export{St as default};
