import{l as N,bM as Q,r as p,bN as k,c as u,w as I,_ as B,aZ as g,A as V,B as y,d as r,bi as b,cw as P,D as m,ao as z,cx as S,cz as U}from"./index.b924195f.js";import{a as X}from"./QSelect.4bb61d02.js";import{u as H}from"./use-quasar.b47a00b3.js";import{u as L}from"./dataStore.434cbe76.js";import{u as O}from"./dataStore.a037e9aa.js";import{I as T,q as G}from"./quickbase.ba4c97f5.js";import{dayjs as j}from"./dayjs.db01f29f.js";import{u as Z}from"./useQuerySaver.ae1b8d62.js";import{R as J}from"./rosterTable.77c32f7d.js";import{_ as K}from"./projectSelector.fcca7541.js";const W=N({props:{},components:{RosterTable:J,projectSelector:K},setup(a){const o=H(),f=Q(),h=T(),d=p(null),v=p(""),n=p(null),i=p(null),{getSelectedProject:s}=k(h),{getAssignments:C,fetchAllAssignments:_,fetchAssignments:F}=L(),{getManpowerData:A,setRosters:R}=O(),l=u(()=>f.params.id?f.params.id:null),$=u(()=>s.value?s.value[3]:null),w=u(()=>{let e;return l.value?e=(A({dataset:"rosters",id:l.value})||[]).sort((c,M)=>c[1].$d<M[1].$d?1:-1):e=C($.value).sort((t,c)=>t[1].$d<c[1].$d?1:-1),e.filter(t=>!t[112]&&t.latest&&t[102]==="Active")}),Y=u(()=>{let e=[];return w.value.forEach(t=>{t[75].toLowerCase().includes(v.value.toLowerCase())&&e.push(t)}),e=n.value?e.filter(t=>j(t[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===j(n.value).tz("America/Chicago").format("MM/DD/YYYY")):e,e=i.value?e.filter(t=>t[68]===i.value):e,e.sort((t,c)=>t.employee[22]>c.employee[22]?1:-1)}),q=u(()=>[...new Map(w.value.map(e=>[e[68],e[68]])).values()]),D=async e=>{o.loading.show(),l.value?(e||!A({dataset:"rosters",id:l.value}))&&await E():d.value?await F({projectId:$.value,refresh:e}):await _({refresh:e}),o.loading.hide()},E=async()=>{const e=`{'74'.EX.'${l.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:t}=await G.fetchFromHiringApp({fields:[Z({type:"assignments",query:e})]});R({id:l.value,data:t})};return I(d,()=>{D(!1)}),D(!1),{allAssignments:w,projectFilter:d,search:v,startDateFilter:n,craftFilter:i,craftOptions:q,rows:Y,loadData:D}}}),x={class:"row items-center"},ee={key:0,class:"col-12 col-md-3"},te={class:"col-12 col-md-3 q-px-sm"},ae={class:"col-12 col-md-3 q-px-sm"},oe={class:"col-12 col-md-3 q-px-sm"};function se(a,o,f,h,d,v){const n=g("projectSelector"),i=g("roster-table");return V(),y("div",null,[r(U,{flat:""},{default:b(()=>[r(P,null,{default:b(()=>[m("div",x,[a.$route.params.id?z("",!0):(V(),y("div",ee,[r(n,{dense:""})])),m("div",te,[r(S,{dense:"",modelValue:a.search,"onUpdate:modelValue":o[0]||(o[0]=s=>a.search=s),label:"Search"},null,8,["modelValue"])]),m("div",ae,[r(S,{dense:"",modelValue:a.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=s=>a.startDateFilter=s),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),m("div",oe,[r(X,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:a.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=s=>a.craftFilter=s),options:a.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),r(i,{rows:a.rows,onRefreshData:o[3]||(o[3]=s=>a.loadData(!0)),title:"Active Roster"},null,8,["rows"])])}var ve=B(W,[["render",se]]);export{ve as E};
