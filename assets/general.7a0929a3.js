import{Q as he,a as Se,b as je}from"./QTabPanels.9c932a84.js";import{Q as De}from"./QTabs.644694c1.js";import{Q as Oe}from"./QPage.094f6505.js";import{u as te}from"./use-quasar.30e2351a.js";import{l as ae,r as V,c as D,_ as oe,b6 as W,B as p,C as L,d as s,bs as n,E as N,ad as S,bX as q,as as M,cW as Q,bP as fe,ar as P,cA as ke,H as ie,cV as se,F as B,b5 as K,cU as ce,a6 as Ae,w as ve,a9 as h,b as G,cX as Ce,bV as de,ay as ue,z as Xe,bW as qe}from"./index.5232afe7.js";import{q as g,u as Le,c as Ue,g as Me}from"./app.062f4def.js";import{dayjs as Te}from"./dayjs.2bff5ac3.js";import{a as J,c as z,e as Ie}from"./array.59f93f43.js";import{a as Z,b as pe}from"./useQuerySaver.d29ff9ee.js";import{u as ne}from"./dataStore.9b754527.js";import{a as me}from"./QSelect.4306c154.js";import{Q as be}from"./QForm.0fd20abe.js";import{a as ye,u as T}from"./vee-validate.esm.54bd3c83.js";import{A as Fe,a as ze}from"./addNewCustomer.46241dc6.js";import{Q as ge}from"./QInnerLoading.1fb22ddf.js";import{a as _,Q as we}from"./QTable.6be9dbf0.js";import{Q as x}from"./QTr.c7fc819d.js";import{Q as Qe}from"./QTooltip.9bbededf.js";import{Q as ee}from"./QTd.5d1ee424.js";import{u as He}from"./project.c55be83e.js";import{s as Je}from"./states.03e3d448.js";import{p as We}from"./VueTelInput.e6837c84.js";import{u as Be}from"./dataStore.01d22159.js";import{a as Ye}from"./approveHeadcount.9d241394.js";import{d as H}from"./decode.3998c82c.js";import"./use-panel.14734608.js";import"./touch.3df10340.js";import"./selection.45123347.js";import"./QResizeObserver.2a509e99.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.74051d05.js";import"./api.84dea7bc.js";import"./index.04bc0a32.js";import"./i18n.f53252d6.js";import"./QChip.ee987a92.js";import"./QMenu.478f57e8.js";import"./position-engine.8e7d05ef.js";import"./QList.99d4c070.js";import"./QMarkupTable.2d16af9f.js";import"./use-fullscreen.ef7e4a1b.js";const Ge=ae({emits:["cancelEdit"],components:{AddProjectLocationForm:Fe,AddCustomerForm:ze},props:{config:Object},setup(e,{emit:l}){const d=V(null),c=V(null),f=V(!1),j=async()=>{const{type:i,initialValue:C}=e.config;if(i==="options"){const{getter:y}=e.config;c.value=await y(),d.value=c.value,b.value=C(d.value)}else b.value=C},u=D(()=>J({entry:e.config.formRules})),{meta:o,errors:t,handleSubmit:k}=ye({validationSchema:u}),{value:b}=T("entry"),$=(i,C)=>{const{filter:y}=e.config;i===""&&C(()=>{d.value=c.value}),C(()=>{const v=i.toLowerCase();d.value=y(c.value,v)})},r=i=>{f.value=!1,c.value.push(i),d.value.push(i),b.value=i},a=k(async i=>{const{setter:C}=e.config;await C(i.entry),l("cancelEdit")});return j(),{rawOptions:c,options:d,entry:b,formErrors:t,formMeta:o,submit:a,filterOptions:$,addNew:f,newOptionAdded:r}}}),Ke={key:0,class:"q-pr-xl"},Ze={class:"text-caption"},_e={key:0,class:"text-center bg-info"},xe={key:0,class:"text-center bg-info"},et={key:1,class:"q-pr-xl"},tt={class:"text-caption"};function at(e,l,d,c,f,j){const u=W("add-project-location-form"),o=W("add-customer-form");return p(),L("div",null,[s(be,{onSubmit:fe(e.submit,["prevent"])},{default:n(()=>[e.config.type==="options"?(p(),L("div",Ke,[s(me,{class:"q-mb-sm",dense:"",label:`Select a ${e.config.fieldLabel}`,"transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":l[3]||(l[3]=t=>e.entry=t),options:e.options,"option-label":e.config.optionLabel,"display-value":`${e.entry?e.entry[e.config.displayValue]:""}`,"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":"","use-input":"","input-debounce":"0",onFilter:e.filterOptions,clearable:"",loading:!e.rawOptions,disable:!e.rawOptions},{error:n(()=>[N("div",Ze,S(e.formErrors.entry),1)]),after:n(()=>[s(q,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),s(q,{color:"dark",icon:"close",dense:"",onClick:l[0]||(l[0]=t=>e.$emit("cancelEdit"))})]),"after-options":n(()=>[e.config.allowNew&&e.options&&e.options.length>0?(p(),L("div",_e,[s(q,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:l[1]||(l[1]=t=>e.addNew=!0)},null,8,["label"])])):M("",!0)]),"no-option":n(()=>[e.config.allowNew?(p(),L("div",xe,[s(q,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:l[2]||(l[2]=t=>e.addNew=!0)},null,8,["label"])])):M("",!0)]),_:1},8,["label","modelValue","options","option-label","display-value","error","onFilter","loading","disable"])])):M("",!0),e.config.type==="input"?(p(),L("div",et,[s(Q,{class:"q-mb-sm",dense:"",label:e.config.fieldLabel,modelValue:e.entry,"onUpdate:modelValue":l[5]||(l[5]=t=>e.entry=t),"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":""},{error:n(()=>[N("div",tt,S(e.formErrors.entry),1)]),after:n(()=>[s(q,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),s(q,{color:"dark",icon:"close",dense:"",onClick:l[4]||(l[4]=t=>e.$emit("cancelEdit"))})]),_:1},8,["label","modelValue","error"])])):M("",!0)]),_:1},8,["onSubmit"]),s(ke,{modelValue:e.addNew,"onUpdate:modelValue":l[8]||(l[8]=t=>e.addNew=t)},{default:n(()=>[e.config.newType==="location"?(p(),P(u,{key:0,onCancelAdd:l[6]||(l[6]=t=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):M("",!0),e.config.newType==="customer"?(p(),P(o,{key:1,onCancelAdd:l[7]||(l[7]=t=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):M("",!0)]),_:1},8,["modelValue"])])}var ot=oe(Ge,[["render",at]]);const rt=ae({emits:[],props:{item:Object},components:{EditDetailsForm:ot},setup(e,{emit:l}){const d=V(!1),c=D(()=>{const{permission:f}=e.item.editable&&e.item.config?e.item.config:{action:null,subject:null};return f});return{edit:d,permission:c}}}),lt={key:0,class:"row"},st={class:"col-12 col-md-4"},nt={class:"col-12 col-md-8"};function it(e,l,d,c,f,j){const u=W("edit-details-form");return p(),P(se,{class:"q-py-sm"},{default:n(()=>[e.edit?(p(),P(u,{key:1,type:e.item.label,config:e.item.config,onCancelEdit:l[1]||(l[1]=o=>e.edit=!1)},null,8,["type","config"])):(p(),L("div",lt,[N("div",st,[N("div",null,[N("span",{class:ie(e.$q.screen.gt.lg?"text-body2":"text-caption")},S(e.item.label),3)])]),N("div",nt,[N("div",null,[N("span",{class:ie(["text-weight-light",e.$q.screen.gt.lg?"text-body2":"text-caption"])},S(e.item.value),3),e.item.editable&&e.$can(e.permission.action,e.permission.subject)?(p(),P(q,{key:0,color:"accent",flat:"",dense:"",round:"",icon:"edit",size:"sm",onClick:l[0]||(l[0]=o=>e.edit=!0)})):M("",!0)])])]))]),_:1})}var ut=oe(rt,[["render",it]]);const dt=ae({props:{title:String,details:Array},components:{DetailsSection:ut}}),ct={class:"text-body1 text-white"};function pt(e,l,d,c,f,j){const u=W("details-section");return p(),L("div",null,[s(ce,{class:"text-dark q-pb-sm"},{default:n(()=>[e.title&&e.title!==""?(p(),P(se,{key:0,class:"bg-info q-py-sm"},{default:n(()=>[N("div",ct,S(e.title.toUpperCase()),1)]),_:1})):M("",!0),(p(!0),L(B,null,K(e.details,o=>(p(),P(u,{key:o,item:o},null,8,["item"]))),128))]),_:1})])}var mt=oe(dt,[["render",pt]]);const ft={class:"q-pa-md q-gutter-sm"},vt={class:"text-body1 text-white"},bt={__name:"projectJobNumber",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:l}){const d=e,c=te(),{getViewedProjects:f,updateViewedProjects:j}=ne(),{prompt:u,record:o}=Ae(d),t=V(!1),k=V(!1),b=D(()=>o.value&&o.value.projectId?f(o.value.projectId):null),$=D(()=>b.value&&b.value.crafts?b.value.crafts:[]),r=D(()=>J({jobNumber:z().required().label("Job Number"),description:z().required().label("Description"),craft:J().nullable().required().label("Craft Required")})),{errors:a,handleSubmit:i,handleReset:C}=ye({validationSchema:r}),{value:y}=T("jobNumber"),{value:v}=T("description"),{value:m}=T("craft"),O=V("add"),I=V("Project Job Number");ve(u,async R=>{if(o.value&&o.value.projectId&&$.value.length===0){const{data:E}=await g.fetchFromProjectsApp({fields:[Z({type:"projectCrafts",query:`{'7'.EX.'${o.value.projectId}'}`})]});j({id:o.value.projectId,dataset:"crafts",data:E})}R===!0&&(t.value=!0,o.value&&o.value[3]?(I.value=`Edit Job Number ${o.value[11]}`,O.value="edit",y.value=o.value[11],o.value[20]==="N/A"?v.value="":v.value=o.value[20],m.value=$.value?$.value.find(E=>E[3]===o.value[14]):null):(I.value="New Job Number",O.value="add"))});const A=i(async R=>{try{k.value=!0;const E={11:{value:R.jobNumber},20:{value:R.description},14:{value:R.craft[3]}};o.value[3]&&(E[3]={value:o.value[3]}),o.value.projectId&&(E[6]={value:o.value.projectId}),await g.upsertRecordsXML({to:"bpzpwr2eh",data:[E],fieldsToReturn:[35],formatObject:35}),U(),k.value=!1,F(!0)}catch{k.value=!1,X()}}),F=R=>{C(),t.value=!1,l(R?"update":"canceled")},U=()=>{O.value==="add"?c.notify({type:"positive",message:"Record added."}):O.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},X=R=>{O.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):O.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(R,E)=>(p(),L("div",ft,[s(ke,{modelValue:t.value,"onUpdate:modelValue":E[4]||(E[4]=w=>t.value=w),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(A),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[N("div",vt,S(I.value),1)]),_:1}),s(se,null,{default:n(()=>[s(Q,{dense:"",modelValue:h(y),"onUpdate:modelValue":E[0]||(E[0]=w=>G(y)?y.value=w:null),label:"Job Number *",readonly:O.value==="edit",error:!!h(a).jobNumber,"error-message":h(a).jobNumber},null,8,["modelValue","readonly","error","error-message"]),s(me,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:h(m),"onUpdate:modelValue":E[1]||(E[1]=w=>G(m)?m.value=w:null),options:$.value,"option-label":"10",error:!!h(a).craft,"error-message":h(a).craft},null,8,["modelValue","options","error","error-message"]),s(Q,{dense:"",modelValue:h(v),"onUpdate:modelValue":E[2]||(E[2]=w=>G(v)?v.value=w:null),label:"Description *",error:!!h(a).description,"error-message":h(a).description},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(q,{color:"secondary",onClick:E[3]||(E[3]=w=>F(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":"",disable:k.value},null,8,["size","disable"]),s(q,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":"",disable:k.value},null,8,["size","disable"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},yt=[{name:0,label:"Job Number",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Craft",align:"left",field:e=>e[15],format:e=>`${e}`,sortable:!0,required:!0}],gt=ae({components:{projectJobNumber:bt},props:{project:String},setup(e){const l=te(),d=de(),c=V(!0),f=V(!1),j=V(null),{getViewedProjects:u,updateViewedProjects:o}=ne(),t=V(d.params.id?d.params.id:e.project);ve(()=>d.params.id,y=>{t.value=d.params.id});const k=D(()=>u(t.value)),b=D(()=>{const y=k.value&&k.value.jobNumbers?k.value.jobNumbers:[];return y.length>0?y.sort((v,m)=>v[1].$d>m[1].$d?1:-1):y}),$=async y=>{if(c.value=!0,f.value=!1,b.value.length===0||y){const{data:v}=await g.fetchFromProjectsApp({fields:[Z({type:"jobNumbers",query:`{'6'.EX.'${t.value}'}AND{'29'.EX.'Active'}`})]});o({id:t.value,dataset:"jobNumbers",data:v})}c.value=!1};function r(y){l.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${y[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{a(y)})}async function a(y){try{const{data:v}=await g.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:y[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35}),m=b.value.filter(O=>O[3]!==v[0][35][3]);o({id:t.value,dataset:"jobNumbers",data:m}),l.notify({type:"positive",message:"Job Number Removed"})}catch(v){console.log(v),l.notify({type:"negative",message:"Something went wrong"})}}const i=y=>{y?j.value={projectId:t.value,...y}:j.value={projectId:t.value},f.value=!0},C=()=>{f.value=!1,j.value=null};return $(),{projectData:k,jobNumberColumns:yt,rows:b,initialPagination:{rowsPerPage:V(10)},showAddJobNumber:f,removeRow:r,loadData:$,loading:c,record:j,openJobNumber:i,jobNumberClosed:C}}}),wt={class:"text-caption"};function $t(e,l,d,c,f,j){const u=W("project-job-number");return p(),L("div",null,[s(we,{dense:"",title:"Job Numbers","title-class":"text-primary",style:{},columns:e.jobNumberColumns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{label:"Loading...","label-class":"text-info"})]),"top-left":n(()=>[e.$can("create","projectJobNumbers")||e.$can("manage","projects")?(p(),P(q,{key:0,dense:"",color:"accent",label:"Add New",onClick:l[0]||(l[0]=o=>e.openJobNumber())})):M("",!0)]),"top-right":n(()=>[s(q,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:l[1]||(l[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[s(Qe,{anchor:"top middle",self:"top middle"},{default:n(()=>[ue("Description: "+S(o.row[20]),1)]),_:2},1024),(p(!0),L(B,null,K(o.cols,t=>(p(),P(ee,{key:t.name,props:o},{default:n(()=>[N("span",wt,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(p(),P(q,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openJobNumber(o.row)},null,8,["onClick"])):M("",!0),e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(p(),P(q,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(o.row)},null,8,["onClick"])):M("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAddJobNumber,record:e.record,onUpdate:l[2]||(l[2]=o=>e.loadData(!0)),onCanceled:e.jobNumberClosed},null,8,["prompt","record","onCanceled"])])}var ht=oe(gt,[["render",$t]]);const jt={class:"q-pa-md q-gutter-sm"},Ct={class:"text-body1 text-white"},Nt={__name:"projectPerDiem",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:l}){const d=e,c=te(),f=V(!1),j=D(()=>J({miles:z().required().label("Contract Miles"),rule:z().required().label("Rule"),amount:Ie().required().label("Per-Diem Amount"),approval:z().nullable().label("Approval"),mapRequired:z().nullable().required().label("Map Required").oneOf(["Yes","No",""]),idRequired:z().nullable().required().label("ID Required").oneOf(["Yes","No",""])})),{errors:u,handleSubmit:o,handleReset:t}=ye({validationSchema:j}),{value:k}=T("miles"),{value:b}=T("rule"),{value:$}=T("amount"),{value:r}=T("approval"),{value:a}=T("mapRequired"),{value:i}=T("idRequired"),C=V("add"),y=V("Project Per Diem"),{prompt:v,record:m}=Ae(d);ve(v,U=>{U===!0&&(f.value=!0,m.value&&m.value[3]?(y.value=`Edit #${m.value[3]} Per Diem`,C.value="edit",k.value=m.value[6],b.value=m.value[11],$.value=m.value[10],r.value=m.value[7]||"",a.value=m.value[23]||"",i.value=m.value[24]||""):(y.value="New Per Diem",C.value="add"))});const O=o(async U=>{try{const X={6:{value:U.miles},11:{value:U.rule},10:{value:U.amount},7:{value:U.approval},23:{value:U.mapRequired},24:{value:U.idRequired}};m.value[3]&&(X[3]={value:m.value[3]}),m.value.projectId&&(X[12]={value:m.value.projectId}),await g.upsertRecordsXML({to:"bp5mpfxia",data:[X],fieldsToReturn:[39],formatObject:39}),A(),I(!0)}catch{F()}}),I=U=>{t(),f.value=!1,l(U?"update":"canceled")},A=()=>{C.value==="add"?c.notify({type:"positive",message:"Record added."}):C.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},F=U=>{C.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):C.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(U,X)=>(p(),L("div",jt,[s(ke,{modelValue:f.value,"onUpdate:modelValue":X[7]||(X[7]=R=>f.value=R),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(O),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[N("div",Ct,S(y.value),1)]),_:1}),s(se,null,{default:n(()=>[s(Q,{dense:"",modelValue:h(b),"onUpdate:modelValue":X[0]||(X[0]=R=>G(b)?b.value=R:null),label:"Rule *",error:!!h(u).rule,"error-message":h(u).rule},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(k),"onUpdate:modelValue":X[1]||(X[1]=R=>G(k)?k.value=R:null),label:"Contract Miles *",error:!!h(u).miles,"error-message":h(u).miles},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h($),"onUpdate:modelValue":X[2]||(X[2]=R=>G($)?$.value=R:null),label:"Per-Diem Amount *",type:"number",error:!!h(u).amount,"error-message":h(u).amount},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(r),"onUpdate:modelValue":X[3]||(X[3]=R=>G(r)?r.value=R:null),label:"Approval",error:!!h(u).approval,"error-message":h(u).approval},null,8,["modelValue","error","error-message"]),s(me,{"transition-show":"flip-up","transition-hide":"flip-down",dense:"",modelValue:h(i),"onUpdate:modelValue":X[4]||(X[4]=R=>G(i)?i.value=R:null),options:["Yes","No"],label:"DL/ID Required? *",error:!!h(u).idRequired,"error-message":h(u).idRequired},null,8,["modelValue","error","error-message"]),s(me,{"transition-show":"flip-up","transition-hide":"flip-down",dense:"",modelValue:h(a),"onUpdate:modelValue":X[5]||(X[5]=R=>G(a)?a.value=R:null),options:["Yes","No"],label:"Map Required? *",error:!!h(u).mapRequired,"error-message":h(u).mapRequired},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(q,{color:"secondary",onClick:X[6]||(X[6]=R=>I(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":""},null,8,["size"]),s(q,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":""},null,8,["size"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},kt=[{name:0,label:"Rule",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Miles",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0,required:!0},{name:2,label:"Amount",align:"left",field:e=>e[10],format:e=>e?`$ ${e.toFixed(2)}`:"",sortable:!0,required:!0}],Rt=ae({components:{projectPerDiem:Nt},props:{project:String},setup(e){const l=te(),d=de(),c=V(!0),f=V(null),{getViewedProjects:j,updateViewedProjects:u}=ne(),o=D(()=>d.params.id?d.params.id:e.project),t=D(()=>j(o.value)),k=D(()=>(t.value&&t.value.perDiem?t.value.perDiem:[]).sort((v,m)=>v[1].$d>m[1].$d?1:-1)),b=async y=>{if(c.value=!0,$.value=!1,k.value.length===0||y){const{data:v}=await g.fetchFromProjectsApp({fields:[Z({type:"perDiemSpecs",query:`{'12'.EX.'${o.value}'}AND{'38'.EX.'Active'}`})]});u({id:o.value,dataset:"perDiem",data:v})}c.value=!1},$=V(!1);He(),D(()=>(t.value&&t.value.jobNumbers?t.value.jobNumbers:[]).sort((v,m)=>v[1].$d>m[1].$d?1:-1));function r(y){l.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${y[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{a(y)})}async function a(y){try{const{data:v}=await g.upsertRecordsXML({to:"bp5mpfxia",data:[{3:{value:y[3]},38:{value:"Inactive"}}],fieldsToReturn:[39],formatObject:39}),m=k.value.filter(O=>O[3]!==v[0][39][3]);u({id:o.value,dataset:"perDiem",data:m})}catch(v){console.log(v),l.notify({type:"negative",message:"Something went wrong"})}}const i=y=>{y?f.value=y:f.value={projectId:o.value},$.value=!0},C=()=>{$.value=!1,f.value=null};return b(),{projectData:t,columns:kt,rows:k,initialPagination:{rowsPerPage:V(8)},showAddJobNumber:$,removeRow:r,loadData:b,loading:c,openPerDiem:i,perDiemClosed:C,record:f}}}),Vt={class:"text-caption"};function At(e,l,d,c,f,j){const u=W("project-per-diem");return p(),L("div",null,[s(we,{dense:"",title:"Per-Diem","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","projectPerDiem")||e.$can("manage","projects")?(p(),P(q,{key:0,dense:"",color:"accent",label:"Add New",onClick:l[0]||(l[0]=o=>e.openPerDiem())})):M("",!0)]),"top-right":n(()=>[s(q,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:l[1]||(l[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(ee,{key:t.name,props:o},{default:n(()=>[N("span",Vt,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(p(),P(q,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openPerDiem(o.row)},null,8,["onClick"])):M("",!0),e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(p(),P(q,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(o.row)},null,8,["onClick"])):M("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAddJobNumber,record:e.record,onUpdate:l[2]||(l[2]=o=>e.loadData(!0)),onCanceled:e.perDiemClosed},null,8,["prompt","record","onCanceled"])])}var qt=oe(Rt,[["render",At]]);const Et=ae({emits:["cancelAdd","addComplete"],props:{project:Object},setup(e,{emit:l}){const d=te(),c=de(),{getViewedProjects:f,updateViewedProjects:j}=ne(),u=D(()=>c.params.id?c.params.id:e.project[3]?e.project[3]:null),o=D(()=>u.value?f(u.value):null),t=J({name:z().required().label("Location Name"),street1:z().required().label("Street Address 1"),street2:z(),city:z().required().label("City"),state:z().required().label("State"),postal:z().required().label("Postal Code")}),{meta:k,errors:b,handleSubmit:$,handleReset:r}=ye({validationSchema:t}),{value:a}=T("name"),{value:i}=T("street1"),{value:C}=T("street2"),{value:y}=T("city"),{value:v}=T("state"),{value:m}=T("postal"),O=$(async I=>{const A={6:{value:I.name},8:{value:I.street1},9:{value:I.street2?I.street2:""},10:{value:I.city},11:{value:I.state},12:{value:I.postal},13:{value:"United States"}};o.value[8]&&Object.assign(A,{15:{value:o.value[8]}});try{const{data:F}=await g.upsertRecordsXML({to:"bp5d2twyj",data:[A],fieldsToReturn:[22],formatObject:22}),U=o.value.meetingLocations;U.push(F[0][22]),j({id:u.value,dataset:"meetingLocations",data:U}),d.notify({type:"positive",message:`Meeting location ${F[0][22][6]} successfully added`}),l("addComplete"),r()}catch(F){console.log(F),d.notify({type:"negative",message:"Something went wrong!"})}});return{projectObject:o,formErrors:b,formMeta:k,submit:O,name:a,street1:i,street2:C,city:y,state:v,postal:m,states:Je}}}),Pt={class:"row"},Lt={class:"col-6 col-md-12"},St={class:"text-caption"},Dt={class:"text-caption"},Ot={class:"text-caption"},Xt={class:"text-caption"},Ut={class:"text-caption"};function Mt(e,l,d,c,f,j){return p(),L("div",null,[s(be,{onSubmit:fe(e.submit,["prevent"])},{default:n(()=>[s(ce,null,{default:n(()=>[s(se,null,{default:n(()=>[N("div",Pt,[N("div",Lt,[s(Q,{label:"Location Name",dense:"",modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=u=>e.name=u),error:!!e.formErrors.name,"bottom-slots":""},{error:n(()=>[N("div",St,S(e.formErrors.name),1)]),_:1},8,["modelValue","error"]),s(Q,{label:"Street Address 1",dense:"",modelValue:e.street1,"onUpdate:modelValue":l[1]||(l[1]=u=>e.street1=u),error:!!e.formErrors.street1,"bottom-slots":""},{error:n(()=>[N("div",Dt,S(e.formErrors.street1),1)]),_:1},8,["modelValue","error"]),s(Q,{label:"Street Address 2",dense:"",modelValue:e.street2,"onUpdate:modelValue":l[2]||(l[2]=u=>e.street2=u),error:!!e.formErrors.street2,"bottom-slots":""},{error:n(()=>[N("div",Ot,S(e.formErrors.street2),1)]),_:1},8,["modelValue","error"]),s(Q,{label:"City",dense:"",modelValue:e.city,"onUpdate:modelValue":l[3]||(l[3]=u=>e.city=u),error:!!e.formErrors.city,"bottom-slots":""},{error:n(()=>[N("div",Xt,S(e.formErrors.city),1)]),_:1},8,["modelValue","error"]),s(me,{dense:"",label:"State","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.state,"onUpdate:modelValue":l[4]||(l[4]=u=>e.state=u),options:e.states,"bottom-slots":""},null,8,["modelValue","options"]),s(Q,{label:"Postal Code",dense:"",modelValue:e.postal,"onUpdate:modelValue":l[5]||(l[5]=u=>e.postal=u),error:!!e.formErrors.postal,"bottom-slots":""},{error:n(()=>[N("div",Ut,S(e.formErrors.postal),1)]),_:1},8,["modelValue","error"])])])]),_:1}),s(Ce,{align:"right"},{default:n(()=>[s(q,{color:"secondary",label:"Cancel",onClick:l[6]||(l[6]=u=>e.$emit("cancelAdd"))}),s(q,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Tt=oe(Et,[["render",Mt]]);const It=[{name:0,label:"Location Name",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0},{name:1,label:"Address",align:"left",field:e=>e[8],format:e=>`${e}`,sortable:!1,required:!0}],Ft=ae({components:{AddMeetingLocation:Tt},props:{project:String},setup(e){const l=te(),d=de(),c=V(!0),f=V(!1),{getViewedProjects:j,updateViewedProjects:u}=ne(),o=D(()=>d.params.id?d.params.id:e.project),t=D(()=>j(o.value)),k=D(()=>t.value&&t.value.meetingLocations?t.value.meetingLocations:[]),b=async a=>{if(c.value=!0,(k.value.length===0||a)&&t.value){const{data:i}=await g.fetchFromStructureApp({fields:[pe({type:"meetingLocations",query:`{'15'.EX.'${t.value[8]}'}AND{'14'.EX.'Active'}`})]});u({id:o.value,dataset:"meetingLocations",data:i})}c.value=!1};function $(a){console.log(a),l.dialog({title:"Confirm",message:`Are you sure you want to remove location ${a[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{r(a)})}async function r(a){try{const{data:i}=await g.upsertRecordsXML({to:"bp5d2twyj",data:[{3:{value:a[3]},14:{value:"Inactive"}}],fieldsToReturn:[22],formatObject:22}),C=k.value.filter(y=>y[3]!==i[0][22][3]);u({id:o.value,dataset:"meetingLocations",data:C}),l.notify({type:"positive",message:"Meeting Location Removed"})}catch(i){console.log(i),l.notify({type:"negative",message:"Something went wrong"})}}return b(),{projectData:t,columns:It,rows:k,initialPagination:{rowsPerPage:V(8)},showAdd:f,removeRow:$,loadData:b,loading:c}}}),zt={class:"text-caption"};function Qt(e,l,d,c,f,j){const u=W("add-meeting-location");return p(),L("div",null,[e.showAdd?M("",!0):(p(),P(we,{key:0,dense:"",title:"Meeting Locations","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[s(q,{dense:"",color:"accent",label:"Add New",onClick:l[0]||(l[0]=o=>e.showAdd=!0)})]),"top-right":n(()=>[s(q,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:l[1]||(l[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(ee,{key:t.name,props:o},{default:n(()=>[N("span",zt,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[s(q,{color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(o.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(p(),P(u,{key:1,onAddComplete:l[2]||(l[2]=o=>e.showAdd=!1),onCancelAdd:l[3]||(l[3]=o=>e.showAdd=!1)})):M("",!0)])}var Ht=oe(Ft,[["render",Qt]]);const Jt={class:"q-pa-md q-gutter-sm"},Wt={class:"text-body1 text-white"},Bt={__name:"projectSiteContact",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:l}){const d=e,c=te(),f=V(10),j=V(null),u=V(!1),o=D(()=>{const R=new RegExp("^[0-9]{"+f.value+"}","g");return J({firstName:z().required().label("First Name"),lastName:z().required().label("Last Name"),email:z().email().required().label("Email"),phoneNumber:z().matches(R,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number")})}),{errors:t,handleSubmit:k,handleReset:b}=ye({validationSchema:o}),{value:$}=T("firstName"),{value:r}=T("lastName"),{value:a}=T("email"),{value:i}=T("phoneNumber"),C=V("add"),y=V("Project Site Contact"),{prompt:v,record:m}=Ae(d);ve(v,R=>{R===!0&&(u.value=!0,m.value&&m.value[3]?(y.value=`Edit #${m.value[3]} ${m.value[17]}`,C.value="edit",$.value=m.value[28],r.value=m.value[29],i.value=m.value[20].replace(/\D/g,""),a.value=m.value[21]):(y.value="New Site Contact",C.value="add"))});const O=k(async R=>{try{const E={28:{value:R.firstName},29:{value:R.lastName},30:{value:R.phoneNumber},31:{value:R.email}};m.value[3]&&(E[3]={value:m.value[3]}),m.value.projectId&&(E[7]={value:m.value.projectId}),await g.upsertRecordsXML({to:"bp5hcce69",data:[E],fieldsToReturn:[27],formatObject:27}),U(),F(!0)}catch{X()}}),I=R=>{j.value=R},A=R=>{f.value=R},F=R=>{b(),u.value=!1,l(R?"update":"canceled")},U=()=>{C.value==="add"?c.notify({type:"positive",message:"Record added."}):C.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},X=R=>{C.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):C.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(R,E)=>(p(),L("div",Jt,[s(ke,{modelValue:u.value,"onUpdate:modelValue":E[5]||(E[5]=w=>u.value=w),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(O),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[N("div",Wt,S(y.value),1)]),_:1}),s(se,null,{default:n(()=>[s(Q,{dense:"",modelValue:h($),"onUpdate:modelValue":E[0]||(E[0]=w=>G($)?$.value=w:null),label:"First Name *",error:!!h(t).firstName,"error-message":h(t).firstName},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(r),"onUpdate:modelValue":E[1]||(E[1]=w=>G(r)?r.value=w:null),label:"Last Name *",error:!!h(t).lastName,"error-message":h(t).lastName},null,8,["modelValue","error","error-message"]),s(We,{name:"phoneNumber",class:"col-xs-12 col-sm-12",dense:"",modelValue:h(i),"onUpdate:modelValue":E[2]||(E[2]=w=>G(i)?i.value=w:null),label:"Phone Number",tabindex:"3",onMaxLengthChanged:A,error:!!h(t).phoneNumber,"error-message":h(t).phoneNumber,onCountryChanged:I},null,8,["modelValue","error","error-message"]),s(Q,{dense:"",modelValue:h(a),"onUpdate:modelValue":E[3]||(E[3]=w=>G(a)?a.value=w:null),label:"Email *",type:"email",error:!!h(t).email,"error-message":h(t).email},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(q,{color:"secondary",onClick:E[4]||(E[4]=w=>F(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":""},null,8,["size"]),s(q,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":""},null,8,["size"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},{capitalize:Pe}=Xe,Ve=e=>{const l=e.split(" ");let d="";return l.forEach((c,f)=>{d+=f>0?` ${Pe(c.toLowerCase())}`:Pe(c.toLowerCase())}),d},Yt=[{name:0,label:"Name",align:"left",field:e=>e[17],format:e=>`${Ve(e)}`,sortable:!0},{name:1,label:"Phone",align:"left",field:e=>e[20],format:e=>e!==""?`${e}`:"N/A",sortable:!0,required:!0}],Gt=ae({components:{projectSiteContact:Bt},props:{project:String},setup(e){const l=te(),d=de(),c=V(!0),f=V(null),{getViewedProjects:j,updateViewedProjects:u}=ne(),o=D(()=>d.params.id?d.params.id:e.project),t=D(()=>j(o.value)),k=D(()=>(t.value&&t.value.siteContacts?t.value.siteContacts:[]).sort((m,O)=>m[17]>O[17]?1:-1)),b=async v=>{if(c.value=!0,k.value.length===0||v){const{data:m}=await g.fetchFromProjectsApp({fields:[Z({type:"siteContacts",query:`{'7'.EX.'${o.value}'}AND{'6'.EX.'Active'}`})]});u({id:o.value,dataset:"siteContacts",data:m})}c.value=!1},$=V(!1);function r(v){l.dialog({title:"Confirm",message:`Are you sure you want to remove contact ${Ve(v[17])}?`,cancel:!0,persistent:!0}).onOk(()=>{a(v)})}async function a(v){try{const{data:m}=await g.upsertRecordsXML({to:"bp5hcce69",data:[{3:{value:v[3]},6:{value:"Inactive"}}],fieldsToReturn:[27],formatObject:27}),O=k.value.filter(I=>I[3]!==m[0][27][3]);u({id:o.value,dataset:"siteContacts",data:O}),l.notify({type:"positive",message:"Contact Removed"})}catch(m){console.log(m),l.notify({type:"negative",message:"Something went wrong"})}}const i=v=>{$.value=!1,b(!0)},C=v=>{v?f.value=v:f.value={projectId:o.value},$.value=!0},y=()=>{$.value=!1,f.value=null};return b(),{projectData:t,columns:Yt,rows:k,initialPagination:{rowsPerPage:V(8)},showAdd:$,removeRow:r,loadData:b,loading:c,properValue:Ve,contactAdded:i,record:f,openSiteContact:C,siteContactClosed:y}}}),Kt={class:"text-caption"};function Zt(e,l,d,c,f,j){const u=W("project-site-contact");return p(),L("div",null,[s(we,{dense:"",title:"Contacts","title-class":"text-primary",style:{"max-height":"300px"},columns:e.columns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","projectContacts")||e.$can("manage","projects")?(p(),P(q,{key:0,dense:"",color:"accent",label:"Add New",onClick:l[0]||(l[0]=o=>e.openSiteContact())})):M("",!0)]),"top-right":n(()=>[s(q,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:l[1]||(l[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(ee,{key:t.name,props:o},{default:n(()=>[N("span",Kt,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectContacts")||e.$can("manage","projects")?(p(),P(q,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openSiteContact(o.row)},null,8,["onClick"])):M("",!0),e.$can("manage","projectContacts")||e.$can("manage","projects")?(p(),P(q,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(o.row)},null,8,["onClick"])):M("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAdd,record:e.record,onUpdate:l[2]||(l[2]=o=>e.loadData(!0)),onCanceled:e.siteContactClosed},null,8,["prompt","record","onCanceled"])])}var _t=oe(Gt,[["render",Zt]]);const xt=ae({components:{},props:{project:Object},setup(e,l){const d=te(),c=V(10),f=V(null),{getUser:j}=qe(Le()),u=V(null),o=D(()=>{const w=new RegExp("^[0-9]{"+c.value+"}","g");return J({firstName:z().required().label("First Name"),lastName:z().required().label("Last Name"),email:z().email().required().label("Email"),phoneNumber:z().matches(w,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),role:J().required().nullable().label("Role"),workdayId:z().required().label("Workday ID")})}),{meta:t,errors:k,handleSubmit:b,handleReset:$}=ye({validationSchema:o}),{value:r}=T("firstName"),{value:a}=T("lastName"),{value:i}=T("email"),{value:C}=T("phoneNumber"),{value:y}=T("role"),{value:v}=T("workdayId");async function m({accessID:w}){const{data:Y}=await g.upsertRecordsXML({to:"br598isx6",data:[{3:{value:w},20:{value:!0}}],fieldsToReturn:[28],formatObject:28});l.emit("userAdded",{user:Y[0][28]}),d.loading.hide(),$()}async function O(w,Y){g.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:w},10:{value:"Active"},11:{value:Y}}]});const{data:$e}=await g.fetchFromStructureApp({fields:[{6:{value:"br598isx6"},7:{value:"Table Query"},8:{value:`{'6'.EX.${w}}`},9:{value:1},14:{value:24}}]});if(new Set($e.filter(le=>le[7]==="Project").map(le=>le[9])).has(e.project[3])){const le=$e.find(Re=>Re[9]===e.project[3]);m({accessID:le[3]})}else return!1}async function I(w){const Y=`{'6'.EX.'${w.email}'}AND{'8'.EX.'${w.phoneNumber}'}AND{'32'.EX.'${w.userType}'}`,$e=[{7:{value:"User Request"},8:{value:Y},9:{value:1},14:{value:77}}];if(Y==="{'10'.EX.'Active'}AND{'32'.EX.'Candidate'}"||Y==="{'10'.EX.'Active'}AND{'32'.EX.'Project User'}")throw{response:{data:{errtext:"Unknown username",errdetail:"Sorry! Something's wrong. Try again."}}};const{data:re}=await g.fetchFromStructureApp({fields:$e});if(re.length<1)return null;if(!await O(re[0][3],w.role))return re}const A=b(async w=>{d.loading.show();const Y={userType:"Project User",phoneNumber:`+${f.value?f.value.dialCode:"1"}${w.phoneNumber}`,email:w.email,role:w.role[3]};if(e.project.users.filter(re=>re[6]===Y.email||re[8]===Y.phoneNumber).length>0)d.dialog({title:"Alert",message:"Your project already has a user with that phone or email."}).onOk(()=>{l.emit("userCanceled")});else{const re=await I(Y);if(console.log(re),re){const{data:le}=await g.upsertRecordsXML({to:"br598isx6",data:[{6:{value:re[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});le.length>0&&l.emit("userAdded",{user:le[0][28]})}else{const le=i.value.match(/^([^@]*)@/)[1],Re=Object.assign({phoneNumber:C.value},f.value),{data:Ee}=await g.upsertRecordsXML({to:"br4pxrbs6",data:[{6:{value:w.email},7:{value:"temp"},8:{value:`+${f.value?f.value.dialCode:"1"}${w.phoneNumber}`},9:{value:JSON.stringify(Re)},10:{value:"Active"},11:{value:w.role[3]},17:{value:!0},23:{value:j.value[3]},24:{value:j.value[3]},25:{value:new Date},26:{value:new Date},32:{value:"Project User"},33:{value:le},35:{value:r.value},37:{value:a.value},49:{value:!0},50:{value:!0},70:{value:w.workdayId}}],fieldsToReturn:[3,96],formatObject:96});if(Ee[0]!==void 0){const Ne=await g.upsertRecordsXML({to:"br598isx6",data:[{6:{value:Ee[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});Ne.data[0]!==void 0&&d.dialog({title:"Confirm",message:"User successfully added. Would you like to send them an invite?",cancel:!0,persistent:!0}).onOk(async()=>{(await g.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:Ne.data[0][28][3]},93:{value:new Date}}],fieldsToReturn:[3]})).data[0]!==void 0&&(d.notify({type:"positive",message:"User invite submitted"}),l.emit("userAdded",{user:Ne.data[0][28]}))}).onCancel(()=>{l.emit("userAdded",{user:Ne.data[0][28]})})}}}$(),d.loading.hide()}),F=D(()=>{const w=e.project.users.map(Y=>Y[9].phoneNumber);return new Set(w)});ve(C,w=>{F.value.has(w)&&d.notify({type:"negative",message:"Phone Number is already in use!",timeout:1e4,position:d.screen.lt.md?"top":"center"})});const U=w=>{f.value=w},X=w=>{c.value=w};function R(){$(),l.emit("userCanceled")}async function E(){d.loading.show();const{data:w}=await g.fetchFromStructureApp({fields:[{6:{value:"br5v4in72"},7:{value:"Table Query"},8:{value:"{'7'.EX.'Projects'}AND{'15'.EX.'Active'}AND{'17'.EX.true}"},9:{value:1},14:{value:18}}]});u.value=w,d.loading.hide()}return E(),{updateCountry:U,updatePhoneMaxLength:X,firstName:r,lastName:a,email:i,phoneNumber:C,role:y,workdayId:v,formMeta:t,formErrors:k,submitUser:A,roleOptions:u,cancel:R}}}),ea=N("div",{class:"text-primary text-h6"},"Add a New User",-1),ta=N("div",{class:"text-accent text-body2 text-italic q-mb-md"},"All info is required.",-1),aa={class:"row justify-between"},oa={class:"row justify-between"},ra={class:"text-caption"},la={class:"row justify-between"},sa={class:"text-caption"},na={class:"text-caption"};function ia(e,l,d,c,f,j){return p(),L("div",null,[s(ce,null,{default:n(()=>[s(be,{onSubmit:fe(e.submitUser,["prevent"])},{default:n(()=>[s(se,null,{default:n(()=>[ea,ta,N("div",aa,[N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":l[0]||(l[0]=u=>e.firstName=u),error:!!e.formErrors.firstName},null,8,["modelValue","error"])],2),N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":l[1]||(l[1]=u=>e.lastName=u),error:!!e.formErrors.lastName},null,8,["modelValue","error"])],2)]),N("div",oa,[N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"Workday ID",modelValue:e.workdayId,"onUpdate:modelValue":l[2]||(l[2]=u=>e.workdayId=u),error:!!e.formErrors.workdayId},null,8,["modelValue","error"])],2),N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"Phone Number",modelValue:e.phoneNumber,"onUpdate:modelValue":l[3]||(l[3]=u=>e.phoneNumber=u),error:!!e.formErrors.phoneNumber,"bottom-slots":""},{error:n(()=>[N("div",ra,S(e.formErrors.phoneNumber),1)]),_:1},8,["modelValue","error"])],2)]),N("div",la,[N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(Q,{dense:"",outlined:"",label:"Email","bottom-slots":"",modelValue:e.email,"onUpdate:modelValue":l[4]||(l[4]=u=>e.email=u),error:!!e.formErrors.email},{error:n(()=>[N("div",sa,S(e.formErrors.email),1)]),_:1},8,["modelValue","error"])],2),N("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(me,{dense:"",outlined:"",label:"Role","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.role,"onUpdate:modelValue":l[5]||(l[5]=u=>e.role=u),options:e.roleOptions,"option-label":"6","display-value":`${e.role?e.role[6]:""}`,"bottom-slots":"",error:!!e.formErrors.role},{error:n(()=>[N("div",na,S(e.formErrors.role),1)]),_:1},8,["modelValue","options","display-value","error"])],2)])]),_:1}),s(Ce,{align:"right"},{default:n(()=>[s(q,{color:"secondary",onClick:e.cancel,label:"Cancel"},null,8,["onClick"]),s(q,{color:"primary",type:"submit",label:"Submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])}var ua=oe(xt,[["render",ia]]);const da=[{name:1,label:"Name",align:"left",field:e=>e[35],format:(e,l)=>`${e} ${l[37]}`,sortable:!0},{name:2,label:"Role",align:"left",field:e=>e[44],format:e=>`${e}`,sortable:!0}],ca=ae({components:{AddUser:ua},props:{project:String},setup(e){const l=te(),d=de(),c=V(!0),f=V(!1),j=Le(),{getViewedProjects:u,updateViewedProjects:o}=ne(),{getUserType:t,userData:k}=qe(j),b=D(()=>d.params.id?d.params.id:e.project),$=D(()=>u(b.value)),r=D(()=>($.value&&$.value.users?$.value.users:[]).sort((m,O)=>m[1].$d>O[1].$d?1:-1)),a=async v=>{if(c.value=!0,r.value.length===0||v){const{data:m}=await g.fetchFromStructureApp({fields:[pe({type:"userAccess",query:`{'9'.EX.'${b.value}'}AND{'20'.EX.true}${t.value==="Project User"&&k.value[130]!==!0?"AND{'60'.EX.false}":""}`})]});o({id:b.value,dataset:"users",data:m})}c.value=!1};function i(v){console.log(v),l.dialog({title:"Confirm",message:`Are you sure you want to remove user ${v[35]} ${v[37]}?`,cancel:!0,persistent:!0}).onOk(()=>{y(v)})}function C({user:v}){l.notify({type:"positive",message:"User successfully added!"}),f.value=!1;const m=$.value.users;m.push(v),o({id:b.value,dataset:"users",data:m})}async function y(v){const{data:m}=await g.fetchFromStructureApp({fields:[pe({type:"userAccessObject",query:`{'6'.EX.'${v[3]}'}AND{'7'.EX.'Project'}AND{'9'.EX.'${b.value}'}`})]}),O=[];m.forEach(A=>{const F={3:{value:A[3]},20:{value:!1},38:{value:!1},39:{value:!1},40:{value:!1},41:{value:!1}};O.push(F)}),g.upsertRecordsXML({to:"br598isx6",data:O,fieldsToReturn:[3]});const I=r.value.filter(A=>A[3]!==v[3]);o({id:b.value,dataset:"users",data:I}),l.notify({type:"positive",message:"User Removed"})}return a(),{projectData:$,columns:da,rows:r,initialPagination:{rowsPerPage:V(8)},showAdd:f,removeRow:i,loadData:a,loading:c,userAdded:C,userData:k}}}),pa={key:0,class:"text-caption"},ma={key:1,class:"text-caption"};function fa(e,l,d,c,f,j){const u=W("add-user");return p(),L("div",null,[e.showAdd?M("",!0):(p(),P(we,{key:0,dense:"",title:"Users","title-class":"text-primary",columns:e.columns,rows:e.rows,"row-key":o=>o[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","users")?(p(),P(q,{key:0,dense:"",color:"accent",label:"Add New",onClick:l[0]||(l[0]=o=>e.showAdd=!0)})):M("",!0)]),"top-right":n(()=>[s(q,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:l[1]||(l[1]=o=>e.loadData(!0))})]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(ee,{key:t.name,props:o},{default:n(()=>[t.label==="Name"&&o.row[130]===!0?(p(),L("span",pa,S(`${t.value} (Not Visible to WMP Users)`),1)):(p(),L("span",ma,S(t.value),1))]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","users")?(p(),P(q,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(o.row)},null,8,["onClick"])):M("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(p(),P(u,{key:1,onUserAdded:e.userAdded,onUserCanceled:l[2]||(l[2]=o=>e.showAdd=!1),project:e.projectData},null,8,["onUserAdded","project"])):M("",!0)])}var va=oe(ca,[["render",fa]]);const ba=ae({components:{approveHeadcount:Ye},props:{project:Object},setup(e){const l=te(),d=de(),c=V(!1),f=V(!0),j=V([]),u=ne(),{getApprovedHeadcount:o}=qe(u),{getAssignments:t,fetchAssignments:k}=Be(),b=Ue(),{fetchAllProjects:$}=b,r=D(()=>d.params.id?d.params.id:e.project&&e.project[3]?e.project[3]:null),a=D(()=>[{name:0,label:"Headcount",align:"left",field:A=>A[6],format:A=>`${A}`,sortable:!0},{name:1,label:"Date",align:"left",field:A=>A[7],format:A=>`${Me.formatDate(new Date(A),"MM/DD/YYYY")}`,sortable:!0}]),i=D(()=>j.value&&j.value[0]&&j.value[0][6]?j.value[0][6]:null),C=async A=>{if(f.value=!0,A||j.value.length===0){const{data:F}=await g.fetchFromProjectsApp({fields:[{14:{value:10},9:{value:1},8:{value:`{'8'.EX.'${r.value}'}AND{'12'.EX.'TRUE'}`},7:{value:"Table Query"},6:{value:"bteqadt9j"}}]});j.value=F.sort((U,X)=>U[7].$d>X[7].$d?-1:1)}f.value=!1},y=D(()=>t(r.value)?t(r.value).filter(A=>!A[112]&&A.latest&&A[102]==="Active").length:"N/A"),v=async A=>{try{t(r.value)&&t(r.value).length===0&&await k({projectId:r.value,refresh:A})}catch(F){console.log(F)}},m=()=>{C(!0),v(!0),$({can:"read"})};function O(A){l.dialog({title:"Confirm",message:`Are you sure you want to remove Client Contracted Headcount ${A[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{I(A)})}async function I(A){try{const F=[{3:{value:A[3]},6:{value:A[6]},7:{value:A[7]},8:{value:A[8]},12:{value:!1}}],{data:U}=await g.upsertRecordsXML({to:"bteqadt9j",fieldsToReturn:[3,6,7,8,12],data:F,formatObject:10});if(U&&U[0]&&U[0][3])m(),l.notify({position:"top-right",type:"positive",message:"Client Contracted Headcount successfully removed"});else throw"Error in removing Client Contracted Headcount"}catch(F){console.log(F),l.notify({position:"top-right",type:"negative",message:"Error removing Client Contracted Headcount"})}}return ve(o,()=>{m()}),C(!1),v(!1),{props:e,addHeadcount:c,loading:f,rows:j,columns:a,initialPagination:{rowsPerPage:V(10)},approvedHeadcount:i,activeHeadcount:y,refreshHeadcount:m,removeRow:O}}}),ya={class:"q-mt-xs"},ga={class:"text-body1 text-white text-uppercase"},wa={key:0,class:"q-px-xs"},$a={key:1,class:"text-caption text-dark text-italic q-px-md"},ha={class:"text-caption"};function ja(e,l,d,c,f,j){const u=W("approveHeadcount");return p(),L(B,null,[N("div",ya,[s(ce,{class:"text-dark q-pb-sm"},{default:n(()=>[s(se,{class:"bg-info q-py-sm"},{default:n(()=>[N("div",ga,[ue(" Client Contracted Headcount "),e.approvedHeadcount?(p(),L("span",wa,"("+S(e.approvedHeadcount)+")",1)):M("",!0)])]),_:1})]),_:1})]),N("div",null,[s(we,{dense:"",style:{},columns:e.columns,rows:e.rows,"row-key":o=>o[7],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{label:"Loading...","label-class":"text-info"})]),"top-left":n(()=>[N("div",null,[e.$can("create","projectHeadcount")||e.$can("manage","projects")?(p(),P(q,{key:0,dense:"",color:"accent",label:"Add New",onClick:l[0]||(l[0]=o=>e.addHeadcount=!0)})):M("",!0),e.activeHeadcount!==null?(p(),L("span",$a,"Active Headcount: "+S(e.activeHeadcount),1)):M("",!0)])]),"top-right":n(()=>[s(q,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:e.refreshHeadcount},null,8,["onClick"])]),header:n(o=>[s(x,{class:"bg-dark text-white",props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(_,{class:"text-left",key:t.name},{default:n(()=>[ue(S(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(o=>[s(x,{props:o},{default:n(()=>[(p(!0),L(B,null,K(o.cols,t=>(p(),P(ee,{key:t.name,props:o},{default:n(()=>[N("span",ha,S(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectHeadcount")||e.$can("manage","projects")?(p(),P(q,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(o.row)},null,8,["onClick"])):M("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{project:e.props.project,modelValue:e.addHeadcount,"onUpdate:modelValue":l[1]||(l[1]=o=>e.addHeadcount=o)},null,8,["project","modelValue"])])],64)}var Ca=oe(ba,[["render",ja]]);const Na=ae({components:{DetailsCard:mt,JobNumbers:ht,PerDiem:qt,MeetingLocations:Ht,SiteContacts:_t,Users:va,ApprovedHeadcount:Ca},setup(e,{emit:l}){const d=te(),c=V(0),f=de(),{getViewedProjects:j,updateViewedProjects:u,setViewedProjects:o}=ne(),t=D(()=>j(f.params.id));(async()=>{if(!t.value){const{data:r}=await g.fetchFromProjectsApp({fields:[Z({type:"projects",id:f.params.id})]});o({id:f.params.id,data:r})}})();const b=r=>{const a=[];for(const[i,C]of Object.entries(r)){const y={fid:i,value:C};a.push(y)}u({id:t.value[3],props:a})};return{details:D(()=>t.value?[{label:"Date Created",value:Te(t.value[1].$d).format("MM/DD/YYYY hh:mm:ss a"),editable:!1},{label:"Project Name",value:t.value[20],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:t.value[20],formRules:z().required().label("Project Name"),fieldLabel:"Enter the Project Name",getter:null,setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},20:{value:r}}],fieldsToReturn:[20,43]});b(a[0]),d.notify({type:"positive",message:"Project Name successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Name"})}}}},{label:"Project Alias",value:t.value[44],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:t.value[44],formRules:z().required().label("Project Alias"),fieldLabel:"Enter the Project Alias",getter:null,setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},44:{value:r}}],fieldsToReturn:[44]});b(a[0]),d.notify({type:"positive",message:"Project Alias successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Alias"})}}}},{label:"Customer",value:t.value[25],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"customer",initialValue:r=>r.find(a=>a[3]===t.value[9]),formRules:J().required().label("Customer").nullable(),fieldLabel:"Customer",optionLabel:"6",displayValue:6,getter:async()=>{const{data:r}=await g.fetchFromStructureApp({fields:[pe({type:"projectCustomers",query:"{'7'.EX.'Active'}"})]});return r.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},9:{value:r[3]}}],fieldsToReturn:[9,25]});b(a[0]),d.notify({type:"positive",message:"Customer successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Customer"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1)}},{label:"Job Site",value:t.value[24],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"location",initialValue:r=>r.find(a=>a[3]===t.value[8]),formRules:J().required().label("Job Site").nullable(),fieldLabel:"Job Site",optionLabel:"6",displayValue:6,getter:async()=>{const{data:r}=await g.fetchFromStructureApp({fields:[pe({type:"projectLocations",query:"{'51'.EX.true}"})]});return r.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},8:{value:r[3]}}],fieldsToReturn:[8,24,43,67,69,136]});b(a[0]),d.notify({type:"positive",message:"Job Site successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Job Site"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1)}},{label:"Address",value:t.value[67]},{label:"Sup Org Manager",value:t.value[245]},{label:"Primary Hiring Center",value:t.value[76],editable:!0,config:{permission:{action:"manage",subject:"hiringCenters"},type:"options",allowNew:!1,initialValue:r=>r.find(a=>a[3]===t.value[12]),formRules:J().required().label("Primary Hiring Center").nullable(),fieldLabel:"Hiring Center",optionLabel:"60",displayValue:60,getter:async()=>{const{data:r}=await g.fetchFromStructureApp({fields:[pe({type:"hiringCenters",query:"{'51'.EX.'Active'}"})]});return r.sort((a,i)=>a[60]>i[60]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},12:{value:r[3]}}],fieldsToReturn:[12,26,76]});b(a[0]),d.notify({type:"positive",message:"Hiring Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Hiring Center"})}},filter:(r,a)=>r.filter(i=>i[60].toLowerCase().indexOf(a)>-1)}},{label:"Workday Location",value:`${t.value[241]} (${t.value[242]})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(a=>a[3]===t.value[240]),formRules:J().required().label("Workday Location").nullable(),fieldLabel:"Workday Location",optionLabel:r=>`${r[6]} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await g.fetchFromProjectsApp({fields:[Z({type:"workdayLocations",query:`{'14'.EX.true}AND{'45'.EX.'${t.value[136]}'}`})]});return r.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},240:{value:r[40]}}],fieldsToReturn:[240,241,242,257,258]});return b(a[0]),d.notify({type:"positive",message:"Workday Location successfully updated"}),!0}catch{d.notify({type:"negative",message:"Error updating Workday Location"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Workday Region",value:`${H(t.value[283])} (${H(t.value[284])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(a=>a[3]===t.value[282]),formRules:J().required().label("Workday Region").nullable(),fieldLabel:"Workday Region",optionLabel:r=>`${H(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await g.fetchFromProjectsApp({fields:[Z({type:"workdayRegions",query:"{'8'.EX.true}"})]});return r.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},282:{value:r[9]}}],fieldsToReturn:[282,283,284]});b(a[0]),d.notify({type:"positive",message:"Region successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Region"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Company",value:`${H(t.value[286])} (${H(t.value[287])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(a=>a[3]===t.value[285]),formRules:J().required().label("Company").nullable(),fieldLabel:"Company",optionLabel:r=>`${H(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await g.fetchFromProjectsApp({fields:[Z({type:"companies",query:`{'8'.EX.true}AND{'14'.EX.'${t.value[136]}'}`})]});return r.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},285:{value:r[10]}}],fieldsToReturn:[285,286,287]});b(a[0]),d.notify({type:"positive",message:"Company successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Company"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Workday Branch",value:`${H(t.value[289])} (${H(t.value[290])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(a=>a[3]===t.value[288]),formRules:J().required().label("Workday Branch").nullable(),fieldLabel:"Workday Branch",optionLabel:r=>`${H(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const r=t.value[264]===""?"Weekly":t.value[264],{data:a}=await g.fetchFromProjectsApp({fields:[Z({type:"workdayBranches",query:`{'8'.EX.true}AND{'9'.EX.'${r}'}AND{'16'.EX.'${t.value[136]}'}`})]});return a.sort((i,C)=>i[6]>C[6]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},288:{value:r[12]}}],fieldsToReturn:[288,289,290]});b(a[0]),d.notify({type:"positive",message:"Branch successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Branch"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Pay Group",value:`${H(t.value[261])} (${H(t.value[262])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(a=>a[3]===t.value[260]),formRules:J().required().label("Workday Pay Group").nullable(),fieldLabel:"Workday Pay Group",optionLabel:r=>`${H(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await g.fetchFromProjectsApp({fields:[Z({type:"workdayPayGroups",query:`{'8'.EX.'TRUE'}AND{'11'.EX.'Weekly'}AND{'21'.EX.'${t.value[136]}'}`})]});return r.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},260:{value:r[16]}}],fieldsToReturn:[260,261,262,263,264,272]});b(a[0]),d.notify({type:"positive",message:"Pay Group successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Pay Group"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Supervisory Org",value:`${H(t.value[259])} (${H(t.value[244])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(a=>a[3]===t.value[243]),formRules:J().required().label("Supervisory Organization").nullable(),fieldLabel:"Supervisory Organization",optionLabel:r=>`${r[42]} (${r[6]}) - ${H(r[26])}`,displayValue:42,getter:async()=>{const{data:r}=await g.fetchFromProjectsApp({fields:[Z({type:"supOrgs",query:`{'32'.EX.'Active'}AND{'44'.EX.'${t.value[272]}'}`})]});return r.sort((a,i)=>a[42]>i[42]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},243:{value:r[16]}}],fieldsToReturn:[243,244,245,259]});b(a[0]),d.notify({type:"positive",message:"Supervisory Organization successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Supervisory Organization"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[26].toLowerCase().indexOf(a)>-1||i[41].toLowerCase().indexOf(a)>-1||i[42].toLowerCase().indexOf(a)>-1)}},{label:"Cost Center",value:`${H(t.value[276])} (${H(t.value[275])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:r=>r.find(a=>a[3]===t.value[274]),formRules:J().required().label("Workday Cost Center").nullable(),fieldLabel:"Workday Cost Center",optionLabel:r=>`${H(r[6])} (${r[7]})`,displayValue:6,getter:async()=>{const{data:r}=await g.fetchFromProjectsApp({fields:[Z({type:"workdayCostCenters",query:`{'8'.EX.true}AND{'9'.EX.'${t.value[287]}'}`})]});return r.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async r=>{try{const{data:a}=await g.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},274:{value:r[22]}}],fieldsToReturn:[274,275,276]});b(a[0]),d.notify({type:"positive",message:"Cost Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Cost Center"})}},filter:(r,a)=>r.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}}]:[]),tab:c,project:t}}}),ka={class:"q-pa-sm"},Ra={class:"row"},Va={class:"col-12 col-sm-7 q-px-xs"},Aa={class:"col-12 col-sm-5 q-px-xs"};function qa(e,l,d,c,f,j){const u=W("details-card"),o=W("job-numbers"),t=W("meeting-locations"),k=W("site-contacts"),b=W("per-diem"),$=W("users"),r=W("approved-headcount");return p(),P(Oe,{style:{"max-width":"100vw"}},{default:n(()=>[N("div",ka,[N("div",Ra,[N("div",Va,[s(u,{details:e.details,title:"Details"},null,8,["details"])]),N("div",Aa,[s(De,{class:"q-py-xs bg-info text-white shadow-2 rounded-borders",align:"left",modelValue:e.tab,"onUpdate:modelValue":l[0]||(l[0]=a=>e.tab=a),dense:"","indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:n(()=>[s(he,{name:0,label:"Job Numbers"}),s(he,{name:1,label:"Locations"}),s(he,{name:2,label:"Contacts"}),s(he,{name:3,label:"Per Diem"}),s(he,{name:4,label:"Users"})]),_:1},8,["modelValue"]),s(Se,{modelValue:e.tab,"onUpdate:modelValue":l[1]||(l[1]=a=>e.tab=a),animated:"",class:"q-px-none"},{default:n(()=>[s(je,{class:"q-px-xs",name:0},{default:n(()=>[s(o)]),_:1}),s(je,{class:"q-px-xs",name:1},{default:n(()=>[s(t)]),_:1}),s(je,{class:"q-px-xs",name:2},{default:n(()=>[s(k)]),_:1}),s(je,{class:"q-px-xs",name:3},{default:n(()=>[s(b)]),_:1}),s(je,{class:"q-px-xs",name:4},{default:n(()=>[s($)]),_:1})]),_:1},8,["modelValue"]),s(r,{project:e.project},null,8,["project"])])])])]),_:1})}var wo=oe(Na,[["render",qa]]);export{wo as default};
