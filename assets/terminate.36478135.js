import{l as qe,r as A,bU as re,bT as de,c as k,w as L,_ as we,A as v,B as V,d as a,br as n,cS as G,cT as J,D as o,ac as w,bR as B,bP as N,ax as $,cU as ae,bW as O,F as oe,b4 as Ae,bS as se,ar as ue,dA as i,cV as Se,bO as Ue,aq as ne}from"./index.fd21eb93.js";import{Q as De}from"./QPage.8866929d.js";import{u as me}from"./use-quasar.43d53512.js";import{u as H}from"./useQuerySaver.d29ff9ee.js";import{q as Y}from"./app.f520a54e.js";import{u as pe}from"./dataStore.dfe1407a.js";import{a as j,Q as Re}from"./QSelect.09bb52c1.js";import{Q as $e}from"./QFile.7e6abcfd.js";import{Q as ke}from"./QList.41430c31.js";import{Q as Ce}from"./QForm.fef2e28d.js";import{a as Ee,u as c}from"./vee-validate.esm.488d9e16.js";import{a as P,b as Qe,c as ie,e as T}from"./array.48ebf9da.js";import{dayjs as z}from"./dayjs.3d0eb117.js";import{s as Ne}from"./submitRelease.dfecbe03.js";import{u as Fe}from"./dataStore.160254b2.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.a6b0da95.js";import"./api.44ca1b77.js";import"./index.04bc0a32.js";import"./i18n.b804dd3b.js";import"./QChip.b0a95252.js";import"./QMenu.533af197.js";import"./position-engine.cb584089.js";import"./selection.78758f2c.js";import"./rtl.b51694b1.js";const Ie=qe({emits:["releaseSubmitted"],props:{record:Object,employee:Object},setup(e,{emit:l}){const S=A(!1),g=A(!1),h=A(null),U=A(!1),t=A([]),m=me(),y=re(),F=de(),{getTermReasons:D,setTermReasons:I}=pe(),{getAssignments:p,fetchAssignments:C}=Fe(),K=k(()=>P({selection:P().required().nullable().label("Reason"),effective:Qe().required().label("Last Day On Site"),category:ie().nullable(),attendance:T().required().label("Attendance"),capability:T().required().label("Capability"),attitude:T().required().label("Attitude"),promotable:T().required().label("Promotability"),comments:ie().nullable().label("Comments"),equipment:P().required().nullable().label("Equipment Returned"),supervisor:P().nullable().label("Supervisor")})),{errors:M,handleSubmit:r,handleReset:d}=Ee({validationSchema:K,initialValues:{}}),{value:f}=c("selection"),{value:q}=c("effective"),{value:E}=c("category"),{value:W}=c("attachments"),{value:Z}=c("capability"),{value:_}=c("attendance"),{value:x}=c("attitude"),{value:ee}=c("promotable"),{value:ce}=c("comments"),{value:te}=c("equipment"),{value:be}=c("supervisor"),Q=k(()=>{const s=D();return E.value?s.filter(u=>u[6]===E.value).sort((u,b)=>u[12]>b[12]?1:-1):s.sort((u,b)=>u[12]>b[12]?1:-1)});y.query&&y.query.reason==="no-show"&&(E.value="Voluntary",Q.value.length>0&&(U.value=!0,f.value=Q.value.find(s=>s[3]===6)),q.value=z().format("YYYY-MM-DD"),te.value={value:!0,label:"None Issued"},Z.value="0",_.value="0",x.value="0",ee.value="0"),L(Q,(s,u)=>{y.query&&y.query.reason==="no-show"&&U.value===!1&&(U.value=!0,f.value=Q.value.find(b=>b[3]===6))}),L(E,(s,u)=>{f.value=null});const ve=r(async s=>{if(g.value&&t.value.length===0)m.dialog({title:"Alert",message:"Supporting documents are required for this reason!"});else{const u={capability:s.capability,attendance:s.attendance,attitude:s.attitude,promotable:s.promotable,comments:s.comments?s.comments.replace(/(\r\n|\n|\r)/gm," "):null};m.dialog({title:"Confirm",message:"Are you sure you want to release this employee?",cancel:!0,persistent:!0}).onOk(async()=>{try{S.value=!0;const{release:b,employee:R,assignment:X}=await Ne({employee:e.employee,assignment:e.record,values:s,effectiveNow:!le.value,attachments:t.value,ratings:u,supervisor:s.supervisor});l("releaseSubmitted",{release:b,employee:R,assignment:X,effectiveNow:!le.value}),d()}catch{S.value=!1,m.notify({type:"negative",message:"Cannot submit release."})}})}}),fe=()=>{m.dialog({title:"Confirm",message:"Are you sure you want to cancel?",cancel:!0,persistent:!0}).onOk(()=>{d(),F.go(-1)})};L(f,(s,u)=>{s&&s[19]?(g.value=!0,W.value=!0):(W.value=!1,g.value=!1)});const ye=k(()=>{const s=D();return[...new Map(s.map(u=>[u[6],u[6]])).values()]}),le=k(()=>q.value&&q.value!==""?z().isBefore(z(q.value)):!1),Ve=s=>new Promise((u,b)=>{const R=new FileReader;R.readAsDataURL(s),R.onload=()=>u(R.result.replace(/^data:.+;base64,/,"")),R.onerror=X=>b(X)}),ge=()=>{h.value&&h.value.forEach(async s=>{const u={6:{value:await Ve(s),filename:s.name},7:{value:s.name}};t.value.push(u),h.value=null}),console.log(t.value)},he=s=>{console.log(t.value[s]),t.value.splice(s,1)};return(async()=>{if(D().length===0){const{data:s}=await Y.fetchFromHiringApp({fields:[H({type:"termReasons",query:"{'11'.EX.'true'}"})]});I({reasons:s})}C({projectId:e.record[74]})})(),{props:e,options:Q,primaryReasons:ye,category:E,selection:f,effective:q,attachments:W,capability:Z,attendance:_,attitude:x,promotable:ee,comments:ce,equipment:te,supervisor:be,attachmentsRequired:g,fileAttachment:h,attachedFiles:t,submit:ve,formErrors:M,handleReset:d,cancelRelease:fe,showFiles:ge,deleteFile:he,getAssignments:p,disableSubmit:S}}}),Be={class:"row"},Oe={class:"col-12 col-md-4 q-px-sm"},je=o("div",{class:"text-caption"},"Is this release voluntary or involuntary?",-1),Pe={class:"text-caption"},Te={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},Le=o("div",{class:"text-caption"},"What is the reason for this release?",-1),He={class:"text-caption"},Ye={class:"row"},Ke={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},Me=o("div",{class:"text-caption"},"When is the employee's last day on site?",-1),We={class:"text-caption"},Xe={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},ze=o("div",{class:"text-caption"},"Has all Company Equipment been returned?",-1),Ge={class:"text-caption"},Je={class:"row items-top justify-between q-mt-sm"},Ze={class:"col-4 q-pl-xs q-pr-sm"},_e={key:0,class:"text-body2 text-negative text-italic"},xe={key:0},et={key:1},tt={key:1,class:"text-body2 text-dark text-italic"},lt=o("span",null,"**Supporting documents are optional for this reason.",-1),at=[lt],ot={key:0,class:"col-6 q-pl-xs q-pr-sm"},st=o("div",{class:"text-body1 text-info q-mb-sm"},"Attached Documents",-1),nt={class:"row q-my-md"},it={class:"col-12"},rt=o("div",{class:"q-pa-sm"},[o("div",{class:"text-h6 text-bold"},"CAAP Rating"),o("div",{class:"text-body1 text-dark text-italic"},"Capability, Attendance, Attitude, and Promotability"),o("div",{class:"text-body2 text-accent q-mt-sm"},"Select how much you agree with each of the following statements.")],-1),dt={class:"q-pb-sm"},ut=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee is capable of performing their assigned job.",-1),mt={class:"q-pb-sm"},pt=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee regularly shows up to work on time.",-1),ct={class:"q-pb-sm"},bt=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee has a good attitude.",-1),vt={class:"q-pb-sm"},ft=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"I am confident that this employee can be promoted in the future.",-1),yt={class:"row q-mt-md"},Vt={class:"col-12 col-md-5"},gt=o("div",{class:"text-body2 text-weight-bold text-info"},[$(" Who conducted this evaluation? "),o("span",{class:"text-italic text-weight-light text-dark"},"(recommended)")],-1),ht={class:"text-caption"},qt={class:"row q-py-sm"},wt={class:"col-12"};function At(e,l,S,g,h,U){return v(),V("div",null,[a(Ce,{onSubmit:Ue(e.submit,["prevent"])},{default:n(()=>[a(G,null,{default:n(()=>[a(J,null,{default:n(()=>[o("div",Be,[o("div",Oe,[je,a(j,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":l[0]||(l[0]=t=>e.category=t),options:e.primaryReasons},{error:n(()=>[o("div",Pe,w(e.formErrors.selection),1)]),"no-option":n(()=>[a(B,null,{default:n(()=>[a(N,{class:"text-grey"},{default:n(()=>[$(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),o("div",Te,[Le,a(j,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":l[1]||(l[1]=t=>e.selection=t),options:e.options,"option-label":"12","display-value":`${e.selection?e.selection[12]:""}`,"bottom-slots":"",error:!!e.formErrors.selection,disable:!e.category},{error:n(()=>[o("div",He,w(e.formErrors.selection),1)]),"no-option":n(()=>[a(B,null,{default:n(()=>[a(N,{class:"text-grey"},{default:n(()=>[$(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","display-value","error","disable"])])]),o("div",Ye,[o("div",Ke,[Me,a(ae,{dense:"",type:"date",modelValue:e.effective,"onUpdate:modelValue":l[2]||(l[2]=t=>e.effective=t),error:!!e.formErrors.effective,"bottom-slots":""},{error:n(()=>[o("div",We,w(e.formErrors.effective),1)]),_:1},8,["modelValue","error"])]),o("div",Xe,[ze,a(j,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.equipment,"onUpdate:modelValue":l[3]||(l[3]=t=>e.equipment=t),options:[{value:!0,label:"Yes"},{value:!1,label:"No"},{value:!0,label:"None Issued"}],"bottom-slots":"",error:!!e.formErrors.equipment},{error:n(()=>[o("div",Ge,w(e.formErrors.equipment),1)]),_:1},8,["modelValue","error"])])]),o("div",Je,[o("div",Ze,[a($e,{dense:"","bottom-slots":"",modelValue:e.fileAttachment,"onUpdate:modelValue":l[4]||(l[4]=t=>e.fileAttachment=t),multiple:"",append:"",label:"Attach Supporting Documents"},{after:n(()=>[a(O,{dense:"",color:"info",round:"",flat:"",icon:"cloud_upload",onClick:e.showFiles},null,8,["onClick"])]),_:1},8,["modelValue"]),e.attachmentsRequired?(v(),V("div",_e,[$("!! "),e.selection[12].toLowerCase().includes("attendance")?(v(),V("span",xe,"Supporting attendance records must be attached.")):(v(),V("span",et,"Supporting documents are required for this reason."))])):(v(),V("div",tt,at))]),e.attachedFiles.length>0?(v(),V("div",ot,[st,a(ke,{dense:""},{default:n(()=>[(v(!0),V(oe,null,Ae(e.attachedFiles,(t,m)=>(v(),V(oe,{key:t},[a(B,null,{default:n(()=>[a(N,null,{default:n(()=>[a(Re,null,{default:n(()=>[$(w(m+1)+". "+w(t[6].filename),1)]),_:2},1024)]),_:2},1024),a(N,{side:""},{default:n(()=>[a(O,{color:"accent",round:"",flat:"",class:"cursor-pointer",icon:"delete",size:"md",onClick:y=>e.deleteFile(m)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),a(se)],64))),128))]),_:1})])):ue("",!0)])]),_:1})]),_:1}),a(se),o("div",nt,[o("div",it,[rt,a(G,null,{default:n(()=>[a(J,null,{default:n(()=>[o("div",null,[o("div",dt,[ut,a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[5]||(l[5]=t=>e.capability=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[6]||(l[6]=t=>e.capability=t),val:"2",label:"Disagree"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[7]||(l[7]=t=>e.capability=t),val:"3",label:"Neutral"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[8]||(l[8]=t=>e.capability=t),val:"4",label:"Agree"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[9]||(l[9]=t=>e.capability=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[10]||(l[10]=t=>e.capability=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",mt,[pt,a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[11]||(l[11]=t=>e.attendance=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[12]||(l[12]=t=>e.attendance=t),val:"2",label:"Disagree"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[13]||(l[13]=t=>e.attendance=t),val:"3",label:"Neutral"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[14]||(l[14]=t=>e.attendance=t),val:"4",label:"Agree"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[15]||(l[15]=t=>e.attendance=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[16]||(l[16]=t=>e.attendance=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",ct,[bt,a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[17]||(l[17]=t=>e.attitude=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[18]||(l[18]=t=>e.attitude=t),val:"2",label:"Disagree"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[19]||(l[19]=t=>e.attitude=t),val:"3",label:"Neutral"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[20]||(l[20]=t=>e.attitude=t),val:"4",label:"Agree"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[21]||(l[21]=t=>e.attitude=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[22]||(l[22]=t=>e.attitude=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",vt,[ft,a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[23]||(l[23]=t=>e.promotable=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[24]||(l[24]=t=>e.promotable=t),val:"2",label:"Disagree"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[25]||(l[25]=t=>e.promotable=t),val:"3",label:"Neutral"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[26]||(l[26]=t=>e.promotable=t),val:"4",label:"Agree"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[27]||(l[27]=t=>e.promotable=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[28]||(l[28]=t=>e.promotable=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])])]),o("div",yt,[o("div",Vt,[gt,a(j,{dense:"",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.supervisor,"onUpdate:modelValue":l[29]||(l[29]=t=>e.supervisor=t),options:e.getAssignments(e.props.record[74]).length>0?e.getAssignments(e.props.record[74]).filter(t=>t[3]!==e.props.record[3]).sort((t,m)=>t[75]>m[75]?1:-1):[],"option-label":t=>`${t[75]} - ${t[104]}`,"display-value":`${e.supervisor?e.supervisor[75]:""}`,"bottom-slots":"",error:!!e.formErrors.supervisor,hint:"Ex: Employee's Supervisor"},{error:n(()=>[o("div",ht,w(e.formErrors.supervisor),1)]),"no-option":n(()=>[a(B,null,{default:n(()=>[a(N,{class:"text-grey"},{default:n(()=>[$(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","error"])])])]),_:1})]),_:1})])]),o("div",qt,[o("div",wt,[a(ae,{filled:"",type:"textarea",modelValue:e.comments,"onUpdate:modelValue":l[30]||(l[30]=t=>e.comments=t),label:"Comments"},null,8,["modelValue"])])]),a(Se,{align:"right"},{default:n(()=>[a(O,{disable:e.disableSubmit,color:"info",label:"Submit",type:"submit"},null,8,["disable"]),a(O,{color:"secondary",label:"Cancel",onClick:e.cancelRelease},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var St=we(Ie,[["render",At]]);const Ut={class:"q-pa-sm"},Dt={class:"row"},Rt={class:"col-12"},$t=o("div",{class:"text-h6 text-weight-bold q-mb-md"},"Please complete the following to submit this release.",-1),tl={__name:"terminate",setup(e){A(0);const l=re(),S=de(),g=me(),h=A("employee");h.value=l.query.reason==="now-show"?"arrivals":"employee";const{getEmployee:U,getAssignmentsByEmployee:t,setAssignmentsByEmployee:m,setEmployees:y,setReleases:F,setReleasesByAssignment:D,setReleasesByEmployee:I}=pe(),p=k(()=>U(l.params.id)),C=k(()=>p.value?t(p.value[3]):null),K=async()=>{if(!C.value&&p.value[577]){const{data:r}=await Y.fetchFromHiringApp({fields:[H({type:"assignments",query:"",id:p.value[577]})]});m({id:p.value[3],data:r})}else if(p.value[577])await Y.fetchFromHiringApp({fields:[H({type:"assignments",query:"",id:p.value[577]})]});else{const r=H({type:"assignments",query:"",id:p.value[577]});r[8]={value:`{3.EX.${l.query.aid}}`};const{data:d}=await Y.fetchFromHiringApp({fields:[r]});m({id:p.value[3],data:d}),console.log("no assignment")}};L(p,(r,d)=>{r&&K()});const M=({employee:r,release:d,assignment:f,effectiveNow:q})=>{g.notify({type:"positive",message:"Release successfully submitted."}),q?(r[581]=d[3],F({id:d[3],data:d}),y({id:r[3],data:r}),m({id:r[3],assignment:f}),D({id:f[3],data:d}),I({id:r[3],data:d})):(r[581]=d[3],y({id:r[3],data:r}),F({id:d[3],data:d}),D({id:f[3],data:d}),I({id:r[3],data:d})),S.replace({name:"view-ee-release",params:{id:r[3],release:d[3]}})};return(r,d)=>(v(),ne(De,{style:{"max-width":"100vw"}},{default:n(()=>[o("div",Ut,[o("div",Dt,[o("div",Rt,[a(G,{flat:""},{default:n(()=>[C.value?(v(),ne(J,{key:0},{default:n(()=>[$t,a(St,{record:C.value,employee:p.value,onReleaseSubmitted:M},null,8,["record","employee"])]),_:1})):ue("",!0)]),_:1})])])])]),_:1}))}};export{tl as default};
