import{bX as ne,r as D,c as T,d1 as se,aQ as ie,ct as ue,h as F,g as ce,bW as g,a5 as de,bT as oe,A as C,B as H,d as l,br as r,D as v,E as fe,cS as O,G as me,a8 as x,cT as $,ax as w,ac as q,aq as N,cU as B,bO as K,bS as ve,F as pe,b4 as be,bR as ge,bP as G,bQ as ye,cV as W,cy as J,dn as we,bt as _e,_ as De,bV as he,b5 as Z}from"./index.dbae30bb.js";import{Q as ee,a as ke}from"./QSelect.5872e32d.js";import{Q as Ce}from"./QPage.c94e329b.js";import{u as re}from"./use-quasar.4af20f9f.js";import{H as te,I as xe,q as P}from"./app.ec713cf3.js";import{dayjs as _}from"./dayjs.c8159a49.js";import{u as Ae}from"./dataStore.57ce49f9.js";import{Q as I}from"./QTooltip.31f2a4b1.js";import{Q as Me}from"./QMenu.fa26a79f.js";import{Q as Ye}from"./QList.be5fb962.js";import{Q as ae}from"./QTd.c1549e34.js";import{Q as Se}from"./QInnerLoading.0bc5211e.js";import{a as $e}from"./QTable.a4288514.js";import{C as Ve}from"./ClosePopup.1982208f.js";import"./arrivalDate.f93b6906.js";import{_ as qe}from"./projectSelector.ca6efaca.js";import"./QChip.1fd9b058.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.d59848b7.js";import"./api.0b402b2c.js";import"./index.04bc0a32.js";import"./i18n.3b5a80ec.js";import"./useQuerySaver.d29ff9ee.js";import"./position-engine.4c646f66.js";import"./selection.6f966ca8.js";import"./QMarkupTable.ce5d83dc.js";import"./use-fullscreen.cd71f547.js";import"./QForm.5b858bcd.js";import"./vee-validate.esm.318aeadf.js";import"./array.22f670ac.js";function U(o,s=new WeakMap){if(Object(o)!==o)return o;if(s.has(o))return s.get(o);const u=o instanceof Date?new Date(o):o instanceof RegExp?new RegExp(o.source,o.flags):o instanceof Set?new Set:o instanceof Map?new Map:typeof o.constructor!="function"?Object.create(null):o.prototype!==void 0&&typeof o.prototype.constructor=="function"?o:new o.constructor;if(typeof o.constructor=="function"&&typeof o.valueOf=="function"){const n=o.valueOf();if(Object(n)!==n){const y=new o.constructor(n);return s.set(o,y),y}}return s.set(o,u),o instanceof Set?o.forEach(n=>{u.add(U(n,s))}):o instanceof Map&&o.forEach((n,y)=>{u.set(y,U(n,s))}),Object.assign(u,...Object.keys(o).map(n=>({[n]:U(o[n],s)})))}var le=ne({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(o,{slots:s,emit:u}){const{proxy:n}=ce(),{$q:y}=n,m=D(null),f=D(""),i=D("");let d=!1;const A=T(()=>se({initialValue:f.value,validate:o.validate,set:h,cancel:c,updatePosition:M},"value",()=>i.value,p=>{i.value=p}));function h(){o.validate(i.value)!==!1&&(Y()===!0&&(u("save",i.value,f.value),u("update:modelValue",i.value)),Q())}function c(){Y()===!0&&u("cancel",i.value,f.value),Q()}function M(){ie(()=>{m.value.updatePosition()})}function Y(){return ue(i.value,f.value)===!1}function Q(){d=!0,m.value.hide()}function j(){d=!1,f.value=U(o.modelValue),i.value=U(o.modelValue),u("beforeShow")}function R(){u("show")}function z(){d===!1&&Y()===!0&&(o.autoSave===!0&&o.validate(i.value)===!0?(u("save",i.value,f.value),u("update:modelValue",i.value)):u("cancel",i.value,f.value)),u("beforeHide")}function S(){u("hide")}function V(){const p=s.default!==void 0?[].concat(s.default(A.value)):[];return o.title&&p.unshift(F("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},o.title)),o.buttons===!0&&p.push(F("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[F(g,{flat:!0,color:o.color,label:o.labelCancel||y.lang.label.cancel,onClick:c}),F(g,{flat:!0,color:o.color,label:o.labelSet||y.lang.label.set,onClick:h})])),p}return Object.assign(n,{set:h,cancel:c,show(p){m.value!==null&&m.value.show(p)},hide(p){m.value!==null&&m.value.hide(p)},updatePosition:M}),()=>{if(o.disable!==!0)return F(Me,{ref:m,class:"q-popup-edit",cover:o.cover,onBeforeShow:j,onShow:R,onBeforeHide:z,onHide:S,onEscapeKey:c},V)}}});const Qe={class:"q-px-sm"},je={key:0,class:"float-right q-card__actions--horiz"},Re={key:1,class:"float-right q-card__actions--horiz"},Pe={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Ie=v("div",{class:"text-h6"},"Arrival Date",-1),Ne=v("span",{class:"q-ml-sm"},"Release as No Show!",-1),Te=v("div",{class:"text-h6"},"Has not arrived.",-1),ze=v("br",null,null,-1),Fe={__name:"markArrivals",props:{rows:Array,selected:Array},emits:["arrivalMarked","updateArrival","arrivalRelease"],setup(o,{emit:s}){const u=o,{rows:n,selected:y}=de(u),m=re();oe();const f=D(_().format("YYYY-MM-DD")),i=D(!1),d=D(!1),A=D(!1),h=D(!1),c=D(null),M=D(0),Y=T(()=>m.screen.gt.sm?[{name:207,label:"Arrival Date",align:"left",field:219,format:e=>`${e&&e.$d&&e.$d.format?e.$d.format("MM/DD/YYYY"):""}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${te.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,a)=>a[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]:[{name:227,label:"Arrival Date",align:"left",field:219,format:e=>`${e&&e.$d&&e.$d.format?e.$d.format("MM/DD/YYYY"):""}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${te.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,a)=>a[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]),Q=({rows:e,added:a,evt:t})=>{i.value=!0,s("arrivalMarked",{record:e[0],added:a}),setTimeout(function(){i.value=!1},1500)},j=e=>{i.value=!0,s("arrivalMarked",{record:c.value,added:e}),e?d.value=!1:h.value=!1,setTimeout(function(){i.value=!1},1500)},R=e=>{c.value=e,c.value[227]=f.value,d.value=!0},z=()=>{c.value=null,d.value=!1},S=e=>{c.value=e,h.value=!0},V=()=>{c.value=null,h.value=!1},p=e=>{c.value=e,A.value=!0},X=()=>{s("arrivalRelease",{record:c.value,added:!0})},E=e=>{e.target.showPicker()},L=async(e,a)=>{a[219]=_(e),M.value+=1,s("updateArrivalDate",{record:a,value:e})};return(e,a)=>(C(),H("div",Qe,[l($e,{dense:"",columns:Y.value,rows:x(n),"row-key":t=>t[3],class:"q-pa-sm",pagination:{rowsPerPage:x(m).screen.gt.sm?25:100},separator:"vertical",onSelection:Q,selected:x(y),"table-header-class":"bg-dark text-white","no-data-label":"There are no expected arrivals",loading:i.value,grid:x(m).screen.lt.md},{item:r(t=>[v("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:fe(t.selected?"transform: scale(0.95);":"")},[l(O,{bordered:"",flat:"",class:me(t.selected?x(m).dark.isActive?"bg-grey-9":"bg-grey-2":"")},{default:r(()=>[l($,null,{default:r(()=>[w(q(t.row[31])+" ",1),t.row[20]!=="Complete"||!t.row[207]?(C(),H("span",je,[l(g,{round:"",color:"positive",icon:"done",size:"xs",onClick:b=>R(t.row)},{default:r(()=>[l(I,{class:"bg-primary"},{default:r(()=>[w("Arrived")]),_:1})]),_:2},1032,["onClick"]),l(g,{round:"",color:"negative",icon:"close",size:"xs",onClick:b=>p(t.row)},{default:r(()=>[l(I,{class:"bg-primary"},{default:r(()=>[w("No Show")]),_:1})]),_:2},1032,["onClick"])])):(C(),H("span",Re,[w(q(x(_)(t.row[219]).format("MM/DD/YYYY"))+" ",1),l(g,{icon:"edit",color:"accent",flat:"",size:"xs",class:"q-px-none q-pr-xs"}),(C(),N(le,{key:M.value,"model-value":x(_)(t.row[219]).format("YYYY-MM-DD"),title:"Arrival Date"},{default:r(b=>[l(B,{autofocus:"",onFocus:a[0]||(a[0]=k=>E(k)),dense:"","model-value":b.value,type:"date",max:f.value,rules:[k=>!!k||"Field is required"],"onUpdate:modelValue":k=>L(k,t.row)},null,8,["model-value","max","rules","onUpdate:modelValue"])]),_:2},1032,["model-value"])),l(g,{round:"",color:"white",icon:"history",size:"xs",onClick:K(b=>S(t.row),["stop"])},{default:r(()=>[l(I,{class:"bg-primary"},{default:r(()=>[w("Revert Back - Has not arrived yet.")]),_:1})]),_:2},1032,["onClick"])]))]),_:2},1024),l(ve),l(Ye,{dense:""},{default:r(()=>[(C(!0),H(pe,null,be(t.cols.filter(b=>b.name!=="action"),b=>(C(),N(ge,{key:b.name},{default:r(()=>[l(G,null,{default:r(()=>[l(ee,null,{default:r(()=>[w(q(b.label),1)]),_:2},1024)]),_:2},1024),l(G,{side:""},{default:r(()=>[l(ee,{caption:""},{default:r(()=>[w(q(b.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),"body-cell-207":r(t=>[t.row[20]!=="Complete"||!t.row[207]?(C(),N(ae,{key:0,props:t,class:"q-card__actions--horiz",style:{"text-align":"center !important"}},{default:r(()=>[l(g,{round:"",color:"positive",icon:"done",size:"xs",onClick:b=>R(t.row)},{default:r(()=>[l(I,{class:"bg-primary"},{default:r(()=>[w("Arrived")]),_:1})]),_:2},1032,["onClick"]),l(g,{round:"",color:"negative",icon:"close",size:"xs",onClick:b=>p(t.row)},{default:r(()=>[l(I,{class:"bg-primary"},{default:r(()=>[w("No Show")]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])):(C(),N(ae,{key:1,props:t,style:{"text-align":"center !important"}},{default:r(()=>[w(q(x(_)(t.row[219]).format("MM/DD/YYYY"))+" ",1),(C(),N(le,{key:M.value,"model-value":x(_)(t.row[219]).format("YYYY-MM-DD"),title:"Arrival Date"},{default:r(b=>[l(B,{autofocus:"",onFocus:a[1]||(a[1]=k=>E(k)),dense:"","model-value":b.value,type:"date",max:f.value,rules:[k=>!!k||"Field is required"],"onUpdate:modelValue":k=>L(k,t.row)},null,8,["model-value","max","rules","onUpdate:modelValue"])]),_:2},1032,["model-value"])),l(g,{round:"",color:"negative",icon:"history",size:"xs",onClick:K(b=>S(t.row),["stop"])},{default:r(()=>[l(I,{class:"bg-primary"},{default:r(()=>[w("Revert Back - Has not arrived yet.")]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"]))]),"no-data":r(({message:t})=>[v("div",Pe,[l(ye,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),v("span",null,q(t),1)])]),loading:r(()=>[l(Se,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","selected","loading","grid"]),l(J,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=t=>d.value=t),persistent:""},{default:r(()=>[l(O,{style:{"min-width":"350px"}},{default:r(()=>[l($,null,{default:r(()=>[Ie]),_:1}),l($,{class:"q-pt-none"},{default:r(()=>[l(B,{dense:"",modelValue:c.value[227],"onUpdate:modelValue":a[2]||(a[2]=t=>c.value[227]=t),autofocus:"",type:"date",max:f.value,rules:[t=>!!t||"Field is required"]},null,8,["modelValue","max","rules"])]),_:1}),l(W,{align:"right",class:"text-primary"},{default:r(()=>[l(g,{flat:"",label:"Cancel",onClick:a[3]||(a[3]=t=>z())}),l(g,{flat:"",label:"Confirm",onClick:a[4]||(a[4]=t=>j(!0))})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(J,{modelValue:A.value,"onUpdate:modelValue":a[7]||(a[7]=t=>A.value=t),persistent:""},{default:r(()=>[l(O,null,{default:r(()=>[l($,{class:"row items-center"},{default:r(()=>[l(we,{icon:"person_remove",color:"primary","text-color":"white"}),Ne]),_:1}),l(W,{align:"right"},{default:r(()=>[_e(l(g,{flat:"",label:"Cancel",color:"primary"},null,512),[[Ve]]),l(g,{flat:"",label:"Release",color:"primary",onClick:a[6]||(a[6]=t=>X())})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(J,{modelValue:h.value,"onUpdate:modelValue":a[10]||(a[10]=t=>h.value=t),persistent:""},{default:r(()=>[l(O,{style:{"min-width":"350px"}},{default:r(()=>[l($,null,{default:r(()=>[Te]),_:1}),l($,{class:"q-pt-none"},{default:r(()=>[w(" You are about to erase the arrival date."),ze,w(" Are you sure you want to do this? ")]),_:1}),l(W,{align:"right",class:"text-primary"},{default:r(()=>[l(g,{label:"No",onClick:a[8]||(a[8]=t=>V())}),l(g,{flat:"",label:"Yes",onClick:a[9]||(a[9]=t=>j(!1))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Oe={name:"Arrivals",components:{MarkArrivalsTable:Fe,projectSelector:qe},setup(){const o=re(),s=xe(),u=oe(),n=D(null),y=D(""),m=D(""),{getSelectedProject:f}=he(s),{fetchAllDeployments:i,updateDeployment:d,getDeployments:A,fetchDeployments:h}=Ae(),c=T(()=>f.value?f.value[3]:null),M=T(()=>A(c.value).filter(e=>e[20]==="Complete")),Y=T(()=>{let e=[];return A(c.value).forEach(a=>{a[31].toLowerCase().includes(m.value.toLowerCase())&&e.push(a)}),e=y.value?e.filter(a=>_(a[33].$d).tz("America/Chicago").format("MM/DD/YYYY")===_(y.value).tz("America/Chicago").format("MM/DD/YYYY")):e,e=n.value?e.filter(a=>a[132]===n.value):e,e.sort((a,t)=>a[219]-t[219]||a[33]-t[33])}),Q=T(()=>[...new Map(Y.value.map(e=>[e[132],e[132]])).values()]);async function j(e){o.loading.show(),c.value?await h({projectId:c.value,refresh:e}):await i({refresh:e}),o.loading.hide()}async function R({record:e,added:a}){if(a){await z(e),await S({id:e[21],status:7});const t=await V(e[3],"Complete");d({projectId:t[134],key:t[3],record:t})}else{await p(e),await S({id:e[21],status:6});const t=await V(e[3],"In Process");d({projectId:t[134],key:t[3],record:t})}}async function z(e){try{const a=e[207]?_(e[207]):_(),{data:t}=await P.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:e[3]},13:{value:e[15]},18:{value:e[21]},60:{value:""},125:{value:a},145:{value:a},165:{value:"Active"}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return t[0][108]}catch(a){throw{message:"Cannot add assignment",error:a}}}async function S({id:e,status:a}){try{const{data:t}=await P.upsertRecordsXML({to:"bp3gb7ng2",data:[{3:{value:e},79:{value:a}}],fieldsToReturn:[3]});return t[0][3]}catch(t){throw{message:"Cannot edit employee",error:t}}}async function V(e,a){try{const{data:t}=await P.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:e},20:{value:a},22:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return t[0][204]}catch(t){throw{message:"Cannot edit deployment",error:t}}}async function p(e){try{const{data:a}=await P.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:e.assignment[3]},22:{value:new Date},21:{value:"Canceled"},19:{value:""},60:{value:""},165:{value:"Inactive"}}],fieldsToReturn:[108],formatObject:108});return a[0][108]}catch(a){throw{message:"Cannot cancel assignment",error:a}}}async function X(e){try{const a=e.value?_(e.value):_();if(e.record.assignment&&e.record.assignment[3]){const{data:t}=await P.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:e.record.assignment[3]},125:{value:a},145:{value:a}}],fieldsToReturn:[3]});return t[0][3]}}catch(a){throw{message:"Cannot edit Assignment",error:a}}}async function E({record:e,added:a}){if(a){const t=await L(e);u.push({name:"ee-termination",params:{id:e[21]},query:{reason:"no-show",hc:e[15],aid:t[3],did:e[3]}})}else{await p(e),await S({id:e[21],status:6});const t=await V(e[3],"In Process");d({projectId:t[134],key:t[3],record:t})}}async function L(e){try{const a=e[207]?_(e[207]):_(),{data:t}=await P.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:e[3]},13:{value:e[15]},18:{value:e[21]},60:{value:""},21:{value:"DNC"},112:{value:!0},165:{value:"Inactive"}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return t[0][108]}catch(a){throw{message:"Cannot release assignment",error:a}}}return j(!0),{arrived:M,allDeployments:Y,arrivalMarked:R,updateArrivalDate:X,arrivalRelease:E,craftOptions:Q,craftFilter:n,startDateFilter:y,search:m}}},Be={class:"q-pt-sm"},Ue={class:"text-h5 text-dark"},Ee={class:"text-body2 text-italic q-ml-sm"},Le=v("div",{class:"text-subtitle2 text-accent"},"Please click on the green checkmark as employees arrive to the job site.",-1),He={class:"row items-center"},Xe={class:"col-12 col-md-3 q-px-sm"},We={class:"col-12 col-md-3 q-px-sm"},Je={class:"col-12 col-md-3 q-px-sm"},Ke={class:"col-12 col-md-3 q-px-sm"};function Ge(o,s,u,n,y,m){const f=Z("projectSelector"),i=Z("mark-arrivals-table");return C(),N(Ce,{style:{"max-width":"100vw"}},{default:r(()=>[v("div",Be,[l(O,{flat:""},{default:r(()=>[l($,{class:"q-pb-none"},{default:r(()=>[v("div",Ue,[w(" Expected Arrivals "),v("span",Ee,"("+q(n.allDeployments.length)+" total)",1)]),Le]),_:1}),l($,null,{default:r(()=>[v("div",He,[v("div",Xe,[l(f,{dense:""})]),v("div",We,[l(B,{dense:"",modelValue:n.search,"onUpdate:modelValue":s[0]||(s[0]=d=>n.search=d),label:"Search"},null,8,["modelValue"])]),v("div",Je,[l(B,{dense:"",modelValue:n.startDateFilter,"onUpdate:modelValue":s[1]||(s[1]=d=>n.startDateFilter=d),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),v("div",Ke,[l(ke,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:n.craftFilter,"onUpdate:modelValue":s[2]||(s[2]=d=>n.craftFilter=d),options:n.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(i,{rows:n.allDeployments,selected:n.arrived,onArrivalRelease:n.arrivalRelease,onArrivalMarked:n.arrivalMarked,onUpdateArrivalDate:n.updateArrivalDate},null,8,["rows","selected","onArrivalRelease","onArrivalMarked","onUpdateArrivalDate"])])]),_:1})}var $t=De(Oe,[["render",Ge]]);export{$t as default};
