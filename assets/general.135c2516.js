import{Q as he,a as Se,b as je}from"./QTabPanels.59e63232.js";import{Q as De}from"./QTabs.c071546f.js";import{Q as Oe}from"./QPage.ea1eb714.js";import{u as te}from"./use-quasar.150e9d23.js";import{l as ae,r as V,c as S,_ as oe,b5 as W,A as p,B as L,d as s,br as n,D as C,ac as D,bW as A,ar as T,cU as z,bO as fe,aq as E,cy as ke,G as ie,cT as se,F as B,b4 as K,cS as ce,a5 as Ae,w as ve,a8 as h,b as G,cV as Ce,bU as de,ax as ue,y as Xe,bV as Pe}from"./index.a8594182.js";import{q as w,u as Le,c as Ue,g as Te}from"./app.0d6b5a44.js";import{dayjs as Me}from"./dayjs.3e9de836.js";import{a as J,c as F,e as Ie}from"./array.59f93f43.js";import{a as Z,b as pe}from"./useQuerySaver.d29ff9ee.js";import{u as ne}from"./dataStore.7f5d81df.js";import{a as me}from"./QSelect.61afed81.js";import{Q as be}from"./QForm.fc4076cc.js";import{a as ye,u as M}from"./vee-validate.esm.04690319.js";import{A as Fe,a as Qe}from"./addNewCustomer.9224e813.js";import{Q as ge}from"./QInnerLoading.df76b9b1.js";import{a as _,Q as we}from"./QTable.edbb3ede.js";import{Q as x}from"./QTr.e2ab3daf.js";import{Q as ze}from"./QTooltip.6dd84b87.js";import{Q as ee}from"./QTd.c45f7868.js";import{u as He}from"./project.c3787a77.js";import{s as Je}from"./states.03e3d448.js";import{p as We}from"./VueTelInput.c95d69ad.js";import{u as Be}from"./dataStore.c4565561.js";import{a as Ye}from"./approveHeadcount.a034001b.js";import{d as H}from"./decode.3998c82c.js";import"./use-panel.1858c2e0.js";import"./touch.3df10340.js";import"./selection.f3574640.js";import"./QResizeObserver.accf2e8f.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.cae5c4e5.js";import"./api.e0860994.js";import"./index.04bc0a32.js";import"./i18n.039f44c6.js";import"./QChip.1005a1e4.js";import"./QMenu.7aeeb4c0.js";import"./position-engine.50d2ebdf.js";import"./QList.40f773a0.js";import"./QMarkupTable.adff077a.js";import"./use-fullscreen.10dcff66.js";const Ge=ae({emits:["cancelEdit"],components:{AddProjectLocationForm:Fe,AddCustomerForm:Qe},props:{config:Object},setup(e,{emit:o}){const d=V(null),c=V(null),f=V(!1),j=async()=>{const{type:i,initialValue:b}=e.config;if(i==="options"){const{getter:m}=e.config;c.value=await m(),d.value=c.value,y.value=b(d.value)}else y.value=b},u=S(()=>J({entry:e.config.formRules})),{meta:r,errors:t,handleSubmit:N}=ye({validationSchema:u}),{value:y}=M("entry"),k=(i,b)=>{const{filter:m}=e.config;i===""&&b(()=>{d.value=c.value}),b(()=>{const g=i.toLowerCase();d.value=m(c.value,g)})},l=i=>{f.value=!1,c.value.push(i),d.value.push(i),y.value=i},a=N(async i=>{const{setter:b}=e.config;await b(i.entry),o("cancelEdit")});return j(),{rawOptions:c,options:d,entry:y,formErrors:t,formMeta:r,submit:a,filterOptions:k,addNew:f,newOptionAdded:l}}}),Ke={key:0,class:"q-pr-xl"},Ze={class:"text-caption"},_e={key:0,class:"text-center bg-info"},xe={key:0,class:"text-center bg-info"},et={key:1,class:"q-pr-xl"},tt={class:"text-caption"};function at(e,o,d,c,f,j){const u=W("add-project-location-form"),r=W("add-customer-form");return p(),L("div",null,[s(be,{onSubmit:fe(e.submit,["prevent"])},{default:n(()=>[e.config.type==="options"?(p(),L("div",Ke,[s(me,{class:"q-mb-sm",dense:"",label:`Select a ${e.config.fieldLabel}`,"transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.entry,"onUpdate:modelValue":o[3]||(o[3]=t=>e.entry=t),options:e.options,"option-label":e.config.optionLabel,"display-value":`${e.entry?e.entry[e.config.displayValue]:""}`,"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":"","use-input":"","input-debounce":"0",onFilter:e.filterOptions,clearable:"",loading:!e.rawOptions,disable:!e.rawOptions},{error:n(()=>[C("div",Ze,D(e.formErrors.entry),1)]),after:n(()=>[s(A,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),s(A,{color:"dark",icon:"close",dense:"",onClick:o[0]||(o[0]=t=>e.$emit("cancelEdit"))})]),"after-options":n(()=>[e.config.allowNew&&e.options&&e.options.length>0?(p(),L("div",_e,[s(A,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:o[1]||(o[1]=t=>e.addNew=!0)},null,8,["label"])])):T("",!0)]),"no-option":n(()=>[e.config.allowNew?(p(),L("div",xe,[s(A,{flat:"",color:"white",label:`Add a New ${e.config.fieldLabel}`,onClick:o[2]||(o[2]=t=>e.addNew=!0)},null,8,["label"])])):T("",!0)]),_:1},8,["label","modelValue","options","option-label","display-value","error","onFilter","loading","disable"])])):T("",!0),e.config.type==="input"?(p(),L("div",et,[s(z,{class:"q-mb-sm",dense:"",label:e.config.fieldLabel,modelValue:e.entry,"onUpdate:modelValue":o[5]||(o[5]=t=>e.entry=t),"bottom-slots":"",error:!!e.formErrors.entry,"stack-label":""},{error:n(()=>[C("div",tt,D(e.formErrors.entry),1)]),after:n(()=>[s(A,{type:"submit",color:"info",icon:"done",dense:"",onClick:e.submit},null,8,["onClick"]),s(A,{color:"dark",icon:"close",dense:"",onClick:o[4]||(o[4]=t=>e.$emit("cancelEdit"))})]),_:1},8,["label","modelValue","error"])])):T("",!0)]),_:1},8,["onSubmit"]),s(ke,{modelValue:e.addNew,"onUpdate:modelValue":o[8]||(o[8]=t=>e.addNew=t)},{default:n(()=>[e.config.newType==="location"?(p(),E(u,{key:0,onCancelAdd:o[6]||(o[6]=t=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):T("",!0),e.config.newType==="customer"?(p(),E(r,{key:1,onCancelAdd:o[7]||(o[7]=t=>e.addNew=!1),onAddComplete:e.newOptionAdded},null,8,["onAddComplete"])):T("",!0)]),_:1},8,["modelValue"])])}var ot=oe(Ge,[["render",at]]);const rt=ae({emits:[],props:{item:Object},components:{EditDetailsForm:ot},setup(e,{emit:o}){const d=V(!1),c=S(()=>{const{permission:f}=e.item.editable&&e.item.config?e.item.config:{action:null,subject:null};return f});return{edit:d,permission:c}}}),lt={key:0,class:"row"},st={class:"col-12 col-md-4"},nt={class:"col-12 col-md-8"};function it(e,o,d,c,f,j){const u=W("edit-details-form");return p(),E(se,{class:"q-py-sm"},{default:n(()=>[e.edit?(p(),E(u,{key:1,type:e.item.label,config:e.item.config,onCancelEdit:o[1]||(o[1]=r=>e.edit=!1)},null,8,["type","config"])):(p(),L("div",lt,[C("div",st,[C("div",null,[C("span",{class:ie(e.$q.screen.gt.lg?"text-body2":"text-caption")},D(e.item.label),3)])]),C("div",nt,[C("div",null,[C("span",{class:ie(["text-weight-light",e.$q.screen.gt.lg?"text-body2":"text-caption"])},D(e.item.value),3),e.item.editable&&e.$can(e.permission.action,e.permission.subject)?(p(),E(A,{key:0,color:"accent",flat:"",dense:"",round:"",icon:"edit",size:"sm",onClick:o[0]||(o[0]=r=>e.edit=!0)})):T("",!0)])])]))]),_:1})}var ut=oe(rt,[["render",it]]);const dt=ae({props:{title:String,details:Array},components:{DetailsSection:ut}}),ct={class:"text-body1 text-white"};function pt(e,o,d,c,f,j){const u=W("details-section");return p(),L("div",null,[s(ce,{class:"text-dark q-pb-sm"},{default:n(()=>[e.title&&e.title!==""?(p(),E(se,{key:0,class:"bg-info q-py-sm"},{default:n(()=>[C("div",ct,D(e.title.toUpperCase()),1)]),_:1})):T("",!0),(p(!0),L(B,null,K(e.details,r=>(p(),E(u,{key:r,item:r},null,8,["item"]))),128))]),_:1})])}var mt=oe(dt,[["render",pt]]);const ft={class:"q-pa-md q-gutter-sm"},vt={class:"text-body1 text-white"},bt={__name:"projectJobNumber",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:o}){const d=e,c=te(),{getViewedProjects:f,updateViewedProjects:j}=ne(),{prompt:u,record:r}=Ae(d),t=V(!1),N=V(!1),y=S(()=>r.value&&r.value.projectId?f(r.value.projectId):null),k=S(()=>y.value&&y.value.crafts?y.value.crafts:[]),l=S(()=>J({jobNumber:F().required().label("Job Number"),description:F().required().label("Description"),craft:J().nullable().required().label("Craft Required")})),{errors:a,handleSubmit:i,handleReset:b}=ye({validationSchema:l}),{value:m}=M("jobNumber"),{value:g}=M("description"),{value:v}=M("craft"),O=V("add"),I=V("Project Job Number");ve(u,async R=>{if(r.value&&r.value.projectId&&k.value.length===0){const{data:q}=await w.fetchFromProjectsApp({fields:[Z({type:"projectCrafts",query:`{'7'.EX.'${r.value.projectId}'}`})]});j({id:r.value.projectId,dataset:"crafts",data:q})}R===!0&&(t.value=!0,r.value&&r.value[3]?(I.value=`Edit Job Number ${r.value[11]}`,O.value="edit",m.value=r.value[11],r.value[20]==="N/A"?g.value="":g.value=r.value[20],v.value=k.value?k.value.find(q=>q[3]===r.value[14]):null):(I.value="New Job Number",O.value="add"))});const P=i(async R=>{try{N.value=!0;const q={11:{value:R.jobNumber},20:{value:R.description},14:{value:R.craft[3]}};r.value[3]&&(q[3]={value:r.value[3]}),r.value.projectId&&(q[6]={value:r.value.projectId}),await w.upsertRecordsXML({to:"bpzpwr2eh",data:[q],fieldsToReturn:[35],formatObject:35}),U(),N.value=!1,Q(!0)}catch{N.value=!1,X()}}),Q=R=>{b(),t.value=!1,o(R?"update":"canceled")},U=()=>{O.value==="add"?c.notify({type:"positive",message:"Record added."}):O.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},X=R=>{O.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):O.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(R,q)=>(p(),L("div",ft,[s(ke,{modelValue:t.value,"onUpdate:modelValue":q[4]||(q[4]=$=>t.value=$),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(P),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[C("div",vt,D(I.value),1)]),_:1}),s(se,null,{default:n(()=>[s(z,{dense:"",modelValue:h(m),"onUpdate:modelValue":q[0]||(q[0]=$=>G(m)?m.value=$:null),label:"Job Number *",readonly:O.value==="edit",error:!!h(a).jobNumber,"error-message":h(a).jobNumber},null,8,["modelValue","readonly","error","error-message"]),s(me,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:h(v),"onUpdate:modelValue":q[1]||(q[1]=$=>G(v)?v.value=$:null),options:k.value,"option-label":"10",error:!!h(a).craft,"error-message":h(a).craft},null,8,["modelValue","options","error","error-message"]),s(z,{dense:"",modelValue:h(g),"onUpdate:modelValue":q[2]||(q[2]=$=>G(g)?g.value=$:null),label:"Description *",error:!!h(a).description,"error-message":h(a).description},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(A,{color:"secondary",onClick:q[3]||(q[3]=$=>Q(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":"",disable:N.value},null,8,["size","disable"]),s(A,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":"",disable:N.value},null,8,["size","disable"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},yt=[{name:0,label:"Job Number",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Craft",align:"left",field:e=>e[15],format:e=>`${e}`,sortable:!0,required:!0}],gt=ae({components:{projectJobNumber:bt},props:{project:String},setup(e){const o=te(),d=de(),c=V(!0),f=V(!1),j=V(null),{getViewedProjects:u,updateViewedProjects:r}=ne(),t=V(d.params.id?d.params.id:e.project);ve(()=>d.params.id,m=>{t.value=d.params.id});const N=S(()=>u(t.value)),y=S(()=>{const m=N.value&&N.value.jobNumbers?N.value.jobNumbers:[];return m.length>0?m.sort((g,v)=>g[1].$d>v[1].$d?1:-1):m}),k=async m=>{if(c.value=!0,f.value=!1,y.value.length===0||m){const{data:g}=await w.fetchFromProjectsApp({fields:[Z({type:"jobNumbers",query:`{'6'.EX.'${t.value}'}AND{'29'.EX.'Active'}`})]});r({id:t.value,dataset:"jobNumbers",data:g})}c.value=!1};function l(m){o.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${m[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{a(m)})}async function a(m){try{const{data:g}=await w.upsertRecordsXML({to:"bpzpwr2eh",data:[{3:{value:m[3]},29:{value:"Inactive"}}],fieldsToReturn:[35],formatObject:35}),v=y.value.filter(O=>O[3]!==g[0][35][3]);r({id:t.value,dataset:"jobNumbers",data:v}),o.notify({type:"positive",message:"Job Number Removed"})}catch(g){console.log(g),o.notify({type:"negative",message:"Something went wrong"})}}const i=m=>{m?j.value={projectId:t.value,...m}:j.value={projectId:t.value},f.value=!0},b=()=>{f.value=!1,j.value=null};return k(),{projectData:N,jobNumberColumns:yt,rows:y,initialPagination:{rowsPerPage:V(10)},showAddJobNumber:f,removeRow:l,loadData:k,loading:c,record:j,openJobNumber:i,jobNumberClosed:b}}}),wt={class:"text-caption"};function $t(e,o,d,c,f,j){const u=W("project-job-number");return p(),L("div",null,[s(we,{dense:"",title:"Job Numbers","title-class":"text-primary",style:{},columns:e.jobNumberColumns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{label:"Loading...","label-class":"text-info"})]),"top-left":n(()=>[e.$can("create","projectJobNumbers")||e.$can("manage","projects")?(p(),E(A,{key:0,dense:"",color:"accent",label:"Add New",onClick:o[0]||(o[0]=r=>e.openJobNumber())})):T("",!0)]),"top-right":n(()=>[s(A,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[1]||(o[1]=r=>e.loadData(!0))})]),header:n(r=>[s(x,{class:"bg-dark text-white",props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(_,{class:"text-left",key:t.name},{default:n(()=>[ue(D(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(r=>[s(x,{props:r},{default:n(()=>[s(ze,{anchor:"top middle",self:"top middle"},{default:n(()=>[ue("Description: "+D(r.row[20]),1)]),_:2},1024),(p(!0),L(B,null,K(r.cols,t=>(p(),E(ee,{key:t.name,props:r},{default:n(()=>[C("span",wt,D(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(p(),E(A,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openJobNumber(r.row)},null,8,["onClick"])):T("",!0),e.$can("manage","projectJobNumbers")||e.$can("manage","projects")?(p(),E(A,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(r.row)},null,8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAddJobNumber,record:e.record,onUpdate:o[2]||(o[2]=r=>e.loadData(!0)),onCanceled:e.jobNumberClosed},null,8,["prompt","record","onCanceled"])])}var ht=oe(gt,[["render",$t]]);const jt={class:"q-pa-md q-gutter-sm"},Ct={class:"text-body1 text-white"},Nt={__name:"projectPerDiem",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:o}){const d=e,c=te(),f=V(!1),j=S(()=>J({miles:F().required().label("Contract Miles"),rule:F().required().label("Rule"),amount:Ie().required().label("Per-Diem Amount"),approval:F().nullable().label("Approval"),mapRequired:F().nullable().required().label("Map Required").oneOf(["Yes","No",""]),idRequired:F().nullable().required().label("ID Required").oneOf(["Yes","No",""])})),{errors:u,handleSubmit:r,handleReset:t}=ye({validationSchema:j}),{value:N}=M("miles"),{value:y}=M("rule"),{value:k}=M("amount"),{value:l}=M("approval"),{value:a}=M("mapRequired"),{value:i}=M("idRequired"),b=V("add"),m=V("Project Per Diem"),{prompt:g,record:v}=Ae(d);ve(g,U=>{U===!0&&(f.value=!0,v.value&&v.value[3]?(m.value=`Edit #${v.value[3]} Per Diem`,b.value="edit",N.value=v.value[6],y.value=v.value[11],k.value=v.value[10],l.value=v.value[7]||"",a.value=v.value[23]||"",i.value=v.value[24]||""):(m.value="New Per Diem",b.value="add"))});const O=r(async U=>{try{const X={6:{value:U.miles},11:{value:U.rule},10:{value:U.amount},7:{value:U.approval},23:{value:U.mapRequired},24:{value:U.idRequired}};v.value[3]&&(X[3]={value:v.value[3]}),v.value.projectId&&(X[12]={value:v.value.projectId}),await w.upsertRecordsXML({to:"bp5mpfxia",data:[X],fieldsToReturn:[39],formatObject:39}),P(),I(!0)}catch{Q()}}),I=U=>{t(),f.value=!1,o(U?"update":"canceled")},P=()=>{b.value==="add"?c.notify({type:"positive",message:"Record added."}):b.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},Q=U=>{b.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):b.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(U,X)=>(p(),L("div",jt,[s(ke,{modelValue:f.value,"onUpdate:modelValue":X[7]||(X[7]=R=>f.value=R),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(O),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[C("div",Ct,D(m.value),1)]),_:1}),s(se,null,{default:n(()=>[s(z,{dense:"",modelValue:h(y),"onUpdate:modelValue":X[0]||(X[0]=R=>G(y)?y.value=R:null),label:"Rule *",error:!!h(u).rule,"error-message":h(u).rule},null,8,["modelValue","error","error-message"]),s(z,{dense:"",modelValue:h(N),"onUpdate:modelValue":X[1]||(X[1]=R=>G(N)?N.value=R:null),label:"Contract Miles *",error:!!h(u).miles,"error-message":h(u).miles},null,8,["modelValue","error","error-message"]),s(z,{dense:"",modelValue:h(k),"onUpdate:modelValue":X[2]||(X[2]=R=>G(k)?k.value=R:null),label:"Per-Diem Amount *",type:"number",error:!!h(u).amount,"error-message":h(u).amount},null,8,["modelValue","error","error-message"]),s(z,{dense:"",modelValue:h(l),"onUpdate:modelValue":X[3]||(X[3]=R=>G(l)?l.value=R:null),label:"Approval",error:!!h(u).approval,"error-message":h(u).approval},null,8,["modelValue","error","error-message"]),s(me,{"transition-show":"flip-up","transition-hide":"flip-down",dense:"",modelValue:h(i),"onUpdate:modelValue":X[4]||(X[4]=R=>G(i)?i.value=R:null),options:["Yes","No"],label:"DL/ID Required? *",error:!!h(u).idRequired,"error-message":h(u).idRequired},null,8,["modelValue","error","error-message"]),s(me,{"transition-show":"flip-up","transition-hide":"flip-down",dense:"",modelValue:h(a),"onUpdate:modelValue":X[5]||(X[5]=R=>G(a)?a.value=R:null),options:["Yes","No"],label:"Map Required? *",error:!!h(u).mapRequired,"error-message":h(u).mapRequired},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(A,{color:"secondary",onClick:X[6]||(X[6]=R=>I(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":""},null,8,["size"]),s(A,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":""},null,8,["size"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},kt=[{name:0,label:"Rule",align:"left",field:e=>e[11],format:e=>`${e}`,sortable:!0},{name:1,label:"Miles",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0,required:!0},{name:2,label:"Amount",align:"left",field:e=>e[10],format:e=>e?`$ ${e.toFixed(2)}`:"",sortable:!0,required:!0}],Rt=ae({components:{projectPerDiem:Nt},props:{project:String},setup(e){const o=te(),d=de(),c=V(!0),f=V(null),{getViewedProjects:j,updateViewedProjects:u}=ne(),r=S(()=>d.params.id?d.params.id:e.project),t=S(()=>j(r.value)),N=S(()=>(t.value&&t.value.perDiem?t.value.perDiem:[]).sort((g,v)=>g[1].$d>v[1].$d?1:-1)),y=async m=>{if(c.value=!0,k.value=!1,N.value.length===0||m){const{data:g}=await w.fetchFromProjectsApp({fields:[Z({type:"perDiemSpecs",query:`{'12'.EX.'${r.value}'}AND{'38'.EX.'Active'}`})]});u({id:r.value,dataset:"perDiem",data:g})}c.value=!1},k=V(!1);He(),S(()=>(t.value&&t.value.jobNumbers?t.value.jobNumbers:[]).sort((g,v)=>g[1].$d>v[1].$d?1:-1));function l(m){o.dialog({title:"Confirm",message:`Are you sure you want to remove job number ${m[11]}?`,cancel:!0,persistent:!0}).onOk(()=>{a(m)})}async function a(m){try{const{data:g}=await w.upsertRecordsXML({to:"bp5mpfxia",data:[{3:{value:m[3]},38:{value:"Inactive"}}],fieldsToReturn:[39],formatObject:39}),v=N.value.filter(O=>O[3]!==g[0][39][3]);u({id:r.value,dataset:"perDiem",data:v})}catch(g){console.log(g),o.notify({type:"negative",message:"Something went wrong"})}}const i=m=>{m?f.value=m:f.value={projectId:r.value},k.value=!0},b=()=>{k.value=!1,f.value=null};return y(),{projectData:t,columns:kt,rows:N,initialPagination:{rowsPerPage:V(8)},showAddJobNumber:k,removeRow:l,loadData:y,loading:c,openPerDiem:i,perDiemClosed:b,record:f}}}),Vt={class:"text-caption"};function At(e,o,d,c,f,j){const u=W("project-per-diem");return p(),L("div",null,[s(we,{dense:"",title:"Per-Diem","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","projectPerDiem")||e.$can("manage","projects")?(p(),E(A,{key:0,dense:"",color:"accent",label:"Add New",onClick:o[0]||(o[0]=r=>e.openPerDiem())})):T("",!0)]),"top-right":n(()=>[s(A,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[1]||(o[1]=r=>e.loadData(!0))})]),header:n(r=>[s(x,{class:"bg-dark text-white",props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(_,{class:"text-left",key:t.name},{default:n(()=>[ue(D(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(r=>[s(x,{props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(ee,{key:t.name,props:r},{default:n(()=>[C("span",Vt,D(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(p(),E(A,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openPerDiem(r.row)},null,8,["onClick"])):T("",!0),e.$can("manage","projectPerDiem")||e.$can("manage","projects")?(p(),E(A,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(r.row)},null,8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAddJobNumber,record:e.record,onUpdate:o[2]||(o[2]=r=>e.loadData(!0)),onCanceled:e.perDiemClosed},null,8,["prompt","record","onCanceled"])])}var qt=oe(Rt,[["render",At]]);const Et=ae({emits:["cancelAdd","addComplete"],props:{project:Object},setup(e,{emit:o}){const d=te(),c=de(),{getViewedProjects:f,updateViewedProjects:j}=ne(),u=S(()=>c.params.id?c.params.id:e.project[3]?e.project[3]:null),r=S(()=>u.value?f(u.value):null),t=J({name:F().required().label("Location Name"),street1:F().required().label("Street Address 1"),street2:F(),city:F().required().label("City"),state:F().required().label("State"),postal:F().required().label("Postal Code")}),{meta:N,errors:y,handleSubmit:k,handleReset:l}=ye({validationSchema:t}),{value:a}=M("name"),{value:i}=M("street1"),{value:b}=M("street2"),{value:m}=M("city"),{value:g}=M("state"),{value:v}=M("postal"),O=k(async I=>{const P={6:{value:I.name},8:{value:I.street1},9:{value:I.street2?I.street2:""},10:{value:I.city},11:{value:I.state},12:{value:I.postal},13:{value:"United States"}};r.value[8]&&Object.assign(P,{15:{value:r.value[8]}});try{const{data:Q}=await w.upsertRecordsXML({to:"bp5d2twyj",data:[P],fieldsToReturn:[22],formatObject:22}),U=r.value.meetingLocations;U.push(Q[0][22]),j({id:u.value,dataset:"meetingLocations",data:U}),d.notify({type:"positive",message:`Meeting location ${Q[0][22][6]} successfully added`}),o("addComplete"),l()}catch(Q){console.log(Q),d.notify({type:"negative",message:"Something went wrong!"})}});return{projectObject:r,formErrors:y,formMeta:N,submit:O,name:a,street1:i,street2:b,city:m,state:g,postal:v,states:Je}}}),Pt={class:"row"},Lt={class:"col-6 col-md-12"},St={class:"text-caption"},Dt={class:"text-caption"},Ot={class:"text-caption"},Xt={class:"text-caption"},Ut={class:"text-caption"};function Tt(e,o,d,c,f,j){return p(),L("div",null,[s(be,{onSubmit:fe(e.submit,["prevent"])},{default:n(()=>[s(ce,null,{default:n(()=>[s(se,null,{default:n(()=>[C("div",Pt,[C("div",Lt,[s(z,{label:"Location Name",dense:"",modelValue:e.name,"onUpdate:modelValue":o[0]||(o[0]=u=>e.name=u),error:!!e.formErrors.name,"bottom-slots":""},{error:n(()=>[C("div",St,D(e.formErrors.name),1)]),_:1},8,["modelValue","error"]),s(z,{label:"Street Address 1",dense:"",modelValue:e.street1,"onUpdate:modelValue":o[1]||(o[1]=u=>e.street1=u),error:!!e.formErrors.street1,"bottom-slots":""},{error:n(()=>[C("div",Dt,D(e.formErrors.street1),1)]),_:1},8,["modelValue","error"]),s(z,{label:"Street Address 2",dense:"",modelValue:e.street2,"onUpdate:modelValue":o[2]||(o[2]=u=>e.street2=u),error:!!e.formErrors.street2,"bottom-slots":""},{error:n(()=>[C("div",Ot,D(e.formErrors.street2),1)]),_:1},8,["modelValue","error"]),s(z,{label:"City",dense:"",modelValue:e.city,"onUpdate:modelValue":o[3]||(o[3]=u=>e.city=u),error:!!e.formErrors.city,"bottom-slots":""},{error:n(()=>[C("div",Xt,D(e.formErrors.city),1)]),_:1},8,["modelValue","error"]),s(me,{dense:"",label:"State","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.state,"onUpdate:modelValue":o[4]||(o[4]=u=>e.state=u),options:e.states,"bottom-slots":""},null,8,["modelValue","options"]),s(z,{label:"Postal Code",dense:"",modelValue:e.postal,"onUpdate:modelValue":o[5]||(o[5]=u=>e.postal=u),error:!!e.formErrors.postal,"bottom-slots":""},{error:n(()=>[C("div",Ut,D(e.formErrors.postal),1)]),_:1},8,["modelValue","error"])])])]),_:1}),s(Ce,{align:"right"},{default:n(()=>[s(A,{color:"secondary",label:"Cancel",onClick:o[6]||(o[6]=u=>e.$emit("cancelAdd"))}),s(A,{color:"primary",label:"Submit",type:"submit",onClick:e.submit},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["onSubmit"])])}var Mt=oe(Et,[["render",Tt]]);const It=[{name:0,label:"Location Name",align:"left",field:e=>e[6],format:e=>`${e}`,sortable:!0},{name:1,label:"Address",align:"left",field:e=>e[8],format:e=>`${e}`,sortable:!1,required:!0}],Ft=ae({components:{AddMeetingLocation:Mt},props:{project:String},setup(e){const o=te(),d=de(),c=V(!0),f=V(!1),{getViewedProjects:j,updateViewedProjects:u}=ne(),r=S(()=>d.params.id?d.params.id:e.project),t=S(()=>j(r.value)),N=S(()=>t.value&&t.value.meetingLocations?t.value.meetingLocations:[]),y=async a=>{if(c.value=!0,(N.value.length===0||a)&&t.value){const{data:i}=await w.fetchFromStructureApp({fields:[pe({type:"meetingLocations",query:`{'15'.EX.'${t.value[8]}'}AND{'14'.EX.'Active'}`})]});u({id:r.value,dataset:"meetingLocations",data:i})}c.value=!1};function k(a){console.log(a),o.dialog({title:"Confirm",message:`Are you sure you want to remove location ${a[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{l(a)})}async function l(a){try{const{data:i}=await w.upsertRecordsXML({to:"bp5d2twyj",data:[{3:{value:a[3]},14:{value:"Inactive"}}],fieldsToReturn:[22],formatObject:22}),b=N.value.filter(m=>m[3]!==i[0][22][3]);u({id:r.value,dataset:"meetingLocations",data:b}),o.notify({type:"positive",message:"Meeting Location Removed"})}catch(i){console.log(i),o.notify({type:"negative",message:"Something went wrong"})}}return y(),{projectData:t,columns:It,rows:N,initialPagination:{rowsPerPage:V(8)},showAdd:f,removeRow:k,loadData:y,loading:c}}}),Qt={class:"text-caption"};function zt(e,o,d,c,f,j){const u=W("add-meeting-location");return p(),L("div",null,[e.showAdd?T("",!0):(p(),E(we,{key:0,dense:"",title:"Meeting Locations","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[s(A,{dense:"",color:"accent",label:"Add New",onClick:o[0]||(o[0]=r=>e.showAdd=!0)})]),"top-right":n(()=>[s(A,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[1]||(o[1]=r=>e.loadData(!0))})]),header:n(r=>[s(x,{class:"bg-dark text-white",props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(_,{class:"text-left",key:t.name},{default:n(()=>[ue(D(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(r=>[s(x,{props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(ee,{key:t.name,props:r},{default:n(()=>[C("span",Qt,D(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[s(A,{color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(r.row)},null,8,["onClick"])]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(p(),E(u,{key:1,onAddComplete:o[2]||(o[2]=r=>e.showAdd=!1),onCancelAdd:o[3]||(o[3]=r=>e.showAdd=!1)})):T("",!0)])}var Ht=oe(Ft,[["render",zt]]);const Jt={class:"q-pa-md q-gutter-sm"},Wt={class:"text-body1 text-white"},Bt={__name:"projectSiteContact",props:{prompt:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update","canceled"],setup(e,{emit:o}){const d=e,c=te(),f=V(10),j=V(null),u=V(!1),r=S(()=>{const R=new RegExp("^[0-9]{"+f.value+"}","g");return J({firstName:F().required().label("First Name"),lastName:F().required().label("Last Name"),email:F().email().required().label("Email"),phoneNumber:F().matches(R,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number")})}),{errors:t,handleSubmit:N,handleReset:y}=ye({validationSchema:r}),{value:k}=M("firstName"),{value:l}=M("lastName"),{value:a}=M("email"),{value:i}=M("phoneNumber"),b=V("add"),m=V("Project Site Contact"),{prompt:g,record:v}=Ae(d);ve(g,R=>{R===!0&&(u.value=!0,v.value&&v.value[3]?(m.value=`Edit #${v.value[3]} ${v.value[17]}`,b.value="edit",k.value=v.value[28],l.value=v.value[29],i.value=v.value[20].replace(/\D/g,""),a.value=v.value[21]):(m.value="New Site Contact",b.value="add"))});const O=N(async R=>{try{const q={28:{value:R.firstName},29:{value:R.lastName},30:{value:R.phoneNumber},31:{value:R.email}};v.value[3]&&(q[3]={value:v.value[3]}),v.value.projectId&&(q[7]={value:v.value.projectId}),await w.upsertRecordsXML({to:"bp5hcce69",data:[q],fieldsToReturn:[27],formatObject:27}),U(),Q(!0)}catch{X()}}),I=R=>{j.value=R},P=R=>{f.value=R},Q=R=>{y(),u.value=!1,o(R?"update":"canceled")},U=()=>{b.value==="add"?c.notify({type:"positive",message:"Record added."}):b.value==="edit"?c.notify({type:"positive",message:"Record updated."}):c.notify({type:"positive",message:"Successful."})},X=R=>{b.value==="add"?c.notify({type:"negative",message:"Error on adding Record!"}):b.value==="edit"?c.notify({type:"negative",message:"Error on updating Record!"}):c.notify({type:"negative",message:"Error!"})};return(R,q)=>(p(),L("div",Jt,[s(ke,{modelValue:u.value,"onUpdate:modelValue":q[5]||(q[5]=$=>u.value=$),persistent:""},{default:n(()=>[s(ce,{style:{"min-width":"350px"}},{default:n(()=>[s(be,{onSubmit:fe(h(O),["prevent"])},{default:n(()=>[s(se,{class:"bg-dark"},{default:n(()=>[C("div",Wt,D(m.value),1)]),_:1}),s(se,null,{default:n(()=>[s(z,{dense:"",modelValue:h(k),"onUpdate:modelValue":q[0]||(q[0]=$=>G(k)?k.value=$:null),label:"First Name *",error:!!h(t).firstName,"error-message":h(t).firstName},null,8,["modelValue","error","error-message"]),s(z,{dense:"",modelValue:h(l),"onUpdate:modelValue":q[1]||(q[1]=$=>G(l)?l.value=$:null),label:"Last Name *",error:!!h(t).lastName,"error-message":h(t).lastName},null,8,["modelValue","error","error-message"]),s(We,{name:"phoneNumber",class:"col-xs-12 col-sm-12",dense:"",modelValue:h(i),"onUpdate:modelValue":q[2]||(q[2]=$=>G(i)?i.value=$:null),label:"Phone Number",tabindex:"3",onMaxLengthChanged:P,error:!!h(t).phoneNumber,"error-message":h(t).phoneNumber,onCountryChanged:I},null,8,["modelValue","error","error-message"]),s(z,{dense:"",modelValue:h(a),"onUpdate:modelValue":q[3]||(q[3]=$=>G(a)?a.value=$:null),label:"Email *",type:"email",error:!!h(t).email,"error-message":h(t).email},null,8,["modelValue","error","error-message"])]),_:1}),s(Ce,{align:"right",class:"text-primary bg-accent"},{default:n(()=>[s(A,{color:"secondary",onClick:q[4]||(q[4]=$=>Q(!1)),label:"Cancel",size:h(c).screen.lt.md?"sm":""},null,8,["size"]),s(A,{color:"primary",type:"submit",label:"Save",size:h(c).screen.lt.md?"sm":""},null,8,["size"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]))}},{capitalize:Ee}=Xe,Ve=e=>{const o=e.split(" ");let d="";return o.forEach((c,f)=>{d+=f>0?` ${Ee(c.toLowerCase())}`:Ee(c.toLowerCase())}),d},Yt=[{name:0,label:"Name",align:"left",field:e=>e[17],format:e=>`${Ve(e)}`,sortable:!0},{name:1,label:"Phone",align:"left",field:e=>e[20],format:e=>e!==""?`${e}`:"N/A",sortable:!0,required:!0}],Gt=ae({components:{projectSiteContact:Bt},props:{project:String},setup(e){const o=te(),d=de(),c=V(!0),f=V(null),{getViewedProjects:j,updateViewedProjects:u}=ne(),r=S(()=>d.params.id?d.params.id:e.project),t=S(()=>j(r.value)),N=S(()=>(t.value&&t.value.siteContacts?t.value.siteContacts:[]).sort((v,O)=>v[17]>O[17]?1:-1)),y=async g=>{if(c.value=!0,N.value.length===0||g){const{data:v}=await w.fetchFromProjectsApp({fields:[Z({type:"siteContacts",query:`{'7'.EX.'${r.value}'}AND{'6'.EX.'Active'}`})]});u({id:r.value,dataset:"siteContacts",data:v})}c.value=!1},k=V(!1);function l(g){o.dialog({title:"Confirm",message:`Are you sure you want to remove contact ${Ve(g[17])}?`,cancel:!0,persistent:!0}).onOk(()=>{a(g)})}async function a(g){try{const{data:v}=await w.upsertRecordsXML({to:"bp5hcce69",data:[{3:{value:g[3]},6:{value:"Inactive"}}],fieldsToReturn:[27],formatObject:27}),O=N.value.filter(I=>I[3]!==v[0][27][3]);u({id:r.value,dataset:"siteContacts",data:O}),o.notify({type:"positive",message:"Contact Removed"})}catch(v){console.log(v),o.notify({type:"negative",message:"Something went wrong"})}}const i=g=>{k.value=!1,y(!0)},b=g=>{g?f.value=g:f.value={projectId:r.value},k.value=!0},m=()=>{k.value=!1,f.value=null};return y(),{projectData:t,columns:Yt,rows:N,initialPagination:{rowsPerPage:V(8)},showAdd:k,removeRow:l,loadData:y,loading:c,properValue:Ve,contactAdded:i,record:f,openSiteContact:b,siteContactClosed:m}}}),Kt={class:"text-caption"};function Zt(e,o,d,c,f,j){const u=W("project-site-contact");return p(),L("div",null,[s(we,{dense:"",title:"Contacts","title-class":"text-primary",style:{"max-height":"300px"},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","projectContacts")||e.$can("manage","projects")?(p(),E(A,{key:0,dense:"",color:"accent",label:"Add New",onClick:o[0]||(o[0]=r=>e.openSiteContact())})):T("",!0)]),"top-right":n(()=>[s(A,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[1]||(o[1]=r=>e.loadData(!0))})]),header:n(r=>[s(x,{class:"bg-dark text-white",props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(_,{class:"text-left",key:t.name},{default:n(()=>[ue(D(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(r=>[s(x,{props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(ee,{key:t.name,props:r},{default:n(()=>[C("span",Kt,D(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectContacts")||e.$can("manage","projects")?(p(),E(A,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"edit",onClick:t=>e.openSiteContact(r.row)},null,8,["onClick"])):T("",!0),e.$can("manage","projectContacts")||e.$can("manage","projects")?(p(),E(A,{key:1,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(r.row)},null,8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{prompt:e.showAdd,record:e.record,onUpdate:o[2]||(o[2]=r=>e.loadData(!0)),onCanceled:e.siteContactClosed},null,8,["prompt","record","onCanceled"])])}var _t=oe(Gt,[["render",Zt]]);const xt=ae({components:{},props:{project:Object},setup(e,o){const d=te(),c=V(10),f=V(null),{getUser:j}=Pe(Le()),u=V(null),r=S(()=>{const $=new RegExp("^[0-9]{"+c.value+"}","g");return J({firstName:F().required().label("First Name"),lastName:F().required().label("Last Name"),email:F().email().required().label("Email"),phoneNumber:F().matches($,{excludeEmptyString:!0,message:"Valid Phone Number Required!"}).required().label("Phone Number"),role:J().required().nullable().label("Role"),workdayId:F().required().label("Workday ID")})}),{meta:t,errors:N,handleSubmit:y,handleReset:k}=ye({validationSchema:r}),{value:l}=M("firstName"),{value:a}=M("lastName"),{value:i}=M("email"),{value:b}=M("phoneNumber"),{value:m}=M("role"),{value:g}=M("workdayId");async function v({accessID:$}){const{data:Y}=await w.upsertRecordsXML({to:"br598isx6",data:[{3:{value:$},20:{value:!0}}],fieldsToReturn:[28],formatObject:28});o.emit("userAdded",{user:Y[0][28]}),d.loading.hide(),k()}async function O($,Y){w.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:$},10:{value:"Active"},11:{value:Y}}]});const{data:$e}=await w.fetchFromStructureApp({fields:[{6:{value:"br598isx6"},7:{value:"Table Query"},8:{value:`{'6'.EX.${$}}`},9:{value:1},14:{value:24}}]});if(new Set($e.filter(le=>le[7]==="Project").map(le=>le[9])).has(e.project[3])){const le=$e.find(Re=>Re[9]===e.project[3]);v({accessID:le[3]})}else return!1}async function I($){const Y=`{'6'.EX.'${$.email}'}AND{'8'.EX.'${$.phoneNumber}'}AND{'32'.EX.'${$.userType}'}`,$e=[{7:{value:"User Request"},8:{value:Y},9:{value:1},14:{value:77}}];if(Y==="{'10'.EX.'Active'}AND{'32'.EX.'Candidate'}"||Y==="{'10'.EX.'Active'}AND{'32'.EX.'Project User'}")throw{response:{data:{errtext:"Unknown username",errdetail:"Sorry! Something's wrong. Try again."}}};const{data:re}=await w.fetchFromStructureApp({fields:$e});if(re.length<1)return null;if(!await O(re[0][3],$.role))return re}const P=y(async $=>{d.loading.show();const Y={userType:"Project User",phoneNumber:`+${f.value?f.value.dialCode:"1"}${$.phoneNumber}`,email:$.email,role:$.role[3]};if(e.project.users.filter(re=>re[6]===Y.email||re[8]===Y.phoneNumber).length>0)d.dialog({title:"Alert",message:"Your project already has a user with that phone or email."}).onOk(()=>{o.emit("userCanceled")});else{const re=await I(Y);if(console.log(re),re){const{data:le}=await w.upsertRecordsXML({to:"br598isx6",data:[{6:{value:re[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});le.length>0&&o.emit("userAdded",{user:le[0][28]})}else{const le=i.value.match(/^([^@]*)@/)[1],Re=Object.assign({phoneNumber:b.value},f.value),{data:qe}=await w.upsertRecordsXML({to:"br4pxrbs6",data:[{6:{value:$.email},7:{value:"temp"},8:{value:`+${f.value?f.value.dialCode:"1"}${$.phoneNumber}`},9:{value:JSON.stringify(Re)},10:{value:"Active"},11:{value:$.role[3]},17:{value:!0},23:{value:j.value[3]},24:{value:j.value[3]},25:{value:new Date},26:{value:new Date},32:{value:"Project User"},33:{value:le},35:{value:l.value},37:{value:a.value},49:{value:!0},50:{value:!0},70:{value:$.workdayId}}],fieldsToReturn:[3,96],formatObject:96});if(qe[0]!==void 0){const Ne=await w.upsertRecordsXML({to:"br598isx6",data:[{6:{value:qe[0][3]},7:{value:"Project"},9:{value:e.project[3]}}],fieldsToReturn:[28],formatObject:28});Ne.data[0]!==void 0&&d.dialog({title:"Confirm",message:"User successfully added. Would you like to send them an invite?",cancel:!0,persistent:!0}).onOk(async()=>{(await w.upsertRecordsXML({to:"br4pxrbs6",data:[{3:{value:Ne.data[0][28][3]},93:{value:new Date}}],fieldsToReturn:[3]})).data[0]!==void 0&&(d.notify({type:"positive",message:"User invite submitted"}),o.emit("userAdded",{user:Ne.data[0][28]}))}).onCancel(()=>{o.emit("userAdded",{user:Ne.data[0][28]})})}}}k(),d.loading.hide()}),Q=S(()=>{const $=e.project.users.map(Y=>Y[9].phoneNumber);return new Set($)});ve(b,$=>{Q.value.has($)&&d.notify({type:"negative",message:"Phone Number is already in use!",timeout:1e4,position:d.screen.lt.md?"top":"center"})});const U=$=>{f.value=$},X=$=>{c.value=$};function R(){k(),o.emit("userCanceled")}async function q(){d.loading.show();const{data:$}=await w.fetchFromStructureApp({fields:[{6:{value:"br5v4in72"},7:{value:"Table Query"},8:{value:"{'7'.EX.'Projects'}AND{'15'.EX.'Active'}AND{'17'.EX.true}"},9:{value:1},14:{value:18}}]});u.value=$,d.loading.hide()}return q(),{updateCountry:U,updatePhoneMaxLength:X,firstName:l,lastName:a,email:i,phoneNumber:b,role:m,workdayId:g,formMeta:t,formErrors:N,submitUser:P,roleOptions:u,cancel:R}}}),ea=C("div",{class:"text-primary text-h6"},"Add a New User",-1),ta=C("div",{class:"text-accent text-body2 text-italic q-mb-md"},"All info is required.",-1),aa={class:"row justify-between"},oa={class:"row justify-between"},ra={class:"text-caption"},la={class:"row justify-between"},sa={class:"text-caption"},na={class:"text-caption"};function ia(e,o,d,c,f,j){return p(),L("div",null,[s(ce,null,{default:n(()=>[s(be,{onSubmit:fe(e.submitUser,["prevent"])},{default:n(()=>[s(se,null,{default:n(()=>[ea,ta,C("div",aa,[C("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(z,{dense:"",outlined:"",label:"First Name",modelValue:e.firstName,"onUpdate:modelValue":o[0]||(o[0]=u=>e.firstName=u),error:!!e.formErrors.firstName},null,8,["modelValue","error"])],2),C("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(z,{dense:"",outlined:"",label:"Last Name",modelValue:e.lastName,"onUpdate:modelValue":o[1]||(o[1]=u=>e.lastName=u),error:!!e.formErrors.lastName},null,8,["modelValue","error"])],2)]),C("div",oa,[C("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(z,{dense:"",outlined:"",label:"Workday ID",modelValue:e.workdayId,"onUpdate:modelValue":o[2]||(o[2]=u=>e.workdayId=u),error:!!e.formErrors.workdayId},null,8,["modelValue","error"])],2),C("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(z,{dense:"",outlined:"",label:"Phone Number",modelValue:e.phoneNumber,"onUpdate:modelValue":o[3]||(o[3]=u=>e.phoneNumber=u),error:!!e.formErrors.phoneNumber,"bottom-slots":""},{error:n(()=>[C("div",ra,D(e.formErrors.phoneNumber),1)]),_:1},8,["modelValue","error"])],2)]),C("div",la,[C("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(z,{dense:"",outlined:"",label:"Email","bottom-slots":"",modelValue:e.email,"onUpdate:modelValue":o[4]||(o[4]=u=>e.email=u),error:!!e.formErrors.email},{error:n(()=>[C("div",sa,D(e.formErrors.email),1)]),_:1},8,["modelValue","error"])],2),C("div",{class:ie(["col-12 col-md-6",e.$q.screen.lt.md?"q-pt-sm":"q-pr-sm"])},[s(me,{dense:"",outlined:"",label:"Role","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.role,"onUpdate:modelValue":o[5]||(o[5]=u=>e.role=u),options:e.roleOptions,"option-label":"6","display-value":`${e.role?e.role[6]:""}`,"bottom-slots":"",error:!!e.formErrors.role},{error:n(()=>[C("div",na,D(e.formErrors.role),1)]),_:1},8,["modelValue","options","display-value","error"])],2)])]),_:1}),s(Ce,{align:"right"},{default:n(()=>[s(A,{color:"secondary",onClick:e.cancel,label:"Cancel"},null,8,["onClick"]),s(A,{color:"primary",type:"submit",label:"Submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})])}var ua=oe(xt,[["render",ia]]);const da=[{name:1,label:"Name",align:"left",field:e=>e[35],format:(e,o)=>`${e} ${o[37]}`,sortable:!0},{name:2,label:"Role",align:"left",field:e=>e[44],format:e=>`${e}`,sortable:!0}],ca=ae({components:{AddUser:ua},props:{project:String},setup(e){const o=te(),d=de(),c=V(!0),f=V(!1),{getViewedProjects:j,updateViewedProjects:u}=ne(),{userData:r}=Le(),t=S(()=>d.params.id?d.params.id:e.project),N=S(()=>j(t.value)),y=S(()=>(N.value&&N.value.users?N.value.users:[]).filter(m=>m[3]!==r[3]).sort((m,g)=>m[1].$d>g[1].$d?1:-1)),k=async b=>{if(c.value=!0,y.value.length===0||b){const{data:m}=await w.fetchFromStructureApp({fields:[pe({type:"userAccess",query:`{'9'.EX.'${t.value}'}AND{'20'.EX.true}`})]});u({id:t.value,dataset:"users",data:m})}c.value=!1};function l(b){console.log(b),o.dialog({title:"Confirm",message:`Are you sure you want to remove user ${b[35]} ${b[37]}?`,cancel:!0,persistent:!0}).onOk(()=>{i(b)})}function a({user:b}){o.notify({type:"positive",message:"User successfully added!"}),f.value=!1;const m=N.value.users;m.push(b),u({id:t.value,dataset:"users",data:m})}async function i(b){const{data:m}=await w.fetchFromStructureApp({fields:[pe({type:"userAccessObject",query:`{'6'.EX.'${b[3]}'}AND{'7'.EX.'Project'}AND{'9'.EX.'${t.value}'}`})]}),g=[];m.forEach(O=>{const I={3:{value:O[3]},20:{value:!1},38:{value:!1},39:{value:!1},40:{value:!1},41:{value:!1}};g.push(I)}),w.upsertRecordsXML({to:"br598isx6",data:g,fieldsToReturn:[3]});const v=y.value.filter(O=>O[3]!==b[3]);u({id:t.value,dataset:"users",data:v}),o.notify({type:"positive",message:"User Removed"})}return k(),{projectData:N,columns:da,rows:y,initialPagination:{rowsPerPage:V(8)},showAdd:f,removeRow:l,loadData:k,loading:c,userAdded:a}}}),pa={class:"text-caption"};function ma(e,o,d,c,f,j){const u=W("add-user");return p(),L("div",null,[e.showAdd?T("",!0):(p(),E(we,{key:0,dense:"",title:"Users","title-class":"text-primary",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[3],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{showing:e.loading,label:"Loading...","label-class":"text-info"},null,8,["showing"])]),"top-left":n(()=>[e.$can("create","users")?(p(),E(A,{key:0,dense:"",color:"accent",label:"Add New",onClick:o[0]||(o[0]=r=>e.showAdd=!0)})):T("",!0)]),"top-right":n(()=>[s(A,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[1]||(o[1]=r=>e.loadData(!0))})]),header:n(r=>[s(x,{class:"bg-dark text-white",props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(_,{class:"text-left",key:t.name},{default:n(()=>[ue(D(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(r=>[s(x,{props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(ee,{key:t.name,props:r},{default:n(()=>[C("span",pa,D(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","users")?(p(),E(A,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(r.row)},null,8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"])),e.showAdd?(p(),E(u,{key:1,onUserAdded:e.userAdded,onUserCanceled:o[2]||(o[2]=r=>e.showAdd=!1),project:e.projectData},null,8,["onUserAdded","project"])):T("",!0)])}var fa=oe(ca,[["render",ma]]);const va=ae({components:{approveHeadcount:Ye},props:{project:Object},setup(e){const o=te(),d=de(),c=V(!1),f=V(!0),j=V([]),u=ne(),{getApprovedHeadcount:r}=Pe(u),{getAssignments:t,fetchAssignments:N}=Be(),y=Ue(),{fetchAllProjects:k}=y,l=S(()=>d.params.id?d.params.id:e.project&&e.project[3]?e.project[3]:null),a=S(()=>[{name:0,label:"Headcount",align:"left",field:P=>P[6],format:P=>`${P}`,sortable:!0},{name:1,label:"Date",align:"left",field:P=>P[7],format:P=>`${Te.formatDate(new Date(P),"MM/DD/YYYY")}`,sortable:!0}]),i=S(()=>j.value&&j.value[0]&&j.value[0][6]?j.value[0][6]:null),b=async P=>{if(f.value=!0,P||j.value.length===0){const{data:Q}=await w.fetchFromProjectsApp({fields:[{14:{value:10},9:{value:1},8:{value:`{'8'.EX.'${l.value}'}AND{'12'.EX.'TRUE'}`},7:{value:"Table Query"},6:{value:"bteqadt9j"}}]});j.value=Q.sort((U,X)=>U[7].$d>X[7].$d?-1:1)}f.value=!1},m=S(()=>t(l.value)?t(l.value).filter(P=>!P[112]&&P.latest&&P[102]==="Active").length:"N/A"),g=async P=>{try{t(l.value)&&t(l.value).length===0&&await N({projectId:l.value,refresh:P})}catch(Q){console.log(Q)}},v=()=>{b(!0),g(!0),k({can:"read"})};function O(P){o.dialog({title:"Confirm",message:`Are you sure you want to remove Client Contracted Headcount ${P[6]}?`,cancel:!0,persistent:!0}).onOk(()=>{I(P)})}async function I(P){try{const Q=[{3:{value:P[3]},6:{value:P[6]},7:{value:P[7]},8:{value:P[8]},12:{value:!1}}],{data:U}=await w.upsertRecordsXML({to:"bteqadt9j",fieldsToReturn:[3,6,7,8,12],data:Q,formatObject:10});if(U&&U[0]&&U[0][3])v(),o.notify({position:"top-right",type:"positive",message:"Client Contracted Headcount successfully removed"});else throw"Error in removing Client Contracted Headcount"}catch(Q){console.log(Q),o.notify({position:"top-right",type:"negative",message:"Error removing Client Contracted Headcount"})}}return ve(r,()=>{v()}),b(!1),g(!1),{props:e,addHeadcount:c,loading:f,rows:j,columns:a,initialPagination:{rowsPerPage:V(10)},approvedHeadcount:i,activeHeadcount:m,refreshHeadcount:v,removeRow:O}}}),ba={class:"q-mt-xs"},ya={class:"text-body1 text-white text-uppercase"},ga={key:0,class:"q-px-xs"},wa={key:1,class:"text-caption text-dark text-italic q-px-md"},$a={class:"text-caption"};function ha(e,o,d,c,f,j){const u=W("approveHeadcount");return p(),L(B,null,[C("div",ba,[s(ce,{class:"text-dark q-pb-sm"},{default:n(()=>[s(se,{class:"bg-info q-py-sm"},{default:n(()=>[C("div",ya,[ue(" Client Contracted Headcount "),e.approvedHeadcount?(p(),L("span",ga,"("+D(e.approvedHeadcount)+")",1)):T("",!0)])]),_:1})]),_:1})]),C("div",null,[s(we,{dense:"",style:{},columns:e.columns,rows:e.rows,"row-key":r=>r[7],"table-header-class":"bg-dark text-white text-caption",pagination:e.initialPagination,loading:e.loading},{loading:n(()=>[s(ge,{label:"Loading...","label-class":"text-info"})]),"top-left":n(()=>[C("div",null,[e.$can("create","projectHeadcount")||e.$can("manage","projects")?(p(),E(A,{key:0,dense:"",color:"accent",label:"Add New",onClick:o[0]||(o[0]=r=>e.addHeadcount=!0)})):T("",!0),e.activeHeadcount!==null?(p(),L("span",wa,"Active Headcount: "+D(e.activeHeadcount),1)):T("",!0)])]),"top-right":n(()=>[s(A,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:e.refreshHeadcount},null,8,["onClick"])]),header:n(r=>[s(x,{class:"bg-dark text-white",props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(_,{class:"text-left",key:t.name},{default:n(()=>[ue(D(t.label),1)]),_:2},1024))),128)),s(_,{"auto-width":""})]),_:2},1032,["props"])]),body:n(r=>[s(x,{props:r},{default:n(()=>[(p(!0),L(B,null,K(r.cols,t=>(p(),E(ee,{key:t.name,props:r},{default:n(()=>[C("span",$a,D(t.value),1)]),_:2},1032,["props"]))),128)),s(ee,{"auto-width":""},{default:n(()=>[e.$can("manage","projectHeadcount")||e.$can("manage","projects")?(p(),E(A,{key:0,color:"accent",dense:"",flat:"",round:"",icon:"delete",onClick:t=>e.removeRow(r.row)},null,8,["onClick"])):T("",!0)]),_:2},1024)]),_:2},1032,["props"])]),_:1},8,["columns","rows","row-key","pagination","loading"]),s(u,{project:e.props.project,modelValue:e.addHeadcount,"onUpdate:modelValue":o[1]||(o[1]=r=>e.addHeadcount=r)},null,8,["project","modelValue"])])],64)}var ja=oe(va,[["render",ha]]);const Ca=ae({components:{DetailsCard:mt,JobNumbers:ht,PerDiem:qt,MeetingLocations:Ht,SiteContacts:_t,Users:fa,ApprovedHeadcount:ja},setup(e,{emit:o}){const d=te(),c=V(0),f=de(),{getViewedProjects:j,updateViewedProjects:u,setViewedProjects:r}=ne(),t=S(()=>j(f.params.id));(async()=>{if(!t.value){const{data:l}=await w.fetchFromProjectsApp({fields:[Z({type:"projects",id:f.params.id})]});r({id:f.params.id,data:l})}})();const y=l=>{const a=[];for(const[i,b]of Object.entries(l)){const m={fid:i,value:b};a.push(m)}u({id:t.value[3],props:a})};return{details:S(()=>t.value?[{label:"Date Created",value:Me(t.value[1].$d).format("MM/DD/YYYY hh:mm:ss a"),editable:!1},{label:"Project Name",value:t.value[20],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:t.value[20],formRules:F().required().label("Project Name"),fieldLabel:"Enter the Project Name",getter:null,setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},20:{value:l}}],fieldsToReturn:[20,43]});y(a[0]),d.notify({type:"positive",message:"Project Name successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Name"})}}}},{label:"Project Alias",value:t.value[44],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"input",initialValue:t.value[44],formRules:F().required().label("Project Alias"),fieldLabel:"Enter the Project Alias",getter:null,setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},44:{value:l}}],fieldsToReturn:[44]});y(a[0]),d.notify({type:"positive",message:"Project Alias successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Project Alias"})}}}},{label:"Customer",value:t.value[25],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"customer",initialValue:l=>l.find(a=>a[3]===t.value[9]),formRules:J().required().label("Customer").nullable(),fieldLabel:"Customer",optionLabel:"6",displayValue:6,getter:async()=>{const{data:l}=await w.fetchFromStructureApp({fields:[pe({type:"projectCustomers",query:"{'7'.EX.'Active'}"})]});return l.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},9:{value:l[3]}}],fieldsToReturn:[9,25]});y(a[0]),d.notify({type:"positive",message:"Customer successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Customer"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1)}},{label:"Job Site",value:t.value[24],editable:!0,config:{permission:{action:"manage",subject:"projects"},type:"options",allowNew:!0,newType:"location",initialValue:l=>l.find(a=>a[3]===t.value[8]),formRules:J().required().label("Job Site").nullable(),fieldLabel:"Job Site",optionLabel:"6",displayValue:6,getter:async()=>{const{data:l}=await w.fetchFromStructureApp({fields:[pe({type:"projectLocations",query:"{'51'.EX.true}"})]});return l.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},8:{value:l[3]}}],fieldsToReturn:[8,24,43,67,69,136]});y(a[0]),d.notify({type:"positive",message:"Job Site successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Job Site"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1)}},{label:"Address",value:t.value[67]},{label:"Sup Org Manager",value:t.value[245]},{label:"Primary Hiring Center",value:t.value[76],editable:!0,config:{permission:{action:"manage",subject:"hiringCenters"},type:"options",allowNew:!1,initialValue:l=>l.find(a=>a[3]===t.value[12]),formRules:J().required().label("Primary Hiring Center").nullable(),fieldLabel:"Hiring Center",optionLabel:"60",displayValue:60,getter:async()=>{const{data:l}=await w.fetchFromStructureApp({fields:[pe({type:"hiringCenters",query:"{'51'.EX.'Active'}"})]});return l.sort((a,i)=>a[60]>i[60]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},12:{value:l[3]}}],fieldsToReturn:[12,26,76]});y(a[0]),d.notify({type:"positive",message:"Hiring Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Hiring Center"})}},filter:(l,a)=>l.filter(i=>i[60].toLowerCase().indexOf(a)>-1)}},{label:"Workday Location",value:`${t.value[241]} (${t.value[242]})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:l=>l.find(a=>a[3]===t.value[240]),formRules:J().required().label("Workday Location").nullable(),fieldLabel:"Workday Location",optionLabel:l=>`${l[6]} (${l[7]})`,displayValue:6,getter:async()=>{const{data:l}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayLocations",query:`{'14'.EX.true}AND{'45'.EX.'${t.value[136]}'}`})]});return l.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},240:{value:l[40]}}],fieldsToReturn:[240,241,242,257,258]});return y(a[0]),d.notify({type:"positive",message:"Workday Location successfully updated"}),!0}catch{d.notify({type:"negative",message:"Error updating Workday Location"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Workday Region",value:`${H(t.value[283])} (${H(t.value[284])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:l=>l.find(a=>a[3]===t.value[282]),formRules:J().required().label("Workday Region").nullable(),fieldLabel:"Workday Region",optionLabel:l=>`${H(l[6])} (${l[7]})`,displayValue:6,getter:async()=>{const{data:l}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayRegions",query:"{'8'.EX.true}"})]});return l.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},282:{value:l[9]}}],fieldsToReturn:[282,283,284]});y(a[0]),d.notify({type:"positive",message:"Region successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Region"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Company",value:`${H(t.value[286])} (${H(t.value[287])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:l=>l.find(a=>a[3]===t.value[285]),formRules:J().required().label("Company").nullable(),fieldLabel:"Company",optionLabel:l=>`${H(l[6])} (${l[7]})`,displayValue:6,getter:async()=>{const{data:l}=await w.fetchFromProjectsApp({fields:[Z({type:"companies",query:`{'8'.EX.true}AND{'14'.EX.'${t.value[136]}'}`})]});return l.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},285:{value:l[10]}}],fieldsToReturn:[285,286,287]});y(a[0]),d.notify({type:"positive",message:"Company successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Company"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Workday Branch",value:`${H(t.value[289])} (${H(t.value[290])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:l=>l.find(a=>a[3]===t.value[288]),formRules:J().required().label("Workday Branch").nullable(),fieldLabel:"Workday Branch",optionLabel:l=>`${H(l[6])} (${l[7]})`,displayValue:6,getter:async()=>{const l=t.value[264]===""?"Weekly":t.value[264],{data:a}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayBranches",query:`{'8'.EX.true}AND{'9'.EX.'${l}'}AND{'16'.EX.'${t.value[136]}'}`})]});return a.sort((i,b)=>i[6]>b[6]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},288:{value:l[12]}}],fieldsToReturn:[288,289,290]});y(a[0]),d.notify({type:"positive",message:"Branch successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Branch"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Pay Group",value:`${H(t.value[261])} (${H(t.value[262])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:l=>l.find(a=>a[3]===t.value[260]),formRules:J().required().label("Workday Pay Group").nullable(),fieldLabel:"Workday Pay Group",optionLabel:l=>`${H(l[6])} (${l[7]})`,displayValue:6,getter:async()=>{const{data:l}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayPayGroups",query:`{'8'.EX.'TRUE'}AND{'11'.EX.'Weekly'}AND{'21'.EX.'${t.value[136]}'}`})]});return l.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},260:{value:l[16]}}],fieldsToReturn:[260,261,262,263,264,272]});y(a[0]),d.notify({type:"positive",message:"Pay Group successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Pay Group"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}},{label:"Supervisory Org",value:`${H(t.value[259])} (${H(t.value[244])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:l=>l.find(a=>a[3]===t.value[243]),formRules:J().required().label("Supervisory Organization").nullable(),fieldLabel:"Supervisory Organization",optionLabel:l=>`${l[42]} (${l[6]}) - ${H(l[26])}`,displayValue:42,getter:async()=>{const{data:l}=await w.fetchFromProjectsApp({fields:[Z({type:"supOrgs",query:`{'32'.EX.'Active'}AND{'44'.EX.'${t.value[272]}'}`})]});return l.sort((a,i)=>a[42]>i[42]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},243:{value:l[16]}}],fieldsToReturn:[243,244,245,259]});y(a[0]),d.notify({type:"positive",message:"Supervisory Organization successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Supervisory Organization"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[26].toLowerCase().indexOf(a)>-1||i[41].toLowerCase().indexOf(a)>-1||i[42].toLowerCase().indexOf(a)>-1)}},{label:"Cost Center",value:`${H(t.value[276])} (${H(t.value[275])})`,editable:!0,config:{permission:{action:"manage",subject:"workdayReferences"},type:"options",allowNew:!1,initialValue:l=>l.find(a=>a[3]===t.value[274]),formRules:J().required().label("Workday Cost Center").nullable(),fieldLabel:"Workday Cost Center",optionLabel:l=>`${H(l[6])} (${l[7]})`,displayValue:6,getter:async()=>{const{data:l}=await w.fetchFromProjectsApp({fields:[Z({type:"workdayCostCenters",query:`{'8'.EX.true}AND{'9'.EX.'${t.value[287]}'}`})]});return l.sort((a,i)=>a[6]>i[6]?1:-1)},setter:async l=>{try{const{data:a}=await w.upsertRecordsXML({to:"bpzpwr2c7",data:[{3:{value:t.value[3]},274:{value:l[22]}}],fieldsToReturn:[274,275,276]});y(a[0]),d.notify({type:"positive",message:"Cost Center successfully updated"})}catch{d.notify({type:"negative",message:"Error updating Cost Center"})}},filter:(l,a)=>l.filter(i=>i[6].toLowerCase().indexOf(a)>-1||i[7].toLowerCase().indexOf(a)>-1)}}]:[]),tab:c,project:t}}}),Na={class:"q-pa-sm"},ka={class:"row"},Ra={class:"col-12 col-sm-7 q-px-xs"},Va={class:"col-12 col-sm-5 q-px-xs"};function Aa(e,o,d,c,f,j){const u=W("details-card"),r=W("job-numbers"),t=W("meeting-locations"),N=W("site-contacts"),y=W("per-diem"),k=W("users"),l=W("approved-headcount");return p(),E(Oe,{style:{"max-width":"100vw"}},{default:n(()=>[C("div",Na,[C("div",ka,[C("div",Ra,[s(u,{details:e.details,title:"Details"},null,8,["details"])]),C("div",Va,[s(De,{class:"q-py-xs bg-info text-white shadow-2 rounded-borders",align:"left",modelValue:e.tab,"onUpdate:modelValue":o[0]||(o[0]=a=>e.tab=a),dense:"","indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:n(()=>[s(he,{name:0,label:"Job Numbers"}),s(he,{name:1,label:"Locations"}),s(he,{name:2,label:"Contacts"}),s(he,{name:3,label:"Per Diem"}),s(he,{name:4,label:"Users"})]),_:1},8,["modelValue"]),s(Se,{modelValue:e.tab,"onUpdate:modelValue":o[1]||(o[1]=a=>e.tab=a),animated:"",class:"q-px-none"},{default:n(()=>[s(je,{class:"q-px-xs",name:0},{default:n(()=>[s(r)]),_:1}),s(je,{class:"q-px-xs",name:1},{default:n(()=>[s(t)]),_:1}),s(je,{class:"q-px-xs",name:2},{default:n(()=>[s(N)]),_:1}),s(je,{class:"q-px-xs",name:3},{default:n(()=>[s(y)]),_:1}),s(je,{class:"q-px-xs",name:4},{default:n(()=>[s(k)]),_:1})]),_:1},8,["modelValue"]),s(l,{project:e.project},null,8,["project"])])])])]),_:1})}var go=oe(Ca,[["render",Aa]]);export{go as default};
