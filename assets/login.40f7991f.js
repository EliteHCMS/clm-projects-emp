import{Q as de}from"./QImg.7e207bfb.js";import{_ as ue,bU as ce,bT as me,r as d,c as V,w,b5 as P,A as u,aq as f,br as t,aQ as D,B as M,d as o,ar as c,D as k,cT as _,ac as g,bO as pe,bN as ve,cU as Y,av as fe,bW as I,bQ as z,E as ge,cV as he,ax as A,cS as ye}from"./index.429672c4.js";import{Q as be}from"./QForm.644d5019.js";import{Q as we}from"./QPage.1c164a0a.js";import{u as ke}from"./use-quasar.e6ca1583.js";import{u as H}from"./vee-validate.esm.217e8859.js";import{p as _e}from"./VueTelInput.cd3acadc.js";import{_ as xe}from"./languageSelector.5681d36e.js";import{c as S}from"./array.59f93f43.js";import{c as Ce}from"./carousel.cbe7bebb.js";import{b as Te,q as G,h as qe}from"./app.d59c0f43.js";import{u as Pe}from"./i18n.0152b37a.js";import{h as J}from"./HelpDeskTicket.0372a360.js";import"./QSelect.4d6ed681.js";import"./QChip.6eeb9910.js";import"./QMenu.c6a626a1.js";import"./position-engine.daa72afe.js";import"./selection.fa3bc4cc.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./use-panel.6bbf83ae.js";import"./touch.70a9dd44.js";import"./use-fullscreen.9de0f9ba.js";import"./dayjs.cdbadc74.js";import"./localForage.7b97ba34.js";import"./api.682a7e8f.js";import"./index.04bc0a32.js";import"./QTooltip.a483311b.js";import"./QFile.e5662f9b.js";import"./QSpinnerGears.1e3e0cc5.js";const Me={name:"Login",components:{phoneNumberInput:_e,carousel:Ce,languageSelector:xe,helpDeskTicket:J},setup(){const l=ke(),s=ce(),x=me(),{locale:e,t:C}=Pe(),{currentUserType:T,currentPageType:R}=Te(),n=d(!1),i=d(!1),q=d(10),p=d(!1),r=d(null),N=d(!1),X=d("first"),h=d("username"),K=d(null),L=d(null),E=d(!1),Q=d(!1),$=d(!1);s.query.redirect&&(L.value=s.query.redirect,x.replace({query:{}}));const ee=V(()=>n.value?S().email(`${C("validEmailIsRequired")}`).nullable():S().email(`${C("validEmailIsRequired")}`).nullable()),ae=V(()=>{if(i.value)return S().nullable();{const a=new RegExp("^[0-9]{"+q.value+"}","g");return S().matches(a,{excludeEmptyString:!0,message:`${C("validPhoneIsRequired")}`}).nullable()}}),le=V(()=>S().required().min(8).matches(/^(?=.*\d)(?=.*[A-Za-z])(?=.*[a-zA-Z]).{8,}$/,{excludeEmptyString:!0,message:`${C("passwordRules")}`}).nullable()),{errorMessage:j,value:y}=H("email",ee),{errorMessage:B,value:v}=H("phone",ae),{errorMessage:O,value:b,validate:oe}=H("password",le),se=d(!0);w(j,a=>{a||y.value===""?i.value=!1:i.value=!0}),w(y,a=>{!a||a===""?i.value=!1:/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(a)&&!j.value&&(i.value=!0)}),w(B,a=>{a||v.value===""?n.value=!1:n.value=!0}),w(v,a=>{!a||a===""?n.value=!1:a.length===q.value&&!B.value&&(n.value=!0)}),w(O,a=>{a||b.value===""?p.value=!1:p.value=!0}),w(b,a=>{N.value=!1,!a||a===""?p.value=!1:oe().then(m=>{p.value=m.valid})});const te=a=>{q.value=a},F=V(()=>!(n.value||i.value)),re=a=>{r.value=a},ne=()=>{h.value="username",b.value=null,D(()=>{document.querySelector("#email").focus()})},ie=()=>{h.value="username",b.value=null,D(()=>{document.querySelector("#phoneNumber").focus()})},Z=async()=>{Q.value=!0;const a={userType:T};n.value?a.phoneNumber=`+${r.value?r.value.dialCode:"1"}${v.value}`:i.value&&(a.email=y.value);try{const m=await G.checkIfUserExist(a);Q.value=!1,m?(h.value="password",D(()=>{document.querySelector("#password").focus()})):T==="Candidate"?x.push({name:"register",params:{...n.value&&{phoneTemp:v.value},...i.value&&{emailTemp:a.email}}}):l.dialog({title:"Alert",message:n.value?"That phone number does not exist. Try again.":"That email does not exist. Try again."}).onOk(()=>{v.value="",n.value=!1,y.value="",i.value=!1})}catch(m){Q.value=!1,console.log(m)}},W=async()=>{E.value=!0,clearTimeout(K.value);const a={password:qe.encodeHTML(b.value),userType:T};n.value?a.phoneNumber=`+${r.value?r.value.dialCode:"1"}${v.value}`:i.value&&(a.email=y.value);try{const m=await G.login(a);E.value=!1,m&&(L.value?x.push(L.value):x.push({path:"/"}))}catch(m){E.value=!1,K.value=setTimeout(function(){N.value=!1},7e3);const{response:U}=m;U&&U.data.errtext&&U.data.errdetail?l.notify({type:"negative",message:U.data.errdetail,timeout:7e3,position:l.screen.lt.md?"top":"top-right"}):(console.log(m),l.notify({type:"negative",message:"An error occurred, please try again later",timeout:7e3,position:l.screen.lt.md?"top":"top-right"}))}};return{email:y,phone:v,password:b,isPwd:se,validPhone:n,validEmail:i,step:h,validPassword:p,invalidLogin:N,continueProgress:Q,loginProgress:E,passwordMessage:O,phoneMessage:B,emailMessage:j,userNameInvalid:F,updatePhoneMaxLength:te,continueAction:Z,editUserNameEmail:ne,editUserNamePhoneNumber:ie,slide:X,login:W,updateCountry:re,onSubmit:a=>{h.value==="username"&&!F.value?Z():h.value==="password"&&!(!p.value||N.value)?W():a.preventDefault()},locale:e,currentUserType:T,currentPageType:R,helpDeskTicket:J,addTicket:$}}},Se={key:0,class:"col-md-7 col-lg-8 col-lx-8"},Ne={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},Ee={class:"text-dark"},Qe={key:1,class:"divider"},Ue={class:"divider-text"},Ve={key:0,class:"text-grey-6",tabindex:"4"},Ie={key:1,class:"text-grey-6"},Ae={key:2,class:"text-grey-6"},Re={class:"row justify-center"},Le={class:"row justify-center"};function je(l,s,x,e,C,T){const R=P("carousel"),n=P("phone-number-input"),i=P("router-link"),q=P("languageSelector"),p=P("helpDeskTicket");return u(),f(we,{class:"window-height window-width row"},{default:t(()=>[l.$q.screen.lt.md?c("",!0):(u(),M("div",Se,[o(R)])),k("div",Ne,[o(ye,{class:"auth-card",flat:""},{default:t(()=>[o(_,{style:{"padding-left":"30px","padding-right":"30px"}},{default:t(()=>[o(de,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),o(_,{class:"text-center auth-description"},{default:t(()=>[k("p",Ee,g(l.$t("pleaseSignInToYourAccount")),1)]),_:1}),o(_,null,{default:t(()=>[o(be,{class:"q-px-sm q-pt-sm",onSubmit:s[4]||(s[4]=pe(()=>{},["prevent"])),onKeyup:ve(e.onSubmit,["enter"])},{default:t(()=>[!e.validEmail&&!e.validPhone||e.validEmail?(u(),f(Y,{key:0,for:"email",style:{"padding-bottom":"0px"},autocomplete:"username",clearable:"",outlined:"",modelValue:e.email,"onUpdate:modelValue":s[0]||(s[0]=r=>e.email=r),type:"email",label:l.$t("email"),tabindex:"1",error:!!e.emailMessage,"error-message":e.emailMessage,readonly:e.step!=="username"},fe({prepend:t(()=>[o(z,{name:"email"})]),_:2},[e.step!=="username"?{name:"append",fn:t(()=>[o(I,{round:"",dense:"",flat:"",icon:"edit",onClick:e.editUserNameEmail},null,8,["onClick"])]),key:"0"}:void 0]),1032,["modelValue","label","error","error-message","readonly"])):c("",!0),!e.validEmail&&!e.validPhone&&e.currentUserType==="Candidate"?(u(),M("div",Qe,[k("div",Ue,g(l.$t("or")),1)])):c("",!0),(!e.validEmail&&!e.validPhone||e.validPhone)&&e.currentUserType==="Candidate"?(u(),f(n,{key:2,outlined:"",for:"phoneNumber",modelValue:e.phone,"onUpdate:modelValue":s[1]||(s[1]=r=>e.phone=r),label:l.$t("phoneNumber"),tabindex:"1",autocomplete:"username",onMaxLengthChanged:e.updatePhoneMaxLength,style:ge(e.phoneMessage?"padding-bottom: 20px;":"padding-bottom: 0px;"),error:!!e.phoneMessage,"error-message":e.phoneMessage,readonly:e.step!=="username",editIcon:e.step!=="username",onEditClicked:e.editUserNamePhoneNumber,onCountryChanged:e.updateCountry},null,8,["modelValue","label","onMaxLengthChanged","style","error","error-message","readonly","editIcon","onEditClicked","onCountryChanged"])):c("",!0),e.step==="password"?(u(),f(Y,{key:3,for:"password",class:"q-mt-lg",outlined:"",modelValue:e.password,"onUpdate:modelValue":s[3]||(s[3]=r=>e.password=r),type:e.isPwd?"password":"text",label:l.$t("password"),autocomplete:"current-password",tabindex:"2",error:!!e.passwordMessage,"error-message":e.passwordMessage},{append:t(()=>[o(z,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:s[2]||(s[2]=r=>e.isPwd=!e.isPwd)},null,8,["name"])]),prepend:t(()=>[o(z,{name:"lock"})]),_:1},8,["modelValue","type","label","error","error-message"])):c("",!0)]),_:1},8,["onKeyup"])]),_:1}),o(he,{class:"q-px-lg"},{default:t(()=>[e.step==="username"?(u(),f(I,{key:0,loading:e.continueProgress,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:l.$t("continue"),tabindex:"3",disabled:e.userNameInvalid,onClick:e.continueAction},null,8,["loading","label","disabled","onClick"])):c("",!0),e.step==="password"?(u(),f(I,{key:1,loading:e.loginProgress,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:l.$t("login"),tabindex:"3",disabled:!e.validPassword||e.invalidLogin,onClick:e.login},null,8,["loading","label","disabled","onClick"])):c("",!0)]),_:1}),o(_,{class:"text-center q-pa-sm"},{default:t(()=>[e.currentUserType==="Candidate"?(u(),M("p",Ve,[A(g(l.$t("needAnAccountQuestion"))+" ",1),o(i,{to:"/register",class:"text-grey-6"},{default:t(()=>[A(g(l.$t("register")),1)]),_:1})])):c("",!0),e.currentUserType==="Candidate"?(u(),M("p",Ie,[o(i,{to:"/forgot-password",class:"text-grey-6"},{default:t(()=>[A(g(l.$t("forgotPasswordQuestion")),1)]),_:1})])):c("",!0),e.currentUserType!=="Candidate"?(u(),M("p",Ae,[A(g(l.$t("needHelpQuestion"))+" ",1),k("a",{class:"text-grey-6",href:"javascript:void(0);",onClick:s[5]||(s[5]=r=>e.addTicket=!0)},g(l.$t("addHelpDeskTicket")),1)])):c("",!0)]),_:1}),o(_,{class:"q-pl-lg q-pa-sm"},{default:t(()=>[k("div",Re,[o(q,{dense:"",borderless:""})])]),_:1}),e.currentPageType==="Candidate Kiosk"?(u(),f(_,{key:0,class:"q-pl-lg q-pa-sm"},{default:t(()=>[k("div",Le,[o(I,{label:"Bookmarks",color:"primary",size:"md",class:"text-white q-mt-xl",to:{name:"bookmarks"}})])]),_:1})):c("",!0)]),_:1})]),o(p,{modelValue:e.addTicket,"onUpdate:modelValue":s[6]||(s[6]=r=>e.addTicket=r)},null,8,["modelValue"])]),_:1})}var ha=ue(Me,[["render",je],["__scopeId","data-v-26f52b0e"]]);export{ha as default};
