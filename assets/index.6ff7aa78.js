import{bX as ne,r as k,c as F,d1 as se,aQ as ie,ct as ue,h as O,g as ce,bW as g,a5 as de,bT as fe,A as Y,B as W,d as t,br as l,D as y,E as me,cS as E,G as ve,a8 as V,cT as q,ax as h,ac as j,aq as I,cU as L,bO as G,bS as pe,F as be,b4 as ge,bR as ye,bP as Z,bQ as we,cV as X,cy as J,dn as _e,bt as De,_ as he,bV as ke,b5 as ee}from"./index.c7640e72.js";import{Q as te,a as xe}from"./QSelect.fadf4533.js";import{Q as Ce}from"./QPage.b5011f60.js";import{u as re}from"./use-quasar.0751f5b6.js";import{H as ae,I as Ae,q as U}from"./app.8f08130a.js";import{dayjs as A}from"./dayjs.3faf0a5e.js";import{u as Me}from"./dataStore.a1b994da.js";import{Q as z}from"./QTooltip.7d959890.js";import{Q as Ye}from"./QMenu.39482be3.js";import{Q as Se}from"./QList.e7f97b0e.js";import{Q as le}from"./QTd.628abedc.js";import{Q as $e}from"./QInnerLoading.f5fe6689.js";import{a as Ve}from"./QTable.14b74a88.js";import{C as qe}from"./ClosePopup.63001028.js";import"./arrivalDate.e2c386c0.js";import{_ as Qe}from"./projectSelector.ca9b647a.js";import"./QChip.7653060e.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.cb436dbd.js";import"./api.d1dfc8c4.js";import"./index.04bc0a32.js";import"./i18n.911c9472.js";import"./useQuerySaver.d29ff9ee.js";import"./position-engine.4d6bc0f8.js";import"./selection.8a1f3691.js";import"./QMarkupTable.df0b9b28.js";import"./use-fullscreen.32fe6529.js";import"./QForm.17871f7d.js";import"./vee-validate.esm.cf3515d2.js";import"./array.27eafe44.js";function H(a,u=new WeakMap){if(Object(a)!==a)return a;if(u.has(a))return u.get(a);const c=a instanceof Date?new Date(a):a instanceof RegExp?new RegExp(a.source,a.flags):a instanceof Set?new Set:a instanceof Map?new Map:typeof a.constructor!="function"?Object.create(null):a.prototype!==void 0&&typeof a.prototype.constructor=="function"?a:new a.constructor;if(typeof a.constructor=="function"&&typeof a.valueOf=="function"){const n=a.valueOf();if(Object(n)!==n){const w=new a.constructor(n);return u.set(a,w),w}}return u.set(a,c),a instanceof Set?a.forEach(n=>{c.add(H(n,u))}):a instanceof Map&&a.forEach((n,w)=>{c.set(w,H(n,u))}),Object.assign(c,...Object.keys(a).map(n=>({[n]:H(a[n],u)})))}var oe=ne({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(a,{slots:u,emit:c}){const{proxy:n}=ce(),{$q:w}=n,v=k(null),_=k(""),d=k("");let m=!1;const S=F(()=>se({initialValue:_.value,validate:a.validate,set:x,cancel:C,updatePosition:p},"value",()=>d.value,D=>{d.value=D}));function x(){a.validate(d.value)!==!1&&($()===!0&&(c("save",d.value,_.value),c("update:modelValue",d.value)),P())}function C(){$()===!0&&c("cancel",d.value,_.value),P()}function p(){ie(()=>{v.value.updatePosition()})}function $(){return ue(d.value,_.value)===!1}function P(){m=!0,v.value.hide()}function B(){m=!1,_.value=H(a.modelValue),d.value=H(a.modelValue),c("beforeShow")}function R(){c("show")}function Q(){m===!1&&$()===!0&&(a.autoSave===!0&&a.validate(d.value)===!0?(c("save",d.value,_.value),c("update:modelValue",d.value)):c("cancel",d.value,_.value)),c("beforeHide")}function N(){c("hide")}function T(){const D=u.default!==void 0?[].concat(u.default(S.value)):[];return a.title&&D.unshift(O("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},a.title)),a.buttons===!0&&D.push(O("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[O(g,{flat:!0,color:a.color,label:a.labelCancel||w.lang.label.cancel,onClick:C}),O(g,{flat:!0,color:a.color,label:a.labelSet||w.lang.label.set,onClick:x})])),D}return Object.assign(n,{set:x,cancel:C,show(D){v.value!==null&&v.value.show(D)},hide(D){v.value!==null&&v.value.hide(D)},updatePosition:p}),()=>{if(a.disable!==!0)return O(Ye,{ref:v,class:"q-popup-edit",cover:a.cover,onBeforeShow:B,onShow:R,onBeforeHide:Q,onHide:N,onEscapeKey:C},T)}}});const je={class:"q-px-sm"},Pe={key:0,class:"float-right q-card__actions--horiz"},Re={key:1,class:"float-right q-card__actions--horiz"},Ne={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Te=y("div",{class:"text-h6"},"Arrival Date",-1),ze=y("span",{class:"q-ml-sm"},"Release as No Show!",-1),Ie=y("div",{class:"text-h6"},"Has not arrived.",-1),Fe={__name:"markArrivals",props:{rows:Array,selected:Array},emits:["arrivalMarked","updateArrival"],setup(a,{emit:u}){const c=a,{rows:n,selected:w}=de(c),v=re(),_=fe(),d=k(A().format("YYYY-MM-DD")),m=k(!1),S=k(!1),x=k(!1),C=k(!1),p=k(null),$=k(0),P=F(()=>v.screen.gt.sm?[{name:207,label:"Arrival Date",align:"left",field:219,format:e=>`${e&&e.$d&&e.$d.format?e.$d.format("MM/DD/YYYY"):""}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${ae.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,s)=>s[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]:[{name:207,label:"Arrival Date",align:"left",field:219,format:e=>`${e&&e.$d&&e.$d.format?e.$d.format("MM/DD/YYYY"):""}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${ae.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,s)=>s[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]),B=({rows:e,added:s,evt:r})=>{m.value=!0,u("arrivalMarked",{record:e[0],added:s}),setTimeout(function(){m.value=!1},1500)},R=e=>{m.value=!0,u("arrivalMarked",{record:p.value,added:e}),e?S.value=!1:C.value=!1,setTimeout(function(){m.value=!1},1500)},Q=e=>{p.value=e,p.value[207]=d.value,S.value=!0},N=()=>{p.value=null,S.value=!1},T=e=>{p.value=e,C.value=!0},D=()=>{p.value=null,C.value=!1},o=e=>{p.value=e,x.value=!0},i=()=>{_.push({name:"ee-termination",params:{id:p.value[21]},query:{reason:"no-show"}})},f=e=>{e.target.showPicker()},K=async(e,s)=>{s[219]=A(e),$.value+=1,u("updateArrivalDate",{record:s,value:e})};return(e,s)=>(Y(),W("div",je,[t(Ve,{dense:"",columns:P.value,rows:V(n),"row-key":r=>r[3],class:"q-pa-sm",pagination:{rowsPerPage:V(v).screen.gt.sm?25:100},separator:"vertical",onSelection:B,selected:V(w),"table-header-class":"bg-dark text-white","no-data-label":"There are no expected arrivals",loading:m.value,grid:V(v).screen.lt.md},{item:l(r=>[y("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:me(r.selected?"transform: scale(0.95);":"")},[t(E,{bordered:"",flat:"",class:ve(r.selected?V(v).dark.isActive?"bg-grey-9":"bg-grey-2":"")},{default:l(()=>[t(q,null,{default:l(()=>[h(j(r.row[31])+" ",1),r.row[20]!=="Complete"||!r.row[207]?(Y(),W("span",Pe,[t(g,{round:"",color:"positive",icon:"done",size:"xs",onClick:b=>Q(r.row)},{default:l(()=>[t(z,{class:"bg-primary"},{default:l(()=>[h("Arrived")]),_:1})]),_:2},1032,["onClick"]),t(g,{round:"",color:"negative",icon:"close",size:"xs",onClick:b=>o(r.row)},{default:l(()=>[t(z,{class:"bg-primary"},{default:l(()=>[h("No Show")]),_:1})]),_:2},1032,["onClick"])])):(Y(),W("span",Re,[h(j(V(A)(r.row[219]).format("MM/DD/YYYY"))+" ",1),t(g,{icon:"edit",color:"accent",flat:"",size:"xs",class:"q-px-none q-pr-xs"}),(Y(),I(oe,{key:$.value,"model-value":V(A)(r.row[219]).format("YYYY-MM-DD"),title:"Arrival Date"},{default:l(b=>[t(L,{autofocus:"",onFocus:s[0]||(s[0]=M=>f(M)),dense:"","model-value":b.value,type:"date",max:d.value,rules:[M=>!!M||"Field is required"],"onUpdate:modelValue":M=>K(M,r.row)},null,8,["model-value","max","rules","onUpdate:modelValue"])]),_:2},1032,["model-value"])),t(g,{round:"",color:"negative",icon:"history",size:"xs",onClick:G(b=>T(r.row),["stop"])},{default:l(()=>[t(z,{class:"bg-primary"},{default:l(()=>[h("Revert Back - Has not arrived yet.")]),_:1})]),_:2},1032,["onClick"])]))]),_:2},1024),t(pe),t(Se,{dense:""},{default:l(()=>[(Y(!0),W(be,null,ge(r.cols.filter(b=>b.name!=="action"),b=>(Y(),I(ye,{key:b.name},{default:l(()=>[t(Z,null,{default:l(()=>[t(te,null,{default:l(()=>[h(j(b.label),1)]),_:2},1024)]),_:2},1024),t(Z,{side:""},{default:l(()=>[t(te,{caption:""},{default:l(()=>[h(j(b.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),"body-cell-207":l(r=>[r.row[20]!=="Complete"||!r.row[207]?(Y(),I(le,{key:0,props:r,class:"q-card__actions--horiz",style:{"text-align":"center !important"}},{default:l(()=>[t(g,{round:"",color:"positive",icon:"done",size:"xs",onClick:b=>Q(r.row)},{default:l(()=>[t(z,{class:"bg-primary"},{default:l(()=>[h("Arrived")]),_:1})]),_:2},1032,["onClick"]),t(g,{round:"",color:"negative",icon:"close",size:"xs",onClick:b=>o(r.row)},{default:l(()=>[t(z,{class:"bg-primary"},{default:l(()=>[h("No Show")]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])):(Y(),I(le,{key:1,props:r,style:{"text-align":"center !important"}},{default:l(()=>[h(j(V(A)(r.row[219]).format("MM/DD/YYYY"))+" ",1),(Y(),I(oe,{key:$.value,"model-value":V(A)(r.row[219]).format("YYYY-MM-DD"),title:"Arrival Date"},{default:l(b=>[t(L,{autofocus:"",onFocus:s[1]||(s[1]=M=>f(M)),dense:"","model-value":b.value,type:"date",max:d.value,rules:[M=>!!M||"Field is required"],"onUpdate:modelValue":M=>K(M,r.row)},null,8,["model-value","max","rules","onUpdate:modelValue"])]),_:2},1032,["model-value"])),t(g,{round:"",color:"negative",icon:"history",size:"xs",onClick:G(b=>T(r.row),["stop"])},{default:l(()=>[t(z,{class:"bg-primary"},{default:l(()=>[h("Revert Back - Has not arrived yet.")]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"]))]),"no-data":l(({message:r})=>[y("div",Ne,[t(we,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),y("span",null,j(r),1)])]),loading:l(()=>[t($e,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","selected","loading","grid"]),t(J,{modelValue:S.value,"onUpdate:modelValue":s[5]||(s[5]=r=>S.value=r),persistent:""},{default:l(()=>[t(E,{style:{"min-width":"350px"}},{default:l(()=>[t(q,null,{default:l(()=>[Te]),_:1}),t(q,{class:"q-pt-none"},{default:l(()=>[t(L,{dense:"",modelValue:p.value[207],"onUpdate:modelValue":s[2]||(s[2]=r=>p.value[207]=r),autofocus:"",type:"date",max:d.value,rules:[r=>!!r||"Field is required"]},null,8,["modelValue","max","rules"])]),_:1}),t(X,{align:"right",class:"text-primary"},{default:l(()=>[t(g,{flat:"",label:"Cancel",onClick:s[3]||(s[3]=r=>N())}),t(g,{flat:"",label:"Confirm",onClick:s[4]||(s[4]=r=>R(!0))})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(J,{modelValue:x.value,"onUpdate:modelValue":s[7]||(s[7]=r=>x.value=r),persistent:""},{default:l(()=>[t(E,null,{default:l(()=>[t(q,{class:"row items-center"},{default:l(()=>[t(_e,{icon:"person_remove",color:"primary","text-color":"white"}),ze]),_:1}),t(X,{align:"right"},{default:l(()=>[De(t(g,{flat:"",label:"Cancel",color:"primary"},null,512),[[qe]]),t(g,{flat:"",label:"Release",color:"primary",onClick:s[6]||(s[6]=r=>i())})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(J,{modelValue:C.value,"onUpdate:modelValue":s[10]||(s[10]=r=>C.value=r),persistent:""},{default:l(()=>[t(E,{style:{"min-width":"350px"}},{default:l(()=>[t(q,null,{default:l(()=>[Ie]),_:1}),t(q,{class:"q-pt-none"},{default:l(()=>[h(" Revert back to Pending Arrival. ")]),_:1}),t(X,{align:"right",class:"text-primary"},{default:l(()=>[t(g,{flat:"",label:"No",onClick:s[8]||(s[8]=r=>D())}),t(g,{flat:"",label:"Yes",onClick:s[9]||(s[9]=r=>R(!1))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},Be={name:"Arrivals",components:{MarkArrivalsTable:Fe,projectSelector:Qe},setup(){const a=re(),u=Ae(),c=k(null),n=k(""),w=k(""),{getSelectedProject:v}=ke(u),{fetchAllDeployments:_,updateDeployment:d,getDeployments:m,fetchDeployments:S}=Me(),x=F(()=>v.value?v.value[3]:null),C=F(()=>m(x.value).filter(o=>o[20]==="Complete")),p=F(()=>{let o=[];return m(x.value).forEach(i=>{i[31].toLowerCase().includes(w.value.toLowerCase())&&o.push(i)}),o=n.value?o.filter(i=>A(i[33].$d).tz("America/Chicago").format("MM/DD/YYYY")===A(n.value).tz("America/Chicago").format("MM/DD/YYYY")):o,o=c.value?o.filter(i=>i[132]===c.value):o,o}),$=F(()=>[...new Map(p.value.map(o=>[o[132],o[132]])).values()]);async function P(o){a.loading.show(),x.value?await S({projectId:x.value,refresh:o}):await _({refresh:o}),a.loading.hide()}async function B({record:o,added:i}){if(i){await R(o),await Q({id:o[21],status:7});const f=await N(o[3],"Complete");d({projectId:f[134],key:f[3],record:f})}else{await T(o),await Q({id:o[21],status:6});const f=await N(o[3],"In Process");d({projectId:f[134],key:f[3],record:f})}}async function R(o){try{const i=o[207]?A(o[207]):A(),{data:f}=await U.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:o[3]},13:{value:o[15]},18:{value:o[21]},60:{value:""},125:{value:i},145:{value:i}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return f[0][108]}catch(i){throw{message:"Cannot add assignment",error:i}}}async function Q({id:o,status:i}){try{const{data:f}=await U.upsertRecordsXML({to:"bp3gb7ng2",data:[{3:{value:o},79:{value:i}}],fieldsToReturn:[3]});return f[0][3]}catch(f){throw{message:"Cannot edit employee",error:f}}}async function N(o,i){try{const{data:f}=await U.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:o},20:{value:i},22:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return f[0][204]}catch(f){throw{message:"Cannot edit deployment",error:f}}}async function T(o){try{const{data:i}=await U.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:o.assignment[3]},22:{value:new Date},21:{value:"Canceled"},19:{value:""},60:{value:""}}],fieldsToReturn:[108],formatObject:108});return i[0][108]}catch(i){throw{message:"Cannot cancel assignment",error:i}}}async function D(o){try{const i=o.value?A(o.value):A();if(o.record.assignment&&o.record.assignment[3]){const{data:f}=await U.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:o.record.assignment[3]},125:{value:i},145:{value:i}}],fieldsToReturn:[3]});return f[0][3]}}catch(i){throw{message:"Cannot edit Assignment",error:i}}}return P(!0),{arrived:C,allDeployments:p,arrivalMarked:B,updateArrivalDate:D,craftOptions:$,craftFilter:c,startDateFilter:n,search:w}}},Oe={class:"q-pt-sm"},Ue={class:"text-h5 text-dark"},Ee={class:"text-body2 text-italic q-ml-sm"},Le=y("div",{class:"text-subtitle2 text-accent"},"Please toggle the switch for everyone that has arrived at the job site.",-1),He={class:"row items-center"},We={class:"col-12 col-md-3 q-px-sm"},Xe={class:"col-12 col-md-3 q-px-sm"},Je={class:"col-12 col-md-3 q-px-sm"},Ke={class:"col-12 col-md-3 q-px-sm"};function Ge(a,u,c,n,w,v){const _=ee("projectSelector"),d=ee("mark-arrivals-table");return Y(),I(Ce,{style:{"max-width":"100vw"}},{default:l(()=>[y("div",Oe,[t(E,{flat:""},{default:l(()=>[t(q,{class:"q-pb-none"},{default:l(()=>[y("div",Ue,[h(" Expected Arrivals "),y("span",Ee,"("+j(n.allDeployments.length)+" total)",1)]),Le]),_:1}),t(q,null,{default:l(()=>[y("div",He,[y("div",We,[t(_,{dense:""})]),y("div",Xe,[t(L,{dense:"",modelValue:n.search,"onUpdate:modelValue":u[0]||(u[0]=m=>n.search=m),label:"Search"},null,8,["modelValue"])]),y("div",Je,[t(L,{dense:"",modelValue:n.startDateFilter,"onUpdate:modelValue":u[1]||(u[1]=m=>n.startDateFilter=m),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),y("div",Ke,[t(xe,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:n.craftFilter,"onUpdate:modelValue":u[2]||(u[2]=m=>n.craftFilter=m),options:n.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),t(d,{rows:n.allDeployments,selected:n.arrived,onArrivalMarked:n.arrivalMarked,onUpdateArrivalDate:n.updateArrivalDate},null,8,["rows","selected","onArrivalMarked","onUpdateArrivalDate"])])]),_:1})}var $t=he(Be,[["render",Ge]]);export{$t as default};
