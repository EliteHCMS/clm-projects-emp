import{a as ce,Q as he}from"./QTable.6be9dbf0.js";import{Q as K}from"./QTr.c7fc819d.js";import{Q as X}from"./QTd.5d1ee424.js";import{l as te,r as m,bW as oe,c as P,w as Ce,_ as le,B as a,ar as f,bs as i,E as j,C as y,ad as D,bX as F,as as $,d,bP as fe,ay as R,G as pe,bU as Ve,z as De,b6 as Z,aw as je,F as _,b5 as x,cW as B,bR as ee}from"./index.5232afe7.js";import{a as ae}from"./QSelect.4306c154.js";import{Q as re}from"./QInnerLoading.1fb22ddf.js";import{u as se}from"./use-quasar.30e2351a.js";import{e as Ne}from"./export-file.dc78ba05.js";import{dayjs as Y}from"./dayjs.2bff5ac3.js";import{u as Ee}from"./index.3f328902.js";import{c as ne,l as O,q as M,u as ye}from"./app.062f4def.js";import{A as Ae}from"./arrivalDate.fbc8d0f3.js";import{Q as H}from"./QTooltip.9bbededf.js";import{Q as be}from"./QForm.0fd20abe.js";import{a as ve,u as we}from"./vee-validate.esm.54bd3c83.js";import{a as W}from"./array.59f93f43.js";import{u as ie}from"./useQuerySaver.d29ff9ee.js";const Pe=te({emits:["disableEdit"],props:{row:Object,rowType:String,edit:Boolean},setup(e,{emit:o}){const g=se(),h=ne(),b=m(e.edit),k=m(null),p=m(null),w=m(!0),{fetchAllJobNumbers:S}=h,{getJobNumbers:l}=oe(h),s=m(e.row[74]?e.row[74]:null);S();const u=P(()=>l.value(s.value)),C=m(O.exports.uniqBy(l.value(s.value),"11"));Ce(u,(V,c)=>{C.value=O.exports.uniqBy(l.value(s.value),"11")});const q=P(()=>W({entry:W().nullable().label("Job #")})),{errors:I,handleSubmit:L,handleReset:U}=ve({validationSchema:q}),{value:N}=we("entry"),z=L(async V=>{w.value=!0;try{const{data:c}=await M.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:p.value},182:{value:V.entry[11].trim()}}],fieldsToReturn:[144],formatObject:144});k.value=c[0][144][105],N.value=c[0][144][105],w.value=!1,g.notify({type:"positive",message:"Job # was updated!"}),b.value=!1}catch{g.notify({type:"negative",message:"There was a problem updating Job #"}),w.value=!1,b.value=!1}});return(async()=>{const V=e.row[105]===""?"":e.row[105];p.value=e.row[3],k.value=V,N.value=V,w.value=!1})(),{editField:b,entry:N,formErrors:I,submit:z,fieldValue:k,loading:w,jobNumbers:C,getJobNumbers:l,projectId:s,disableEditFunction:()=>{b.value=!1,o("disableEdit",e.row)},filterFn:(V,c)=>{if(V===""){c(()=>{C.value=O.exports.uniqBy(l.value(s.value),"11")});return}c(()=>{const E=V.toLowerCase();C.value=O.exports.uniqBy(l.value(s.value),"11").filter(J=>J[11].toLowerCase().indexOf(E)>-1)})}}}}),Se={key:0},qe={key:0},Ie={key:1},Le={key:1},Te={class:"q-pt-sm"},Re={class:"text-caption"};function Ue(e,o,g,h,b,k){return a(),f(X,{"auto-width":!e.editField,style:pe([e.editField?"min-width: 250px;":"",{"padding-left":"0px"}])},{default:i(()=>[j("div",null,[e.editField?(a(),y("div",Le,[d(be,{onSubmit:fe(e.submit,["prevent"])},{default:i(()=>[d(ae,{outlined:"",dense:"","bg-color":"grey-2",class:"text-caption","use-input":"",onFilter:e.filterFn,"popup-content-class":"text-caption",options:e.jobNumbers,"option-value":"11","option-label":"11","options-dense":"",modelValue:e.entry,"onUpdate:modelValue":o[2]||(o[2]=p=>e.entry=p),behavior:"menu",error:!!e.formErrors.entry},{after:i(()=>[j("div",Te,[d(F,{class:"q-mr-xs",onClick:o[1]||(o[1]=p=>e.disableEditFunction()),icon:"close",color:"secondary",dense:"",size:"sm"},{default:i(()=>[d(H,{class:"bg-secondary"},{default:i(()=>[R("Cancel")]),_:1})]),_:1}),d(F,{disable:!!e.formErrors.entry,type:"submit",onClick:e.submit,icon:"done",color:"info",dense:"",size:"sm"},{default:i(()=>[d(H,{class:"bg-info"},{default:i(()=>[R("Submit")]),_:1})]),_:1},8,["disable","onClick"])])]),error:i(()=>[j("div",Re,D(e.formErrors.entry),1)]),_:1},8,["onFilter","options","modelValue","error"])]),_:1},8,["onSubmit"])])):(a(),y("div",Se,[e.loading?(a(),y("div",Ie,[d(re,{size:"sm",showing:"",color:"primary"})])):(a(),y("div",qe,[j("span",null,D(e.fieldValue||"Not Assigned"),1),e.$can("manage","employees")?(a(),f(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:o[0]||(o[0]=p=>e.editField=!0)})):$("",!0)]))]))])]),_:1},8,["auto-width","style"])}var ze=le(Pe,[["render",Ue]]);const Be=te({emits:["disableEdit"],props:{row:Object,rowType:String,edit:Boolean},setup(e,{emit:o}){const g=se(),h=ne(),b=m(e.edit),k=m(null),p=m(null),w=m(!0),{getUserType:S,getUser:l}=ye(),{getProjects:s,getSelectedOffice:u}=oe(h),C=m(u.value?u.value[8]:null),q=m(S==="Project User"?l[3]:C),I=P(()=>s.value({userType:S,selectedId:q.value,can:"read"}).filter(c=>!0).sort((c,E)=>c[298].localeCompare(E[298]))),L=P(()=>W({entry:W().nullable().label("Project")})),{errors:U,handleSubmit:N,handleReset:z}=ve({validationSchema:L}),{value:A}=we("entry"),Q=N(async c=>{w.value=!0;try{if(c.entry[3]===0||!c.entry[3]||!O.exports.isNumber(c.entry[3]))return w.value=!1,b.value=!1,!0;const{data:E}=await M.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:p.value},156:{value:c.entry[3]},204:{value:!0}}],fieldsToReturn:[144],formatObject:144});k.value=E[0][144][117],A.value=E[0][144][117],w.value=!1,g.notify({type:"positive",message:"Project was updated!"}),b.value=!1}catch{g.notify({type:"negative",message:"There was a problem updating Project"}),w.value=!1,b.value=!1}});return(async()=>{const c=e.row[117]===""?"":e.row[117];p.value=e.row[3],k.value=c,A.value=c,w.value=!1})(),{editField:b,entry:A,formErrors:U,submit:Q,fieldValue:k,loading:w,options:I,disableEditFunction:()=>{b.value=!1,o("disableEdit",e.row)}}}}),Qe={key:0},Ye={key:0},Xe={key:1},Oe={key:1},Me={class:"q-pt-sm"},Je={class:"text-caption"};function He(e,o,g,h,b,k){return a(),f(X,{"auto-width":!e.editField,style:pe([e.editField?"min-width: 250px;":"",{"padding-left":"0px"}])},{default:i(()=>[j("div",null,[e.editField?(a(),y("div",Oe,[d(be,{onSubmit:fe(e.submit,["prevent"])},{default:i(()=>[d(ae,{outlined:"",dense:"","bg-color":"grey-2",class:"text-caption","popup-content-class":"text-caption",options:e.options,"option-label":"298","options-dense":"",modelValue:e.entry,"onUpdate:modelValue":o[2]||(o[2]=p=>e.entry=p),behavior:"menu",error:!!e.formErrors.entry},{after:i(()=>[j("div",Me,[d(F,{class:"q-mr-xs",onClick:o[1]||(o[1]=p=>e.disableEditFunction()),icon:"close",color:"secondary",dense:"",size:"sm"},{default:i(()=>[d(H,{class:"bg-secondary"},{default:i(()=>[R("Cancel")]),_:1})]),_:1}),d(F,{disable:!!e.formErrors.entry,type:"submit",onClick:e.submit,icon:"done",color:"info",dense:"",size:"sm"},{default:i(()=>[d(H,{class:"bg-info"},{default:i(()=>[R("Submit")]),_:1})]),_:1},8,["disable","onClick"])])]),error:i(()=>[j("div",Je,D(e.formErrors.entry),1)]),_:1},8,["options","modelValue","error"])]),_:1},8,["onSubmit"])])):(a(),y("div",Qe,[e.loading?(a(),y("div",Xe,[d(re,{size:"sm",showing:"",color:"primary"})])):(a(),y("div",Ye,[j("span",null,D(e.fieldValue||"Not Assigned"),1),e.$can("manage","employees")?(a(),f(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:o[0]||(o[0]=p=>e.editField=!0)})):$("",!0)]))]))])]),_:1},8,["auto-width","style"])}var We=le(Be,[["render",He]]);const Ge=te({components:{ArrivalDate:Ae,JobNumber:ze,ProjectEdit:We},emits:["refreshData"],props:{rows:Array,title:String},setup(e,o){const g=se(),h=Ve(),{can:b}=Ee(),k=ne(),{getUserType:p,getUser:w}=ye(),{getProjects:S,getSelectedOffice:l}=oe(k),{capitalize:s}=De,u=m(!1),C=m(null),q=m(null),I=m(null),L=m(null),U=m(null),N=m(null),z=m(null),A=m(null),Q=m(!1),G=m(l.value?l.value[8]:null),V=m(p==="Project User"?w[3]:G),c=P(()=>S.value({userType:p,selectedId:V.value,can:"read"}).length),E=P(()=>[{name:1,label:"Name",align:"left",field:t=>t.employee[22],format:(t,n)=>`${de(n.employee)}`,sortable:!0,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:t=>t.employee[25],format:t=>`${t}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:t=>t.employee[378],format:t=>`${t}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:t=>t.employee[213],format:t=>t===""?"not available":t,sortable:!0},{name:4,label:"Classification",align:"left",field:t=>t[20],format:t=>`${!t||t===""?"Not Assigned":t}`,sortable:!0},{name:116,label:"Rate",align:"left",field:t=>t[116],format:t=>`${t===""||!t||t===0?"N/A":`$${Number(t).toFixed(2)}`}`,sortable:!0},{name:117,label:"Project",align:"left",field:t=>t[117],format:t=>`${t}`,sortable:!0},{name:5,label:"Job #",align:"left",field:t=>t[105],format:t=>`${t===""||!t?"Not Assigned":t}`,sortable:!0},{name:145,label:"Arrival Date",align:"left",field:t=>t[145],format:t=>`${Y(t).isValid()?Y(t).format("MM/DD/YYYY"):"N/A"}`,sortable:!0}]),J=P(()=>g.screen.gt.sm?[1,7,2,3,4,b("read","rates")?116:[],c.value>1&&Q.value?117:[],5,145]:[1,7,2,3,4,b("read","rates")?116:[],c.value>1&&Q.value?117:[],5,145]),ge=P(()=>[...new Set(e.rows.map(t=>t[105]===""||!t[105]?"Not Assigned":t[105]))]),ue=P(()=>{let t=e.rows;if(C.value&&C.value.trim().length>0){const n=C.value.trim().toLowerCase();t=t.filter(r=>r.employee&&de(r.employee).toLowerCase().includes(n))}if(q.value&&q.value.trim().length>0){const n=q.value.trim().toLowerCase();t=t.filter(r=>r.employee&&r.employee[25]&&r.employee[25].toLowerCase().includes(n))}if(I.value&&I.value.trim().length>0){const n=I.value.trim().toLowerCase();t=t.filter(r=>r.employee&&r.employee[378]&&r.employee[378].toLowerCase().includes(n))}if(L.value&&L.value.trim().length>0){const n=L.value.trim().toLowerCase();t=t.filter(r=>r.employee&&(r.employee[213]===""?"not available".includes(n):r.employee[213]&&r.employee[213].toLowerCase().includes(n)))}if(U.value&&U.value.trim().length>0){const n=U.value.trim().toLowerCase();t=t.filter(r=>!r[20]||r[20]===""?"Not Assigned".toLowerCase().includes(n):r[20]&&r[20].toLowerCase().includes(n))}if(N.value&&N.value.trim().length>0){const n=N.value.trim().toLowerCase();t=t.filter(r=>r[116]===""||!r[116]||r[116]===0?"N/A".toLowerCase().includes(n):r[116]&&"$".concat(Number(r[116]).toFixed(2).toString()).toLowerCase().includes(n))}if(z.value&&z.value.trim().length>0){const n=z.value.trim().toLowerCase();t=t.filter(r=>r[105]===""||!r[105]?"Not Assigned".toLowerCase().includes(n):r[105]&&r[105].toLowerCase().includes(n))}if(A.value&&A.value.trim().length>0){const n=Y(A.value.trim()).format("MM/DD/YYYY");t=t.filter(r=>ke(r)===n)}return t}),de=t=>{const n=t[20]!==""?s(t[20].toLowerCase().trim()):"",r=t[22]!==""?s(t[22].toLowerCase().trim()):"",v=t[21]!==""?` ${s(t[21].toLowerCase().trim())}`:"",T=t[23]!==""?` ${s(t[23])}`:"";return`${r}${T}, ${n}${v}`};function $e(t){h.push({name:"ee-summary",params:{id:t[18]}})}function me(t,n,r){let v=n!==void 0?n(t,r):t;return v=v==null?"":String(v),v=v.split('"').join('""'),`"${v}"`}function Fe(){const t=E.value.filter(v=>!!J.value.includes(v.name)),n=[t.map(v=>me(v.label))].concat(ue.value.map(v=>t.map(T=>me(typeof T.field=="function"?T.field(v):v[T.field===void 0?T.name:T.field],T.format,v)).join(","))).join(`\r
`);Ne(`${Y().format("MM.DD.YYYY")} Employees-Export.csv`,n,"text/csv")!==!0&&g.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const ke=t=>{const n=t[145]&&t[145].$d?t[145].$d:t[1].$d;return Y(n).format("MM/DD/YYYY")};return{columns:E,visibleColumns:J,props:e,exportAllEmployees:Fe,viewEmployee:$e,showFilter:u,nameFilter:C,phoneNumberFilter:q,workdayIDFilter:I,payrollIDFilter:L,classificationFilter:U,rateFilter:N,jobNumberFilter:z,arrivalDateFilter:A,jobNumbers:ge,filteredRows:ue,dayjs:Y,projectsAvailable:c,transferBetweenProjects:Q,getUserType:p}}}),Ke={key:0},Ze={key:1},_e={key:1},xe={key:1},et={key:2},tt={key:1},ot={key:3},lt={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},at={class:"text-dark text-caption text-italic"};function rt(e,o,g,h,b,k){const p=Z("job-number"),w=Z("arrival-date"),S=Z("project-edit");return a(),y("div",null,[d(he,{title:e.title,"title-class":"text-h5 text-primary",columns:e.columns,"visible-columns":e.visibleColumns,rows:e.filteredRows,"row-key":l=>l[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no employees in the roster",dense:""},je({header:i(l=>[d(K,{class:"bg-dark text-white",props:l},{default:i(()=>[d(ce,{"auto-width":""}),(a(!0),y(_,null,x(l.cols,s=>(a(),f(ce,{key:s.name,props:l},{default:i(()=>[R(D(s.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:i(l=>[d(K,{props:l},{default:i(()=>[d(X,{"auto-width":""},{default:i(()=>[d(ee,{class:"cursor-pointer",size:e.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:s=>e.viewEmployee(l.row),name:l.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(a(!0),y(_,null,x(l.cols,s=>(a(),f(X,{key:s.name,props:l},{default:i(()=>[s.name===5?(a(),y("span",Ke,[l.row.editJobNumber?(a(),f(p,{class:"text-left",rowType:"assignment",row:l.row,key:l.row[3],edit:!0,onDisableEdit:u=>l.row.editJobNumber=!1},null,8,["row","onDisableEdit"])):$("",!0),l.row.editJobNumber?$("",!0):(a(),y("span",Ze,[R(D(s.value)+" ",1),e.$can("manage","employees")?(a(),f(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:u=>l.row.editJobNumber=!0},null,8,["onClick"])):$("",!0)]))])):s.name===145?(a(),y("span",_e,[l.row.editArrivalDate?(a(),f(w,{class:"text-left",rowType:"assignment",row:l.row,key:l.row[3],edit:!0,onDisableEdit:u=>l.row.editArrivalDate=!1},null,8,["row","onDisableEdit"])):$("",!0),l.row.editArrivalDate?$("",!0):(a(),y("span",xe,[R(D(s.value)+" ",1),d(F,{icon:"edit",color:"accent",flat:"",size:"sm",onClick:u=>l.row.editArrivalDate=!0},null,8,["onClick"])]))])):s.name===117?(a(),y("span",et,[l.row.editProject?(a(),f(S,{class:"text-left",rowType:"assignment",row:l.row,key:l.row[3],edit:!0,onDisableEdit:u=>l.row.editProject=!1},null,8,["row","onDisableEdit"])):$("",!0),l.row.editProject?$("",!0):(a(),y("span",tt,[R(D(s.value)+" ",1),e.transferBetweenProjects?(a(),f(F,{key:0,icon:"edit",color:"accent",flat:"",size:"sm",onClick:u=>l.row.editProject=!0},null,8,["onClick"])):$("",!0)]))])):(a(),y("span",ot,D(s.value),1))]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":i(({message:l})=>[j("div",lt,[d(ee,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),j("span",null,D(l),1)])]),"top-right":i(()=>[e.projectsAvailable>1&&!e.transferBetweenProjects&&e.getUserType==="Project User"&&e.title==="Active Roster"?(a(),f(F,{key:0,dense:e.$q.screen.lt.md,class:"q-mr-sm",color:"primary",label:"Move between Projects",onClick:o[8]||(o[8]=l=>e.transferBetweenProjects=!0)},null,8,["dense"])):$("",!0),e.projectsAvailable>1&&e.transferBetweenProjects&&e.getUserType==="Project User"?(a(),f(F,{key:1,dense:e.$q.screen.lt.md,class:"q-mr-sm",color:"primary",label:"Cancel",onClick:o[9]||(o[9]=l=>e.transferBetweenProjects=!1)},null,8,["dense"])):$("",!0),j("div",at,"(Total: "+D(e.filteredRows.length)+" employees)",1),d(ee,{class:"q-pl-md",size:"xs",color:e.showFilter?"info":"grey-7",name:"fa-solid fa-filter",onClick:o[10]||(o[10]=l=>e.showFilter=!e.showFilter)},null,8,["color"]),d(F,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[11]||(o[11]=l=>e.$emit("refreshData"))}),d(F,{dense:e.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:e.exportAllEmployees,disable:e.filteredRows.length<1},null,8,["dense","onClick","disable"])]),loading:i(()=>[d(re,{showing:"",color:"primary"})]),_:2},[e.showFilter?{name:"top-row",fn:i(l=>[d(K,{props:l},{default:i(()=>[d(X,{"auto-width":""}),(a(!0),y(_,null,x(l.cols,s=>(a(),f(X,{key:s.name},{default:i(()=>[s.name===1?(a(),f(B,{key:0,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.nameFilter,"onUpdate:modelValue":o[0]||(o[0]=u=>e.nameFilter=u)},null,8,["modelValue"])):s.name===7?(a(),f(B,{key:1,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.phoneNumberFilter,"onUpdate:modelValue":o[1]||(o[1]=u=>e.phoneNumberFilter=u)},null,8,["modelValue"])):s.name===2?(a(),f(B,{key:2,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.workdayIDFilter,"onUpdate:modelValue":o[2]||(o[2]=u=>e.workdayIDFilter=u)},null,8,["modelValue"])):s.name===3?(a(),f(B,{key:3,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.payrollIDFilter,"onUpdate:modelValue":o[3]||(o[3]=u=>e.payrollIDFilter=u)},null,8,["modelValue"])):s.name===4?(a(),f(B,{key:4,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.classificationFilter,"onUpdate:modelValue":o[4]||(o[4]=u=>e.classificationFilter=u)},null,8,["modelValue"])):s.name===116?(a(),f(B,{key:5,outlined:"",dense:"","bg-color":"grey-2",clearable:"","input-class":"text-caption",modelValue:e.rateFilter,"onUpdate:modelValue":o[5]||(o[5]=u=>e.rateFilter=u)},null,8,["modelValue"])):s.name===5?(a(),f(ae,{key:6,outlined:"",dense:"","bg-color":"grey-2",clearable:"",class:"text-caption","popup-content-class":"text-caption",options:e.jobNumbers,"options-dense":"",modelValue:e.jobNumberFilter,"onUpdate:modelValue":o[6]||(o[6]=u=>e.jobNumberFilter=u)},null,8,["options","modelValue"])):s.name===145?(a(),f(B,{key:7,outlined:"",dense:"","bg-color":"grey-2","input-class":"text-caption",clearable:"",type:"date",modelValue:e.arrivalDateFilter,"onUpdate:modelValue":o[7]||(o[7]=u=>e.arrivalDateFilter=u)},null,8,["modelValue"])):$("",!0)]),_:2},1024))),128))]),_:2},1032,["props"])]),key:"0"}:void 0]),1032,["title","columns","visible-columns","rows","row-key"])])}var Dt=le(Ge,[["render",rt],["__scopeId","data-v-5a8e9750"]]);const jt=async e=>{const o=await st(e),g=await nt(e),h=await it(e);return o.concat(g.concat(h))},st=async e=>{const{data:o}=await M.fetchFromHiringApp({fields:[ie({type:"inProcesses",query:`{'108'.EX.'${e}'}AND{'37'.EX.'In Process'}AND{'38'.EX.'4'}`})]});return o},nt=async e=>{const{data:o}=await M.fetchFromHiringApp({fields:[ie({type:"dispatches",query:`{'157'.EX.'${e}'}AND{'24'.EX.'5'}AND{'17'.EX.'In Process'}`})]});return o},it=async e=>{const{data:o}=await M.fetchFromHiringApp({fields:[ie({type:"deployments",query:`{'134'.EX.'${e}'}ANDAND({'33'.OAF.'today'}OR{'33'.IR.'last 10 d'})AND({'20'.EX.'In Process'}OR{'20'.EX.'Complete'})AND{'128'.EX.'Yes'}AND({'27'.EX.'6'}OR{'27'.EX.'7'})`})]});return o};export{Dt as R,jt as g};
