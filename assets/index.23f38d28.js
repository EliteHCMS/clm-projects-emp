import{Q as J,a as qe,b as G}from"./QTabPanels.d6381f9e.js";import{Q as Re}from"./QTabs.e3196157.js";import{Q as Ce}from"./QToolbar.dab6cc44.js";import{Q as ke}from"./QPage.50af9100.js";import{l as re,bU as ne,bT as ye,r as v,bV as Z,c as j,w as K,_ as ee,b5 as T,A,B as F,d as a,br as c,cT as W,D as f,ar as B,cU as L,cS as ae,o as Qe,F as ue,b4 as me,aq as z,ax as se,ac as X,bQ as pe,a8 as fe,bW as ve,y as Ie}from"./index.6ad28899.js";import{a as he}from"./QSelect.a35c72f5.js";import{u as te}from"./use-quasar.32520ede.js";import{u as ie}from"./dataStore.3ce61acc.js";import{u as de}from"./dataStore.b26b6cac.js";import{c as le,q as _e,u as Ye,i as be}from"./app.ae18e828.js";import{dayjs as Y}from"./dayjs.32f0a35d.js";import{u as De}from"./useQuerySaver.d29ff9ee.js";import{R as je,g as Ne}from"./quickbaseDataHelpers.54393870.js";import{_ as oe}from"./projectSelector.afef6542.js";import{a as ge,Q as Te}from"./QTable.2cdd6b35.js";import{Q as $e}from"./QTr.ffefdfd4.js";import{Q as we}from"./QTd.935a3373.js";import{Q as Fe}from"./QInnerLoading.ba1209fa.js";import{e as Me}from"./export-file.dc78ba05.js";import{P as Ue}from"./projectPipeline.bca8beba.js";import"./use-panel.7c10604f.js";import"./touch.3df10340.js";import"./selection.53968a35.js";import"./QResizeObserver.bfe8e417.js";import"./rtl.b51694b1.js";import"./QChip.26ec4575.js";import"./QMenu.798567a6.js";import"./position-engine.eb4313f6.js";import"./localForage.b23cd6d4.js";import"./_commonjsHelpers.a26ce4be.js";import"./api.2d8f8822.js";import"./index.04bc0a32.js";import"./i18n.693194ed.js";import"./index.4a45d316.js";import"./arrivalDate.e690fd6d.js";import"./QTooltip.e6c7da28.js";import"./QForm.8b10ff15.js";import"./vee-validate.esm.8e982689.js";import"./array.59f93f43.js";import"./QList.25171d0a.js";import"./QMarkupTable.8454fed9.js";import"./use-fullscreen.b062bb91.js";const Ee=re({props:{},components:{RosterTable:je,projectSelector:oe},setup(l){const o=te(),y=ne(),P=ye(),$=le(),S=v(""),b=v(null),u=v(null),{getSelectedProject:n}=Z($),{getAssignments:Q,fetchAllAssignments:C,fetchAssignments:U}=ie(),{getManpowerData:M,setRosters:q}=de(),p=j(()=>y.params.id?y.params.id:null),w=j(()=>n.value?n.value[3]:null),R=j(()=>{let t;return p.value?t=(M({dataset:"rosters",id:p.value})||[]).sort((r,_)=>r[1].$d<_[1].$d?1:-1):t=Q(w.value).sort((s,r)=>s[1].$d<r[1].$d?1:-1),t.filter(s=>!s[112]&&s.latest&&s[102]==="Active")}),N=j(()=>{let t=[];return R.value.forEach(s=>{s[75].toLowerCase().includes(S.value.toLowerCase())&&t.push(s)}),t=b.value?t.filter(s=>Y(s[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Y(b.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=u.value?t.filter(s=>s[68]===u.value):t,t.sort((s,r)=>s.employee[22]>r.employee[22]?1:-1)}),h=j(()=>[...new Map(R.value.map(t=>[t[68],t[68]])).values()]),I=async t=>{o.loading.show(),y.query&&y.query.refresh&&(t=!0,P.push({query:{}})),p.value?(t||!M({dataset:"rosters",id:p.value}))&&await d():w.value?await U({projectId:w.value,refresh:t}):await C({refresh:t}),o.loading.hide()},d=async()=>{const t=`{'173'.EX.'${p.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:s}=await _e.fetchFromHiringApp({fields:[De({type:"assignments",query:t})]});q({id:p.value,data:s})};return K(w,()=>{I()}),I(),{allAssignments:R,search:S,startDateFilter:b,craftFilter:u,craftOptions:h,rows:N,loadData:I}}}),xe={class:"row items-center"},Be={key:0,class:"col-12 col-md-3"},Le={class:"col-12 col-md-3 q-px-sm"},Oe={class:"col-12 col-md-3 q-px-sm"},ze={class:"col-12 col-md-3 q-px-sm"};function Xe(l,o,y,P,$,S){const b=T("projectSelector"),u=T("roster-table");return A(),F("div",null,[a(ae,{flat:""},{default:c(()=>[a(W,null,{default:c(()=>[f("div",xe,[l.$route.params.id?B("",!0):(A(),F("div",Be,[a(b,{dense:""})])),f("div",Le,[a(L,{dense:"",modelValue:l.search,"onUpdate:modelValue":o[0]||(o[0]=n=>l.search=n),label:"Search"},null,8,["modelValue"])]),f("div",Oe,[a(L,{dense:"",modelValue:l.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=n=>l.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),f("div",ze,[a(he,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:l.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=n=>l.craftFilter=n),options:l.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(u,{rows:l.rows,onRefreshData:o[3]||(o[3]=n=>l.loadData(!0)),title:"Active Roster"},null,8,["rows"])])}var We=ee(Ee,[["render",Xe]]);const He=re({props:{},components:{RosterTable:je,projectSelector:oe},setup(l){const o=te(),y=ne(),P=le(),$=v(""),S=v(null),b=v(null),{getSelectedProject:u}=Z(P),{getAssignments:n,fetchAllAssignments:Q,fetchAssignments:C}=ie(),{getManpowerData:U,setRosters:M}=de(),q=j(()=>y.params.id?y.params.id:null),p=j(()=>u.value?u.value[3]:null),w=j(()=>{let d;const t=Y().subtract(14,"day");return q.value?d=(U({dataset:"rosters",id:q.value})||[]).sort((r,_)=>r[1].$d<_[1].$d?1:-1):d=n(p.value).sort((s,r)=>s[1].$d<r[1].$d?1:-1),d.filter(s=>!s[112]&&s.latest&&s[102]==="Active"&&Y(s[1].$d).isSameOrAfter(t)&&Y(s[1].$d).isSameOrBefore(Y()))}),R=j(()=>{let d=[];return w.value.forEach(t=>{t[75].toLowerCase().includes($.value.toLowerCase())&&d.push(t)}),d=S.value?d.filter(t=>Y(t[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===Y(S.value).tz("America/Chicago").format("MM/DD/YYYY")):d,d=b.value?d.filter(t=>t[68]===b.value):d,d.sort((t,s)=>t.employee[22]>s.employee[22]?1:-1)}),N=j(()=>[...new Map(w.value.map(d=>[d[68],d[68]])).values()]),h=async d=>{o.loading.show(),q.value?(d||!U({dataset:"rosters",id:q.value}))&&await I():p.value?await C({projectId:p.value,refresh:d}):await Q({refresh:d}),o.loading.hide()},I=async()=>{const d=`{'173'.EX.'${q.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:t}=await _e.fetchFromProjectsApp({fields:[De({type:"assignments",query:d})]});M({id:q.value,data:t})};return{allAssignments:w,search:$,startDateFilter:S,craftFilter:b,craftOptions:N,rows:R,loadData:h}}}),Je={class:"row items-center"},Ge={key:0,class:"col-12 col-md-3"},Ke={class:"col-12 col-md-3 q-px-sm"},Ze={class:"col-12 col-md-3 q-px-sm"},ea={class:"col-12 col-md-3 q-px-sm"};function aa(l,o,y,P,$,S){const b=T("projectSelector"),u=T("roster-table");return A(),F("div",null,[a(ae,{flat:""},{default:c(()=>[a(W,null,{default:c(()=>[f("div",Je,[l.$route.params.id?B("",!0):(A(),F("div",Ge,[a(b,{dense:""})])),f("div",Ke,[a(L,{dense:"",modelValue:l.search,"onUpdate:modelValue":o[0]||(o[0]=n=>l.search=n),label:"Search"},null,8,["modelValue"])]),f("div",Ze,[a(L,{dense:"",modelValue:l.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=n=>l.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),f("div",ea,[a(he,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:l.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=n=>l.craftFilter=n),options:l.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(u,{rows:l.rows,onRefreshData:o[3]||(o[3]=n=>l.loadData(!0)),title:"New Arrivals"},null,8,["rows"])])}var ta=ee(He,[["render",aa]]);const la={class:"row items-center"},oa={key:0,class:"col-12 col-md-3"},sa={class:"col-12 col-md-3 q-px-sm"},ra={class:"col-12 col-md-3 q-px-sm"},na=f("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),ia={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},da={class:"text-dark text-caption text-italic"},ca={__name:"releases",setup(l){const o=ye(),y=te(),P=le(),{getUserType:$,getUser:S}=Ye(),{getProjects:b,getSelectedProject:u,getSelectedOffice:n}=Z(P),{capitalize:Q}=Ie,C=v(n.value?n.value[8]:null),U=v(u.value?u.value[3]:null),M=v($==="Project User"?S[3]:C),q=v(),p=v([]),w=v(""),R=v(""),N=v(!1),h=v({sortBy:6,descending:!0,page:1,rowsPerPage:25,rowsNumber:0});$==="QuickBase User"&&K(n,()=>{C.value=n.value?n.value[8]:null,_()}),$==="Project User"&&K(u,()=>{U.value=u.value?u.value[3]:null,_()}),K(R,()=>{_()});const I=v([{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${t(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:6,label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0}]),d=v([{name:1,label:"Name",align:"left",field:e=>e[49],format:e=>`${t(e)}`,sortable:!1,sortOrder:"ad"},{name:7,label:"Phone #",align:"left",field:e=>e[56],sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[50],format:e=>`${e}`,sortable:!1,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[51],format:e=>e===""?"not available":e,sortable:!1},{name:4,label:"Classification",align:"left",field:e=>e[82],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!1},{name:5,label:"Job #",align:"left",field:e=>e[81],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!1},{name:7,label:"Term Reason",align:"left",field:e=>e[32],format:e=>`${e}`,sortable:!1},{name:6,label:"Release Date",align:"left",field:e=>e[36].$d,format:e=>`${Y(e).format("MM/DD/YYYY")}`,sortable:!0}]),t=e=>{const D=e.split(" ");let i="";return D.forEach((m,E)=>{i+=E>0?` ${Q(m.toLowerCase())}`:Q(m.toLowerCase())}),i},s=({page:e,pageSize:D,descending:i,filter:m,sortBy:E})=>{try{let k="";m&&(k=m.trim());let x=null;u.value?x=u.value[3]:(x=[],b.value({userType:$,selectedId:M.value,can:"read"}).forEach(g=>{x.push(g[3])}));const V={...m&&{$or:[{fullName:{$containsi:`${k}`}},{classification:{$containsi:`${k}`}},{jobNumber:{$containsi:`${k}`}},{workdayId:{$containsi:`${k}`}},{phoneNumber:{$containsi:`${k}`}},{payrollId:{$containsi:`${k}`}}]},...R.value&&{effectiveDate:{$eq:R.value}},...u.value&&{projectRID:{$eq:x}},...!u.value&&{projectRID:{$in:x}}};return be.getReleases({pagination:{page:e,pageSize:D},sort:`effectiveDate:${i?"desc":"asc"}`,filters:V}).then(g=>{const{data:O,meta:Ae}=g,ce=[];return O.forEach(Se=>{ce.push(be.formatObject(Se.syncObject))}),N.value=!1,{data:ce,meta:Ae}})}catch{N.value=!1}},r=async e=>{const{page:D,rowsPerPage:i,sortBy:m,descending:E}=e.pagination,k=e.filter,x=i===0?h.value.rowsNumber:i;N.value=!0;const V=await s({page:D,sortBy:m,descending:E,pageSize:x,filter:k});if(N.value=!1,V){const{data:g,meta:O}=V;p.value.splice(0,p.value.length,...g),h.value.page=O.pagination.page,h.value.rowsPerPage=O.pagination.pageSize,h.value.sortBy=m,h.value.rowsPerPage=O.pagination.pageSize,h.value.rowsNumber=O.pagination.total}};Qe(()=>{q.value.requestServerInteraction()});const _=()=>{q.value.requestServerInteraction()};function H(e,D,i){let m=D!==void 0?D(e,i):e;return m=m==null?"":String(m),m=m.split('"').join('""'),`"${m}"`}const Pe=async()=>{const{page:e,rowsNumber:D,sortBy:i,descending:m}=h.value,E=await s({page:e,sortBy:i,descending:m,pageSize:D,filter:w.value});let k=[I.value.map(V=>H(V.label))].concat(p.value.map(V=>I.value.map(g=>H(typeof g.field=="function"?g.field(V):V[g.field===void 0?g.name:g.field],g.format,V)).join(","))).join(`\r
`);E&&E.data&&(k=[d.value.map(V=>H(V.label))].concat(E.data.map(V=>d.value.map(g=>H(typeof g.field=="function"?g.field(V):V[g.field===void 0?g.name:g.field],g.format,V)).join(","))).join(`\r
`)),Me(`${Y().format("MM.DD.YYYY")} Releases-Export.csv`,k,"text/csv")!==!0&&y.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};function Ve(e){o.push({name:"view-release",params:{release:e[3]}})}return(e,D)=>(A(),F("div",null,[a(ae,{flat:""},{default:c(()=>[a(W,null,{default:c(()=>[f("div",la,[e.$route.params.id?B("",!0):(A(),F("div",oa,[a(oe,{debounce:"300",dense:""})])),f("div",sa,[a(L,{dense:"",debounce:"300",modelValue:w.value,"onUpdate:modelValue":D[0]||(D[0]=i=>w.value=i),label:"Search"},null,8,["modelValue"])]),f("div",ra,[a(L,{dense:"",debounce:"300",modelValue:R.value,"onUpdate:modelValue":D[1]||(D[1]=i=>R.value=i),label:"Release Date",type:"date","stack-label":""},null,8,["modelValue"])]),na])]),_:1})]),_:1}),f("div",null,[a(Te,{title:"Releases","title-class":"text-h5 text-primary",ref_key:"tableRef",ref:q,columns:I.value,rows:p.value,"row-key":i=>i[3],class:"q-pa-sm",pagination:h.value,"onUpdate:pagination":D[2]||(D[2]=i=>h.value=i),"table-header-class":"bg-dark text-white","no-data-label":"There are no releases",dense:"",filter:w.value,onRequest:r},{header:c(i=>[a($e,{class:"bg-dark text-white",props:i},{default:c(()=>[a(ge,{"auto-width":""}),(A(!0),F(ue,null,me(i.cols,m=>(A(),z(ge,{key:m.name,props:i},{default:c(()=>[se(X(m.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:c(i=>[a($e,{props:i},{default:c(()=>[a(we,{"auto-width":""},{default:c(()=>[a(pe,{class:"cursor-pointer",size:fe(y).screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:m=>Ve(i.row),name:i.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(A(!0),F(ue,null,me(i.cols,m=>(A(),z(we,{key:m.name,props:i},{default:c(()=>[se(X(m.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":c(({message:i})=>[f("div",ia,[a(pe,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),f("span",null,X(i),1)])]),"top-right":c(()=>[f("div",da,"(Total: "+X(h.value.rowsNumber)+" releases)",1),a(ve,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:_}),a(ve,{dense:fe(y).screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:Pe,disable:h.value.rowsNumber<1},null,8,["dense","disable"])]),loading:c(()=>[a(Fe,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","filter"])])]))}},ua={name:"Pipeline",components:{ProjectPipelineTable:Ue,projectSelector:oe},setup(){const l=te(),o=ne(),y=le(),P=v(null),$=v(""),{getSelectedProject:S}=Z(y),{fetchAllDeployments:b,fetchAllInProcess:u,fetchAllPending:n,getDeployments:Q,getInProcess:C,getPending:U}=ie(),{getManpowerData:M,setPipelines:q}=de(),p=j(()=>o.params.id?o.params.id:null),w=j(()=>S.value?S.value[3]:null),R=j(()=>Q(w.value).filter(r=>r[20]==="Complete")),N=j(()=>{const r=[];return Q(w.value).forEach(_=>{_[31].toLowerCase().includes($.value.toLowerCase())&&r.push(_)}),r}),h=j(()=>{const r=[];return U(w.value).forEach(_=>{_[25].toLowerCase().includes($.value.toLowerCase())&&r.push(_)}),r}),I=j(()=>{const r=[];return C(w.value).forEach(_=>{_[39].toLowerCase().includes($.value.toLowerCase())&&r.push(_)}),r}),d=j(()=>{let r;return p.value?r=M({dataset:"pipelines",id:p.value})||[]:r=I.value.concat(h.value.concat(N.value)),r}),t=async r=>{l.loading.show(),p.value?(r||!M({dataset:"pipelines",id:p.value}))&&await s():(await b(r),await u(r),await n(r)),l.loading.hide()},s=async()=>{const r=await Ne(p.value);q({id:p.value,data:r})};return t(),{projectFilter:P,arrived:R,allPipeline:d,search:$,loadData:t}}},ma={class:"text-h5 text-dark"},pa={class:"text-body2 text-italic q-ml-sm"},fa=f("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),va={class:"row items-center"},ba={key:0,class:"col-12 col-md-3 q-px-sm"},ga={class:"col-12 col-md-3 q-px-sm"};function $a(l,o,y,P,$,S){const b=T("projectSelector"),u=T("project-pipeline-table");return A(),F("div",null,[a(ae,{flat:""},{default:c(()=>[a(W,{class:"q-pb-none"},{default:c(()=>[f("div",ma,[se(" Staffing Pipeline "),f("span",pa,"("+X(P.allPipeline.length)+" total)",1)]),fa]),_:1}),a(W,null,{default:c(()=>[f("div",va,[l.$route.params.id?B("",!0):(A(),F("div",ba,[a(b,{dense:""})])),f("div",ga,[a(L,{dense:"",modelValue:P.search,"onUpdate:modelValue":o[0]||(o[0]=n=>P.search=n),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(u,{rows:P.allPipeline,onRefresh:o[1]||(o[1]=n=>P.loadData(!0))},null,8,["rows"])])}var wa=ee(ua,[["render",$a]]);const ya=re({name:"Employees",components:{RosterTab:We,NewArrivalsTab:ta,ReleasesTab:ca,PipelineTab:wa},setup(){return{tab:v(0)}}}),ha={class:"q-pa-md"};function _a(l,o,y,P,$,S){const b=T("roster-tab"),u=T("new-arrivals-tab"),n=T("pipeline-tab"),Q=T("releases-tab");return A(),z(ke,{style:{"max-width":"100vw"}},{default:c(()=>[f("div",ha,[a(Ce,{class:"bg-info text-white shadow-2 rounded-borders"},{default:c(()=>[a(Re,{modelValue:l.tab,"onUpdate:modelValue":o[0]||(o[0]=C=>l.tab=C),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:c(()=>[a(J,{name:0,label:l.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),a(J,{name:1,label:"New Arrivals"}),l.$route.name==="project-manpower"?(A(),z(J,{key:0,name:3,label:"Pipeline"})):B("",!0),l.$can("read","releases")?(A(),z(J,{key:1,name:2,label:"Releases"})):B("",!0)]),_:1},8,["modelValue"])]),_:1}),a(qe,{modelValue:l.tab,"onUpdate:modelValue":o[1]||(o[1]=C=>l.tab=C),animated:""},{default:c(()=>[a(G,{name:0},{default:c(()=>[a(b)]),_:1}),a(G,{name:1},{default:c(()=>[a(u)]),_:1}),a(G,{name:3},{default:c(()=>[a(n)]),_:1}),l.$can("read","releases")?(A(),z(G,{key:0,name:2},{default:c(()=>[a(Q)]),_:1})):B("",!0)]),_:1},8,["modelValue"])])]),_:1})}var ut=ee(ya,[["render",_a]]);export{ut as default};
