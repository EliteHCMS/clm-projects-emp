import{Q as te}from"./QImg.df333256.js";import{_ as re,b$ as ne,b_ as ie,r as i,c as Q,w,aV as T,v as d,aj as v,be as s,x as R,d as l,ak as c,z as U,cx as C,a7 as q,bB as ue,bA as de,cy as Y,ao as ce,c1 as B,bU as L,A as me,cz as pe,aq as z,cA as ge,aE as j}from"./index.7d1fc063.js";import{Q as ve}from"./QForm.5da620ff.js";import{Q as fe}from"./QPage.cf81e9f3.js";import{u as he}from"./use-quasar.1dad9cc9.js";import{c as P,u as K}from"./array.a79aab14.js";import{p as ye}from"./VueTelInput.d2570c63.js";import{_ as be}from"./languageSelector.c1da374c.js";import{c as we}from"./carousel.badabc1a.js";import{b as _e,q as G}from"./quickbase.84bd8ea6.js";import{u as xe}from"./i18n.21d54472.js";import"./_commonjsHelpers.dfee5925.js";import"./QSelect.c4aa14ef.js";import"./QMenu.51f98045.js";import"./position-engine.1a5475dd.js";import"./selection.546e0de6.js";import"./rtl.65b79c69.js";import"./use-panel.1e2f64ec.js";import"./touch.d8ab472d.js";import"./use-fullscreen.abf69d3b.js";import"./dayjs.1dd59d98.js";import"./localForage.bcacbe1d.js";import"./index.7dbe61ef.js";import"./api.12567d5d.js";const ke={name:"Login",components:{phoneNumberInput:ye,carousel:we,languageSelector:be},setup(){const o=he(),r=ne(),_=ie(),{locale:e,t:x}=xe(),{currentUserType:k}=_e(),t=i(!1),n=i(!1),f=i(10),p=i(!1),u=i(null),M=i(!1),J=i("first"),h=i("username"),D=i(null),I=i(null),S=i(!1),E=i(!1);r.query.redirect&&(I.value=r.query.redirect,_.replace({query:{}}));const W=Q(()=>t.value?P().email(`${x("validEmailIsRequired")}`).nullable():P().email(`${x("validEmailIsRequired")}`).nullable()),X=Q(()=>{if(n.value)return P().nullable();{const a=new RegExp("^[0-9]{"+f.value+"}","g");return P().matches(a,{excludeEmptyString:!0,message:`${x("validPhoneIsRequired")}`}).nullable()}}),$=Q(()=>P().required().matches(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d@$!%*#?&]{8,}$/,{excludeEmptyString:!0,message:`${x("passwordRules")}`}).nullable()),{errorMessage:A,value:y}=K("email",W),{errorMessage:V,value:g}=K("phone",X),{errorMessage:F,value:b}=K("password",$),ee=i(!0);w(A,a=>{a||y.value===""?n.value=!1:n.value=!0}),w(y,a=>{!a||a===""?n.value=!1:/^\w+([.-]?\w+)*@\w+([.-]?\w+)*(\.\w{2,3})+$/.test(a)&&!A.value&&(n.value=!0)}),w(V,a=>{a||g.value===""?t.value=!1:t.value=!0}),w(g,a=>{!a||a===""?t.value=!1:a.length===f.value&&!V.value&&(t.value=!0)}),w(F,a=>{a||b.value===""?p.value=!1:p.value=!0}),w(b,a=>{M.value=!1,(!a||a==="")&&(p.value=!1)});const ae=a=>{f.value=a},O=Q(()=>!(t.value||n.value)),oe=a=>{u.value=a},le=()=>{h.value="username",b.value=null,j(()=>{document.querySelector("#email").focus()})},se=()=>{h.value="username",b.value=null,j(()=>{document.querySelector("#phoneNumber").focus()})},Z=async()=>{E.value=!0;const a={userType:k};t.value?a.phoneNumber=`+${u.value?u.value.dialCode:"1"}${g.value}`:n.value&&(a.email=y.value);try{const m=await G.checkIfUserExist(a);E.value=!1,m?(h.value="password",j(()=>{document.querySelector("#password").focus()})):k==="Candidate"?_.push({name:"register",params:{...t.value&&{phoneTemp:g.value},...n.value&&{emailTemp:a.email}}}):o.dialog({title:"Alert",message:t.value?"That phone number does not exist. Try again.":"That email does not exist. Try again."}).onOk(()=>{g.value="",t.value=!1,y.value="",n.value=!1})}catch(m){E.value=!1,console.log(m)}},H=async()=>{S.value=!0,clearTimeout(D.value);const a={password:b.value,userType:k};t.value?a.phoneNumber=`+${u.value?u.value.dialCode:"1"}${g.value}`:n.value&&(a.email=y.value);try{const m=await G.login(a);S.value=!1,m&&(I.value?_.push(I.value):_.push({path:"/"}))}catch(m){S.value=!1,D.value=setTimeout(function(){M.value=!1},7e3);const{response:N}=m;N&&N.data.errtext&&N.data.errdetail?o.notify({type:"negative",message:N.data.errdetail,timeout:7e3,position:o.screen.lt.md?"top":"top-right"}):(console.log(m),o.notify({type:"negative",message:"An error occurred, please try again later",timeout:7e3,position:o.screen.lt.md?"top":"top-right"}))}};return{email:y,phone:g,password:b,isPwd:ee,validPhone:t,validEmail:n,step:h,validPassword:p,invalidLogin:M,continueProgress:E,loginProgress:S,passwordMessage:F,phoneMessage:V,emailMessage:A,userNameInvalid:O,updatePhoneMaxLength:ae,continueAction:Z,editUserNameEmail:le,editUserNamePhoneNumber:se,slide:J,login:H,updateCountry:oe,onSubmit:a=>{h.value==="username"&&!O.value?Z():h.value==="password"&&!(!p.value||M.value)?H():a.preventDefault()},locale:e,currentUserType:k}}},Ce={key:0,class:"col-md-7 col-lg-8 col-lx-8"},qe={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},Pe={class:"text-dark"},Me={key:1,class:"divider"},Se={class:"divider-text"},Ee={key:0,class:"text-grey-6",tabindex:"4"},Ne={class:"row justify-center"};function Qe(o,r,_,e,x,k){const t=T("carousel"),n=T("phone-number-input"),f=T("router-link"),p=T("languageSelector");return d(),v(fe,{class:"window-height window-width row"},{default:s(()=>[o.$q.screen.lt.md?c("",!0):(d(),R("div",Ce,[l(t)])),U("div",qe,[l(ge,{class:"auth-card",flat:""},{default:s(()=>[l(C,{style:{"padding-left":"30px","padding-right":"30px"}},{default:s(()=>[l(te,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),l(C,{class:"text-center auth-description"},{default:s(()=>[U("p",Pe,q(o.$t("pleaseSignInToYourAccount")),1)]),_:1}),l(C,null,{default:s(()=>[l(ve,{class:"q-px-sm q-pt-sm",onSubmit:r[4]||(r[4]=ue(()=>{},["prevent"])),onKeyup:de(e.onSubmit,["enter"])},{default:s(()=>[!e.validEmail&&!e.validPhone||e.validEmail?(d(),v(Y,{key:0,for:"email",style:{"padding-bottom":"0px"},autocomplete:"username",clearable:"",outlined:"",modelValue:e.email,"onUpdate:modelValue":r[0]||(r[0]=u=>e.email=u),type:"email",label:o.$t("email"),tabindex:"1",error:!!e.emailMessage,"error-message":e.emailMessage,readonly:e.step!=="username"},ce({prepend:s(()=>[l(L,{name:"email"})]),_:2},[e.step!=="username"?{name:"append",fn:s(()=>[l(B,{round:"",dense:"",flat:"",icon:"edit",onClick:e.editUserNameEmail},null,8,["onClick"])])}:void 0]),1032,["modelValue","label","error","error-message","readonly"])):c("",!0),!e.validEmail&&!e.validPhone&&e.currentUserType!=="QuickBase User"?(d(),R("div",Me,[U("div",Se,q(o.$t("or")),1)])):c("",!0),(!e.validEmail&&!e.validPhone||e.validPhone)&&e.currentUserType!=="QuickBase User"?(d(),v(n,{key:2,outlined:"",for:"phoneNumber",modelValue:e.phone,"onUpdate:modelValue":r[1]||(r[1]=u=>e.phone=u),label:o.$t("phoneNumber"),tabindex:"1",autocomplete:"username",onMaxLengthChanged:e.updatePhoneMaxLength,style:me(e.phoneMessage?"padding-bottom: 20px;":"padding-bottom: 0px;"),error:!!e.phoneMessage,"error-message":e.phoneMessage,readonly:e.step!=="username",editIcon:e.step!=="username",onEditClicked:e.editUserNamePhoneNumber,onCountryChanged:e.updateCountry},null,8,["modelValue","label","onMaxLengthChanged","style","error","error-message","readonly","editIcon","onEditClicked","onCountryChanged"])):c("",!0),e.step==="password"?(d(),v(Y,{key:3,for:"password",class:"q-mt-lg",outlined:"",modelValue:e.password,"onUpdate:modelValue":r[3]||(r[3]=u=>e.password=u),type:e.isPwd?"password":"text",label:o.$t("password"),autocomplete:"current-password",tabindex:"2",error:!!e.passwordMessage,"error-message":e.passwordMessage},{append:s(()=>[l(L,{name:e.isPwd?"visibility_off":"visibility",class:"cursor-pointer",onClick:r[2]||(r[2]=u=>e.isPwd=!e.isPwd)},null,8,["name"])]),prepend:s(()=>[l(L,{name:"lock"})]),_:1},8,["modelValue","type","label","error","error-message"])):c("",!0)]),_:1},8,["onKeyup"])]),_:1}),l(pe,{class:"q-px-lg"},{default:s(()=>[e.step==="username"?(d(),v(B,{key:0,loading:e.continueProgress,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:o.$t("continue"),tabindex:"3",disabled:e.userNameInvalid,onClick:e.continueAction},null,8,["loading","label","disabled","onClick"])):c("",!0),e.step==="password"?(d(),v(B,{key:1,loading:e.loginProgress,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:o.$t("login"),tabindex:"3",disabled:!e.validPassword||e.invalidLogin,onClick:e.login},null,8,["loading","label","disabled","onClick"])):c("",!0)]),_:1}),l(C,{class:"text-center q-pa-sm"},{default:s(()=>[e.currentUserType==="Candidate"?(d(),R("p",Ee,[z(q(o.$t("needAnAccountQuestion"))+" ",1),l(f,{to:"/register",class:"text-grey-6"},{default:s(()=>[z(q(o.$t("register")),1)]),_:1})])):c("",!0),e.currentUserType!=="QuickBase User"?(d(),v(f,{key:1,to:"/forgot-password",class:"text-grey-6"},{default:s(()=>[z(q(o.$t("forgotPasswordQuestion")),1)]),_:1})):c("",!0)]),_:1}),l(C,{class:"q-pl-lg q-pa-sm"},{default:s(()=>[U("div",Ne,[l(p,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1})}var la=re(ke,[["render",Qe],["__scopeId","data-v-1814dc0e"]]);export{la as default};
