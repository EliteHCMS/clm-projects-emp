import{Q as B}from"./QPage.55f2abc8.js";import{k as w,c as _,_ as S,A as l,B as u,d as r,bi as n,D as a,ab as y,bJ as O,bH as A,au as V,cy as I,bO as M,bF as H,r as L,aZ as Y,an as p,cw as h,cz as P,ao as $,w as N,F as C,aY as R,bk as x,bI as z,cZ as J,bM as T,G}from"./index.c09bc2a4.js";import{u as U}from"./useQuerySaver.e863619d.js";import{q as E}from"./quickbase.3c094681.js";import{u as Q}from"./dataStore.d5a29dad.js";import{Q as Z}from"./QSelect.c52b58d3.js";import{Q as W}from"./QForm.1e612a67.js";import{a as F,b as X,u as K}from"./array.b3d67d73.js";import{u as ee}from"./use-quasar.e0cdf7ef.js";import{u as se}from"./dataStore.22bea712.js";import{dayjs as f}from"./dayjs.b00e5e8b.js";import{d as te}from"./decode.593c6ccc.js";import{d as ae,Q as oe}from"./helpers.bec42906.js";import{Q as le}from"./QList.be97f1ab.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.ff6a6a7e.js";import"./i18n.6b16a0d1.js";import"./api.8270b409.js";import"./QChip.9fb9a4d7.js";import"./QItemLabel.3dafae5d.js";import"./QMenu.f586b24f.js";import"./position-engine.a348f403.js";import"./selection.6b3a67ea.js";import"./rtl.cf9bbe47.js";const ne=w({emits:["supUpdated"],props:{record:Object},setup(e,{emit:d}){const c=ee(),{getAssignments:o,fetchAssignments:i}=se(),m=_(()=>o(e.record[74]).filter(b=>b[138]&&b[3]!==e.record[3]).sort((b,g)=>b[75]>g[75]?1:-1)),s=_(()=>F({selection:F().required().nullable().label("Supervisor")})),{errors:t,handleSubmit:v,handleReset:q}=X({validationSchema:s}),{value:j}=K("selection"),k=v(async D=>{const b=[{3:{value:e.record[3]},133:{value:D.selection[3]}}];try{const{data:g}=await E.upsertRecordsXML({to:"bp3gazpqj",data:b,fieldsToReturn:[110],formatObject:110});console.log(g),d("supUpdated",g[0][110]),c.notify({type:"positive",message:"Supervisor successfully updated!"})}catch(g){console.log(g),c.notify({type:"negative",message:"Cannot save supervisor."}),q()}});return i({projectId:e.record[74],refresh:!0}),{props:e,options:m,selection:j,submit:k,formErrors:t,handleReset:q}}}),ie={class:"text-caption"};function re(e,d,c,o,i,m){return l(),u("div",null,[r(W,{onSubmit:H(e.submit,["prevent"])},{default:n(()=>[r(Z,{dense:"",clearable:"",label:"Select a Supervisor","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":d[0]||(d[0]=s=>e.selection=s),options:e.options,"option-label":s=>`${s[75]} - ${s[20]}`,"display-value":`${e.selection?e.selection[75]:""}`,"bottom-slots":"",error:!!e.formErrors.selection},{error:n(()=>[a("div",ie,y(e.formErrors.selection),1)]),"no-option":n(()=>[r(O,null,{default:n(()=>[r(A,{class:"text-grey"},{default:n(()=>[V(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","error"]),r(I,{align:"right"},{default:n(()=>[r(M,{color:"info",label:"Submit",type:"submit"}),r(M,{color:"secondary",label:"Cancel",onClick:e.handleReset},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var de=S(ne,[["render",re]]);const ce=w({props:{employee:Object,assignment:Object},components:{UpdateSupervisor:de},setup(e){const d=L(!1),{setAssignmentsByEmployee:c}=Q();return{props:e,supUpdated:i=>{d.value=!1,c({id:i[18],data:i})},editSup:d}}}),ue=a("div",{class:"text-h6 q-pb-sm"},"Assign a Supervisor",-1),me={class:"row text-body2"},pe={class:"col-12 col-md-6"},ve=a("div",{class:"q-mb-xs"},"Current Location",-1),ye={class:"q-pl-sm"},fe={class:"col-12 col-md-6"},_e=a("div",{class:"q-mb-xs"},"Current Supervisor",-1),be={class:"q-pl-sm"};function ge(e,d,c,o,i,m){const s=Y("update-supervisor");return l(),u("div",null,[e.assignment&&e.assignment[3]?(l(),p(P,{key:0,class:"text-dark"},{default:n(()=>[e.editSup?(l(),p(h,{key:0},{default:n(()=>[ue,r(s,{record:e.assignment,onSupUpdated:e.supUpdated},null,8,["record","onSupUpdated"])]),_:1})):(l(),p(h,{key:1},{default:n(()=>[a("div",me,[a("div",pe,[ve,a("div",ye,y(e.assignment[141]),1)]),a("div",fe,[_e,a("div",be,y(e.assignment[140]===""?"N/A":e.assignment[140]),1)])])]),_:1}))]),_:1})):$("",!0)])}var he=S(ce,[["render",ge]]);const $e=w({props:{employee:Object,assignment:Object},components:{},setup(e){const{getWorkdayData:d}=Q(),c=({id:t,idType:v})=>v.includes("J&amp;E")?t.slice(-5):t,o=_(()=>[]),i=_(()=>{const t=d(e.employee[3]);let v;if(t&&!e.employee[207]){const{employmentData:q,personalData:j}=t,{positionData:k,workerStatus:D}=q,{jobProfile:b}=k,{identificationData:g}=j;v=[{label:"Position",value:`${k.positionId} ${k.positionTitle}`},{label:"Job Profile",value:`${b.jobProfileId} - ${b.jobProfileName}`},{label:te(g.customIds[0].idType),value:c(g.customIds[0])},{label:"Hire Date",value:f(D.hireDate).format("MM/DD/YYYY")},{label:"Original Hire Date",value:f(D.originalHireDate).format("MM/DD/YYYY")},{label:"Years Since Last Hire",value:f().diff(D.hireDate,"year",!0).toFixed(2)}]}else v=[];return v}),m=_(()=>{let t;return e.assignment[3]?t=[{label:"Project",value:e.assignment[94]},{label:"Job Title",value:e.assignment[20]}]:t=[],t}),s=_(()=>o.value.concat(m.value).concat(i.value));return N(i,(t,v)=>{console.log(d(e.employee[3]))}),{props:e,details:s}}}),De=a("div",{class:"text-h6 text-weight-bold"},"Job Details",-1),ke=a("div",{class:"text-body1 text-primary text-italic"},"Employee has a pending release.",-1),we={class:"row"},Se={class:"col-12 col-md-4"},qe={class:"text-body2"},Ye={class:"col-12 col-md-8"},Ce={class:"text-body2 text-weight-light"};function Qe(e,d,c,o,i,m){return l(),u("div",null,[r(P,{class:"text-dark"},{default:n(()=>[r(h,{class:"q-pb-sm"},{default:n(()=>[De]),_:1}),e.employee[581]?(l(),p(h,{key:0,class:"q-py-sm"},{default:n(()=>[ke]),_:1})):$("",!0),(l(!0),u(C,null,R(e.details,s=>(l(),p(h,{key:s,class:"q-py-sm"},{default:n(()=>[a("div",we,[a("div",Se,[a("div",qe,y(s.label),1)]),a("div",Ye,[a("div",Ce,y(s.value),1)])])]),_:2},1024))),128))]),_:1})])}var je=S($e,[["render",Qe]]);const Ae=w({props:{employee:Object},components:{},setup(e){const{getReleases:d,setReleases:c}=Q(),o=_(()=>d(e.employee[581])),i=_(()=>{let t;return o.value&&o.value[3]?t=[{label:"Reason",value:o.value[32]},{label:"Last Hire Date",value:f(e.employee[397].$d).format("MM/DD/YYYY")},{label:"Last Day On Site",value:f(o.value[36].$d).format("MM/DD/YYYY")},{label:"Returned Equipment",value:o.value[72]?"Yes":"No"},{label:"Pay Deduct Needed",value:!o.value[72]&&f.duration(f(o.value[36].$d).diff(f(e.employee[397].$d))).asDays()<30?"Yes":"No"},{label:"CAAP Rating",value:o.value[59]&&o.value[59].length>0?o.value[59][0][37]:0,type:"rating"},{label:"Submitted By",value:`${o.value[38][35]} ${o.value[38][37]}`},{label:"Submitted On",value:f(o.value[1].$d).tz(f.tz.guess()).format("MM/DD/YYYY hh:mm a")},{label:"Comments",value:o.value[60],type:"comments"}]:t=[],t}),m=async()=>{if(!o.value&&e.employee[581]){const{data:t}=await E.fetchFromHiringApp({fields:[U({type:"releases",query:"",id:e.employee[581]})]},{action:"read",type:"release"});console.log(t),c({id:t[3],data:t})}},s=t=>{console.log(t)};return m(),{releaseDetails:i,release:o,downloadFile:ae,getFile:s}}}),Me={class:"row items-center"},Re=a("div",{class:"col-12 col-md-7"},[a("div",{class:"text-h6 text-weight-bold"},"Pending Release Details")],-1),Pe={key:0,class:"col-12 col-md-5"},Ee={class:"row"},Fe={class:"col-12 col-md-5"},Oe={class:"text-body2"},Ve={class:"col-12 col-md-7"},Ie={key:0},Ne={key:1,class:"text-body2 text-weight-light"},Ue={key:1,class:"text-body2 text-weight-light"},Be={class:"text-body1 text-weight-bold q-mb-xs"},He={class:"text-body2 text-italic text-primary q-pl-md"},Le=a("div",{class:"text-body1 text-weight-bold q-mb-xs"},"Supporting Docs",-1);function xe(e,d,c,o,i,m){return l(),u("div",null,[r(P,{class:"text-dark"},{default:n(()=>[r(h,{class:"q-pb-sm"},{default:n(()=>[a("div",Me,[Re,e.release?(l(),u("div",Pe,[r(I,{align:"right"},{default:n(()=>[r(M,{size:"md",flat:"",dense:"",label:"View Release",color:"info",to:{name:"view-ee-release",params:{id:e.release[25],release:e.release[3]}}},null,8,["to"])]),_:1})])):$("",!0)])]),_:1}),(l(!0),u(C,null,R(e.releaseDetails,s=>(l(),u(C,{key:s},[s.type!=="comments"?(l(),p(h,{key:0,class:"q-py-sm"},{default:n(()=>[a("div",Ee,[a("div",Fe,[a("div",Oe,y(s.label),1)]),a("div",Ve,[s.type==="rating"?(l(),u("div",Ie,[s.value>0?(l(),p(oe,{key:0,modelValue:s.value,"onUpdate:modelValue":t=>s.value=t,max:"5",size:"sm",color:"accent",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"])):(l(),u("div",Ne,"Not Available"))])):(l(),u("div",Ue,y(s.value),1))])])]),_:2},1024)):s.value!==""?(l(),p(h,{key:1},{default:n(()=>[a("div",Be,y(s.label),1),a("div",He,y(s.value),1)]),_:2},1024)):$("",!0)],64))),128)),e.release&&e.release[70].length>0?(l(),p(h,{key:0},{default:n(()=>[Le,r(le,null,{default:n(()=>[(l(!0),u(C,null,R(e.release[70],(s,t)=>x((l(),p(O,{key:t,clickable:"",class:"text-body2",onClick:v=>e.downloadFile(s.url)},{default:n(()=>[r(A,null,{default:n(()=>[V(y(t+1)+". "+y(s[7]),1)]),_:2},1024),r(A,{avatar:""},{default:n(()=>[r(z,{color:"info",name:"file_download"})]),_:1})]),_:2},1032,["onClick"])),[[J]])),128))]),_:1})]),_:1})):$("",!0)]),_:1})])}var ze=S(Ae,[["render",xe]]);const Je=w({components:{LocationAndManager:he,EmployeeJobDetails:je,PendingReleaseDetails:ze},setup(){const e=T(),{getEmployee:d,getAssignmentsByEmployee:c,setAssignmentsByEmployee:o}=Q(),i=_(()=>d(e.params.id)),m=_(()=>i.value?c(i.value[3]):null),s=async()=>{if(!m.value&&i.value[577]){const{data:t}=await E.fetchFromHiringApp({fields:[U({type:"assignments",query:"",id:i.value[577]})]});console.log(t),o({id:i.value[3],data:t})}};return N(i,(t,v)=>{t&&s()}),{employee:i,assignment:m}}}),Te={class:"q-pa-sm"},Ge={class:"row"},Ze={class:"col-12 col-md-6 q-px-xs"},We={key:1},Xe={key:0};function Ke(e,d,c,o,i,m){const s=Y("location-and-manager"),t=Y("employee-job-details"),v=Y("pending-release-details");return l(),p(B,{style:{"max-width":"100vw"}},{default:n(()=>[a("div",Te,[a("div",Ge,[a("div",Ze,[e.employee&&e.employee[408]==="Active"?(l(),p(s,{key:0,employee:e.employee,assignment:e.assignment},null,8,["employee","assignment"])):$("",!0),e.employee&&e.assignment?(l(),u("div",We,[e.assignment[21]==="In Process"?(l(),p(t,{key:0,class:"q-mt-md",assignment:e.assignment,employee:e.employee},null,8,["assignment","employee"])):$("",!0)])):$("",!0)]),a("div",{class:G(["col-12 col-md-6 q-px-xs",e.employee&&e.employee[581]?"order-first":""])},[e.employee&&e.employee[581]?(l(),u("div",Xe,[r(v,{employee:e.employee},null,8,["employee"])])):$("",!0)],2)])])]),_:1})}var Ss=S(Je,[["render",Ke]]);export{Ss as default};
