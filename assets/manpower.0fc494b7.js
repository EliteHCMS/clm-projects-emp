import{Q as M,b as T,a as ae}from"./QTabPanels.9e681541.js";import{Q as oe}from"./QTabs.33d8c11b.js";import{Q as se}from"./QToolbar.40b55e19.js";import{Q as le}from"./QPage.025a70ae.js";import{l as E,bM as I,r as _,c as $,_ as j,aZ as q,A as D,B as Y,d as o,bi as n,cw as F,D as u,cx as Q,cz as S,bL as re,F as X,aY as B,an as N,au as L,ab as k,bI as H,bO as G,y as ne,ao as ie}from"./index.1b5374c8.js";import{Q as K}from"./QSelect.7256ef6b.js";import{u as O}from"./use-quasar.a24d697c.js";import{u as U}from"./dataStore.a9f42791.js";import{dayjs as y}from"./dayjs.5d57e85b.js";import{u as x}from"./useQuerySaver.b2d7aad9.js";import{q as z}from"./quickbase.2ee72534.js";import{R as ee}from"./rosterTable.e506d70a.js";import{Q as J,a as de}from"./QTable.4b856605.js";import{Q as W}from"./QTr.a1256565.js";import{Q as Z}from"./QTd.b04748be.js";import{Q as ue}from"./QInnerLoading.a02206a5.js";import{e as pe}from"./export-file.eb604dd4.js";import{g as me}from"./quickbaseDataHelpers.a2a8da91.js";import{P as ce}from"./projectPipeline.06984d64.js";import"./use-panel.bd5ef06e.js";import"./touch.60582172.js";import"./selection.971e5b60.js";import"./QResizeObserver.3970a03c.js";import"./rtl.cf9bbe47.js";import"./QChip.de32f227.js";import"./QItemLabel.ee2c7196.js";import"./QMenu.d63f2496.js";import"./position-engine.c9766907.js";import"./localForage.f1f06786.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./i18n.6386200b.js";import"./api.d146f206.js";import"./QList.4ca8141b.js";import"./QMarkupTable.9bc1e671.js";import"./use-fullscreen.61060e22.js";const fe=E({props:{},components:{RosterTable:ee},setup(t){const a=O(),v=I(),d=_(""),p=_(null),m=_(null),{getManpowerData:s,setRosters:r}=U(),b=$(()=>v.params.id?v.params.id:null),c=$(()=>(s({dataset:"rosters",id:b.value})||[]).sort((w,g)=>w[1].$d<g[1].$d?1:-1).filter(w=>!w[112]&&w.latest&&w[102]==="Active")),h=$(()=>{let l=[];return c.value.forEach(i=>{i[75].toLowerCase().includes(d.value.toLowerCase())&&l.push(i)}),l=p.value?l.filter(i=>y(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===y(p.value).tz("America/Chicago").format("MM/DD/YYYY")):l,l=m.value?l.filter(i=>i[68]===m.value):l,l.sort((i,w)=>i.employee[22]>w.employee[22]?1:-1)}),R=$(()=>[...new Map(c.value.map(l=>[l[68],l[68]])).values()]),C=async l=>{(l||!s({dataset:"rosters",id:b.value}))&&(a.loading.show(),await P(),a.loading.hide())},P=async()=>{const l=`{'74'.EX.'${b.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:i}=await z.fetchFromHiringApp({fields:[x({type:"assignments",query:l})]});r({id:b.value,data:i})};return C(!1),{allAssignments:c,search:d,startDateFilter:p,craftFilter:m,craftOptions:R,rows:h,loadData:C}}}),be={class:"row items-center"},ve={class:"col-12 col-md-3 q-px-sm"},we={class:"col-12 col-md-3 q-px-sm"},$e={class:"col-12 col-md-3 q-px-sm"};function he(t,a,v,d,p,m){const s=q("roster-table");return D(),Y("div",null,[o(S,{flat:""},{default:n(()=>[o(F,null,{default:n(()=>[u("div",be,[u("div",ve,[o(Q,{dense:"",modelValue:t.search,"onUpdate:modelValue":a[0]||(a[0]=r=>t.search=r),label:"Search"},null,8,["modelValue"])]),u("div",we,[o(Q,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":a[1]||(a[1]=r=>t.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",$e,[o(K,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":a[2]||(a[2]=r=>t.craftFilter=r),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),o(s,{rows:t.rows,onRefreshData:a[3]||(a[3]=r=>t.loadData(!0))},null,8,["rows"])])}var ge=j(fe,[["render",he]]);const ye=E({props:{},components:{RosterTable:ee},setup(t){const a=O(),v=I(),d=_(""),p=_(null),m=_(null),{getManpowerData:s,setRosters:r}=U(),b=$(()=>v.params.id?v.params.id:null),c=$(()=>{const l=y().subtract(14,"day");return(s({dataset:"rosters",id:b.value})||[]).sort((g,e)=>g[1].$d<e[1].$d?1:-1).filter(g=>!g[112]&&g.latest&&g[102]==="Active"&&y(g[1].$d).isSameOrAfter(l)&&y(g[1].$d).isSameOrBefore(y()))}),h=$(()=>{let l=[];return c.value.forEach(i=>{i[75].toLowerCase().includes(d.value.toLowerCase())&&l.push(i)}),l=p.value?l.filter(i=>y(i[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===y(p.value).tz("America/Chicago").format("MM/DD/YYYY")):l,l=m.value?l.filter(i=>i[68]===m.value):l,l.sort((i,w)=>i.employee[22]>w.employee[22]?1:-1)}),R=$(()=>[...new Map(c.value.map(l=>[l[68],l[68]])).values()]),C=async l=>{(l||!s({dataset:"rosters",id:b.value}))&&(a.loading.show(),await P(),a.loading.hide())},P=async()=>{const l=`{'74'.EX.'${b.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:i}=await z.fetchFromProjectsApp({fields:[x({type:"assignments",query:l})]});r({id:b.value,data:i})};return{allAssignments:c,search:d,startDateFilter:p,craftFilter:m,craftOptions:R,rows:h,loadData:C}}}),De={class:"row items-center"},_e={class:"col-12 col-md-3 q-px-sm"},Ve={class:"col-12 col-md-3 q-px-sm"},Ae={class:"col-12 col-md-3 q-px-sm"};function qe(t,a,v,d,p,m){const s=q("roster-table");return D(),Y("div",null,[o(S,{flat:""},{default:n(()=>[o(F,null,{default:n(()=>[u("div",De,[u("div",_e,[o(Q,{dense:"",modelValue:t.search,"onUpdate:modelValue":a[0]||(a[0]=r=>t.search=r),label:"Search"},null,8,["modelValue"])]),u("div",Ve,[o(Q,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":a[1]||(a[1]=r=>t.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),u("div",Ae,[o(K,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":a[2]||(a[2]=r=>t.craftFilter=r),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),o(s,{rows:t.rows,onRefresh:a[3]||(a[3]=r=>t.loadData(!0))},null,8,["rows"])])}var Qe=j(ye,[["render",qe]]);const Ce=E({props:{},components:{},setup(t){const a=O(),v=re(),d=I(),{capitalize:p}=ne,m=_(""),s=_(null),{getManpowerData:r,setDepartures:b}=U(),c=$(()=>d.params.id?d.params.id:null),h=[{name:1,label:"Name",align:"left",field:e=>e[66][22],format:(e,V)=>`${R(V[66])}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e[66][378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[66][213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[67][20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[67][105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Depature Date",align:"left",field:e=>e[36].$d,format:e=>`${y(e).format("MM/DD/YYYY")}`,sortable:!0}],R=e=>{const V=e[20]!==""?p(e[20].toLowerCase().trim()):"",A=e[22]!==""?p(e[22].toLowerCase().trim()):"",f=e[21]!==""?` ${p(e[21].toLowerCase().trim())}`:"",te=e[23]!==""?` ${p(e[23])}`:"";return`${A}${te}, ${V}${f}`};function C(e){v.push({name:"view-release",params:{release:e[3]}})}function P(e,V,A){let f=V!==void 0?V(e,A):e;return f=f==null?"":String(f),f=f.split('"').join('""'),`"${f}"`}function l(){const e=[h.value.map(A=>P(A.label))].concat(i.value.map(A=>h.value.map(f=>P(typeof f.field=="function"?f.field(A):A[f.field===void 0?f.name:f.field],f.format,A)).join(","))).join(`\r
`);pe(`${y().format("MM.DD.YYYY")} Releases-Export.csv`,e,"text/csv")!==!0&&a.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const i=$(()=>r({dataset:"departures",id:c.value})||[]),w=async e=>{(e||!r({dataset:"departures",id:c.value}))&&(a.loading.show(),await g(),a.loading.hide())},g=async()=>{const e=`{'41'.EX.'${c.value}'}AND{'42'.XEX.'Complete'}AND({'36'.OAF.'today'}OR{'36'.IR.'last 30 d'}OR{'1'.IR.'last 30 d'})`,{data:V}=await z.fetchFromHiringApp({fields:[x({type:"releases",query:e})]});b({id:c.value,data:V})};return w(),{search:m,dateFilter:s,loadData:w,columns:h,viewRelease:C,exportAllReleases:l,rows:i}}}),Pe={class:"row items-center"},Ye={class:"col-12 col-md-3 q-px-sm"},Re={class:"col-12 col-md-3 q-px-sm"},ke={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Fe={class:"text-dark text-caption text-italic"};function je(t,a,v,d,p,m){return D(),Y("div",null,[o(S,{flat:""},{default:n(()=>[o(F,null,{default:n(()=>[u("div",Pe,[u("div",Ye,[o(Q,{dense:"",modelValue:t.search,"onUpdate:modelValue":a[0]||(a[0]=s=>t.search=s),label:"Search"},null,8,["modelValue"])]),u("div",Re,[o(Q,{dense:"",modelValue:t.dateFilter,"onUpdate:modelValue":a[1]||(a[1]=s=>t.dateFilter=s),label:"Departure Date",type:"date","stack-label":""},null,8,["modelValue"])])])]),_:1})]),_:1}),u("div",null,[o(de,{title:"Recent Departures","title-class":"text-h5 text-primary",columns:t.columns,rows:t.rows,"row-key":s=>s[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent departures",dense:""},{header:n(s=>[o(W,{class:"bg-dark text-white",props:s},{default:n(()=>[o(J,{"auto-width":""}),(D(!0),Y(X,null,B(s.cols,r=>(D(),N(J,{key:r.name,props:s},{default:n(()=>[L(k(r.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:n(s=>[o(W,{props:s},{default:n(()=>[o(Z,{"auto-width":""},{default:n(()=>[o(H,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:r=>t.viewRelease(s.row),name:s.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(D(!0),Y(X,null,B(s.cols,r=>(D(),N(Z,{key:r.name,props:s},{default:n(()=>[L(k(r.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":n(({message:s})=>[u("div",ke,[o(H,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),u("span",null,k(s),1)])]),"top-right":n(()=>[u("div",Fe,"(Total: "+k(t.rows.length)+" departures)",1),o(G,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:a[2]||(a[2]=s=>t.loadData(!0))}),o(G,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllReleases,disable:t.rows.length<1},null,8,["dense","onClick","disable"])]),loading:n(()=>[o(ue,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Me=j(Ce,[["render",je]]);const Te={name:"Pipeline",components:{ProjectPipelineTable:ce},setup(){const t=O(),a=I(),v=_(""),{getManpowerData:d,setPipelines:p}=U(),m=$(()=>a.params.id?a.params.id:null),s=$(()=>d({dataset:"pipelines",id:m.value})||[]),r=async c=>{(c||!d({dataset:"pipelines",id:m.value}))&&(t.loading.show(),await b(),t.loading.hide())},b=async()=>{const c=await me(m.value);p({id:m.value,data:c})};return r(),{allPipeline:s,search:v,loadData:r}}},Ne={class:"text-h5 text-dark"},Ee={class:"text-body2 text-italic q-ml-sm"},Ie=u("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Se={class:"row items-center"},Oe={class:"col-12 col-md-3 q-px-sm"};function Ue(t,a,v,d,p,m){const s=q("project-pipeline-table");return D(),Y("div",null,[o(S,{flat:""},{default:n(()=>[o(F,{class:"q-pb-none"},{default:n(()=>[u("div",Ne,[L(" Staffing Pipeline "),u("span",Ee,"("+k(d.allPipeline.length)+" total)",1)]),Ie]),_:1}),o(F,null,{default:n(()=>[u("div",Se,[u("div",Oe,[o(Q,{dense:"",modelValue:d.search,"onUpdate:modelValue":a[0]||(a[0]=r=>d.search=r),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),o(s,{rows:d.allPipeline,onRefresh:a[1]||(a[1]=r=>d.loadData(!0))},null,8,["rows"])])}var Le=j(Te,[["render",Ue]]);const xe=E({name:"Employees",components:{RosterTab:ge,NewArrivalsTab:Qe,ReleasesTab:Me,PipelineTab:Le},setup(){return{tab:_(0)}}}),ze={class:"q-pa-md"};function Xe(t,a,v,d,p,m){const s=q("roster-tab"),r=q("new-arrivals-tab"),b=q("pipeline-tab"),c=q("releases-tab");return D(),N(le,{style:{"max-width":"100vw"}},{default:n(()=>[u("div",ze,[o(se,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[o(oe,{modelValue:t.tab,"onUpdate:modelValue":a[0]||(a[0]=h=>t.tab=h),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:n(()=>[o(M,{name:0,label:t.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),o(M,{name:1,label:"New Arrivals"}),t.$route.name==="project-manpower"?(D(),N(M,{key:0,name:3,label:"Pipeline"})):ie("",!0),o(M,{name:2,label:"Departures"})]),_:1},8,["modelValue"])]),_:1}),o(ae,{modelValue:t.tab,"onUpdate:modelValue":a[1]||(a[1]=h=>t.tab=h),animated:""},{default:n(()=>[o(T,{name:0},{default:n(()=>[o(s)]),_:1}),o(T,{name:1},{default:n(()=>[o(r)]),_:1}),o(T,{name:3},{default:n(()=>[o(b)]),_:1}),o(T,{name:2},{default:n(()=>[o(c)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var Pt=j(xe,[["render",Xe]]);export{Pt as default};
