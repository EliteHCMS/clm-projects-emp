import{k as w,r as k,i as v,f as I,l as d}from"./index.ec3d94e8.js";import{o as R,z as P,a as b,q as a}from"./quickbase.1ec2a476.js";import"./_commonjsHelpers.dfee5925.js";import"./dayjs.16fee34f.js";import"./localForage.7b019c38.js";import"./index.7dbe61ef.js";import"./i18n.fca7b0c1.js";import"./api.da398f20.js";function S(r){if(r.hasOwnProperty("possibleRulesFor"))return r;var t=k(!0);r.on("updated",function(){t.value=!t.value});var e=r.possibleRulesFor.bind(r);return r.possibleRulesFor=function(o,i){return t.value=t.value,e(o,i)},r.can=r.can.bind(r),r.cannot=r.cannot.bind(r),r}var g=Symbol("ability");function N(){var r=v(g);if(!r)throw new Error("Cannot inject Ability instance because it was not provided");return r}function O(r){return"a"in r?"a":"this"in r?"this":"an"in r?"an":""}w({name:"Can",props:{I:String,do:String,a:[String,Function],an:[String,Function],this:[String,Function,Object],on:[String,Function,Object],not:Boolean,passThrough:Boolean,field:String},setup:function(t,e){var o=e.slots,i=t,n="do",s="on";if(n in t||(n="I",s=O(t)),!i[n])throw new Error("Neither `I` nor `do` prop was passed in <Can>");if(!o.default)throw new Error("Expects to receive default slot");var l=N();return function(){var c=l.can(i[n],i[s],i.field),m=t.not?!c:c;return t.passThrough?o.default({allowed:m,ability:l}):m?o.default():null}}});function j(r,t,e){if(!t||!(t instanceof R))throw new Error("Please provide an Ability instance to abilitiesPlugin plugin");r.provide(g,S(t)),e&&e.useGlobalProperties&&(r.config.globalProperties.$ability=t,r.config.globalProperties.$can=t.can.bind(t))}const E=r=>r.matched.some(t=>b.can(t.meta.action||"read",t.meta.resource));var K=I(({app:r,router:t})=>{r.config.globalProperties.$subject=P,r.use(j,b,{useGlobalProperties:!0}),t.beforeEach(async(e,o,i)=>{const n=await a.isUserLoggedIn(),s=Object.assign({},e.query);if(n||a.logout(),s.office_id?(a.setOfficeLocation({rid:s.office_id}),!!s.qr&(s.qr==="3422"||s.qr===3422)&&a.setCheckIn(!0)):s.qr&&s.type&&a.setEvent(s,!0),o.fullPath==="/"&&!o.name){const f=await a.getIpInfo();f?f.country!==d.country&&await a.fetchIpInfo():await a.fetchIpInfo(),n?await a.reloadUserInfo({reAuthenticate:!0}):d.pageType==="Candidate Kiosk"&&await a.updateStore()}if(!E(e)){const f=e.path!=="/";return!n&&d.pageType==="Candidate Kiosk"&&d.startPage?i({name:"start"}):i(n?{name:"not-authorized"}:{name:"login",query:{...f&&{redirect:e.path}}})}if(d.pageType==="Candidate Kiosk"&&e.name!=="bookmarks"&&e.name!=="start"){const f=await a.bookmarksValid(),h=await a.bookMarksOnly();if(f&&h)return i({name:"bookmarks"})}if(e.name==="bookmarks"&&!await a.bookmarksValid())return a.clearBookmarks(),i("/");if(e.meta.redirectIfLoggedIn&&n)return i("/");const l=await a.phoneNumberRequired(n),c=await a.emailRequired(n),m=await a.verifyRequired(n),y=await a.employeeLinkRequired(n),u=await a.getUserFromStore(n),q=await a.getSocialRequired(n),p=await a.getEvent(n);if(l||c)return o.name==="update-information"&&n&&e.query.rid?(e.query.phoneNumber&&await a.setPhoneNumber(e.query.phoneNumber),e.query.email&&await a.setEmail(e.query.email),i({path:"/",query:{}})):e.name!=="update-information"?i({name:"update-information",query:{rid:u[3],...l&&{phoneNumberRequired:!0},...c&&{emailRequired:!0}}}):Object.keys(e.query).length===0&&o.name!=="update-information"?i({name:"update-information",query:{rid:u[3],...l&&{phoneNumberRequired:!0},...c&&{emailRequired:!0}}}):i();if(o.name==="update-information"&&Object.keys(e.query).length>=1)return i({path:"/",query:{}});if(m)return o.name==="code-confirmation"&&n&&e.query.code?(await a.setVerified(!0),i({path:"/"})):e.name!=="code-confirmation"?i({name:"code-confirmation",query:{p:u[9]?u[9].phoneNumber:u[8].replace(/[^0-9]/g,""),rid:u[3]}}):Object.keys(e.query).length===0&&o.name!=="code-confirmation"?i({name:"code-confirmation",query:{p:u[9]?u[9].phoneNumber:u[8].replace(/[^0-9]/g,""),rid:u[3]}}):i();if(y||q)return o.name==="verify-identity"&&n&&e.query.verify?(e.query.rid?await a.setIdentityVerified(e.query.rid):await a.setIdentityVerified(!1),i({path:"/",query:{}})):e.name!=="verify-identity"?i({name:"verify-identity",query:{rid:u[3]}}):Object.keys(e.query).length===0&&o.name!=="verify-identity"?i({name:"verify-identity",query:{rid:u[3]}}):i();if(e.name==="verify-identity"){if(!y)return i({path:"/"})}else if(e.name==="code-confirmation")return!n&&e.query.ac?i():i({path:"/"});return n&&p&&p.type==="Training"&&p.qr&&e.name!=="training"?i({name:"training",query:p}):i()}),t.afterEach(async(e,o)=>{const i=await a.isUserLoggedIn();o.fullPath==="/"&&!o.name&&i&&await a.updateStore({reAuthenticate:!1})})});export{K as default};
