import{Q as G}from"./QImg.11916f67.js";import{_ as H,c5 as X,c4 as J,r as c,c as K,w as S,z as n,am as M,bh as d,a6 as E,A as p,d as v,an as i,C as b,c2 as w,aa as Q,at as j,bE as W,cB as Z,b as ee,c6 as te,c3 as ae,aU as oe,aS as se}from"./index.240d1a52.js";import{Q as re}from"./QForm.e0924146.js";import{Q as ne}from"./QPage.8fa79c16.js";import{u as le}from"./use-quasar.bd98b4ac.js";import{u as ie,c as ue}from"./array.90dce8c1.js";import{u as ce,q as h}from"./quickbase.6c5e86c5.js";import{c as de}from"./carousel.22d3c8d8.js";import{api as pe}from"./api.bcb86c9f.js";import{dayjs as q}from"./dayjs.33ce7aa3.js";import"./_commonjsHelpers.dfee5925.js";import"./localForage.99e9627d.js";import"./index.7dbe61ef.js";import"./i18n.76e23039.js";import"./use-panel.35bc3613.js";import"./touch.d8ab472d.js";import"./selection.a751ca80.js";import"./use-fullscreen.f7e2e87d.js";const R=k=>(oe("data-v-102decb2"),k=k(),se(),k),me={key:0,class:"col-md-7 col-lg-8 col-lx-8"},ve={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},fe={key:0,class:"text-dark"},ge={key:1,class:"text-dark"},ye={key:2,class:"text-dark"},he={key:3,class:"text-dark"},be=R(()=>b("br",null,null,-1)),_e={key:4,class:"text-dark"},xe=R(()=>b("br",null,null,-1)),we={key:2,class:"text-grey-6 text-right"},qe={key:3,class:"text-grey-6 text-right"},ke={__name:"codeConfirmation",setup(k){const f=le(),V=ce(),t=X(),m=J(),D=c(""),N=c(""),s=c("phone number"),l=c("code-confirmation"),u=c(Math.floor(1e5+Math.random()*9e5)),_=c(null),C=c(!1),x=c(0),r=c(null),{value:g}=ie("codeConfirmation",ue().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:"Code Not Valid!"}).required().oneOf([u.value],"Code Not Valid!")),B=K(()=>g.value===u.value),O=a=>{const e=Math.floor(a/6e4),o=(a%6e4/1e3).toFixed(0);return e+":"+(o<10?"0":"")+o};S(s,a=>{u.value=null,g.value=null,C.value=!1,u.value=null,_.value=null,l.value="code-confirmation"}),S(x,a=>{a===0?(C.value=!0,u.value=null,_.value=null):C.value=!1}),S(g,async a=>{Number(a)===u.value&&(f.notify({position:"top-right",type:"positive",message:"Code Verified!"}),s.value==="phone number"?$():s.value==="email"&&A())});const I=async()=>{u.value=Math.floor(1e5+Math.random()*9e5),g.value=null,_.value=q().add(5,"minute").toISOString(),s.value==="phone number"?(await pe.createMessageQueue({to:D.value,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",message:`Your Brandsafway Verification Code is: ${u.value}`,extRef:null,massText:!1}),f.notify({position:"top-right",type:"info",message:"Text message sent!"}),_.value=q().add(1,"minute")):s.value==="email"&&(await P(),f.notify({position:"top-right",type:"info",message:"Email sent!"}),_.value=q().add(2,"minute")),T(),l.value="code-sent"},T=()=>{const a=setInterval(()=>{x.value=q(_.value).valueOf()-q().valueOf(),x.value<=0&&(x.value=0,clearInterval(a))},1e3)},P=async()=>{if(!r.value||r.value==="")return!1;const a=await h.isUserLoggedIn(),e=new Date;u.value||(u.value=Math.floor(1e5+Math.random()*9e5));const o={3:{value:r.value},26:{value:e},87:{value:e},88:{value:u.value},47:{value:!0}};try{return a?await h.updateUserData({fields:o}):await h.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[o],formatObject:76})}catch(y){f.notify({position:"top-right",type:"negative",message:y.message||"Error updating Verification!"})}},$=async()=>{if(!r.value||r.value==="")return!1;const a=await h.isUserLoggedIn(),e=new Date,o={3:{value:r.value},26:{value:e},50:{value:!0}};try{await h.updateUserData({fields:o}),a?m.push({path:"/",query:{code:!0}}):m.push({name:"password-update",query:{rid:r.value,ac:!0}})}catch(y){f.notify({position:"top-right",type:"negative",message:y.message||"Error updating Verification!"})}},A=async()=>{if(!r.value||r.value==="")return!1;const a=await h.isUserLoggedIn(),e=new Date,o={3:{value:r.value},26:{value:e},49:{value:!0}};try{await h.updateUserData({fields:o}),a?m.push({path:"/",query:{code:!0}}):m.push({name:"password-update",query:{rid:r.value,ac:!0}})}catch(y){f.notify({position:"top-right",type:"negative",message:y.message||"Error updating Verification!"})}},F=()=>{V.logout().then(()=>{m.replace({name:"login"})})},z=()=>D.value.replace(/(\d{3})(\d{3})(\d{4})/,"******$3"),Y=()=>(V.userLoggedIn?V.user[34]:N.value||"").replace(/(.{2})(.*)(?=@)/,function(e,o,y){for(let L=0;L<y.length;L++)o+="*";return o});S(()=>t.query,()=>{U(!1)});const U=async a=>{if(t.query.p&&t.query.rid){l.value="code-confirmation",D.value=t.query.p,r.value=t.query.rid,t.query.p=null,t.query.rid=null;const e=Object.assign({},t.query);delete e.p,delete e.rid,(t.query.send==="true"||t.query.send===!0)&&I(),delete e.send,m.replace({query:e})}else if(t.query.e&&t.query.rid){l.value="code-confirmation",s.value="email",N.value=t.query.e,r.value=t.query.rid,t.query.e=null,t.query.rid=null;const e=Object.assign({},t.query);delete e.p,delete e.rid,(t.query.send==="true"||t.query.send===!0)&&I(),delete e.send,m.replace({query:e})}else a&&m.push("/login")};return U(!0),(a,e)=>(n(),M(ne,{class:"window-height window-width row"},{default:d(()=>[E(f).screen.lt.md?i("",!0):(n(),p("div",me,[v(de)])),b("div",ve,[v(ae,{class:"auth-card",flat:""},{default:d(()=>[v(w,{style:{"padding-left":"30px","padding-right":"30px"}},{default:d(()=>[v(G,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),v(w,{class:"text-center auth-description"},{default:d(()=>[l.value==="code-sent"&&s.value==="phone number"?(n(),p("p",fe,"A text message with a verification code has been sent to your phone.")):i("",!0),l.value==="code-sent"&&s.value==="email"?(n(),p("p",ge,"A verification code has been sent to your email. ")):i("",!0),l.value==="code-confirmation"?(n(),p("p",ye,"Your "+Q(s.value)+" needs to be verified click the button below to verify.",1)):i("",!0),l.value==="code-confirmation"&&s.value==="phone number"?(n(),p("p",he,[be,j(Q(z()),1)])):i("",!0),l.value==="code-confirmation"&&s.value==="email"?(n(),p("p",_e,[xe,j(Q(Y()),1)])):i("",!0)]),_:1}),v(w,null,{default:d(()=>[v(re,{class:"q-px-sm q-pt-sm",onSubmit:e[3]||(e[3]=W(()=>{},["prevent"]))},{default:d(()=>[l.value==="code-sent"?(n(),M(Z,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",clearable:"",outlined:"",disable:C.value,modelValue:E(g),"onUpdate:modelValue":e[0]||(e[0]=o=>ee(g)?g.value=o:null),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:"Code",tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!E(B),"error-message":"Code does not match!"},{append:d(()=>[j(Q(O(x.value))+"\xA0 ",1)]),_:1},8,["disable","modelValue","error"])):i("",!0),l.value==="code-confirmation"?(n(),M(te,{key:1,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Send Code",tabindex:"1",onClick:I})):i("",!0),s.value==="phone number"?(n(),p("p",we,[b("a",{href:"javascript:void(0);",onClick:e[1]||(e[1]=o=>s.value="email")},"Use Email")])):i("",!0),s.value==="email"?(n(),p("p",qe,[b("a",{href:"javascript:void(0);",onClick:e[2]||(e[2]=o=>s.value="phone number")},"Use Phone Number")])):i("",!0),l.value==="code-sent"?(n(),M(w,{key:4,class:"q-py-none row justify-center"},{default:d(()=>[x.value===0?(n(),p("a",{key:0,onClick:I,class:"text-grey-6",href:"javascript:void(0);",tabindex:"2"},"Resend Code")):i("",!0)]),_:1})):i("",!0)]),_:1})]),_:1}),v(w,{class:"text-center q-pa-sm"},{default:d(()=>[b("p",{class:"text-grey-6"},[b("a",{onClick:F,class:"text-grey-6",href:"javascript:void(0);",tabindex:"3"},"Logout")])]),_:1})]),_:1})])]),_:1}))}};var Ae=H(ke,[["__scopeId","data-v-102decb2"]]);export{Ae as default};
