import{q as d,u as p}from"./quickbase.d58ce3ab.js";import{dayjs as h}from"./dayjs.58d8c02b.js";import{l as q,_ as y,A as m,an as w,bi as f,B as R,d as E,bI as N,ao as b,D as C,ab as P,H as $,cx as D}from"./index.bf0c7c2b.js";const x=async({data:e})=>{const{project:a,general:t,classifications:r,names:s,matches:n}=e;if(n)return{data:await _({data:e})};try{return{data:await M({data:e})}}catch(c){throw console.log(c),{message:"There was a problem submitting the hire request"}}},_=async({data:e})=>{const{matches:a,classifications:t,names:r}=e,s=a,n=t.filter(o=>o.match),c=t.filter(o=>!o.match);n.forEach(o=>{o.names=r.filter(l=>l.job.id===o.id)}),c.forEach(o=>{o.names=r.filter(l=>l.job.id===o.id)});const i=[];c.forEach(o=>{const l=v({requestData:s,job:o});i.push(l)}),n.forEach(o=>{const l=L({job:o});i.push(l)});const u=await Promise.allSettled(i);return s.classes=u.map(o=>o.value),s},M=async({data:e})=>{const{project:a,general:t,classifications:r,names:s}=e,{userData:n}=p();r.forEach(u=>{u.names=s.filter(o=>o.job.id===u.id)});const c={64:{value:t.dateNeeded},282:{value:t.restriction.value},284:{value:t.reason.value},31:{value:t.meetingLocation[3]},9:{value:t.jobNumber[3]},60:{value:t.siteContact[3]},92:{value:a[12]},6:{value:a[3]},272:{value:n[3]},281:{value:n[32]==="Project User"},14:{value:"Pending"},147:{value:2},82:{value:h()},68:{value:t.perDiem?"Yes":"No"}};return await k({fields:c,classifications:r})},k=async({fields:e,classifications:a})=>{const{data:t}=await d.upsertRecordsXML({to:"bpzpyjbuy",data:[e],fieldsToReturn:[289],formatObject:289});if(!t[0])throw{message:"Error adding request!"};const r=t[0][289],s=[];a.forEach(c=>{const i=v({requestData:r,job:c});s.push(i)});const n=await Promise.allSettled(s);return r.classes=n.map(c=>c.value),r},L=async({job:e})=>{let a=0;a=e.match[18]+e.qty,a=a>e.names.length?a:e.names.length;const t={3:{value:e.match[3]},18:{value:a}},{data:r}=await d.upsertRecordsXML({to:"bpzpyqcu4",data:[t],fieldsToReturn:[250],formatObject:250});if(!r[0])throw{message:"Error updating classification!"};const s=r[0][250];if(e.names&&e.names.length>0){const n=[];e.names.forEach(i=>{const u=g({classificationData:s,name:i});n.push(u)});const c=await Promise.allSettled(n);return s.names=c.map(i=>i.value),s}else return s},v=async({requestData:e,job:a})=>{const t={6:{value:e[3]},9:{value:a.classification[3]},17:{value:"Pending"},18:{value:a.qty},23:{value:a.rate},238:{value:a.id}},{data:r}=await d.upsertRecordsXML({to:"bpzpyqcu4",data:[t],fieldsToReturn:[250],formatObject:250});if(!r[0])throw{message:"Error adding classification!"};const s=r[0][250];if(a.names&&a.names.length>0){const n=[];a.names.forEach(i=>{const u=g({classificationData:s,name:i});n.push(u)});const c=await Promise.allSettled(n);return s.names=c.map(i=>i.value),s}else return s},g=async({classificationData:e,name:a})=>{const{userData:t}=p(),r={6:{value:a.firstName},7:{value:a.lastName},8:{value:a.phoneNumber},19:{value:h()},16:{value:a.ssn},10:{value:"Has Not Arrived"},14:{value:`${t[35]} ${t[37]}`},17:{value:e[3]}},{data:s}=await d.upsertRecordsXML({to:"bsg4yb4wa",data:[r],fieldsToReturn:[40],formatObject:40});if(!s[0])throw{message:"Error adding name!"};return s[0][40]},H=async({job:e,matches:a})=>{const{classification:t,rate:r}=e,s=e.match?null:a.classes.find(n=>n[9]===t[3]&&n[23]===r);return s&&(e.match=s),e},I=async({id:e,qty:a})=>{const t={3:{value:e},18:{value:a}},{data:r}=await d.upsertRecordsXML({to:"bpzpyqcu4",data:[t],fieldsToReturn:[220],formatObject:220});return r[0][220]},S=q({name:"PayRateV2"}),T={key:0,class:"text-right"},V={class:"text-caption"};function z(e,a,t,r,s,n){return m(),w(D,$(e.$attrs,{"bottom-slots":""}),{append:f(()=>[e.$attrs.job&&e.$attrs.job.hasFixedRate&&!e.$can("manage","rates")?(m(),R("div",T,[E(N,{name:"lock",size:"sm"})])):b("",!0)]),error:f(()=>[C("div",V,P(e.$attrs.errorMessage),1)]),_:1},16)}var Q=y(S,[["render",z]]);export{Q as P,v as c,H as f,x as n,I as u};
