import{Q as z}from"./QSpace.4b132439.js";import{bY as se,dw as te,c3 as ie,r as b,d9 as re,c as v,dx as ue,w as R,o as de,h,bR as L,bZ as ce,bX as Q,g as fe,cy as me,bW as be,aU as ve,B as M,C as N,d as a,bs as l,cV as ge,E as _,H as F,a9 as x,ad as $,cU as pe,cW as we,ay as T,bS as G,bQ as H}from"./index.5232afe7.js";import{Q as X}from"./QTooltip.9bbededf.js";import{Q as Z}from"./QTd.5d1ee424.js";import{Q as J}from"./QSelect.4306c154.js";import{Q as he}from"./QList.99d4c070.js";import{Q as _e}from"./QBtnGroup.385863d6.js";import{Q as Se}from"./QMenu.478f57e8.js";import{u as ye}from"./use-quasar.30e2351a.js";import{e as Be}from"./export-file.dc78ba05.js";import{u as Ce,c as xe,b as Qe,q as K}from"./app.062f4def.js";import{dayjs as ke}from"./dayjs.2bff5ac3.js";import{_ as qe}from"./hiringTabs.0acf8ede.js";import{_ as De}from"./officeSelector.0dd519b5.js";import{_ as Ve}from"./aTable.c29657ce.js";import{u as ee}from"./useQuerySaver.d29ff9ee.js";import"./api.84dea7bc.js";import{l as Pe}from"./socketListener.d081167d.js";import"./position-engine.8e7d05ef.js";import"./selection.45123347.js";import"./QChip.ee987a92.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.74051d05.js";import"./index.04bc0a32.js";import"./i18n.f53252d6.js";import"./QBadge.84f8b815.js";import"./QRouteTab.757ddfa3.js";import"./QTabs.644694c1.js";import"./QResizeObserver.2a509e99.js";import"./QTable.6be9dbf0.js";import"./QMarkupTable.2d16af9f.js";import"./use-fullscreen.ef7e4a1b.js";const Ae=Object.keys(te),Ie=e=>Ae.reduce((r,u)=>{const f=e[u];return f!==void 0&&(r[u]=f),r},{});var $e=se({name:"QBtnDropdown",props:{...te,...ie,modelValue:Boolean,split:Boolean,dropdownIcon:String,contentClass:[Array,String,Object],contentStyle:[Array,String,Object],cover:Boolean,persistent:Boolean,noRouteDismiss:Boolean,autoClose:Boolean,menuAnchor:{type:String,default:"bottom end"},menuSelf:{type:String,default:"top end"},menuOffset:Array,disableMainBtn:Boolean,disableDropdown:Boolean,noIconAnimation:Boolean,toggleAriaLabel:String},emits:["update:modelValue","click","beforeShow","show","beforeHide","hide"],setup(e,{slots:r,emit:u}){const{proxy:f}=fe(),g=b(e.modelValue),d=b(null),k=re(),q=v(()=>{const t={"aria-expanded":g.value===!0?"true":"false","aria-haspopup":"true","aria-controls":k.value,"aria-label":e.toggleAriaLabel||f.$q.lang.label[g.value===!0?"collapse":"expand"](e.label)};return(e.disable===!0||e.split===!1&&e.disableMainBtn===!0||e.disableDropdown===!0)&&(t["aria-disabled"]="true"),t}),j=v(()=>"q-btn-dropdown__arrow"+(g.value===!0&&e.noIconAnimation===!1?" rotate-180":"")+(e.split===!1?" q-btn-dropdown__arrow-container":"")),S=v(()=>ue(e)),p=v(()=>Ie(e));R(()=>e.modelValue,t=>{d.value!==null&&d.value[t?"show":"hide"]()}),R(()=>e.split,C);function m(t){g.value=!0,u("beforeShow",t)}function D(t){u("show",t),u("update:modelValue",!0)}function c(t){g.value=!1,u("beforeHide",t)}function y(t){u("hide",t),u("update:modelValue",!1)}function V(t){u("click",t)}function B(t){me(t),C(),u("click",t)}function P(t){d.value!==null&&d.value.toggle(t)}function A(t){d.value!==null&&d.value.show(t)}function C(t){d.value!==null&&d.value.hide(t)}return Object.assign(f,{show:A,hide:C,toggle:P}),de(()=>{e.modelValue===!0&&A()}),()=>{const t=[h(L,{class:j.value,name:e.dropdownIcon||f.$q.iconSet.arrow.dropdown})];return e.disableDropdown!==!0&&t.push(h(Se,{ref:d,id:k.value,class:e.contentClass,style:e.contentStyle,cover:e.cover,fit:!0,persistent:e.persistent,noRouteDismiss:e.noRouteDismiss,autoClose:e.autoClose,anchor:e.menuAnchor,self:e.menuSelf,offset:e.menuOffset,separateClosePopup:!0,transitionShow:e.transitionShow,transitionHide:e.transitionHide,transitionDuration:e.transitionDuration,onBeforeShow:m,onShow:D,onBeforeHide:c,onHide:y},r.default)),e.split===!1?h(Q,{class:"q-btn-dropdown q-btn-dropdown--simple",...p.value,...q.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:V},{default:()=>ce(r.label,[]).concat(t),loading:r.loading}):h(_e,{class:"q-btn-dropdown q-btn-dropdown--split no-wrap q-btn-item",rounded:e.rounded,square:e.square,...S.value,glossy:e.glossy,stretch:e.stretch},()=>[h(Q,{class:"q-btn-dropdown--current",...p.value,disable:e.disable===!0||e.disableMainBtn===!0,noWrap:!0,round:!1,onClick:B},{default:r.label,loading:r.loading}),h(Q,{class:"q-btn-dropdown__arrow-container q-anchor--skip",...q.value,...S.value,disable:e.disable===!0||e.disableDropdown===!0,rounded:e.rounded,color:e.color,textColor:e.textColor,dense:e.dense,size:e.size,padding:e.padding,ripple:e.ripple},()=>t)])}}});const Te={class:"q-pa-md"},He={class:"row items-center"},Le={class:"col-12 col-md-5 q-px-sm"},je={class:"col-12 col-md-3 q-px-sm"},Oe={class:"col-12 col-md-5 q-px-sm"},Me={key:0},Ne={key:1},St={__name:"index",setup(e){const r=ye(),{notificationService:u}=Pe,{userOffices:f,getUser:g}=Ce(),d=xe(),{openWindow:k}=Qe(),{fetchProfiles:q,fetchAllProfiles:j,setProfiles:S}=d,{getProfiles:p,getSelectedOffice:m,getLoadingState:D}=be(d),c=b(m.value?m.value[8]:null),y=b("Profiles"),V=b("profiles"),B=b(""),P=b({sortBy:"1",descending:!1,rowsPerPage:150}),A=async o=>{const{data:n}=await K.fetchFromHiringApp({fields:[ee({type:"profiles",useQuery:{id:o}})]});return{id:o,data:n}},C=async o=>{if(o||p.value().length===0)if(c.value){const{data:n}=await K.fetchFromHiringApp({fields:[ee({type:"profiles",useQuery:{id:c.value}})]});console.log(n),S({selectedId:c.value,data:n})}else{const n=[];f().forEach(w=>{const ne=A(w[8]);n.push(ne)});const Y=(await Promise.allSettled(n)).map(w=>w.value);console.log(Y),Y.forEach(w=>{S({selectedId:w.id,data:w.data})})}else return p.value(c.value)},t=o=>{c.value?q({selectedId:c.value,refresh:o}):j({can:"read",refresh:o})};t(),R(m,()=>{c.value=m.value?m.value[8]:null,t()});const ae=b(new Date),oe=setInterval(()=>{ae.value=new Date},1e3);ve(()=>{clearInterval(oe)});const le=v(()=>["index","submissionTime","name","phoneNumber","craft","latestScore","employmentStatus","action",...m.value?[]:["office"]]),O=v(()=>[{name:"index",align:"left",label:"#",sortable:!1},{name:"submissionTime",align:"left",label:"Time",field:"78",sortable:!1},{name:"name",align:"left",label:"Name",field:"24",sortable:!1},{name:"phoneNumber",align:"center",label:"Phone Number",field:"25",sortable:!1},{name:"craft",align:"center",label:"Craft",field:"52",sortable:!1},{name:"latestScore",align:"center",label:"Latest Score",field:"155",sortable:!1},{name:"employmentStatus",align:"center",label:"Employment Status",field:"56",sortable:!1},{name:"office",align:"center",label:"Office",field:"191",sortable:!1},{name:"action",align:"center",label:"",sortable:!1}]),I=v(()=>p.value(c.value).filter(o=>!0).sort((o,n)=>P.value.descending?o[1].isBefore(n[1]):o[1].isAfter(n[1]))),U=(o,n,s)=>{let i=n!==void 0?n(o,s):o;return i=i==null?"":String(i),i=i.split('"').join('""'),`"${i}"`},E=o=>{k(null,{url:`https://elitehcms.quickbase.com/db/bs7qsu6wh?a=dbpage&pageID=6&ee=${o[3]}`,name:"View Profile"})},W=()=>{const o=[O.value.map(s=>U(s.label))].concat(I.value.map(s=>O.value.map(i=>U(typeof i.field=="function"?i.field(s):s[i.field===void 0?i.name:i.field],i.format,s)).join(","))).join(`\r
`);Be(`${y.value} ${ke().format("MM.DD.YYYY")}.csv`,o,"text/csv")!==!0&&r.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})};return u.on("created",({officeId:o,title:n})=>{n==="profilesUpdated"&&o&&t(!0)}),(o,n)=>(M(),N("div",Te,[a(qe),a(pe,{flat:"",class:"q-pt-none"},{default:l(()=>[a(ge,null,{default:l(()=>[_("div",He,[_("div",Le,[_("div",{class:F(["text-dark",x(r).screen.lt.md?"text-body1":"text-h5"])},$(y.value),3)]),a(z),_("div",je,[a(De,{styleSelection:!0})])])]),_:1})]),_:1}),a(Ve,{rows:I.value,columns:O.value,pagination:P.value,filter:B.value,title:y.value,separator:"vertical","row-key":"3",loading:x(D)(V.value),"visible-columns":le.value,downloadButton:!0,onDownload:W},{top:l(()=>[_("div",Oe,[a(we,{dense:x(r).screen.lt.md,modelValue:B.value,"onUpdate:modelValue":n[0]||(n[0]=s=>B.value=s),label:"Search...",clearable:""},{prepend:l(()=>[a(L,{name:"search"})]),_:1},8,["dense","modelValue"])]),a(z),_("div",{class:F(["text-dark text-caption text-italic",x(r).screen.lt.md?"offset-xs-5":""])},"(Total: "+$(I.value.length)+")",3),a(Q,{flat:"",round:"",color:"primary",icon:"download",disable:I.value.length<1,onClick:W},{default:l(()=>[a(X,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:l(()=>[T(" Download ")]),_:1})]),_:1},8,["disable"]),a(Q,{flat:"",round:"",color:"primary",icon:"refresh",onClick:n[1]||(n[1]=s=>C(!0)),loading:x(D)(V.value)},{default:l(()=>[a(X,{class:"bg-accent text-black shadow-4",offset:[10,10]},{default:l(()=>[T(" Refresh ")]),_:1})]),_:1},8,["loading"])]),"body-cell-submissionTime":l(s=>[a(Z,{props:s},{default:l(()=>[o.$dayjs(s.value).isValid()?(M(),N("div",Me,$(s.value.format("L LT")),1)):(M(),N("div",Ne,$(s.row[1].format("L LT")),1))]),_:2},1032,["props"])]),"body-cell-action":l(s=>[a(Z,{props:s},{default:l(()=>[a($e,{split:"",color:"primary",label:"View Profile","menu-anchor":"bottom right",onClick:i=>E(s.row),size:".75rem"},{default:l(()=>[a(he,{class:"text-primary",separator:"",bordered:""},{default:l(()=>[a(G,{clickable:"",onClick:i=>E(s.row)},{default:l(()=>[a(H,{avatar:""},{default:l(()=>[a(L,{name:"person"})]),_:1}),a(H,null,{default:l(()=>[a(J,null,{default:l(()=>[T("CEM View Profile")]),_:1})]),_:1})]),_:2},1032,["onClick"]),a(G,{clickable:"",to:{name:"ee-hiring",params:{id:s.row[3]}}},{default:l(()=>[a(H,{avatar:""},{default:l(()=>[a(L,{name:"badge"})]),_:1}),a(H,null,{default:l(()=>[a(J,null,{default:l(()=>[T("Full Employee")]),_:1})]),_:1})]),_:2},1032,["to"])]),_:2},1024)]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","pagination","filter","title","loading","visible-columns"])]))}};export{St as default};
