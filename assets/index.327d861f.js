import{bX as ce,r as D,c as T,d1 as de,aQ as fe,ct as me,h as O,g as ve,bW as g,a5 as pe,bT as ie,A as h,B as S,d as l,br as r,D as p,E as G,cS as B,G as Z,a8 as x,cT as q,ax as w,ac as V,aq as U,cU as E,bO as ee,bS as be,F as ae,b4 as te,bR as ge,bP as le,bQ as ye,cV as J,cy as K,dn as we,bt as _e,_ as he,bV as De,b5 as oe}from"./index.43f38233.js";import{Q as re,a as ke}from"./QSelect.6415da62.js";import{Q as Ce}from"./QPage.535c5ad9.js";import{u as ue}from"./use-quasar.bddc3f3b.js";import{H as ne,I as xe,q as I}from"./app.793ed19f.js";import{dayjs as _}from"./dayjs.bf5f86cb.js";import{u as Ae}from"./dataStore.1b0f38c1.js";import{Q as N}from"./QTooltip.7f664dad.js";import{Q as Me}from"./QMenu.7817539c.js";import{Q as Ye}from"./QList.42f39c51.js";import{Q as $e}from"./QTd.f4136fd0.js";import{Q as Se}from"./QTr.ea685c07.js";import{Q as Ve}from"./QInnerLoading.43bb3898.js";import{a as qe}from"./QTable.50181827.js";import{C as Qe}from"./ClosePopup.131f3d1a.js";import"./arrivalDate.f8bc4fef.js";import{_ as je}from"./projectSelector.da11bd41.js";import"./QChip.15719b5d.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.8d948119.js";import"./api.a832941b.js";import"./index.04bc0a32.js";import"./i18n.310885c6.js";import"./useQuerySaver.d29ff9ee.js";import"./position-engine.4649d7f5.js";import"./selection.9a6fa029.js";import"./QMarkupTable.536d8a9a.js";import"./use-fullscreen.c8381895.js";import"./QForm.2dd906d6.js";import"./vee-validate.esm.b0681a66.js";import"./array.7acd2339.js";function L(o,s=new WeakMap){if(Object(o)!==o)return o;if(s.has(o))return s.get(o);const u=o instanceof Date?new Date(o):o instanceof RegExp?new RegExp(o.source,o.flags):o instanceof Set?new Set:o instanceof Map?new Map:typeof o.constructor!="function"?Object.create(null):o.prototype!==void 0&&typeof o.prototype.constructor=="function"?o:new o.constructor;if(typeof o.constructor=="function"&&typeof o.valueOf=="function"){const n=o.valueOf();if(Object(n)!==n){const y=new o.constructor(n);return s.set(o,y),y}}return s.set(o,u),o instanceof Set?o.forEach(n=>{u.add(L(n,s))}):o instanceof Map&&o.forEach((n,y)=>{u.set(y,L(n,s))}),Object.assign(u,...Object.keys(o).map(n=>({[n]:L(o[n],s)})))}var se=ce({name:"QPopupEdit",props:{modelValue:{required:!0},title:String,buttons:Boolean,labelSet:String,labelCancel:String,color:{type:String,default:"primary"},validate:{type:Function,default:()=>!0},autoSave:Boolean,cover:{type:Boolean,default:!0},disable:Boolean},emits:["update:modelValue","save","cancel","beforeShow","show","beforeHide","hide"],setup(o,{slots:s,emit:u}){const{proxy:n}=ve(),{$q:y}=n,v=D(null),f=D(""),i=D("");let d=!1;const A=T(()=>de({initialValue:f.value,validate:o.validate,set:k,cancel:c,updatePosition:M},"value",()=>i.value,b=>{i.value=b}));function k(){o.validate(i.value)!==!1&&(Y()===!0&&(u("save",i.value,f.value),u("update:modelValue",i.value)),j())}function c(){Y()===!0&&u("cancel",i.value,f.value),j()}function M(){fe(()=>{v.value.updatePosition()})}function Y(){return me(i.value,f.value)===!1}function j(){d=!0,v.value.hide()}function R(){d=!1,f.value=L(o.modelValue),i.value=L(o.modelValue),u("beforeShow")}function P(){u("show")}function z(){d===!1&&Y()===!0&&(o.autoSave===!0&&o.validate(i.value)===!0?(u("save",i.value,f.value),u("update:modelValue",i.value)):u("cancel",i.value,f.value)),u("beforeHide")}function $(){u("hide")}function Q(){const b=s.default!==void 0?[].concat(s.default(A.value)):[];return o.title&&b.unshift(O("div",{class:"q-dialog__title q-mt-sm q-mb-sm"},o.title)),o.buttons===!0&&b.push(O("div",{class:"q-popup-edit__buttons row justify-center no-wrap"},[O(g,{flat:!0,color:o.color,label:o.labelCancel||y.lang.label.cancel,onClick:c}),O(g,{flat:!0,color:o.color,label:o.labelSet||y.lang.label.set,onClick:k})])),b}return Object.assign(n,{set:k,cancel:c,show(b){v.value!==null&&v.value.show(b)},hide(b){v.value!==null&&v.value.hide(b)},updatePosition:M}),()=>{if(o.disable!==!0)return O(Me,{ref:v,class:"q-popup-edit",cover:o.cover,onBeforeShow:R,onShow:P,onBeforeHide:z,onHide:$,onEscapeKey:c},Q)}}});const Re={class:"q-px-sm"},Pe={key:0,class:"float-right q-card__actions--horiz"},Ie={key:1,class:"float-right q-card__actions--horiz"},Ne={key:0},Te={key:1},ze={key:2,class:"text-caption"},Fe={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Oe=p("div",{class:"text-h6"},"Arrival Date",-1),Be=p("span",{class:"q-ml-sm"},"Release as No Show!",-1),Ue=p("div",{class:"text-h6"},"Has not arrived.",-1),Ee=p("br",null,null,-1),Le={__name:"markArrivals",props:{rows:Array,selected:Array},emits:["arrivalMarked","updateArrival","arrivalRelease"],setup(o,{emit:s}){const u=o,{rows:n,selected:y}=pe(u),v=ue();ie();const f=D(_().format("YYYY-MM-DD")),i=D(!1),d=D(!1),A=D(!1),k=D(!1),c=D(null),M=D(0),Y=T(()=>v.screen.gt.sm?[{name:207,label:"Arrival Date",align:"left",field:219,format:e=>`${e&&e.$d&&e.$d.format?e.$d.format("MM/DD/YYYY"):""}`,sortable:!0,style:"text-align: center !important;"},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${ne.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,t)=>t[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]:[{name:227,label:"Arrival Date",align:"left",field:219,format:e=>`${e&&e.$d&&e.$d.format?e.$d.format("MM/DD/YYYY"):""}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${ne.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0},{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,t)=>t[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0}]),j=({rows:e,added:t,evt:a})=>{i.value=!0,s("arrivalMarked",{record:e[0],added:t}),setTimeout(function(){i.value=!1},1500)},R=e=>{i.value=!0,s("arrivalMarked",{record:c.value,added:e}),e?d.value=!1:k.value=!1,setTimeout(function(){i.value=!1},1500)},P=e=>{c.value=e,c.value[227]=f.value,d.value=!0},z=()=>{c.value=null,d.value=!1},$=e=>{c.value=e,k.value=!0},Q=()=>{c.value=null,k.value=!1},b=e=>{c.value=e,A.value=!0},W=()=>{s("arrivalRelease",{record:c.value,added:!0})},H=e=>{e.target.showPicker()},X=async(e,t)=>{t[219]=_(e),M.value+=1,s("updateArrivalDate",{record:t,value:e})};return(e,t)=>(h(),S("div",Re,[l(qe,{dense:"",columns:Y.value,rows:x(n),"row-key":a=>a[3],class:"q-pa-sm",pagination:{rowsPerPage:x(v).screen.gt.sm?25:100},separator:"vertical",onSelection:j,selected:x(y),"table-header-class":"bg-dark text-white","no-data-label":"There are no expected arrivals",loading:i.value,grid:x(v).screen.lt.md},{item:r(a=>[p("div",{class:"q-pa-xs col-xs-12 col-sm-6 col-md-4 col-lg-3 grid-style-transition",style:G(a.selected?"transform: scale(0.95);":"")},[l(B,{bordered:"",flat:"",class:Z(a.selected?x(v).dark.isActive?"bg-grey-9":"bg-grey-2":"")},{default:r(()=>[l(q,null,{default:r(()=>[w(V(a.row[31])+" ",1),a.row[20]!=="Complete"||!a.row[207]?(h(),S("span",Pe,[l(g,{round:"",color:"positive",icon:"done",size:"xs",onClick:m=>P(a.row)},{default:r(()=>[l(N,{class:"bg-primary"},{default:r(()=>[w("Arrived")]),_:1})]),_:2},1032,["onClick"]),l(g,{round:"",color:"negative",icon:"close",size:"xs",onClick:m=>b(a.row)},{default:r(()=>[l(N,{class:"bg-primary"},{default:r(()=>[w("No Show")]),_:1})]),_:2},1032,["onClick"])])):(h(),S("span",Ie,[w(V(x(_)(a.row[219]).format("MM/DD/YYYY"))+" ",1),l(g,{icon:"edit",color:"accent",flat:"",size:"xs",class:"q-px-none q-pr-xs"}),(h(),U(se,{key:M.value,"model-value":x(_)(a.row[219]).format("YYYY-MM-DD"),title:"Arrival Date"},{default:r(m=>[l(E,{autofocus:"",onFocus:t[0]||(t[0]=C=>H(C)),dense:"","model-value":m.value,type:"date",max:f.value,rules:[C=>!!C||"Field is required"],"onUpdate:modelValue":C=>X(C,a.row)},null,8,["model-value","max","rules","onUpdate:modelValue"])]),_:2},1032,["model-value"])),l(g,{round:"",color:"white",icon:"history",size:"xs",onClick:ee(m=>$(a.row),["stop"])},{default:r(()=>[l(N,{class:"bg-primary"},{default:r(()=>[w("Revert Back - Has not arrived yet.")]),_:1})]),_:2},1032,["onClick"])]))]),_:2},1024),l(be),l(Ye,{dense:""},{default:r(()=>[(h(!0),S(ae,null,te(a.cols.filter(m=>m.name!=="action"),m=>(h(),U(ge,{key:m.name},{default:r(()=>[l(le,null,{default:r(()=>[l(re,null,{default:r(()=>[w(V(m.label),1)]),_:2},1024)]),_:2},1024),l(le,{side:""},{default:r(()=>[l(re,{caption:""},{default:r(()=>[w(V(m.value),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["class"])],4)]),body:r(a=>[l(Se,{"no-hover":"",props:a,class:Z(a.row[33]&&a.row[33].$d&&e.$dayjs().businessDiff(e.$dayjs(a.row[33].$d),"day",!0)>5&&a.row[20]!=="Complete"?"bg-red-11":"")},{default:r(()=>[(h(!0),S(ae,null,te(a.cols,m=>(h(),U($e,{key:m.name,props:a,classes:m.name===207&&a.row[20]!=="Complete"||!a.row[207]?"q-card__actions--horiz":"",style:G(m.style)},{default:r(()=>[m.name===207&&(a.row[20]!=="Complete"||!a.row[207])?(h(),S("span",Ne,[l(g,{round:"",color:"positive",icon:"done",size:"xs",onClick:C=>P(a.row)},{default:r(()=>[l(N,{class:"bg-primary"},{default:r(()=>[w("Arrived")]),_:1})]),_:2},1032,["onClick"]),l(g,{round:"",color:"negative",icon:"close",size:"xs",onClick:C=>b(a.row)},{default:r(()=>[l(N,{class:"bg-primary"},{default:r(()=>[w("No Show")]),_:1})]),_:2},1032,["onClick"])])):m.name===207?(h(),S("span",Te,[w(V(x(_)(a.row[219]).format("MM/DD/YYYY"))+" ",1),(h(),U(se,{key:M.value,"model-value":x(_)(a.row[219]).format("YYYY-MM-DD"),title:"Arrival Date"},{default:r(C=>[l(E,{autofocus:"",onFocus:t[1]||(t[1]=F=>H(F)),dense:"","model-value":C.value,type:"date",max:f.value,rules:[F=>!!F||"Field is required"],"onUpdate:modelValue":F=>X(F,a.row)},null,8,["model-value","max","rules","onUpdate:modelValue"])]),_:2},1032,["model-value"])),l(g,{round:"",color:"negative",icon:"history",size:"xs",onClick:ee(C=>$(a.row),["stop"])},{default:r(()=>[l(N,{class:"bg-primary"},{default:r(()=>[w("Revert Back - Has not arrived yet.")]),_:1})]),_:2},1032,["onClick"])])):(h(),S("span",ze,V(m.value),1))]),_:2},1032,["props","classes","style"]))),128))]),_:2},1032,["props","class"])]),"no-data":r(({message:a})=>[p("div",Fe,[l(ye,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),p("span",null,V(a),1)])]),loading:r(()=>[l(Ve,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","selected","loading","grid"]),l(K,{modelValue:d.value,"onUpdate:modelValue":t[5]||(t[5]=a=>d.value=a),persistent:""},{default:r(()=>[l(B,{style:{"min-width":"350px"}},{default:r(()=>[l(q,null,{default:r(()=>[Oe]),_:1}),l(q,{class:"q-pt-none"},{default:r(()=>[l(E,{dense:"",modelValue:c.value[227],"onUpdate:modelValue":t[2]||(t[2]=a=>c.value[227]=a),autofocus:"",type:"date",max:f.value,rules:[a=>!!a||"Field is required"]},null,8,["modelValue","max","rules"])]),_:1}),l(J,{align:"right",class:"text-primary"},{default:r(()=>[l(g,{flat:"",label:"Cancel",onClick:t[3]||(t[3]=a=>z())}),l(g,{flat:"",label:"Confirm",onClick:t[4]||(t[4]=a=>R(!0))})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:A.value,"onUpdate:modelValue":t[7]||(t[7]=a=>A.value=a),persistent:""},{default:r(()=>[l(B,null,{default:r(()=>[l(q,{class:"row items-center"},{default:r(()=>[l(we,{icon:"person_remove",color:"primary","text-color":"white"}),Be]),_:1}),l(J,{align:"right"},{default:r(()=>[_e(l(g,{flat:"",label:"Cancel",color:"primary"},null,512),[[Qe]]),l(g,{flat:"",label:"Release",color:"primary",onClick:t[6]||(t[6]=a=>W())})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:k.value,"onUpdate:modelValue":t[10]||(t[10]=a=>k.value=a),persistent:""},{default:r(()=>[l(B,{style:{"min-width":"350px"}},{default:r(()=>[l(q,null,{default:r(()=>[Ue]),_:1}),l(q,{class:"q-pt-none"},{default:r(()=>[w(" You are about to erase the arrival date."),Ee,w(" Are you sure you want to do this? ")]),_:1}),l(J,{align:"right",class:"text-primary"},{default:r(()=>[l(g,{label:"No",onClick:t[8]||(t[8]=a=>Q())}),l(g,{flat:"",label:"Yes",onClick:t[9]||(t[9]=a=>R(!1))})]),_:1})]),_:1})]),_:1},8,["modelValue"])]))}},He={name:"Arrivals",components:{MarkArrivalsTable:Le,projectSelector:je},setup(){const o=ue(),s=xe(),u=ie(),n=D(null),y=D(""),v=D(""),{getSelectedProject:f}=De(s),{fetchAllDeployments:i,updateDeployment:d,getDeployments:A,fetchDeployments:k}=Ae(),c=T(()=>f.value?f.value[3]:null),M=T(()=>A(c.value).filter(e=>e[20]==="Complete")),Y=T(()=>{let e=[];return A(c.value).forEach(t=>{t[31].toLowerCase().includes(v.value.toLowerCase())&&e.push(t)}),e=y.value?e.filter(t=>_(t[33].$d).tz("America/Chicago").format("MM/DD/YYYY")===_(y.value).tz("America/Chicago").format("MM/DD/YYYY")):e,e=n.value?e.filter(t=>t[132]===n.value):e,e.sort((t,a)=>t[219]-a[219]||t[33]-a[33])}),j=T(()=>[...new Map(Y.value.map(e=>[e[132],e[132]])).values()]);async function R(e){o.loading.show(),c.value?await k({projectId:c.value,refresh:e}):await i({refresh:e}),o.loading.hide()}async function P({record:e,added:t}){if(t){await z(e),await $({id:e[21],status:7});const a=await Q(e[3],"Complete");d({projectId:a[134],key:a[3],record:a})}else{await b(e),await $({id:e[21],status:6});const a=await Q(e[3],"In Process");d({projectId:a[134],key:a[3],record:a})}}async function z(e){try{const t=e[207]?_(e[207]):_(),{data:a}=await I.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:e[3]},13:{value:e[15]},18:{value:e[21]},60:{value:""},125:{value:t},145:{value:t},165:{value:"Active"}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return a[0][108]}catch(t){throw{message:"Cannot add assignment",error:t}}}async function $({id:e,status:t}){try{const{data:a}=await I.upsertRecordsXML({to:"bp3gb7ng2",data:[{3:{value:e},79:{value:t}}],fieldsToReturn:[3]});return a[0][3]}catch(a){throw{message:"Cannot edit employee",error:a}}}async function Q(e,t){try{const{data:a}=await I.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:e},20:{value:t},22:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return a[0][204]}catch(a){throw{message:"Cannot edit deployment",error:a}}}async function b(e){try{const{data:t}=await I.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:e.assignment[3]},22:{value:new Date},21:{value:"Canceled"},19:{value:""},60:{value:""},165:{value:"Inactive"}}],fieldsToReturn:[108],formatObject:108});return t[0][108]}catch(t){throw{message:"Cannot cancel assignment",error:t}}}async function W(e){try{const t=e.value?_(e.value):_();if(e.record.assignment&&e.record.assignment[3]){const{data:a}=await I.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:e.record.assignment[3]},125:{value:t},145:{value:t}}],fieldsToReturn:[3]});return a[0][3]}}catch(t){throw{message:"Cannot edit Assignment",error:t}}}async function H({record:e,added:t}){if(t){const a=await X(e);u.push({name:"ee-termination",params:{id:e[21]},query:{reason:"no-show",hc:e[15],aid:a[3],did:e[3]}})}else{await b(e),await $({id:e[21],status:6});const a=await Q(e[3],"In Process");d({projectId:a[134],key:a[3],record:a})}}async function X(e){try{const t=e[207]?_(e[207]):_(),{data:a}=await I.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:e[3]},13:{value:e[15]},18:{value:e[21]},60:{value:""},21:{value:"DNC"},112:{value:!0},165:{value:"Inactive"}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return a[0][108]}catch(t){throw{message:"Cannot release assignment",error:t}}}return R(!0),{arrived:M,allDeployments:Y,arrivalMarked:P,updateArrivalDate:W,arrivalRelease:H,craftOptions:j,craftFilter:n,startDateFilter:y,search:v}}},Xe={class:"q-pt-sm"},We={class:"text-h5 text-dark"},Je={class:"text-body2 text-italic q-ml-sm"},Ke=p("div",{class:"text-subtitle2 text-accent"},"Please click on the green checkmark as employees arrive to the job site.",-1),Ge={class:"row items-center"},Ze={class:"col-12 col-md-3 q-px-sm"},ea={class:"col-12 col-md-3 q-px-sm"},aa={class:"col-12 col-md-3 q-px-sm"},ta={class:"col-12 col-md-3 q-px-sm"};function la(o,s,u,n,y,v){const f=oe("projectSelector"),i=oe("mark-arrivals-table");return h(),U(Ce,{style:{"max-width":"100vw"}},{default:r(()=>[p("div",Xe,[l(B,{flat:""},{default:r(()=>[l(q,{class:"q-pb-none"},{default:r(()=>[p("div",We,[w(" Expected Arrivals "),p("span",Je,"("+V(n.allDeployments.length)+" total)",1)]),Ke]),_:1}),l(q,null,{default:r(()=>[p("div",Ge,[p("div",Ze,[l(f,{dense:""})]),p("div",ea,[l(E,{dense:"",modelValue:n.search,"onUpdate:modelValue":s[0]||(s[0]=d=>n.search=d),label:"Search"},null,8,["modelValue"])]),p("div",aa,[l(E,{dense:"",modelValue:n.startDateFilter,"onUpdate:modelValue":s[1]||(s[1]=d=>n.startDateFilter=d),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),p("div",ta,[l(ke,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:n.craftFilter,"onUpdate:modelValue":s[2]||(s[2]=d=>n.craftFilter=d),options:n.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),l(i,{rows:n.allDeployments,selected:n.arrived,onArrivalRelease:n.arrivalRelease,onArrivalMarked:n.arrivalMarked,onUpdateArrivalDate:n.updateArrivalDate},null,8,["rows","selected","onArrivalRelease","onArrivalMarked","onUpdateArrivalDate"])])]),_:1})}var Pa=he(He,[["render",la]]);export{Pa as default};
