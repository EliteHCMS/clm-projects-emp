import{h as S,bX as se,db as oe,dc as re,l as N,r as V,c as y,_ as F,A as c,aq as D,br as v,B as C,F as q,b4 as U,ax as K,ac as P,bQ as M,ar as Q,b5 as E,d as b,D as w,y as H,G as ne,b1 as le,a$ as ie,bV as B,w as ce,cS as ue,cT as de,cU as me}from"./index.c7640e72.js";import{a as pe}from"./QSelect.fadf4533.js";import{Q as X,a as fe,b as G}from"./QTabPanels.cee75858.js";import{Q as ye}from"./QTabs.ae541ee5.js";import{Q as ge}from"./QToolbar.149ad01d.js";import{Q as he}from"./QPage.b5011f60.js";import{u as ve}from"./use-quasar.0751f5b6.js";import{P as be,q as z,I as we,u as _e}from"./app.8f08130a.js";import{dayjs as T}from"./dayjs.3faf0a5e.js";import{u as Y}from"./dataStore.c8ea7188.js";import{u as R}from"./dataStore.a1b994da.js";import{a as J}from"./QTable.14b74a88.js";import{a as W}from"./useQuerySaver.d29ff9ee.js";import{Q as L}from"./QTd.628abedc.js";import{Q as Z}from"./QTr.28969074.js";import{_ as $e}from"./projectSelector.ca9b647a.js";import"./QChip.7653060e.js";import"./QMenu.39482be3.js";import"./position-engine.4d6bc0f8.js";import"./selection.8a1f3691.js";import"./rtl.b51694b1.js";import"./use-panel.66d06a3e.js";import"./touch.70a9dd44.js";import"./QResizeObserver.6f4084ce.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.cb436dbd.js";import"./api.d1dfc8c4.js";import"./index.04bc0a32.js";import"./i18n.911c9472.js";import"./QList.e7f97b0e.js";import"./QMarkupTable.df0b9b28.js";import"./use-fullscreen.32fe6529.js";const Ce=[S("defs",[S("linearGradient",{x1:"8.042%",y1:"0%",x2:"65.682%",y2:"23.865%",id:"a"},[S("stop",{"stop-color":"currentColor","stop-opacity":"0",offset:"0%"}),S("stop",{"stop-color":"currentColor","stop-opacity":".631",offset:"63.146%"}),S("stop",{"stop-color":"currentColor",offset:"100%"})])]),S("g",{transform:"translate(1 1)",fill:"none","fill-rule":"evenodd"},[S("path",{d:"M36 18c0-9.94-8.06-18-18-18",stroke:"url(#a)","stroke-width":"2"},[S("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.9s",repeatCount:"indefinite"})]),S("circle",{fill:"currentColor",cx:"36",cy:"18",r:"1"},[S("animateTransform",{attributeName:"transform",type:"rotate",from:"0 18 18",to:"360 18 18",dur:"0.9s",repeatCount:"indefinite"})])])];var je=se({name:"QSpinnerTail",props:oe,setup(e){const{cSize:t,classes:r}=re(e);return()=>S("svg",{class:r.value,width:t.value,height:t.value,viewBox:"0 0 38 38",xmlns:"http://www.w3.org/2000/svg"},Ce)}});const ke=({assignment:e,employee:t,project:r})=>{const u=t[556]&&t[556][1].$d?t[556][1].$d:null;if(u?T(u).isSameOrAfter(T().subtract(T.duration({days:2})),"day"):!1){const{setDisaStatusChecks:f}=Y(),{setDisaStatus:s}=R();f({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:t[556][10]}),s({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:t[556]})}else ee({assignment:e,employee:t,project:r})},ee=async({assignment:e,employee:t,project:r})=>new Promise((u,i)=>{const f={ownerId:r[322],socialSecurityNumbers:[t[188]]};be.justChecking(f).then(async s=>{const a=s.results?s.results[0]:null;a&&(a.dateChecked=T(),r[321][36]&&a.dccStatus==="ACTIVE"||a.dccStatus==="ACTIVE"?a.ownerStatus="Active":a.ownerStatus="Inactive");const{data:l}=await z.upsertRecordsXML({to:"bsfjg3kz9",data:[{6:{value:t[3]},10:{value:JSON.stringify(a)}}],fieldsToReturn:[15],formatObject:15}),{setDisaStatusChecks:m}=Y(),{setDisaStatus:g}=R();m({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:l[0][15][10]}),g({id:t[3],assignmentId:e?e[3]:null,projectId:r[3],data:l[0][15]}),u(l[0][15])}).catch(s=>{console.log(s),i(s)})}),Se=async({roster:e,project:t})=>{const r=[];e.forEach(async i=>{const f=new Promise((s,a)=>{const l=i.employee[556]&&i.employee[556][1].$d?i.employee[556][1].$d:null;(l?T(l).isSameOrAfter(T().subtract(T.duration({days:2})),"day"):!1)?s(i.employee[556]):ee({assignment:i,employee:i.employee,project:t}).then(g=>{s(g)}).catch(g=>{a(g)})});r.push(f)}),await Promise.allSettled(r);const{setDisaReady:u}=R();u({id:t[3]})},De=N({props:{row:Object,columns:Array},setup(e){const{getMatrixInputs:t,setMatrixInputs:r}=R(),u=V(!0),i=y(()=>t(e.row.employee[3]).sort((m,g)=>m[1].$d>g[1].$d?-1:1)),f=async()=>{i.value.length===0&&r({id:e.row.employee[3],data:e.row.employee[561]}),u.value=!1},s=({col:m})=>{const g=i.value.find(n=>n[21]===m.name);return g?m.type==="date"?T(g.value,"MM-DD-YYYY").format("MM/DD/YYYY"):g.value:null},a=y(()=>e.columns.filter(g=>g.dynamic)),l=y(()=>e.columns.filter(g=>!g.dynamic));return f(),{props:e,stored:i,loading:u,calculateValue:s,dynamicColumns:a,staticColumns:l}}}),Te={key:0},Pe={key:0},Ve={key:1},xe={key:1},Ae={key:1};function Ie(e,t,r,u,i,f){return c(),D(Z,null,{default:v(()=>[e.loading?Q("",!0):(c(),C(q,{key:0},[(c(!0),C(q,null,U(e.staticColumns,s=>(c(),D(L,{key:s.name},{default:v(()=>[K(P(s.value),1)]),_:2},1024))),128)),(c(!0),C(q,null,U(e.dynamicColumns,s=>(c(),D(L,{class:"text-center",key:s.name},{default:v(()=>[s.type!=="checkbox"?(c(),C("div",Te,[e.calculateValue({col:s})?(c(),C("span",Pe,P(e.calculateValue({col:s})),1)):(c(),C("span",Ve,"-"))])):(c(),C("div",xe,[e.calculateValue({col:s})?(c(),D(M,{key:0,size:"sm",name:e.calculateValue({col:s})?"done":"check_box_outline_blank",color:e.calculateValue({col:s})?"positive":"negative"},null,8,["name","color"])):(c(),C("span",Ae,"-"))]))]),_:2},1024))),128))],64))]),_:1})}var Qe=F(De,[["render",Ie]]);const qe=N({props:{project:Number,roster:Array},components:{TrainingMatrixRow:Qe},setup(e){const{capitalize:t}=H,r=n=>{const d=n[20]!==""?t(n[20].toLowerCase().trim()):"",_=n[22]!==""?t(n[22].toLowerCase().trim()):"",j=n[21]!==""?` ${t(n[21].toLowerCase().trim())}`:"",x=n[23]!==""?` ${t(n[23])}`:"";return`${_}${x}, ${d}${j}`},u=n=>{const d=n.split(" "),_=[];return d.forEach((j,x)=>{const I=t(j);_[x]=I}),_.join(" ")},i=[{name:0,label:"Name",align:"left",field:n=>r(n.employee),format:n=>n,sortable:!0,sortOrder:"ad"}],{getMatrixColumns:f,setMatrixColumns:s}=R(),a=y(()=>f(e.project)),l=y(()=>{const n=[];return i.forEach(d=>{n.push(d)}),a.value.forEach(d=>{const _=d.default?{name:d[12],label:u(d[6]),align:"center",dynamic:!0,default:!0,type:d[8],sortable:!0}:{name:d[18],label:u(d[7]),align:"center",dynamic:!0,default:!1,type:d[13],sortable:!0};n.push(_)}),n.sort((d,_)=>d.name>_.name?1:-1)});async function m(){if(a.value.length===0&&e.project){const{data:n}=await z.fetchFromProjectsApp({fields:[W({type:"matrixColumns",query:`{'8'.EX.'false'}AND{'10'.EX.'${e.project}'}`})]}),d=await g(),_=[];n.forEach(j=>{_.push(j)}),d.forEach(j=>{_.push(j)}),s({id:e.project,data:_})}}async function g(){const{data:n}=await z.fetchFromProjectsApp({fields:[W({type:"availableMatrixColumns",query:"{'14'.EX.'true'}"})]});return n}return m(),{props:e,tableColumns:l,initialPagination:V({rowsPerPage:e.roster.length})}}}),Re={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function Me(e,t,r,u,i,f){const s=E("training-matrix-row");return c(),C("div",null,[b(J,{columns:e.tableColumns,rows:e.props.roster,"row-key":a=>a.employee[3],"title-class":e.$q.screen.gt.sm?"text-primary text-h6":"text-primary text-body1",title:"Training Matrix",class:"q-pa-sm",pagination:e.initialPagination,"onUpdate:pagination":t[0]||(t[0]=a=>e.initialPagination=a),"rows-per-page-options":[0],separator:"vertical","table-header-class":"bg-dark text-white","no-data-label":"There are no employees",grid:e.$q.screen.lt.sm,dense:""},{body:v(a=>[b(s,{columns:a.cols,row:a.row},null,8,["columns","row"])]),"no-data":v(({message:a})=>[w("div",Re,[b(M,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),w("span",null,P(a),1)])]),_:1},8,["columns","rows","row-key","title-class","pagination","grid"])])}var Ee=F(qe,[["render",Me],["__scopeId","data-v-71f7f8cd"]]);const Ne=N({props:{row:Object,columns:Array,project:Object},setup(e){const{getDisaStatusChecks:t}=Y(),r=V(!0),u=async()=>{ke({assignment:e.row,employee:e.row.employee,project:e.project}),r.value=!1},i=({col:a})=>{const l=t({id:e.row.employee[3],key:a.dataKey});return a.dataKey==="hasPendingRandom"?l?"Yes":"No":a.dataKey==="daysUntilWindowCloses"?l||"N/A":l?T(l).isValid()?T(l).format("MM/DD/YYYY"):l:null},f=y(()=>e.columns.filter(l=>l.dynamic)),s=y(()=>e.columns.filter(l=>!l.dynamic));return u(),{props:e,loading:r,calculateValue:i,dynamicColumns:f,staticColumns:s}}});function Fe(e,t,r,u,i,f){return c(),D(Z,null,{default:v(()=>[e.loading?Q("",!0):(c(),C(q,{key:0},[(c(!0),C(q,null,U(e.staticColumns,s=>(c(),D(L,{key:s.name},{default:v(()=>[K(P(s.value),1)]),_:2},1024))),128)),(c(!0),C(q,null,U(e.dynamicColumns,s=>(c(),D(L,{class:"text-center",key:s.name},{default:v(()=>[w("div",null,[w("span",null,P(e.calculateValue({col:s})||"?"),1)])]),_:2},1024))),128))],64))]),_:1})}var Oe=F(Ne,[["render",Fe]]);const Ue=N({props:{project:Object,roster:Array},components:{DisaMatrixRow:Oe},setup(e){const t=V({sortBy:null,descending:!1,page:1,rowsPerPage:25}),{capitalize:r}=H,{getProjectDisaRoster:u}=Y(),i=o=>{const h=o[20]!==""?r(o[20].toLowerCase().trim()):"",p=o[22]!==""?r(o[22].toLowerCase().trim()):"",$=o[21]!==""?` ${r(o[21].toLowerCase().trim())}`:"",A=o[23]!==""?` ${r(o[23])}`:"";return`${p}${A}, ${h}${$}`},f=o=>o.split(" ").join("_"),s=o=>{const h=o.split(" "),p=[];return h.forEach(($,A)=>{const ae=r($);p[A]=ae}),p.join(" ")},a=o=>{const h=o.toLowerCase().trim();return h.includes("dccha")||h.includes("dcceo")||h.includes("upstream")?"lastUrineTest":h.includes("dccht")?"lastHairTest":h.includes("nasap")?"lastNASAPTest":h.includes("dccof")?"lastOralFluidTest":""},l=[{name:0,label:"Name",align:"left",field:o=>i(o.employee),format:o=>o,sortable:!0,sortOrder:"ad"},{name:1,dataKey:"ownerStatus",label:"Status",align:"center",dynamic:!0},{name:2,dataKey:"hasPendingRandom",label:"On Random",align:"center",dynamic:!0},{name:3,dataKey:"daysUntilWindowCloses",label:"Days Left",align:"center",dynamic:!0}],m=y(()=>e.project[321][10].split(",")),g=y(()=>{const o=[];return l.forEach(h=>{o.push(h)}),m.value.forEach(h=>{const p={name:f(h),dataKey:a(h),label:`${s(h)} Last Test`,align:"center",dynamic:!0};o.push(p)}),e.project[321][36]&&o.push({name:"bg",label:"Background Status",dataKey:"backgrounds",align:"center",dynamic:!0},{name:"bg_exp",label:"Background Expires",dataKey:"backgroundsExpDate",align:"center",dynamic:!0}),o.sort((h,p)=>h.name>p.name?1:-1)}),n=y(()=>e.project),d=y(()=>n.value[321]),_=y(()=>d.value?decodeURI(d.value[14]):""),j=y(()=>u(n.value[3])),x=y(()=>j.value.filter(o=>o.hasPendingRandom)),I=y(()=>j.value.filter(o=>o.ownerStatus!=="Active")),k=y(()=>I.value.length===0);console.log(e.roster);const O=o=>{console.log(o),t.value=o};return{props:e,tableColumns:g,initialPagination:V({rowsPerPage:e.roster.length}),projectData:n,ownerData:d,totalRoster:j,randoms:x,notActive:I,specialRules:_,rosterCompliant:k,pageUpdated:O,pagination:t}}}),te=e=>(le("data-v-c645e706"),e=e(),ie(),e),Le={key:0},Ye=te(()=>w("span",{class:"text-positive text-body1 q-pr-md"},"Roster is in compliance.",-1)),ze={key:1},Ke={class:"text-negative text-body1 q-pr-md"},Be={class:"text-right"},Xe=te(()=>w("div",{class:"text-body1 text-info"},"Owner Special Rules",-1)),Ge={class:"text-body2 text-italic text-info"},We={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function He(e,t,r,u,i,f){const s=E("disa-matrix-row");return c(),C("div",null,[b(J,{columns:e.tableColumns,rows:e.props.roster,"row-key":a=>a.employee[3],class:"q-pa-sm sticky-header-table",pagination:e.initialPagination,"onUpdate:pagination":t[0]||(t[0]=a=>e.initialPagination=a),"rows-per-page-options":[0],separator:"vertical","table-header-class":"bg-dark text-white","no-data-label":"There are no employees",grid:e.$q.screen.lt.sm,dense:""},{"top-left":v(()=>[e.rosterCompliant?(c(),C("div",Le,[Ye,b(M,{color:"positive",name:"task_alt",size:"sm"})])):(c(),C("div",ze,[w("span",Ke,P(e.notActive.length)+" out of compliance.",1),b(M,{color:"negative",name:"error",size:"sm"})])),w("div",null,[w("div",{class:ne(["text-body2 text-italic",e.randoms.length>0?"text-negative":"text-positive"])},P(e.randoms.length)+" pending randoms",3)])]),"top-right":v(()=>[w("div",Be,[Xe,w("div",Ge,P(e.specialRules),1)])]),body:v(a=>[b(s,{columns:a.cols,row:a.row,project:e.projectData},null,8,["columns","row","project"])]),"no-data":v(({message:a})=>[w("div",We,[b(M,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),w("span",null,P(a),1)])]),_:1},8,["columns","rows","row-key","pagination","grid"])])}var Je=F(Ue,[["render",He],["__scopeId","data-v-c645e706"]]);const Ze=N({name:"Compliance",components:{MatrixTab:Ee,DisaTab:Je,projectSelector:$e},setup(){const e=ve(),t=we(),r=_e(),u=V(0),i=V(""),f=V(null),{getSelectedProject:s,getProjects:a}=B(t),{getAssignments:l,fetchAllAssignments:m,fetchAssignments:g,getDisaReady:n}=R(),{getUserType:d,getUser:_}=B(r),j=y(()=>l(k.value).sort(($,A)=>$[1].$d<A[1].$d?1:-1).filter($=>!$[112]&&$.latest&&$[102]==="Active")),x=y(()=>{let p=[];return j.value.forEach($=>{$[75].toLowerCase().includes(i.value.toLowerCase())&&p.push($)}),p=f.value?p.filter($=>$[68]===f.value):p,p.sort(($,A)=>$.employee[22]>A.employee[22]?1:-1)}),I=y(()=>[...new Map(j.value.map(p=>[p[68],p[68]])).values()]),k=y(()=>s.value?s.value[3]:null),O=y(()=>k.value?a.value({userType:d.value,selectedId:_.value[3],can:"read"}).find(p=>p[3]===k.value)[322]!==null:!1),o=y(()=>k.value?a.value({userType:d.value,selectedId:_.value[3],can:"read"}).find(p=>p[3]===k.value):null);async function h(){e.loading.show(),k.value?(await g({projectId:k.value}),O.value&&Se({roster:j.value,project:o.value})):await m(),e.loading.hide()}return ce(k,(p,$)=>{h()}),{tab:u,projectFilterValue:k,search:i,isDisaProject:O,project:o,rows:x,craftOptions:I,craftFilter:f,getDisaReady:n}}}),et={class:"q-pa-md"},tt={class:"row items-center"},at={class:"col-12 col-md-3"},st={class:"col-12 col-md-3 q-px-sm"},ot={class:"col-12 col-md-3 q-px-sm"},rt={key:0};function nt(e,t,r,u,i,f){const s=E("projectSelector"),a=E("matrix-tab"),l=E("disa-tab");return c(),D(he,{style:{"max-width":"100vw"}},{default:v(()=>[w("div",et,[b(ue,{flat:""},{default:v(()=>[b(de,null,{default:v(()=>[w("div",tt,[w("div",at,[b(s,{dense:""})]),w("div",st,[b(me,{dense:"",modelValue:e.search,"onUpdate:modelValue":t[0]||(t[0]=m=>e.search=m),label:"Search"},null,8,["modelValue"])]),w("div",ot,[b(pe,{dense:"",label:"Filter by Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.craftFilter,"onUpdate:modelValue":t[1]||(t[1]=m=>e.craftFilter=m),options:e.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),e.projectFilterValue?(c(),C("div",rt,[b(ge,{class:"bg-info text-white shadow-2 rounded-borders"},{default:v(()=>[b(ye,{modelValue:e.tab,"onUpdate:modelValue":t[2]||(t[2]=m=>e.tab=m),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:v(()=>[b(X,{name:0,label:"Matrix"}),e.isDisaProject?(c(),D(X,{key:0,name:1,disable:!e.getDisaReady(e.projectFilterValue)},{default:v(()=>[w("div",null,[K(" Disa "),e.getDisaReady(e.projectFilterValue)?Q("",!0):(c(),D(je,{key:0,color:"white",size:"2em"}))])]),_:1},8,["disable"])):Q("",!0)]),_:1},8,["modelValue"])]),_:1}),b(fe,{modelValue:e.tab,"onUpdate:modelValue":t[3]||(t[3]=m=>e.tab=m),animated:""},{default:v(()=>[b(G,{name:0},{default:v(()=>[b(a,{project:e.projectFilterValue,roster:e.rows},null,8,["project","roster"])]),_:1}),e.isDisaProject?(c(),D(G,{key:0,name:1},{default:v(()=>[b(l,{project:e.project,roster:e.rows},null,8,["project","roster"])]),_:1})):Q("",!0)]),_:1},8,["modelValue"])])):Q("",!0)])]),_:1})}var Nt=F(Ze,[["render",nt]]);export{Nt as default};
