import{l as U,r as y,c as v,_ as I,b5 as q,A as u,B as x,d as s,br as i,ax as D,F as Q,b4 as V,aq as g,ac as k,dj as W,D as c,bQ as X,bV as H,cE as S,cF as T,cH as J}from"./index.4017ca31.js";import{a as G}from"./QSelect.f649ca34.js";import{Q as K}from"./QPage.de97fdf1.js";import{u as N}from"./use-quasar.5edd4060.js";import{H as Y,I as Z,q as h}from"./quickbase.4804bb81.js";import{dayjs as _}from"./dayjs.01a1f0cd.js";import{u as ee}from"./dataStore.05f4029a.js";import{Q as A,a as te}from"./QTable.cf3c1214.js";import{Q as P}from"./QTr.a6004cec.js";import{Q as $}from"./QTd.a5677bd1.js";import{Q as ae}from"./QInnerLoading.a464eed9.js";import{A as le}from"./arrivalDate.fbf73788.js";import{_ as oe}from"./projectSelector.0821c424.js";import"./QChip.4797ac30.js";import"./QMenu.f2054918.js";import"./position-engine.9b406c07.js";import"./selection.238bfdbe.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.04bc0a32.js";import"./localForage.8295c071.js";import"./api.a5c07642.js";import"./i18n.c0a86e49.js";import"./useQuerySaver.d29ff9ee.js";import"./QList.5e1c5b15.js";import"./QMarkupTable.73ed5d05.js";import"./use-fullscreen.61aac10e.js";import"./QTooltip.1e7f358f.js";import"./QForm.09001e6a.js";import"./vee-validate.esm.12a7079e.js";import"./array.46b57c33.js";const re=U({emits:["arrivalMarked"],name:"Arrivals Table",components:{ArrivalDate:le},props:{rows:Array,selected:Array},setup(d,{emit:m}){const f=N(),l=y(!1);return{columns:v(()=>f.screen.gt.sm?[{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,a)=>a[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${Y.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0}]:[{name:1,label:"Name",align:"left",field:e=>e[31],format:e=>`${e}`,sortable:!0},{name:9,label:"Phone #",align:"left",field:e=>e[42],format:e=>`${e}`,sortable:!1},{name:2,label:"Workday ID",align:"left",field:e=>e[152],format:(e,a)=>a[20]==="In Process"?"W---------":e,sortable:!0},{name:3,label:"Project",align:"left",field:e=>e[171],format:e=>`${e}`,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[45],format:e=>`${e}`,sortable:!0},{name:5,label:"Job Number",align:"left",field:e=>e[85],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:6,label:"Site Contact",align:"left",field:e=>e[186],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:7,label:"Start Date",align:"left",field:e=>e[33].$d,format:e=>`${Y.formatDate(new Date(e),"MM/DD/YYYY")}`,sortable:!0}]),updateArrivals:({rows:e,added:a,evt:r})=>{l.value=!0,m("arrivalMarked",{record:e[0],added:a}),setTimeout(function(){l.value=!1},1500)},props:d,loading:l}}}),se={class:"q-px-sm"},ne={class:"text-caption"},ie={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"};function de(d,m,f,l,p,b){const e=q("arrival-date");return u(),x("div",se,[s(te,{dense:"",columns:d.columns,rows:d.rows,"row-key":a=>a[3],class:"q-pa-sm",pagination:{rowsPerPage:d.$q.screen.gt.sm?25:100},separator:"vertical",selection:"multiple",onSelection:d.updateArrivals,selected:d.selected,"table-header-class":"bg-dark text-white","no-data-label":"There are no expected arrivals",loading:d.loading,grid:d.$q.screen.lt.md},{header:i(a=>[s(P,{class:"bg-dark text-white",props:a},{default:i(()=>[s(A,{"auto-width":""}),s(A,{class:"text-left","auto-width":""},{default:i(()=>[D("Arrival Date")]),_:1}),(u(!0),x(Q,null,V(a.cols,r=>(u(),g(A,{class:"text-left",key:r.name},{default:i(()=>[D(k(r.label),1)]),_:2},1024))),128))]),_:2},1032,["props"])]),body:i(a=>[s(P,{"no-hover":"",props:a},{default:i(()=>[s($,{"auto-width":""},{default:i(()=>[s(W,{class:"q-pa-none q-ma-none",size:"xs",modelValue:a.selected,"onUpdate:modelValue":r=>a.selected=r},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a.row[20]==="Complete"&&a.row[207]?(u(),g(e,{key:0,class:"text-left",rowType:"deployment",row:a.row},null,8,["row"])):(u(),g($,{key:1,"auto-width":"",class:"text-left"},{default:i(()=>[D("TBD")]),_:1})),(u(!0),x(Q,null,V(a.cols,r=>(u(),g($,{key:r.name,props:a},{default:i(()=>[c("span",ne,k(r.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":i(({message:a})=>[c("div",ie,[s(X,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),c("span",null,k(a),1)])]),loading:i(()=>[s(ae,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","pagination","onSelection","selected","loading","grid"])])}var ce=I(re,[["render",de]]);const me={name:"Arrivals",components:{MarkArrivalsTable:ce,projectSelector:oe},setup(){const d=N(),m=Z(),f=y(null),l=y(""),p=y(""),{getSelectedProject:b}=H(m),{fetchAllDeployments:e,updateDeployment:a,getDeployments:r,fetchDeployments:F}=ee(),w=v(()=>b.value?b.value[3]:null),R=v(()=>r(w.value).filter(t=>t[20]==="Complete")),C=v(()=>{let t=[];return r(w.value).forEach(o=>{o[31].toLowerCase().includes(p.value.toLowerCase())&&t.push(o)}),t=l.value?t.filter(o=>_(o[33].$d).tz("America/Chicago").format("MM/DD/YYYY")===_(l.value).tz("America/Chicago").format("MM/DD/YYYY")):t,t=f.value?t.filter(o=>o[132]===f.value):t,t}),L=v(()=>[...new Map(C.value.map(t=>[t[132],t[132]])).values()]);async function z(t){d.loading.show(),w.value?await F({projectId:w.value,refresh:t}):await e({refresh:t}),d.loading.hide()}async function B({record:t,added:o}){if(o){await E(t),await M({id:t[21],status:7});const n=await j(t[3],"Complete");a({projectId:n[134],key:n[3],record:n})}else{await O(t),await M({id:t[21],status:6});const n=await j(t[3],"In Process");a({projectId:n[134],key:n[3],record:n})}}async function E(t){try{const{data:o}=await h.upsertRecordsXML({to:"bp3gazpqj",data:[{6:{value:t[3]},13:{value:t[15]},18:{value:t[21]},60:{value:""},125:{value:_()},145:{value:_()}}],fieldsToReturn:[108],formatObject:108},{action:"create",type:"arrival"});return o[0][108]}catch(o){throw{message:"Cannot add assignment",error:o}}}async function M({id:t,status:o}){try{const{data:n}=await h.upsertRecordsXML({to:"bp3gb7ng2",data:[{3:{value:t},79:{value:o}}],fieldsToReturn:[3]});return n[0][3]}catch(n){throw{message:"Cannot edit employee",error:n}}}async function j(t,o){try{const{data:n}=await h.upsertRecordsXML({to:"bp3gaymc3",data:[{3:{value:t},20:{value:o},22:{value:new Date}}],fieldsToReturn:[204],formatObject:204});return n[0][204]}catch(n){throw{message:"Cannot edit deployment",error:n}}}async function O(t){try{const{data:o}=await h.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:t.assignment[3]},22:{value:new Date},21:{value:"Canceled"},19:{value:""},60:{value:""}}],fieldsToReturn:[108],formatObject:108});return o[0][108]}catch(o){throw{message:"Cannot cancel assignment",error:o}}}return z(!0),{arrived:R,allDeployments:C,arrivalMarked:B,craftOptions:L,craftFilter:f,startDateFilter:l,search:p}}},ue={class:"q-pt-sm"},fe={class:"text-h5 text-dark"},pe={class:"text-body2 text-italic q-ml-sm"},be=c("div",{class:"text-subtitle2 text-accent"},"Please toggle the switch for everyone that has arrived at the job site.",-1),ve={class:"row items-center"},ge={class:"col-12 col-md-3 q-px-sm"},we={class:"col-12 col-md-3 q-px-sm"},he={class:"col-12 col-md-3 q-px-sm"},_e={class:"col-12 col-md-3 q-px-sm"};function ye(d,m,f,l,p,b){const e=q("projectSelector"),a=q("mark-arrivals-table");return u(),g(K,{style:{"max-width":"100vw"}},{default:i(()=>[c("div",ue,[s(J,{flat:""},{default:i(()=>[s(S,{class:"q-pb-none"},{default:i(()=>[c("div",fe,[D(" Expected Arrivals "),c("span",pe,"("+k(l.allDeployments.length)+" total)",1)]),be]),_:1}),s(S,null,{default:i(()=>[c("div",ve,[c("div",ge,[s(e,{dense:""})]),c("div",we,[s(T,{dense:"",modelValue:l.search,"onUpdate:modelValue":m[0]||(m[0]=r=>l.search=r),label:"Search"},null,8,["modelValue"])]),c("div",he,[s(T,{dense:"",modelValue:l.startDateFilter,"onUpdate:modelValue":m[1]||(m[1]=r=>l.startDateFilter=r),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),c("div",_e,[s(G,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:l.craftFilter,"onUpdate:modelValue":m[2]||(m[2]=r=>l.craftFilter=r),options:l.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),s(a,{rows:l.allDeployments,selected:l.arrived,onArrivalMarked:l.arrivalMarked},null,8,["rows","selected","onArrivalMarked"])])]),_:1})}var Ze=I(me,[["render",ye]]);export{Ze as default};
