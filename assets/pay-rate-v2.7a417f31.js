import{u as d,q as m}from"./app.dc1ff75d.js";import{dayjs as h}from"./dayjs.1133dfcf.js";import{l as g,_ as y,A as f,aq as w,br as p,B as R,d as E,bQ as N,ar as C,D as $,ac as b,H as D,cU as P}from"./index.4dac2c6e.js";const Q=async({data:e})=>{const{project:a,general:t,classifications:r,names:s,matches:n}=e;if(n)return{data:await _({data:e})};try{return{data:await M({data:e})}}catch(c){throw console.log(c),{message:"There was a problem submitting the hire request"}}},_=async({data:e})=>{const{matches:a,classifications:t,names:r}=e,s=a,n=t.filter(o=>o.match),c=t.filter(o=>!o.match);n.forEach(o=>{o.names=r.filter(l=>l.job.id===o.id)}),c.forEach(o=>{o.names=r.filter(l=>l.job.id===o.id)});const i=[];c.forEach(o=>{const l=v({requestData:s,job:o});i.push(l)}),n.forEach(o=>{const l=k({job:o});i.push(l)});const u=await Promise.allSettled(i);return s.classes=u.map(o=>o.value),s},M=async({data:e})=>{const{project:a,general:t,classifications:r,names:s}=e,{userData:n}=d();r.forEach(u=>{u.names=s.filter(o=>o.job.id===u.id)});const c={64:{value:t.dateNeeded},282:{value:t.restriction.value},284:{value:t.reason.value},31:{value:t.meetingLocation[3]},9:{value:t.jobNumber[3]},60:{value:t.siteContact[3]},92:{value:a[12]},6:{value:a[3]},272:{value:n[3]},281:{value:n[32]==="Project User"},14:{value:"Open"},147:{value:3},82:{value:h()},68:{value:t.perDiem?"Yes":"No"},299:{value:t.notes?t.notes:""}};return await O({fields:c,classifications:r})},O=async({fields:e,classifications:a})=>{const{data:t}=await m.upsertRecordsXML({to:"bpzpyjbuy",data:[e],fieldsToReturn:[289],formatObject:289});if(!t[0])throw{message:"Error adding request!"};const r=t[0][289],s=[];a.forEach(c=>{const i=v({requestData:r,job:c});s.push(i)});const n=await Promise.allSettled(s);return r.classes=n.map(c=>c.value),r},k=async({job:e})=>{let a=0;a=e.match[18]+e.qty,a=a>e.names.length?a:e.names.length;const t={3:{value:e.match[3]},18:{value:a}},{data:r}=await m.upsertRecordsXML({to:"bpzpyqcu4",data:[t],fieldsToReturn:[250],formatObject:250});if(!r[0])throw{message:"Error updating classification!"};const s=r[0][250];if(e.names&&e.names.length>0){const n=[];e.names.forEach(i=>{const u=q({classificationData:s,name:i});n.push(u)});const c=await Promise.allSettled(n);return s.names=c.map(i=>i.value),s}else return s},v=async({requestData:e,job:a})=>{d();const t={6:{value:e[3]},9:{value:a.classification[3]},17:{value:"Open"},128:{value:3},18:{value:a.qty},23:{value:a.rate},238:{value:a.id}},{data:r}=await m.upsertRecordsXML({to:"bpzpyqcu4",data:[t],fieldsToReturn:[250],formatObject:250});if(!r[0])throw{message:"Error adding classification!"};const s=r[0][250];if(a.names&&a.names.length>0){const n=[];a.names.forEach(i=>{const u=q({classificationData:s,name:i});n.push(u)});const c=await Promise.allSettled(n);return s.names=c.map(i=>i.value),s}else return s},q=async({classificationData:e,name:a})=>{const{userData:t}=d(),r={6:{value:a.firstName},7:{value:a.lastName},8:{value:a.phoneNumber},19:{value:h()},16:{value:a.ssn},10:{value:"Has Not Arrived"},14:{value:`${t[35]} ${t[37]}`},17:{value:e[3]}},{data:s}=await m.upsertRecordsXML({to:"bsg4yb4wa",data:[r],fieldsToReturn:[40],formatObject:40});if(!s[0])throw{message:"Error adding name!"};return s[0][40]},H=async({job:e,matches:a})=>{const{classification:t,rate:r}=e,s=e.match?null:a.classes.find(n=>n[9]===t[3]&&n[23]===r);return s&&(e.match=s),e},U=async({id:e,qty:a})=>{const t={3:{value:e},18:{value:a}},{data:r}=await m.upsertRecordsXML({to:"bpzpyqcu4",data:[t],fieldsToReturn:[220],formatObject:220});return r[0][220]},L=g({name:"PayRateV2"}),S={key:0,class:"text-right"},T={class:"text-caption"};function V(e,a,t,r,s,n){return f(),w(P,D(e.$attrs,{"bottom-slots":""}),{append:p(()=>[e.$attrs.job&&e.$attrs.job.hasFixedRate&&!e.$can("manage","rates")?(f(),R("div",S,[E(N,{name:"lock",size:"sm"})])):C("",!0)]),error:p(()=>[$("div",T,b(e.$attrs.errorMessage),1)]),_:1},16)}var x=y(L,[["render",V]]);export{x as P,v as c,H as f,Q as n,U as u};
