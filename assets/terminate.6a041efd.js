import{l as Ve,r as R,bT as x,c as D,w as ee,_ as ge,A as b,B as y,d as a,br as s,cS as H,cT as K,D as o,ac as w,bR as B,bP as Q,ax as U,cU as G,bW as I,F as X,b4 as he,bS as Y,ar as te,dA as i,cV as qe,bO as we,bU as Ae,aq as J}from"./index.c7640e72.js";import{Q as Se}from"./QPage.b5011f60.js";import{u as le}from"./use-quasar.0751f5b6.js";import{u as W}from"./useQuerySaver.d29ff9ee.js";import{q as M}from"./app.8f08130a.js";import{u as ae}from"./dataStore.c8ea7188.js";import{a as O,Q as Ue}from"./QSelect.fadf4533.js";import{Q as Re}from"./QFile.fa30d338.js";import{Q as De}from"./QList.e7f97b0e.js";import{Q as ke}from"./QForm.17871f7d.js";import{a as Ce,u as p}from"./vee-validate.esm.cf3515d2.js";import{a as P,b as Ee,c as Z,e as T}from"./array.27eafe44.js";import{dayjs as _}from"./dayjs.3faf0a5e.js";import{s as Qe}from"./submitRelease.ca7fbf46.js";import{u as $e}from"./dataStore.a1b994da.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.cb436dbd.js";import"./api.d1dfc8c4.js";import"./index.04bc0a32.js";import"./i18n.911c9472.js";import"./QChip.7653060e.js";import"./QMenu.39482be3.js";import"./position-engine.4d6bc0f8.js";import"./selection.8a1f3691.js";import"./rtl.b51694b1.js";const Ne=Ve({emits:["releaseSubmitted"],props:{record:Object,employee:Object},setup(e,{emit:l}){const A=R(!1),V=R(!1),g=R(null),c=R([]),t=le(),v=x(),{getTermReasons:h,setTermReasons:$}=ae(),{getAssignments:N,fetchAssignments:F}=$e(),m=D(()=>P({selection:P().required().nullable().label("Reason"),effective:Ee().required().label("Last Day On Site"),category:Z().nullable(),attendance:T().required().label("Attendance"),capability:T().required().label("Capability"),attitude:T().required().label("Attitude"),promotable:T().required().label("Promotability"),comments:Z().nullable().label("Comments"),equipment:P().required().nullable().label("Equipment Returned"),supervisor:P().nullable().label("Supervisor")})),{errors:k,handleSubmit:j,handleReset:C}=Ce({validationSchema:m,initialValues:{}}),{value:r}=p("selection"),{value:d}=p("effective"),{value:q}=p("category"),{value:E}=p("attachments"),{value:oe}=p("capability"),{value:se}=p("attendance"),{value:ne}=p("attitude"),{value:ie}=p("promotable"),{value:re}=p("comments"),{value:de}=p("equipment"),{value:ue}=p("supervisor"),me=D(()=>{const n=h();return q.value?n.filter(u=>u[6]===q.value).sort((u,f)=>u[12]>f[12]?1:-1):n.sort((u,f)=>u[12]>f[12]?1:-1)}),pe=j(async n=>{if(V.value&&c.value.length===0)t.dialog({title:"Alert",message:"Supporting documents are required for this reason!"});else{const u={capability:n.capability,attendance:n.attendance,attitude:n.attitude,promotable:n.promotable,comments:n.comments?n.comments.replace(/(\r\n|\n|\r)/gm," "):null};t.dialog({title:"Confirm",message:"Are you sure you want to release this employee?",cancel:!0,persistent:!0}).onOk(async()=>{try{A.value=!0;const{release:f,employee:S,assignment:L}=await Qe({employee:e.employee,assignment:e.record,values:n,effectiveNow:!z.value,attachments:c.value,ratings:u,supervisor:n.supervisor});l("releaseSubmitted",{release:f,employee:S,assignment:L,effectiveNow:!z.value}),C()}catch{A.value=!1,t.notify({type:"negative",message:"Cannot submit release."})}})}}),ce=()=>{t.dialog({title:"Confirm",message:"Are you sure you want to cancel?",cancel:!0,persistent:!0}).onOk(()=>{C(),v.go(-1)})};ee(r,(n,u)=>{n&&n[19]?(V.value=!0,E.value=!0):(E.value=!1,V.value=!1)});const be=D(()=>{const n=h();return[...new Map(n.map(u=>[u[6],u[6]])).values()]}),z=D(()=>d.value&&d.value!==""?_().isBefore(_(d.value)):!1),ve=n=>new Promise((u,f)=>{const S=new FileReader;S.readAsDataURL(n),S.onload=()=>u(S.result.replace(/^data:.+;base64,/,"")),S.onerror=L=>f(L)}),fe=()=>{g.value&&g.value.forEach(async n=>{const u={6:{value:await ve(n),filename:n.name},7:{value:n.name}};c.value.push(u),g.value=null}),console.log(c.value)},ye=n=>{console.log(c.value[n]),c.value.splice(n,1)};return(async()=>{if(h().length===0){const{data:n}=await M.fetchFromHiringApp({fields:[W({type:"termReasons",query:"{'11'.EX.'true'}"})]});$({reasons:n})}F({projectId:e.record[74]})})(),{props:e,options:me,primaryReasons:be,category:q,selection:r,effective:d,attachments:E,capability:oe,attendance:se,attitude:ne,promotable:ie,comments:re,equipment:de,supervisor:ue,attachmentsRequired:V,fileAttachment:g,attachedFiles:c,submit:pe,formErrors:k,handleReset:C,cancelRelease:ce,showFiles:fe,deleteFile:ye,getAssignments:N,disableSubmit:A}}}),Fe={class:"row"},Be={class:"col-12 col-md-4 q-px-sm"},Ie=o("div",{class:"text-caption"},"Is this release voluntary or involuntary?",-1),Oe={class:"text-caption"},Pe={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},Te=o("div",{class:"text-caption"},"What is the reason for this release?",-1),je={class:"text-caption"},Le={class:"row"},He={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},Ke=o("div",{class:"text-caption"},"When is the employee's last day on site?",-1),We={class:"text-caption"},Me={class:"col-12 col-md-4 q-pl-xs q-pr-sm"},ze=o("div",{class:"text-caption"},"Has all Company Equipment been returned?",-1),Ge={class:"text-caption"},Xe={class:"row items-top justify-between q-mt-sm"},Ye={class:"col-4 q-pl-xs q-pr-sm"},Je={key:0,class:"text-body2 text-negative text-italic"},Ze={key:0},_e={key:1},xe={key:1,class:"text-body2 text-dark text-italic"},et=o("span",null,"**Supporting documents are optional for this reason.",-1),tt=[et],lt={key:0,class:"col-6 q-pl-xs q-pr-sm"},at=o("div",{class:"text-body1 text-info q-mb-sm"},"Attached Documents",-1),ot={class:"row q-my-md"},st={class:"col-12"},nt=o("div",{class:"q-pa-sm"},[o("div",{class:"text-h6 text-bold"},"CAAP Rating"),o("div",{class:"text-body1 text-dark text-italic"},"Capability, Attendance, Attitude, and Promotability"),o("div",{class:"text-body2 text-accent q-mt-sm"},"Select how much you agree with each of the following statements.")],-1),it={class:"q-pb-sm"},rt=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee is capable of performing their assigned job.",-1),dt={class:"q-pb-sm"},ut=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee regularly shows up to work on time.",-1),mt={class:"q-pb-sm"},pt=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"This employee has a good attitude.",-1),ct={class:"q-pb-sm"},bt=o("div",{class:"text-body2 text-info text-bold q-mb-sm"},"I am confident that this employee can be promoted in the future.",-1),vt={class:"row q-mt-md"},ft={class:"col-12 col-md-5"},yt=o("div",{class:"text-body2 text-weight-bold text-info"},[U(" Who conducted this evaluation? "),o("span",{class:"text-italic text-weight-light text-dark"},"(recommended)")],-1),Vt={class:"text-caption"},gt={class:"row q-py-sm"},ht={class:"col-12"};function qt(e,l,A,V,g,c){return b(),y("div",null,[a(ke,{onSubmit:we(e.submit,["prevent"])},{default:s(()=>[a(H,null,{default:s(()=>[a(K,null,{default:s(()=>[o("div",Fe,[o("div",Be,[Ie,a(O,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":l[0]||(l[0]=t=>e.category=t),options:e.primaryReasons},{error:s(()=>[o("div",Oe,w(e.formErrors.selection),1)]),"no-option":s(()=>[a(B,null,{default:s(()=>[a(Q,{class:"text-grey"},{default:s(()=>[U(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),o("div",Pe,[Te,a(O,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":l[1]||(l[1]=t=>e.selection=t),options:e.options,"option-label":"12","display-value":`${e.selection?e.selection[12]:""}`,"bottom-slots":"",error:!!e.formErrors.selection,disable:!e.category},{error:s(()=>[o("div",je,w(e.formErrors.selection),1)]),"no-option":s(()=>[a(B,null,{default:s(()=>[a(Q,{class:"text-grey"},{default:s(()=>[U(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","display-value","error","disable"])])]),o("div",Le,[o("div",He,[Ke,a(G,{dense:"",type:"date",modelValue:e.effective,"onUpdate:modelValue":l[2]||(l[2]=t=>e.effective=t),error:!!e.formErrors.effective,"bottom-slots":""},{error:s(()=>[o("div",We,w(e.formErrors.effective),1)]),_:1},8,["modelValue","error"])]),o("div",Me,[ze,a(O,{dense:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.equipment,"onUpdate:modelValue":l[3]||(l[3]=t=>e.equipment=t),options:[{value:!0,label:"Yes"},{value:!1,label:"No"},{value:!0,label:"None Issued"}],"bottom-slots":"",error:!!e.formErrors.equipment},{error:s(()=>[o("div",Ge,w(e.formErrors.equipment),1)]),_:1},8,["modelValue","error"])])]),o("div",Xe,[o("div",Ye,[a(Re,{dense:"","bottom-slots":"",modelValue:e.fileAttachment,"onUpdate:modelValue":l[4]||(l[4]=t=>e.fileAttachment=t),multiple:"",append:"",label:"Attach Supporting Documents"},{after:s(()=>[a(I,{dense:"",color:"info",round:"",flat:"",icon:"cloud_upload",onClick:e.showFiles},null,8,["onClick"])]),_:1},8,["modelValue"]),e.attachmentsRequired?(b(),y("div",Je,[U("!! "),e.selection[12].toLowerCase().includes("attendance")?(b(),y("span",Ze,"Supporting attendance records must be attached.")):(b(),y("span",_e,"Supporting documents are required for this reason."))])):(b(),y("div",xe,tt))]),e.attachedFiles.length>0?(b(),y("div",lt,[at,a(De,{dense:""},{default:s(()=>[(b(!0),y(X,null,he(e.attachedFiles,(t,v)=>(b(),y(X,{key:t},[a(B,null,{default:s(()=>[a(Q,null,{default:s(()=>[a(Ue,null,{default:s(()=>[U(w(v+1)+". "+w(t[6].filename),1)]),_:2},1024)]),_:2},1024),a(Q,{side:""},{default:s(()=>[a(I,{color:"accent",round:"",flat:"",class:"cursor-pointer",icon:"delete",size:"md",onClick:h=>e.deleteFile(v)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),a(Y)],64))),128))]),_:1})])):te("",!0)])]),_:1})]),_:1}),a(Y),o("div",ot,[o("div",st,[nt,a(H,null,{default:s(()=>[a(K,null,{default:s(()=>[o("div",null,[o("div",it,[rt,a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[5]||(l[5]=t=>e.capability=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[6]||(l[6]=t=>e.capability=t),val:"2",label:"Disagree"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[7]||(l[7]=t=>e.capability=t),val:"3",label:"Neutral"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[8]||(l[8]=t=>e.capability=t),val:"4",label:"Agree"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[9]||(l[9]=t=>e.capability=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),a(i,{name:"capability",modelValue:e.capability,"onUpdate:modelValue":l[10]||(l[10]=t=>e.capability=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",dt,[ut,a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[11]||(l[11]=t=>e.attendance=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[12]||(l[12]=t=>e.attendance=t),val:"2",label:"Disagree"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[13]||(l[13]=t=>e.attendance=t),val:"3",label:"Neutral"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[14]||(l[14]=t=>e.attendance=t),val:"4",label:"Agree"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[15]||(l[15]=t=>e.attendance=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),a(i,{name:"attendance",modelValue:e.attendance,"onUpdate:modelValue":l[16]||(l[16]=t=>e.attendance=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",mt,[pt,a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[17]||(l[17]=t=>e.attitude=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[18]||(l[18]=t=>e.attitude=t),val:"2",label:"Disagree"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[19]||(l[19]=t=>e.attitude=t),val:"3",label:"Neutral"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[20]||(l[20]=t=>e.attitude=t),val:"4",label:"Agree"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[21]||(l[21]=t=>e.attitude=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),a(i,{name:"attitude",modelValue:e.attitude,"onUpdate:modelValue":l[22]||(l[22]=t=>e.attitude=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])]),o("div",ct,[bt,a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[23]||(l[23]=t=>e.promotable=t),val:"1",label:"Strongly Disagree"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[24]||(l[24]=t=>e.promotable=t),val:"2",label:"Disagree"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[25]||(l[25]=t=>e.promotable=t),val:"3",label:"Neutral"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[26]||(l[26]=t=>e.promotable=t),val:"4",label:"Agree"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[27]||(l[27]=t=>e.promotable=t),val:"5",label:"Strongly Agree"},null,8,["modelValue"]),a(i,{name:"promotable",modelValue:e.promotable,"onUpdate:modelValue":l[28]||(l[28]=t=>e.promotable=t),val:"0",label:"I Do Not Know"},null,8,["modelValue"])])]),o("div",vt,[o("div",ft,[yt,a(O,{dense:"",clearable:"","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.supervisor,"onUpdate:modelValue":l[29]||(l[29]=t=>e.supervisor=t),options:e.getAssignments(e.props.record[74]).length>0?e.getAssignments(e.props.record[74]).filter(t=>t[3]!==e.props.record[3]).sort((t,v)=>t[75]>v[75]?1:-1):[],"option-label":t=>`${t[75]} - ${t[104]}`,"display-value":`${e.supervisor?e.supervisor[75]:""}`,"bottom-slots":"",error:!!e.formErrors.supervisor,hint:"Ex: Employee's Supervisor"},{error:s(()=>[o("div",Vt,w(e.formErrors.supervisor),1)]),"no-option":s(()=>[a(B,null,{default:s(()=>[a(Q,{class:"text-grey"},{default:s(()=>[U(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","error"])])])]),_:1})]),_:1})])]),o("div",gt,[o("div",ht,[a(G,{filled:"",type:"textarea",modelValue:e.comments,"onUpdate:modelValue":l[30]||(l[30]=t=>e.comments=t),label:"Comments"},null,8,["modelValue"])])]),a(qe,{align:"right"},{default:s(()=>[a(I,{disable:e.disableSubmit,color:"info",label:"Submit",type:"submit"},null,8,["disable"]),a(I,{color:"secondary",label:"Cancel",onClick:e.cancelRelease},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var wt=ge(Ne,[["render",qt]]);const At={class:"q-pa-sm"},St={class:"row"},Ut={class:"col-12"},Rt=o("div",{class:"text-h6 text-weight-bold q-mb-md"},"Please complete the following to submit this release.",-1),xt={__name:"terminate",setup(e){R(0);const l=Ae(),A=x(),V=le(),g=R("employee");g.value=l.query.reason==="now-show"?"arrivals":"employee";const{getEmployee:c,getAssignmentsByEmployee:t,setAssignmentsByEmployee:v,setEmployees:h,setReleases:$,setReleasesByAssignment:N,setReleasesByEmployee:F}=ae(),m=D(()=>c(l.params.id)),k=D(()=>m.value?t(m.value[3]):null);l.query&&console.log(l.query);const j=async()=>{if(!k.value&&m.value[577]){const{data:r}=await M.fetchFromHiringApp({fields:[W({type:"assignments",query:"",id:m.value[577]})]});console.log(r),v({id:m.value[3],data:r})}else if(m.value[577]){const{data:r}=await M.fetchFromHiringApp({fields:[W({type:"assignments",query:"",id:m.value[577]})]});console.log(r)}};ee(m,(r,d)=>{r&&j()});const C=({employee:r,release:d,assignment:q,effectiveNow:E})=>{V.notify({type:"positive",message:"Release successfully submitted."}),E?(r[581]=d[3],$({id:d[3],data:d}),h({id:r[3],data:r}),v({id:r[3],assignment:q}),N({id:q[3],data:d}),F({id:r[3],data:d})):(r[581]=d[3],h({id:r[3],data:r}),$({id:d[3],data:d}),N({id:q[3],data:d}),F({id:r[3],data:d})),A.replace({name:"view-ee-release",params:{id:r[3],release:d[3]}})};return(r,d)=>(b(),J(Se,{style:{"max-width":"100vw"}},{default:s(()=>[o("div",At,[o("div",St,[o("div",Ut,[a(H,{flat:""},{default:s(()=>[k.value?(b(),J(K,{key:0},{default:s(()=>[Rt,a(wt,{record:k.value,employee:m.value,onReleaseSubmitted:C},null,8,["record","employee"])]),_:1})):te("",!0)]),_:1})])])])]),_:1}))}};export{xt as default};
