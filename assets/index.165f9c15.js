import{_ as O,l as W,bV as z,A as G,aq as H,br as r,D as o,d as a,cS as X,bO as J,cT as h,ac as u,cU as c,bQ as K,ax as Y,cV as Z,bW as S}from"./index.ed1cd1a8.js";import{a as V}from"./QSelect.d18b0263.js";import{Q as x}from"./QTooltip.8a03cb8d.js";import{Q as ee}from"./QFile.4902dd1c.js";import{Q as oe}from"./QSpinnerGears.c374fbaf.js";import{Q as te}from"./QForm.a26f0b73.js";import{Q as se}from"./QPage.4d3a0dd4.js";import{a as le,u as i}from"./vee-validate.esm.9e016e91.js";import{a as F,c as d}from"./array.59f93f43.js";import{u as ae,b as re,q as ie}from"./app.58c96d85.js";import{u as ne}from"./use-quasar.0680e35f.js";import"./QChip.8da1fa28.js";import"./QMenu.d23a604a.js";import"./position-engine.df0f0bff.js";import"./selection.e39b2fce.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./dayjs.d6c6127f.js";import"./localForage.830ce567.js";import"./api.e0fdf09c.js";import"./index.04bc0a32.js";import"./i18n.9212c305.js";const de=W({setup(){const e=ne(),l=ae(),{userData:m,fullName:g}=z(l),{userType:q}=re(),y=m.value&&m.value[8]?m.value[8]:"",s=m.value&&m.value[6]?m.value[6]:"",E=[...s===""?["Personal Login Issues"]:[],"General Help","Data Updates & System Maintenance","Reporting","Security","Integration Maintenance/Failure","Bug",...s!==""?["Personal Login Issues"]:[]],P=["Worksite Management Portal","Craft Employee Management"],w=F({type:d().required().label("Type"),category:d().required().label("Category"),subject:d().required().label("Subject"),details:d().required().label("Details"),supportingFile:F().nullable().label("Supporting File"),requestedFor:d().required().label("Requested For"),contactPhone:d().matches(/^[+()0-9 .-]+$/,{excludeEmptyString:!0,message:"Valid Phone Number Only!"}).required().label("Contact Phone"),contactEmail:d().email().required().label("Contact Email"),additionalPeople:d().nullable().label("Additional People Affected")}),{meta:Q,errors:C,handleSubmit:_,handleReset:k,isSubmitting:U}=le({validationSchema:w,initialValues:{type:"",category:q==="QuickBase User"?"Craft Employee Management":"Worksite Management Portal",requestedFor:g.value?g.value.includes("undefined")?"":g.value:"",contactPhone:y,contactEmail:s}}),{value:T}=i("type"),{value:j}=i("category"),{value:A}=i("subject"),{value:R}=i("details"),{value:M}=i("supportingFile"),{value:D}=i("requestedFor"),{value:$}=i("contactPhone"),{value:B}=i("contactEmail"),{value:I}=i("additionalPeople"),N=t=>new Promise((b,f)=>{const p=new FileReader;p.readAsDataURL(t),p.onload=()=>b(p.result.replace(/^data:.+;base64,/,"")),p.onerror=n=>f(n)}),L=_(async t=>{try{t.details=t.details?t.details.replace(/(\r\n|\n|\r)/gm," "):null,t.additionalPeople=t.additionalPeople?t.additionalPeople.replace(/(\r\n|\n|\r)/gm," "):null;const b=t.supportingFile&&t.supportingFile[0]?await N(t.supportingFile[0]):null,f=t.supportingFile&&t.supportingFile[0]?t.supportingFile[0].name:null;console.log(t);const p=[{7:{value:t.type},8:{value:t.category},6:{value:t.subject},10:{value:t.details},11:{value:b,filename:f},19:{value:t.requestedFor},21:{value:t.contactPhone},22:{value:t.contactEmail},23:{value:t.additionalPeople?t.additionalPeople:""}}],{data:n}=await ie.upsertRecordsXML({to:"btb8bh2ki",fieldsToReturn:[32],data:p,formatObject:32});if(console.log(n),n&&n[0]&&n[0][32]&&n[0][32][3])e.notify({position:"top-right",type:"positive",message:`Support Request ${n[0][32][3]} successfully added`});else throw"Error in adding support request";v()}catch(b){console.log(b),e.notify({position:"top-right",type:"negative",message:"There was a problem submitting request!"})}}),v=()=>{k()};return{types:E,categories:P,type:T,category:j,subject:A,details:R,supportingFile:M,requestedFor:D,contactPhone:$,contactEmail:B,additionalPeople:I,formMeta:Q,formErrors:C,submitTicket:L,closeAddTicket:v,isSubmitting:U}}}),me={class:"row justify-center q-pt-sm"},ue={class:"col-12 col-md-8"},pe=o("div",{class:"text-h5 text-dark"},"Request Support",-1),ce=o("div",{class:"text-primary text-h6 q-mb-sm"},"Support Details",-1),be={class:"row"},ge={class:"col-12 col-md-6 q-pr-md"},fe={class:"text-caption"},he={class:"col-12 col-md-6 q-pr-md"},qe={class:"text-caption"},ye={class:"row"},ve={class:"col-12 q-pr-md"},Se={class:"text-caption q-pt-none"},Ve={class:"row"},Fe={class:"col-12 q-pr-md"},Ee={class:"text-caption"},Pe={class:"row"},we={class:"col-12 col-md-8 q-pr-md"},Qe=o("div",{class:"text-primary text-h6 q-mb-sm"},"Contact Information",-1),Ce={class:"row"},_e={class:"col-12 col-md-8 q-pr-md"},ke={class:"text-caption"},Ue={class:"row"},Te={class:"col-12 col-md-6 q-pr-md"},je={class:"text-caption"},Ae={class:"col-12 col-md-6 q-pr-md"},Re={class:"text-caption"},Me={class:"row"},De={class:"col-12 q-pr-md"};function $e(e,l,m,g,q,y){return G(),H(se,{style:{"max-width":"100vw","max-height":"100vh"}},{default:r(()=>[o("div",me,[o("div",ue,[a(X,{flat:""},{default:r(()=>[a(te,{onSubmit:J(e.submitTicket,["prevent"])},{default:r(()=>[a(h,{class:"q-pb-lg"},{default:r(()=>[pe]),_:1}),a(h,{class:"q-pl-lg q-pt-none"},{default:r(()=>[ce,o("div",be,[o("div",ge,[a(V,{class:"q-mb-md",dense:"",outlined:"",label:"Type","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.type,"onUpdate:modelValue":l[0]||(l[0]=s=>e.type=s),options:e.types,"bottom-slots":"",error:!!e.formErrors.type,disable:e.isSubmitting},{error:r(()=>[o("div",fe,u(e.formErrors.type),1)]),_:1},8,["modelValue","options","error","disable"])]),o("div",he,[a(V,{class:"q-mb-md",dense:"",outlined:"",label:"App","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.category,"onUpdate:modelValue":l[1]||(l[1]=s=>e.category=s),options:e.categories,"bottom-slots":"",error:!!e.formErrors.category,disable:e.isSubmitting},{error:r(()=>[o("div",qe,u(e.formErrors.category),1)]),_:1},8,["modelValue","options","error","disable"])])]),o("div",ye,[o("div",ve,[a(c,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Subject",modelValue:e.subject,"onUpdate:modelValue":l[2]||(l[2]=s=>e.subject=s),"bottom-slots":"",error:!!e.formErrors.subject,disable:e.isSubmitting},{error:r(()=>[o("div",Se,u(e.formErrors.subject),1)]),_:1},8,["modelValue","error","disable"])])]),o("div",Ve,[o("div",Fe,[a(c,{class:"q-mb-md",dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e.details,"onUpdate:modelValue":l[3]||(l[3]=s=>e.details=s),label:"Details","bottom-slots":"",error:!!e.formErrors.details,disable:e.isSubmitting},{error:r(()=>[o("div",Ee,u(e.formErrors.details),1)]),_:1},8,["modelValue","error","disable"])])]),o("div",Pe,[o("div",we,[a(ee,{dense:"",outlined:"","bottom-slots":"",modelValue:e.supportingFile,"onUpdate:modelValue":l[4]||(l[4]=s=>e.supportingFile=s),multiple:"",append:"","max-files":"1","use-chips":"",label:"Supporting File",disable:e.isSubmitting},{prepend:r(()=>[a(K,{name:"attach_file"},{default:r(()=>[a(x,null,{default:r(()=>[Y("Click in the box to add supporting file")]),_:1})]),_:1})]),_:1},8,["modelValue","disable"])])])]),_:1}),a(h,{class:"q-pl-lg q-pt-none"},{default:r(()=>[Qe,o("div",Ce,[o("div",_e,[a(c,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Requested For",modelValue:e.requestedFor,"onUpdate:modelValue":l[5]||(l[5]=s=>e.requestedFor=s),error:!!e.formErrors.requestedFor,"bottom-slots":"",disable:e.isSubmitting},{error:r(()=>[o("div",ke,u(e.formErrors.requestedFor),1)]),_:1},8,["modelValue","error","disable"])])]),o("div",Ue,[o("div",Te,[a(c,{class:"q-mb-md",dense:"",outlined:"",maxlength:"15",label:"Contact Phone",modelValue:e.contactPhone,"onUpdate:modelValue":l[6]||(l[6]=s=>e.contactPhone=s),error:!!e.formErrors.contactPhone,"bottom-slots":"",disable:e.isSubmitting},{error:r(()=>[o("div",je,u(e.formErrors.contactPhone),1)]),_:1},8,["modelValue","error","disable"])]),o("div",Ae,[a(c,{class:"q-mb-md",dense:"",outlined:"",maxlength:"100",label:"Contact Email",modelValue:e.contactEmail,"onUpdate:modelValue":l[7]||(l[7]=s=>e.contactEmail=s),error:!!e.formErrors.contactEmail,"bottom-slots":"",disable:e.isSubmitting},{error:r(()=>[o("div",Re,u(e.formErrors.contactEmail),1)]),_:1},8,["modelValue","error","disable"])])]),o("div",Me,[o("div",De,[a(c,{dense:"",outlined:"","input-style":"resize: none",maxlength:"2500",type:"textarea",modelValue:e.additionalPeople,"onUpdate:modelValue":l[8]||(l[8]=s=>e.additionalPeople=s),label:"Additional People Affected",disable:e.isSubmitting},null,8,["modelValue","disable"])])])]),_:1}),a(Z,{class:"q-pl-lg q-py-lg",align:"right"},{default:r(()=>[a(S,{loading:e.isSubmitting,disable:e.isSubmitting,color:"primary",label:"Save & Close",type:"submit"},{loading:r(()=>[a(oe)]),_:1},8,["loading","disable"]),a(S,{class:"q-mr-lg",color:"secondary",label:"Cancel",onClick:e.closeAddTicket},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})])])]),_:1})}var io=O(de,[["render",$e]]);export{io as default};
