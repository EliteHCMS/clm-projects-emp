import{Q as Z,b as J,a as K}from"./QTabPanels.0df2a8c9.js";import{Q as ee}from"./QTabs.26b904e3.js";import{Q as te}from"./QPage.987dae48.js";import{u as O}from"./use-quasar.f362f467.js";import{l as R,r as g,_ as D,A as v,an as y,bi as n,D as r,bL as se,c as Q,aZ as B,B as k,d as o,cw as ae,cx as oe,cz as le,F as A,aY as x,au as P,ab as $,bI as U,bO as ne,y as ie}from"./index.0dddbf49.js";import{Q as w}from"./QSelect.af0bdc06.js";import{Q as q,a as re}from"./QTable.8a4ac7c4.js";import{Q as N}from"./QTr.0744195d.js";import{Q as _}from"./QTd.61b760e4.js";import{Q as de}from"./QInnerLoading.220f2c4b.js";import{u as ue}from"./dataStore.aa435c1a.js";import"./dayjs.b650d6a4.js";import{u as E}from"./useQuerySaver.bb1ebf35.js";import{q as F,u as me}from"./quickbase.c1f7b402.js";import"./workdayAPI.0e32edf1.js";import"./workday.ffb7f83c.js";import"./dataStore.17a4b24a.js";import"./use-panel.3cd36c56.js";import"./touch.60582172.js";import"./selection.1ecd6506.js";import"./QResizeObserver.79867edd.js";import"./rtl.cf9bbe47.js";import"./QChip.40f77c99.js";import"./QItemLabel.8751cc33.js";import"./QMenu.bcbd89cc.js";import"./position-engine.67a5d571.js";import"./QList.c6e274bc.js";import"./QMarkupTable.b40a30ae.js";import"./use-fullscreen.4b93e4f9.js";import"./localForage.5c039857.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./i18n.1d81d753.js";import"./api.5ba01119.js";const pe=async({array:e})=>{const a=[];return e.forEach(async c=>{const u=ce({release:c});a.push(u)}),(await Promise.allSettled(a)).map(c=>c.value)},ce=async({release:e})=>{const a=e[93],d=e[102]&&e[e[102]]?e[e[102]]:null,p=d?E({status:a,id:d}):null;if(p){const{data:c}=await F.fetchFromHiringApp({fields:[p]}),u=c;if(u){const f=u[1].$d>e[1].$d;return f?{release:await fe({release:e,disposition:"Reassign",ts:u[1].$d}),reassigned:f}:{release:e,reassigned:!1}}else return{release:e,reassigned:!1}}else return{release:e,reassigned:!1}},fe=async({release:e,disposition:a,ts:d})=>{me();const{data:p}=await F.upsertRecordsXML({to:"bp3ga39ut",data:[{3:{value:e[3]},42:{value:"Complete"},43:{value:a},44:{value:e[44].$d||d},73:{value:"Cancelled"}}],fieldsToReturn:[80],formatObject:80});return p[0][80]},be=R({emits:[],props:{id:String,release:Object},setup(e){const a=g(null),d=g(!0);return{record:a,loading:d}}}),ge=r("div",null,null,-1);function ve(e,a,d,p,c,u){return v(),y(_,{class:"text-left","auto-width":""},{default:n(()=>[ge]),_:1})}var we=D(be,[["render",ve]]);const he=R({props:{},components:{GetWorkerCell:we},setup(e){const a=O(),d=se(),{capitalize:p}=ie,c=g(""),u=g(null),f=g(null),t=g(null),b=g(null),V=g(null),h=g(!0),L=[{name:1,label:"Name",align:"left",field:s=>s[49],format:s=>`${Y(s)}`,sortable:!0},{name:2,label:"Disposition",align:"left",field:s=>s[43],format:s=>`${s}`,sortable:!0},{name:3,label:"Workday Status",align:"left",field:s=>s[87],format:s=>`${s}`,sortable:!0},{name:4,label:"Hiring Status",align:"left",field:s=>s[92],format:s=>`${s}`,sortable:!0},{name:5,label:"Submission Status",align:"left",field:s=>s[73],format:s=>`${s}`,sortable:!0}],z=async()=>{const s=S.value.filter(m=>m[87]==="Active"&&m[95]&&m[42]!=="Complete"),l=await pe({array:s}),i=l.filter(m=>m.reassigned);console.log(l),console.log(i)},H=[{value:"Reassign",label:"Reassign"},{value:"Terminate",label:"Terminate"},{value:"",label:"None"}],{setAdminData:I,getAdminData:X,setAdminItemData:xe}=ue(),C=Q(()=>{const s=S.value;let l;if(f.value?l=s.filter(i=>i[87]===f.value):l=s,t.value&&(l=l.filter(i=>i[43]===t.value.value)),u.value&&(l=l.filter(i=>i[73]===u.value)),b.value&&(l=l.filter(i=>i[92]===b.value)),V.value){const i=V.value==="Yes";l=l.filter(m=>m[95]===i)}return l}),S=Q(()=>(X({dataset:"releases"})||[]).sort((i,m)=>i[36].$d>m[36].$d?1:-1)),T=async s=>{if(s||C.value.length===0){h.value=!0;const{data:l}=await F.fetchFromHiringApp({fields:[E({type:"releases",query:"{'39'.EX.true}AND{'74'.EX.false}AND{'1'.OAF.'12-12-2022'}"})]});I({dataset:"releases",data:l}),h.value=!1}else h.value=!1},Y=s=>{const l=s.split(" ");let i="";return l.forEach((m,W)=>{i+=W>0?` ${p(m.toLowerCase())}`:p(m.toLowerCase())}),i},j=async()=>{a.loading.show(),await z(),a.loading.hide()};function G(s){d.push({name:"view-release",params:{release:s[3]}})}const M=Q(()=>[...new Map(S.value.map(s=>[s[92],s[92]])).values()].filter(s=>s!==""));return T(),{search:c,columns:L,rows:C,loadData:T,loading:h,statusFilter:f,checkForUpdates:j,viewRelease:G,dispositionFilter:t,dispositions:H,submissionStatus:u,hiringStatusFilter:b,hiringStatusOptions:M,possibleReassignment:V}}}),$e={class:"row items-center"},ye={class:"col-12 col-md-2 q-px-sm"},Ve={class:"col-12 col-md-2 q-px-sm"},Se={class:"col-12 col-md-2 q-px-sm"},Qe={class:"col-12 col-md-2 q-px-sm"},ke={class:"col-12 col-md-2 q-px-sm"},qe={class:"col-12 col-md-2 q-px-sm"},_e={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Re={class:"text-dark text-caption text-italic"};function De(e,a,d,p,c,u){const f=B("get-worker-cell");return v(),k("div",null,[o(le,{flat:""},{default:n(()=>[o(ae,null,{default:n(()=>[r("div",$e,[r("div",ye,[o(oe,{dense:"",modelValue:e.search,"onUpdate:modelValue":a[0]||(a[0]=t=>e.search=t),label:"Search"},null,8,["modelValue"])]),r("div",Ve,[o(w,{dense:"",label:"Employment Status","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.statusFilter,"onUpdate:modelValue":a[1]||(a[1]=t=>e.statusFilter=t),options:["Active","Terminated"],clearable:""},null,8,["modelValue"])]),r("div",Se,[o(w,{dense:"",label:"Hiring Status","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.hiringStatusFilter,"onUpdate:modelValue":a[2]||(a[2]=t=>e.hiringStatusFilter=t),options:e.hiringStatusOptions,clearable:""},null,8,["modelValue","options"])]),r("div",Qe,[o(w,{dense:"",label:"Submission Status","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.submissionStatus,"onUpdate:modelValue":a[3]||(a[3]=t=>e.submissionStatus=t),options:["Processed","Pending","Cancelled","Submitted","Rescinded"],clearable:""},null,8,["modelValue"])]),r("div",ke,[o(w,{dense:"",label:"Disposition","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.dispositionFilter,"onUpdate:modelValue":a[4]||(a[4]=t=>e.dispositionFilter=t),options:e.dispositions,clearable:""},null,8,["modelValue","options"])]),r("div",qe,[o(w,{dense:"",label:"Possible Reassignment","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.possibleReassignment,"onUpdate:modelValue":a[5]||(a[5]=t=>e.possibleReassignment=t),options:["Yes","No"],clearable:""},null,8,["modelValue"])])])]),_:1})]),_:1}),r("div",null,[o(re,{title:"Departures","title-class":"text-h5 text-primary",columns:e.columns,rows:e.rows,"row-key":t=>t[3],class:"q-pa-sm",pagination:{rowsPerPage:100},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent departures",dense:"",loading:e.loading},{header:n(t=>[o(N,{class:"bg-dark text-white",props:t},{default:n(()=>[o(q,{"auto-width":""}),(v(!0),k(A,null,x(t.cols,b=>(v(),y(q,{key:b.name,props:t},{default:n(()=>[P($(b.label),1)]),_:2},1032,["props"]))),128)),o(q,{"auto-width":""})]),_:2},1032,["props"])]),body:n(t=>[o(N,{props:t},{default:n(()=>[o(_,{"auto-width":""},{default:n(()=>[o(U,{class:"cursor-pointer",size:e.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:b=>e.viewRelease(t.row),name:t.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(v(!0),k(A,null,x(t.cols,b=>(v(),y(_,{key:b.name,props:t},{default:n(()=>[P($(b.value),1)]),_:2},1032,["props"]))),128)),o(f,{id:t.row[50],release:t.row},null,8,["id","release"])]),_:2},1032,["props"])]),"no-data":n(({message:t})=>[r("div",_e,[o(U,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),r("span",null,$(t),1)])]),"top-right":n(()=>[r("div",Re,"(Total: "+$(e.rows.length)+" departures)",1),o(ne,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:a[6]||(a[6]=t=>e.loadData(!0))})]),loading:n(()=>[o(de,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key","loading"])])])}var Fe=D(he,[["render",De]]);const Ce=R({name:"Admin",components:{ReleasesPanel:Fe},setup(){const e=g(0);return O(),{tab:e}}}),Te={class:"q-pa-sm"};function Ae(e,a,d,p,c,u){const f=B("releases-panel");return v(),y(te,{style:{"max-width":"100vw"}},{default:n(()=>[r("div",Te,[o(ee,{class:"q-py-xs q-px-sm bg-info text-white shadow-2 rounded-borders",align:"left",modelValue:e.tab,"onUpdate:modelValue":a[0]||(a[0]=t=>e.tab=t),dense:"","indicator-color":"accent","outside-arrows":"","mobile-arrows":"","inline-label":""},{default:n(()=>[o(Z,{name:0,label:"Departures"})]),_:1},8,["modelValue"]),o(K,{modelValue:e.tab,"onUpdate:modelValue":a[1]||(a[1]=t=>e.tab=t),animated:"",class:"q-px-none"},{default:n(()=>[o(J,{class:"q-px-xs",name:0},{default:n(()=>[o(f)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var bt=D(Ce,[["render",Ae]]);export{bt as default};
