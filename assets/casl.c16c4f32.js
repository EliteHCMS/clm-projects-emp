import{k as q,r as k,i as v,f as w,l as m}from"./index.4c9f8c37.js";import{o as R,z as I,a as y,q as t}from"./quickbase.d4bab664.js";import"./_commonjsHelpers.dfee5925.js";import"./dayjs.acb2046f.js";import"./localForage.55355626.js";import"./index.7dbe61ef.js";import"./i18n.7cca90cb.js";import"./api.28aa76b3.js";function P(r){if(r.hasOwnProperty("possibleRulesFor"))return r;var a=k(!0);r.on("updated",function(){a.value=!a.value});var e=r.possibleRulesFor.bind(r);return r.possibleRulesFor=function(o,i){return a.value=a.value,e(o,i)},r.can=r.can.bind(r),r.cannot=r.cannot.bind(r),r}var b=Symbol("ability");function S(){var r=v(b);if(!r)throw new Error("Cannot inject Ability instance because it was not provided");return r}function N(r){return"a"in r?"a":"this"in r?"this":"an"in r?"an":""}q({name:"Can",props:{I:String,do:String,a:[String,Function],an:[String,Function],this:[String,Function,Object],on:[String,Function,Object],not:Boolean,passThrough:Boolean,field:String},setup:function(a,e){var o=e.slots,i=a,n="do",s="on";if(n in a||(n="I",s=N(a)),!i[n])throw new Error("Neither `I` nor `do` prop was passed in <Can>");if(!o.default)throw new Error("Expects to receive default slot");var f=S();return function(){var d=f.can(i[n],i[s],i.field),l=a.not?!d:d;return a.passThrough?o.default({allowed:l,ability:f}):l?o.default():null}}});function O(r,a,e){if(!a||!(a instanceof R))throw new Error("Please provide an Ability instance to abilitiesPlugin plugin");r.provide(b,P(a)),e&&e.useGlobalProperties&&(r.config.globalProperties.$ability=a,r.config.globalProperties.$can=a.can.bind(a))}const j=r=>r.matched.some(a=>y.can(a.meta.action||"read",a.meta.resource));var B=w(({app:r,router:a})=>{r.config.globalProperties.$subject=I,r.use(O,y,{useGlobalProperties:!0}),a.beforeEach(async(e,o,i)=>{const n=await t.isUserLoggedIn(),s=Object.assign({},e.query);if(n||t.logout(),s.office_id&&(t.setOfficeLocation({rid:s.office_id}),s.qr&s.qr==="3422"&&t.setCheckIn(!0)),o.fullPath==="/"&&!o.name&&(n?await t.reloadUserInfo({reAuthenticate:!0}):m.pageType==="Candidate Kiosk"&&await t.updateStore()),!j(e)){const c=e.path!=="/";return!n&&m.pageType==="Candidate Kiosk"&&m.startPage?i({name:"start"}):i(n?{name:"not-authorized"}:{name:"login",query:{...c&&{redirect:e.path}}})}if(m.pageType==="Candidate Kiosk"&&e.name!=="bookmarks"&&e.name!=="start"){const c=await t.bookmarksValid(),h=await t.bookMarksOnly();if(c&&h)return i({name:"bookmarks"})}if(e.name==="bookmarks"&&!await t.bookmarksValid())return t.clearBookmarks(),i("/");if(e.meta.redirectIfLoggedIn&&n)return i("/");const f=await t.phoneNumberRequired(n),d=await t.emailRequired(n),l=await t.verifyRequired(n),p=await t.employeeLinkRequired(n),u=await t.getUserFromStore(n),g=await t.getSocialRequired(n);if(f||d)return o.name==="update-information"&&n&&e.query.rid?(e.query.phoneNumber&&await t.setPhoneNumber(e.query.phoneNumber),e.query.email&&await t.setEmail(e.query.email),i({path:"/",query:{}})):e.name!=="update-information"?i({name:"update-information",query:{rid:u[3],...f&&{phoneNumberRequired:!0},...d&&{emailRequired:!0}}}):Object.keys(e.query).length===0&&o.name!=="update-information"?i({name:"update-information",query:{rid:u[3],...f&&{phoneNumberRequired:!0},...d&&{emailRequired:!0}}}):i();if(o.name==="update-information"&&Object.keys(e.query).length>=1)return i({path:"/",query:{}});if(l)return o.name==="code-confirmation"&&n&&e.query.code?(await t.setVerified(!0),i({path:"/"})):e.name!=="code-confirmation"?i({name:"code-confirmation",query:{p:u[9]?u[9].phoneNumber:u[8].replace(/[^0-9]/g,""),rid:u[3]}}):Object.keys(e.query).length===0&&o.name!=="code-confirmation"?i({name:"code-confirmation",query:{p:u[9]?u[9].phoneNumber:u[8].replace(/[^0-9]/g,""),rid:u[3]}}):i();if(p||g)return o.name==="verify-identity"&&n&&e.query.verify?(e.query.rid?await t.setIdentityVerified(e.query.rid):await t.setIdentityVerified(!1),i({path:"/",query:{}})):e.name!=="verify-identity"?i({name:"verify-identity",query:{rid:u[3]}}):Object.keys(e.query).length===0&&o.name!=="verify-identity"?i({name:"verify-identity",query:{rid:u[3]}}):i();if(e.name==="verify-identity"){if(!p)return i({path:"/"})}else if(e.name==="code-confirmation")return!n&&e.query.ac?i():i({path:"/"});return i()}),a.afterEach(async(e,o)=>{const i=await t.isUserLoggedIn();o.fullPath==="/"&&!o.name&&i&&await t.updateStore({reAuthenticate:!1})})});export{B as default};
