import{Q as he}from"./QImg.b9a8384a.js";import{_ as le,a4 as J,r as v,c as oe,w as T,A as t,B as _,d as y,br as g,ar as r,ax as ee,ac as L,cT as M,bO as ue,bN as re,aq as E,cU as se,a8 as f,b as ae,bW as ie,D as R,b1 as ge,a$ as be,bU as ye,bT as _e,cS as qe,G as Ne,bQ as xe,cV as we}from"./index.6ad28899.js";import{Q as ne}from"./QForm.8b10ff15.js";import{Q as $e}from"./QPage.50af9100.js";import{u as de}from"./use-quasar.32520ede.js";import{u as W,a as ke}from"./vee-validate.esm.8e982689.js";import{u as Ce}from"./i18n.693194ed.js";import{u as ce,q as P,b as Se}from"./app.ae18e828.js";import{api as me}from"./api.2d8f8822.js";import{_ as Ie}from"./languageSelector.395c7919.js";import{p as Ee}from"./VueTelInput.59ef2204.js";import{c as I,a as H}from"./array.59f93f43.js";import{dayjs as O}from"./dayjs.32f0a35d.js";import{c as Re}from"./carousel.4a3c6ec5.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.b23cd6d4.js";import"./index.04bc0a32.js";import"./QSelect.a35c72f5.js";import"./QChip.26ec4575.js";import"./QMenu.798567a6.js";import"./position-engine.eb4313f6.js";import"./selection.53968a35.js";import"./rtl.b51694b1.js";import"./use-panel.7c10604f.js";import"./touch.3df10340.js";import"./use-fullscreen.b062bb91.js";const ve=Q=>(ge("data-v-0fccbf6d"),Q=Q(),be(),Q),De={key:0,class:"text-dark"},Ue={key:1,class:"text-dark"},Me={key:2,class:"text-dark"},Ve={key:3,class:"text-dark"},Pe={key:4,class:"text-dark"},Qe=ve(()=>R("br",null,null,-1)),Ae={key:5,class:"text-dark"},je=ve(()=>R("br",null,null,-1)),Oe={key:2,class:"text-grey-6 text-right"},Te={key:3,class:"text-grey-6 text-right"},Le={__name:"codeComponent",props:{phoneNumber:String,email:String,type:String,rid:String},emits:["verified"],setup(Q,{emit:C}){const D=Q,U=de(),q=ce(),w=J(D,"phoneNumber"),e=J(D,"email"),a=J(D,"type"),l=v("code-confirmation"),b=v(Math.floor(1e5+Math.random()*9e5)),s=v(null),h=v(!1),i=v(!1),n=v(!1),p=v(0),c=J(D,"rid"),{value:S}=W("codeConfirmation",I().matches(/^[0-9]{6}/g,{excludeEmptyString:!0,message:"Code Not Valid!"}).required().oneOf([b.value],"Code Not Valid!")),te=oe(()=>S.value===b.value),B=d=>{const o=Math.floor(d/6e4),m=(d%6e4/1e3).toFixed(0);return o+":"+(m<10?"0":"")+m};T(a,d=>{b.value=null,S.value=null,h.value=!1,b.value=null,s.value=null,l.value="code-confirmation"}),T(p,d=>{d===0?(h.value=!0,b.value=null,s.value=null):h.value=!1}),T(S,async d=>{Number(d)===b.value&&(U.notify({position:"top-right",type:"positive",message:"Code Verified!"}),a.value==="phone-number"?X():a.value==="email"&&F())});const $=async()=>{n.value=!0,l.value==="code-confirmation"?(b.value=Math.floor(1e5+Math.random()*9e5),S.value=null,s.value=O().add(5,"minute").toISOString(),a.value==="phone-number"?(await me.createMessage({contact:w.value,to:w.value,message:`Your Brandsafway Verification Code is: ${b.value}`,messagingServiceSid:"MGd0e31773980318b7cdc5d2043117e27c",send:!0,readBy:[],status:"pending"}),n.value=!1,U.notify({position:"top-right",type:"info",message:"Text message sent!"}),s.value=O().add(1,"minute")):a.value==="email"&&(await A(),n.value=!1,U.notify({position:"top-right",type:"info",message:"Email sent!"}),s.value=O().add(2,"minute")),n.value=!1,N(),l.value="code-sent"):n.value=!1},N=()=>{const d=setInterval(()=>{p.value=O(s.value).valueOf()-O().valueOf(),p.value<=0&&(p.value=0,clearInterval(d))},1e3)},A=async()=>{if(!c.value||c.value==="")return!1;const d=await P.isUserLoggedIn(),o=new Date;b.value||(b.value=Math.floor(1e5+Math.random()*9e5));const m={3:{value:c.value},26:{value:o},87:{value:o},88:{value:b.value},47:{value:!0}};try{return d?await P.updateUserData({fields:m}):await P.upsertRecordsXML({to:"br4pxrbs6",fieldsToReturn:[76],data:[m],formatObject:76})}catch(j){U.notify({position:"top-right",type:"negative",message:j.message||"Error updating Verification!"})}},X=async()=>{if(i.value=!0,!c.value||c.value==="")return i.value=!1,!1;const d=new Date,o={3:{value:c.value},26:{value:d},50:{value:!0}};try{await P.updateUserData({fields:o}),i.value=!1,C("verified")}catch(m){i.value=!1,U.notify({position:"top-right",type:"negative",message:m.message||"Error updating Verification!"})}},F=async()=>{if(i.value=!0,!c.value||c.value==="")return i.value=!1,!1;const d=new Date,o={3:{value:c.value},26:{value:d},49:{value:!0}};try{await P.updateUserData({fields:o}),i.value=!1,C("verified")}catch(m){i.value=!1,U.notify({position:"top-right",type:"negative",message:m.message||"Error updating Verification!"})}},k=()=>w.value.replace(/(\d{3})(\d{3})(\d{4})/,"******$3"),K=()=>(q.userLoggedIn?q.user[34]:e.value||"").replace(/(.{2})(.*)(?=@)/,function(o,m,j){for(let z=0;z<j.length;z++)m+="*";return m});return T(()=>D.phoneNumber,()=>{console.log(D)}),(d,o)=>(t(),_("div",null,[y(M,{class:"text-center auth-description"},{default:g(()=>[l.value==="code-sent"&&a.value==="phone-number"?(t(),_("p",De,"A text message with a verification code has been sent to your phone.")):r("",!0),l.value==="code-sent"&&a.value==="email"?(t(),_("p",Ue,"A verification code has been sent to your email. ")):r("",!0),l.value==="code-confirmation"&&a.value==="phone-number"?(t(),_("p",Me,"Your Phone Number needs to be verified click the button below to verify.")):r("",!0),l.value==="code-confirmation"&&a.value==="email"?(t(),_("p",Ve,"Your Email needs to be verified click the button below to verify.")):r("",!0),l.value==="code-confirmation"&&a.value==="phone-number"?(t(),_("p",Pe,[Qe,ee(L(k()),1)])):r("",!0),l.value==="code-confirmation"&&a.value==="email"?(t(),_("p",Ae,[je,ee(L(K()),1)])):r("",!0)]),_:1}),y(M,null,{default:g(()=>[y(ne,{class:"q-px-sm q-pt-sm",onSubmit:o[3]||(o[3]=ue(()=>{},["prevent"])),onKeyup:re($,["enter"])},{default:g(()=>[l.value==="code-sent"?(t(),E(se,{key:0,class:"col-xs-12 col-sm-6 q-pb-md",clearable:!i.value,outlined:"",disable:h.value,loading:i.value,modelValue:f(S),"onUpdate:modelValue":o[0]||(o[0]=m=>ae(S)?S.value=m:null),type:"text",autocomplete:"one-time-code",inputmode:"numeric",pattern:"[0-9]*",label:"Code",tabindex:"1",maxlength:"6",minlength:"6",name:"codeConfirmation",error:!!te.value,"error-message":"Code does not match!"},{append:g(()=>[ee(L(B(p.value))+"\xA0 ",1)]),_:1},8,["clearable","disable","loading","modelValue","error"])):r("",!0),l.value==="code-confirmation"?(t(),E(ie,{key:1,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:"Send Code",tabindex:"1",loading:n.value,onClick:$},null,8,["loading"])):r("",!0),a.value==="phone-number"&&e.value!==""?(t(),_("p",Oe,[R("a",{href:"javascript:void(0);",onClick:o[1]||(o[1]=m=>a.value="email")},"Use Email")])):r("",!0),a.value==="email"&&w.value!==""?(t(),_("p",Te,[R("a",{href:"javascript:void(0);",onClick:o[2]||(o[2]=m=>a.value="phone-number")},"Use Phone Number")])):r("",!0),l.value==="code-sent"?(t(),E(M,{key:4,class:"q-py-none row justify-center"},{default:g(()=>[p.value===0?(t(),_("a",{key:0,onClick:$,class:"text-grey-6",href:"javascript:void(0);",tabindex:"2"},"Resend Code")):r("",!0)]),_:1})):r("",!0)]),_:1},8,["onKeyup"])]),_:1})]))}};var Be=le(Le,[["__scopeId","data-v-0fccbf6d"]]);const Fe={key:0,class:"col-md-7 col-lg-8 col-lx-8"},Ke={class:"col-xs-12 col-sm-12 col-md-5 col-lg-4 col-lx-4 row justify-center items-center"},ze={class:"text-dark"},Ye={key:0,class:"row q-col-gutter-xs"},Ge={key:1,class:"row q-col-gutter-xs"},Je={class:"text-grey-6"},He={class:"row justify-center"},We={__name:"updateInfo",setup(Q){const C=de(),D=ce(),{currentUserType:U}=Se(),q=ye(),w=_e(),{t:e}=Ce(),a=v(!1),l=v("update-information"),b=v(10),s=v(!1),h=v(!1),i=v(null),n=v(null),p=v(!1),c=v(!1),S=oe(()=>{const u=new RegExp("^[0-9]{"+b.value+"}","g");return h.value&&s.value?H({email:I().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:I().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)}):h.value&&!s.value?H({email:I().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:I().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).label(`${e("phoneNumber")}`)}):!h.value&&s.value?H({email:I().email(`${e("validEmailIsRequired")}`).label(`${e("email")}`),phoneNumber:I().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)}):H({email:I().email(`${e("validEmailIsRequired")}`).required().label(`${e("email")}`),phoneNumber:I().matches(u,{excludeEmptyString:!0,message:`${e("validPhoneIsRequired")}`}).required().label(`${e("phoneNumber")}`)})}),{errors:te,meta:B}=ke({validationSchema:S,initialValues:{phoneNumber:"",email:""}}),{value:$}=W("userRID"),{value:N,errorMessage:A,setErrors:X,meta:F}=W("phoneNumber"),{value:k,errorMessage:K,setErrors:d,meta:o}=W("email");v(!0),q.query.rid?($.value=q.query.rid,q.query.emailRequired&&(h.value=!0),q.query.phoneNumberRequired&&(s.value=!0),w.replace({query:{}})):w.push("/"),T(()=>q.query,()=>{q.query.rid&&($.value=q.query.rid,q.query.emailRequired&&(h.value=!0),q.query.phoneNumberRequired&&(s.value=!0),w.replace({query:{}}))});const m=u=>{b.value=u},j=u=>{i.value=u},z=()=>{D.logout().then(()=>{w.replace({name:"login"})})},Z=async()=>{if(a.value=!0,!B.value.valid)return a.value=!1,!1;if(!$.value||$.value==="")return a.value=!0,!1;const u=new Date;let x={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1};if(s.value){if(n.value=await me.twilioLookup({phoneNumber:N.value}),n.value&&(N.e164=n.value.phoneNumber,delete n.value.url,delete n.value.price,delete n.value.phoneNumber,delete n.value.addOns),n.value&&n.value.validPhoneNumber===!1)return X(`${e("validPhoneIsRequired")}`),C.notify({type:"negative",message:`${e("validPhoneIsRequired")}`,timeout:7e3,position:C.screen.lt.md?"top":"top-right"}),a.value=!1,null;x=Object.assign({phoneNumber:N.value},i.value,n.value||{})}if(h.value&&k.value===""&&n.value&&n.value.validPhoneNumber===!1)return d(`${e("validEmailIsRequired")}`),C.notify({type:"negative",message:`${e("validEmailIsRequired")}`,timeout:7e3,position:C.screen.lt.md?"top":"top-right"}),a.value=!1,null;const V={...s.value&&{8:{value:`+${i.value?i.value.dialCode:"1"}${N.value}`}},...s.value&&{9:{value:JSON.stringify(x)}},...s.value&&{111:{value:!1}},...h.value&&{6:{value:k.value}},...h.value&&{112:{value:!1}},26:{value:u}};try{await P.updateUserData({fields:V}),a.value=!1,w.push({path:"/",query:{rid:$.value,...s.value&&{phoneNumber:`+${i.value?i.value.dialCode:"1"}${N.value}`},...h.value&&{email:k.value}}})}catch(Y){c.value=!1,p.value=!1,Y.lineErrors&&Y.lineErrors.forEach(G=>{G.includes('is not unique for unique formula field with ID "27"')&&(c.value=!0),G.includes('The field named "uniqueEmail" with field id 27 requires a unique value.')&&(c.value=!0),G.includes('is not unique for unique formula field with ID "28"')&&(p.value=!0),G.includes('The field named "uniquePhoneNumber" with field id 28 requires a unique value.')&&(p.value=!0)}),p.value||c.value?l.value="code-confirmation":C.notify({position:"top-right",type:"negative",message:Y.message||"Error updating Information!"})}},pe=async()=>{try{const u=new Date,x={phoneNumber:"N/A",name:"United States",iso2:"US",dialCode:"1",iso2sm:"us",callerName:null,countryCode:"US",nationalFormat:"N/A",carrier:null,validPhoneNumber:!1},V=[{...p.value&&{8:{value:""}},...p.value&&{9:{value:JSON.stringify(x)}},...p.value&&{50:{value:!1}},...p.value&&{111:{value:!0}},26:{value:u},...c.value&&{6:{value:""}},...c.value&&{49:{value:!1}},...c.value&&{112:{value:!0}}}];return await P.findAndUpdateUser({...p.value&&{phoneNumber:`+${i.value?i.value.dialCode:"1"}${N.value}`},...c.value&&{email:k.value},userType:U,fields:V})}catch(u){console.log(u)}},fe=async()=>{l.value="update-information",await pe(),await Z()};return(u,x)=>(t(),E($e,{class:"window-height window-width row"},{default:g(()=>[f(C).screen.lt.md?r("",!0):(t(),_("div",Fe,[y(Re)])),R("div",Ke,[y(qe,{class:"auth-card",flat:""},{default:g(()=>[y(M,{style:{"padding-left":"30px","padding-right":"30px"}},{default:g(()=>[y(he,{src:"https://cdn.jsdelivr.net/gh/EliteHCMS/assets@latest/public/logo.svg",fit:"scale-down",class:"auth-logo full-width"})]),_:1}),l.value==="update-information"?(t(),E(M,{key:0,class:"text-center auth-description"},{default:g(()=>[R("p",ze,L(u.$t("pleaseUpdateInformation")),1)]),_:1})):r("",!0),l.value==="update-information"?(t(),E(M,{key:1},{default:g(()=>[y(ne,{class:"q-px-sm q-pt-sm",onSubmit:x[2]||(x[2]=ue(()=>{},["prevent"])),onKeyup:re(Z,["enter"])},{default:g(()=>[s.value?(t(),_("div",Ye,[y(Ee,{name:"phoneNumber",class:Ne(["col-xs-12 col-sm-12",{"q-pb-lg":f(A)&&f(F).validated}]),outlined:"",modelValue:f(N),"onUpdate:modelValue":x[0]||(x[0]=V=>ae(N)?N.value=V:null),label:u.$t("phoneNumber"),tabindex:"3",onMaxLengthChanged:m,error:!!(f(A)&&f(F).validated),"error-message":f(A),onCountryChanged:j},null,8,["class","modelValue","label","error","error-message"])])):r("",!0),h.value?(t(),_("div",Ge,[y(se,{class:"col-xs-12 col-sm-12 q-pb-lg",clearable:"",outlined:"",modelValue:f(k),"onUpdate:modelValue":x[1]||(x[1]=V=>ae(k)?k.value=V:null),type:"email",autocomplete:"email",label:u.$t("email"),tabindex:"4",name:"email",error:!!(f(K)&&f(o).validated),"error-message":f(K)},{prepend:g(()=>[y(xe,{name:"email"})]),_:1},8,["modelValue","label","error","error-message"])])):r("",!0)]),_:1},8,["onKeyup"])]),_:1})):r("",!0),l.value==="code-confirmation"?(t(),E(Be,{key:2,onVerified:fe,phoneNumber:f(N),email:f(k),type:s.value?"phone-number":"email",rid:f($)},null,8,["phoneNumber","email","type","rid"])):r("",!0),l.value==="update-information"?(t(),E(we,{key:3,class:"q-px-lg"},{default:g(()=>[l.value==="update-information"?(t(),E(ie,{key:0,ref:"confirm",loading:a.value,disable:!f(B).valid,unelevated:"",size:"lg",color:"primary",class:"full-width text-white",label:u.$t("confirm"),tabindex:"3",onClick:Z},null,8,["loading","disable","label"])):r("",!0)]),_:1})):r("",!0),y(M,{class:"text-center q-pa-sm"},{default:g(()=>[R("p",Je,[R("a",{onClick:z,class:"text-grey-6",href:"javascript:void(0);",tabindex:"4"},L(u.$t("logout")),1)])]),_:1}),y(M,{class:"q-pl-lg q-pa-sm"},{default:g(()=>[R("div",He,[y(Ie,{dense:"",borderless:""})])]),_:1})]),_:1})])]),_:1}))}};var wa=le(We,[["__scopeId","data-v-711f1fb5"]]);export{wa as default};
