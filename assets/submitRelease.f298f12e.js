import{u as b,q as u}from"./quickbase.a8fc0a6c.js";import{dayjs as p}from"./dayjs.7d293816.js";import{u as T}from"./dataStore.f8ad13a8.js";import{u as S}from"./dataStore.6d323eeb.js";import{k as L}from"./index.b77499f4.js";const D=async({employee:a,assignment:e,effectiveNow:c,values:s,attachments:l,ratings:o,supervisor:t})=>{const{userData:i,getUserType:v}=b(),n=i;n.access&&delete n.access,n.permissions&&delete n.permissions;const R=[{25:{value:a[3]},28:{value:e[3]},30:{value:s.selection[10]},35:{value:e[142]},36:{value:s.effective},38:{value:JSON.stringify(n)},39:{value:v!=="QuickBase User"},60:{value:o.comments?o.comments:""},72:{value:s.equipment.value}}];if(c){const{ee:m,assign:r}=await M({assignment:e,supervisor:t}),{data:f}=await u.upsertRecordsXML({to:"bp3ga39ut",data:R,fieldsToReturn:[37],formatObject:37},{action:"create",type:"release"}),{release:d}=await O({release:f[0][37][3],employee:f[0][37][25],ratings:o,user:n,supervisor:t});if(l.length>0){const{docs:g}=await j({release:d,attachments:l,user:n});return d[70]=g.map(w=>w[12]),{release:d,employee:m,assignment:r,attachments:g}}else return{release:d,employee:m,assignment:r,attachments:[]}}else{const{data:m}=await u.upsertRecordsXML({to:"bp3ga39ut",data:R,fieldsToReturn:[37],formatObject:37},{action:"create",type:"release"});t&&X({assignment:e,supervisor:t});const{release:r}=await O({release:m[0][37][3],employee:m[0][37][25],ratings:o,user:n,supervisor:t});if(l.length>0){const{docs:f}=await j({release:r,attachments:l,user:n});return r[70]=f.map(d=>d[12]),{release:r,employee:a,assignment:e,attachments:f}}else return{release:r,employee:a,assignment:e,attachments:[]}}},O=async({release:a,employee:e,ratings:c,user:s,supervisor:l})=>{const o={6:{value:c.attendance},8:{value:c.attitude},10:{value:c.capability},12:{value:c.promotable},14:{value:c.comments?c.comments:""},16:{value:e},34:{value:a},36:{value:JSON.stringify(s)}};l&&Object.assign(o,{42:{value:l[18]}});const{data:t}=await u.upsertRecordsXML({to:"bqzkbcxup",data:[o],fieldsToReturn:[35],formatObject:35});return{release:t[0][35]}},j=async({release:a,attachments:e,user:c})=>{const s=[];e.forEach(o=>{Object.assign(o,{8:{value:JSON.stringify(c)},9:{value:a[3]},10:{value:a[25]}}),s.push(o)});const{data:l}=await u.upsertRecordsXML({to:"bsstsai5d",data:s,fieldsToReturn:[12],formatObject:12});return{docs:l}},M=async({assignment:a,supervisor:e,id:c})=>{const{removeData:s}=T(),{removeFromRoster:l}=S(),o={3:{value:c||a[3]},21:{value:"Complete"},22:{value:p()}};e&&Object.assign(o,{133:{value:e[3]}});const{data:t}=await u.upsertRecordsXML({to:"bp3gazpqj",data:[o],fieldsToReturn:[110],formatObject:110});return l({id:t[0][110][74],data:t[0]}),s({type:"assignments",key:t[0][110][74],item:t[0][110],storageKey:L.storageAssignments}),{ee:await y({3:{value:t[0][110][18]},79:{value:19}}),assign:t[0][110]}},y=async a=>{const{data:e}=await u.upsertRecordsXML({to:"bp3gb7ng2",data:[a],fieldsToReturn:[549],formatObject:549});return e[0][549]},X=async({assignment:a,supervisor:e})=>{u.upsertRecordsXML({to:"bp3gazpqj",data:[{3:{value:a[3]},133:{value:e[3]}}],fieldsToReturn:[110],formatObject:110})},k=async({release:a,disp:e})=>{const{userData:c}=b(),s=c;s.access&&delete s.access,s.permissions&&delete s.permissions;const l={3:{value:a[3]},42:{value:e.value==="Terminate"?"Reviewed":"Complete"},43:{value:e.value},73:{value:e.value==="Terminate"?"Pending":"Cancelled"},75:{value:JSON.stringify(s)},77:{value:p()}},o=e.value==="Terminate"?19:15,t=await y({3:{value:a[25]},79:{value:o},16:{value:a[35]}}),{data:i}=await u.upsertRecordsXML({to:"bp3ga39ut",data:[l],fieldsToReturn:[37],formatObject:37},{action:"update",type:"release"});return{release:i[0][37],employee:t}},z=async({release:a,fid:e,entryMoment:c,workdayData:s})=>{const{userData:l}=b(),o=e||37,t=l;t.access&&delete t.access,t.permissions&&delete t.permissions;const i=[{3:{value:a[3]},42:{value:"Complete"},73:{value:"Processed"},76:{value:JSON.stringify(t)},78:{value:p(c)||p()},106:{value:s?JSON.stringify(s):""}}];y({3:{value:a[25]},79:{value:""},122:{value:""}});const{data:v}=await u.upsertRecordsXML({to:"bp3ga39ut",data:i,fieldsToReturn:[o],formatObject:o},{action:"update",type:"release"});return{data:v[0][o]}};export{k as f,M as r,D as s,z as t};
