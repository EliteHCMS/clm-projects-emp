import{Q as F}from"./QPage.f2628afe.js";import{l as w,c as b,_ as k,A as a,B as m,d as i,bi as n,D as s,ab as f,bJ as O,bH as j,au as N,cy as V,bO as x,bF as H,r as U,aZ as A,an as y,cw as _,cz as Q,ao as h,F as C,aY as I,bk as B,bI as L,cZ as T,bM as z,w as J,G as W}from"./index.b48bafa3.js";import{u as P}from"./useQuerySaver.b8f46e72.js";import{q as E}from"./quickbase.76c41fac.js";import{u as M}from"./dataStore.beef04c5.js";import{Q as G}from"./QSelect.b8f07e1a.js";import{Q as Z}from"./QForm.fc9a358b.js";import{a as X,u as K}from"./vee-validate.esm.caf1489b.js";import{a as R}from"./array.b59bb1b2.js";import{u as ee}from"./use-quasar.ed3977b0.js";import{u as te}from"./dataStore.708e0494.js";import{dayjs as v}from"./dayjs.1b825f16.js";import{Q as se}from"./QRating.2f06f6a3.js";import{Q as oe}from"./QList.fb685d10.js";import{d as ae}from"./helpers.983c4b26.js";import{d as le}from"./decode.593c6ccc.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./localForage.81a16957.js";import"./i18n.469ad19f.js";import"./api.004b0e8a.js";import"./QChip.a60f92f6.js";import"./QItemLabel.6755a8b9.js";import"./QMenu.c9ecf4aa.js";import"./position-engine.859102af.js";import"./selection.880c234f.js";import"./rtl.cf9bbe47.js";const ne=w({emits:["supUpdated"],props:{record:Object},setup(e,{emit:c}){const u=ee(),{getAssignments:o,fetchAssignments:r}=te(),l=b(()=>o(e.record[74]).filter($=>$[138]&&$[3]!==e.record[3]).sort(($,D)=>$[75]>D[75]?1:-1)),t=b(()=>R({selection:R().required().nullable().label("Supervisor")})),{errors:p,handleSubmit:d,handleReset:g}=X({validationSchema:t}),{value:S}=K("selection"),Y=d(async q=>{const $=[{3:{value:e.record[3]},133:{value:q.selection[3]}}];try{const{data:D}=await E.upsertRecordsXML({to:"bp3gazpqj",data:$,fieldsToReturn:[110],formatObject:110});console.log(D),c("supUpdated",D[0][110]),u.notify({type:"positive",message:"Supervisor successfully updated!"})}catch(D){console.log(D),u.notify({type:"negative",message:"Cannot save supervisor."}),g()}});return r({projectId:e.record[74],refresh:!0}),{props:e,options:l,selection:S,submit:Y,formErrors:p,handleReset:g}}}),ie={class:"text-caption"};function re(e,c,u,o,r,l){return a(),m("div",null,[i(Z,{onSubmit:H(e.submit,["prevent"])},{default:n(()=>[i(G,{dense:"",clearable:"",label:"Select a Supervisor","transition-show":"flip-up","transition-hide":"flip-down",modelValue:e.selection,"onUpdate:modelValue":c[0]||(c[0]=t=>e.selection=t),options:e.options,"option-label":t=>`${t[75]} - ${t[20]}`,"display-value":`${e.selection?e.selection[75]:""}`,"bottom-slots":"",error:!!e.formErrors.selection},{error:n(()=>[s("div",ie,f(e.formErrors.selection),1)]),"no-option":n(()=>[i(O,null,{default:n(()=>[i(j,{class:"text-grey"},{default:n(()=>[N(" No Options Available ")]),_:1})]),_:1})]),_:1},8,["modelValue","options","option-label","display-value","error"]),i(V,{align:"right"},{default:n(()=>[i(x,{color:"info",label:"Submit",type:"submit"}),i(x,{color:"secondary",label:"Cancel",onClick:e.handleReset},null,8,["onClick"])]),_:1})]),_:1},8,["onSubmit"])])}var de=k(ne,[["render",re]]);const ce=w({props:{employee:Object,assignment:Object},components:{UpdateSupervisor:de},setup(e){const c=U(!1),{setAssignmentsByEmployee:u}=M();return{props:e,supUpdated:r=>{c.value=!1,u({id:r[18],data:r})},editSup:c}}}),ue=s("div",{class:"text-h6 q-pb-sm"},"Assign a Supervisor",-1),me={class:"row text-body2"},pe={class:"col-12 col-md-6"},ve=s("div",{class:"q-mb-xs"},"Current Location",-1),fe={class:"q-pl-sm"},ye={class:"col-12 col-md-6"},_e=s("div",{class:"q-mb-xs"},"Current Supervisor",-1),be={class:"q-pl-sm"};function he(e,c,u,o,r,l){const t=A("update-supervisor");return a(),m("div",null,[e.assignment&&e.assignment[3]?(a(),y(Q,{key:0,class:"text-dark"},{default:n(()=>[e.editSup?(a(),y(_,{key:0},{default:n(()=>[ue,i(t,{record:e.assignment,onSupUpdated:e.supUpdated},null,8,["record","onSupUpdated"])]),_:1})):(a(),y(_,{key:1},{default:n(()=>[s("div",me,[s("div",pe,[ve,s("div",fe,f(e.assignment[141]),1)]),s("div",ye,[_e,s("div",be,f(e.assignment[140]===""?"N/A":e.assignment[140]),1)])])]),_:1}))]),_:1})):h("",!0)])}var ge=k(ce,[["render",he]]);const $e=w({props:{employee:Object,assignment:Object},components:{},setup(e){const{getWorkdayData:c}=M(),u=b(()=>[]),o=b(()=>{const d=c(e.employee[3]);if(d){const{employmentData:g}=d,{positionData:S,workerStatus:Y}=g,{jobProfile:q}=S;return[{label:"Position",value:`${S.positionId} ${S.positionTitle}`},{label:"Job Profile",value:`${q.jobProfileId} - ${q.jobProfileName}`},{label:"Hire Date",value:v(Y.hireDate).format("MM/DD/YYYY")},{label:"Original Hire Date",value:v(Y.originalHireDate).format("MM/DD/YYYY")},{label:"Years Since Last Hire",value:v().diff(Y.hireDate,"year",!0).toFixed(2)}]}else return[]}),r=d=>d[145].$d?v(d[145].$d).format("MM/DD/YYYY"):v(d[1].$d).format("MM/DD/YYYY"),l=d=>d[145].$d?v().diff(d[145].$d,"day"):v().diff(d[1].$d,"day"),t=b(()=>e.assignment[3]?[{label:"Project",value:e.assignment[94]},{label:"Job Title",value:e.assignment[20]},{label:"Arrival Date",value:r(e.assignment)},{label:"Days on Site",value:`${l(e.assignment)}`}]:[]),p=b(()=>u.value.concat(t.value).concat(o.value));return{props:e,details:p}}}),De=s("div",{class:"text-h6 text-weight-bold"},"Job Details",-1),we=s("div",{class:"text-body1 text-primary text-italic"},"Employee has a pending release.",-1),ke={class:"row"},Se={class:"col-12 col-md-4"},Ye={class:"text-body2"},qe={class:"col-12 col-md-8"},Ae={class:"text-body2 text-weight-light"};function Ce(e,c,u,o,r,l){return a(),m("div",null,[i(Q,{class:"text-dark"},{default:n(()=>[i(_,{class:"q-pb-sm"},{default:n(()=>[De]),_:1}),e.employee[581]?(a(),y(_,{key:0,class:"q-py-sm"},{default:n(()=>[we]),_:1})):h("",!0),(a(!0),m(C,null,I(e.details,t=>(a(),y(_,{key:t,class:"q-py-sm"},{default:n(()=>[s("div",ke,[s("div",Se,[s("div",Ye,f(t.label),1)]),s("div",qe,[s("div",Ae,f(t.value),1)])])]),_:2},1024))),128))]),_:1})])}var Me=k($e,[["render",Ce]]);const Ie=w({props:{employee:Object},components:{},setup(e){const{getReleases:c,setReleases:u}=M(),o=b(()=>c(e.employee[581])),r=b(()=>{let t;return o.value&&o.value[3]?t=[{label:"Reason",value:o.value[32]},{label:"Last Hire Date",value:v(e.employee[397].$d).format("MM/DD/YYYY")},{label:"Last Day On Site",value:v(o.value[36].$d).format("MM/DD/YYYY")},{label:"Returned Equipment",value:o.value[72]?"Yes":"No"},{label:"Pay Deduct Needed",value:!o.value[72]&&v.duration(v(o.value[36].$d).diff(v(e.employee[397].$d))).asDays()<30?"Yes":"No"},{label:"CAAP Rating",value:o.value[59]&&o.value[59].length>0?o.value[59][0][37]:0,type:"rating"},{label:"Submitted By",value:`${o.value[38][35]} ${o.value[38][37]}`},{label:"Submitted On",value:v(o.value[1].$d).tz(v.tz.guess()).format("MM/DD/YYYY hh:mm a")},{label:"Comments",value:o.value[60],type:"comments"}]:t=[],t});return(async()=>{if(!o.value&&e.employee[581]){const{data:t}=await E.fetchFromHiringApp({fields:[P({type:"releases",query:"",id:e.employee[581]})]},{action:"read",type:"release"});u({id:t[3],data:t})}})(),{releaseDetails:r,release:o,downloadFile:ae}}}),Qe={class:"row items-center"},je=s("div",{class:"col-12 col-md-7"},[s("div",{class:"text-h6 text-weight-bold"},"Pending Release Details")],-1),xe={key:0,class:"col-12 col-md-5"},Ee={class:"row"},Re={class:"col-12 col-md-5"},Oe={class:"text-body2"},Ne={class:"col-12 col-md-7"},Ve={key:0},Pe={key:1,class:"text-body2 text-weight-light"},Fe={key:1,class:"text-body2 text-weight-light"},He={class:"text-body1 text-weight-bold q-mb-xs"},Ue={class:"text-body2 text-italic text-primary q-pl-md"},Be=s("div",{class:"text-body1 text-weight-bold q-mb-xs"},"Supporting Docs",-1);function Le(e,c,u,o,r,l){return a(),m("div",null,[i(Q,{class:"text-dark"},{default:n(()=>[i(_,{class:"q-pb-sm"},{default:n(()=>[s("div",Qe,[je,e.release?(a(),m("div",xe,[i(V,{align:"right"},{default:n(()=>[i(x,{size:"md",flat:"",dense:"",label:"View Release",color:"info",to:{name:"view-ee-release",params:{id:e.release[25],release:e.release[3]}}},null,8,["to"])]),_:1})])):h("",!0)])]),_:1}),(a(!0),m(C,null,I(e.releaseDetails,t=>(a(),m(C,{key:t},[t.type!=="comments"?(a(),y(_,{key:0,class:"q-py-sm"},{default:n(()=>[s("div",Ee,[s("div",Re,[s("div",Oe,f(t.label),1)]),s("div",Ne,[t.type==="rating"?(a(),m("div",Ve,[t.value>0?(a(),y(se,{key:0,modelValue:t.value,"onUpdate:modelValue":p=>t.value=p,max:"5",size:"sm",color:"accent",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"])):(a(),m("div",Pe,"Not Available"))])):(a(),m("div",Fe,f(t.value),1))])])]),_:2},1024)):t.value!==""?(a(),y(_,{key:1},{default:n(()=>[s("div",He,f(t.label),1),s("div",Ue,f(t.value),1)]),_:2},1024)):h("",!0)],64))),128)),e.release&&e.release[70].length>0?(a(),y(_,{key:0},{default:n(()=>[Be,i(oe,null,{default:n(()=>[(a(!0),m(C,null,I(e.release[70],(t,p)=>B((a(),y(O,{key:p,clickable:"",class:"text-body2",onClick:d=>e.downloadFile({tableId:"bsstsai5d",recordId:t[3],fieldId:6,versionNumber:1,name:t[7]})},{default:n(()=>[i(j,null,{default:n(()=>[N(f(p+1)+". "+f(t[7]),1)]),_:2},1024),i(j,{avatar:""},{default:n(()=>[i(L,{color:"info",name:"file_download"})]),_:1})]),_:2},1032,["onClick"])),[[T]])),128))]),_:1})]),_:1})):h("",!0)]),_:1})])}var Te=k(Ie,[["render",Le]]);const ze=w({props:{employee:Object},components:{},setup(e){const{getWorkdayData:c}=M(),u=({id:r,idType:l})=>l.includes("J&amp;E")?`${r.slice(1,4)} / ${r.slice(-5)}`:r,o=b(()=>{const r=c(e.employee[3]);if(r){const{personalData:l}=r;if(l){const{customIds:t}=l.identificationData?l.identificationData:{customIds:[]};return t}else return[]}else return[]});return{props:e,customIds:o,decodeHTML:le,processCustomID:u}}}),Je=s("div",{class:"text-h6 text-weight-bold"},"Employee Identification",-1),We={class:"row"},Ge=s("div",{class:"col-12 col-md-4"},[s("div",{class:"text-body2"},"Workday ID")],-1),Ze={class:"col-12 col-md-8"},Xe={class:"text-body2 text-weight-light"},Ke={class:"row"},et={class:"col-12 col-md-4"},tt={class:"text-body2"},st={class:"col-12 col-md-8"},ot={class:"text-body2 text-weight-light"};function at(e,c,u,o,r,l){return a(),m("div",null,[i(Q,{class:"text-dark"},{default:n(()=>[i(_,{class:"q-pb-sm"},{default:n(()=>[Je]),_:1}),i(_,{class:"q-py-sm"},{default:n(()=>[s("div",We,[Ge,s("div",Ze,[s("div",Xe,f(e.employee[378]===""?"N/A":e.employee[378]),1)])])]),_:1}),(a(!0),m(C,null,I(e.customIds,(t,p)=>(a(),y(_,{key:p,class:"q-py-sm"},{default:n(()=>[s("div",Ke,[s("div",et,[s("div",tt,f(e.decodeHTML(t.idType)),1)]),s("div",st,[s("div",ot,f(e.processCustomID(t)),1)])])]),_:2},1024))),128))]),_:1})])}var lt=k(ze,[["render",at]]);const nt=w({components:{LocationAndManager:ge,EmployeeJobDetails:Me,PendingReleaseDetails:Te,EmployeeIdentificationCard:lt},setup(){const e=z(),{getEmployee:c,getAssignmentsByEmployee:u,setAssignmentsByEmployee:o,updateViewedEmployees:r}=M(),l=b(()=>c(e.params.id)),t=b(()=>l.value?l.value.currentAssignment?l.value.currentAssignment:u(l.value[3])?u(l.value[3]):null:null),p=async()=>{if(!t.value&&l.value[577]){const{data:d}=await E.fetchFromHiringApp({fields:[P({type:"rawAssignments",query:"",id:l.value[577]})]});r({id:l.value[3],dataset:"currentAssignment",data:d}),o({id:l.value[3],data:d})}};return J(l,(d,g)=>{d&&p()}),{employee:l,assignment:t}}}),it={class:"q-pa-sm"},rt={key:0,class:"row"},dt={class:"col-12 col-md-6 q-px-sm"},ct={key:0,class:"q-mt-md"};function ut(e,c,u,o,r,l){const t=A("location-and-manager"),p=A("employee-job-details"),d=A("employee-identification-card"),g=A("pending-release-details");return a(),y(F,{style:{"max-width":"100vw"}},{default:n(()=>[s("div",it,[e.employee?(a(),m("div",rt,[s("div",dt,[e.employee[408]==="Active"?(a(),y(t,{key:0,employee:e.employee,assignment:e.assignment},null,8,["employee","assignment"])):h("",!0),i(p,{class:"q-mt-md",assignment:e.assignment||{},employee:e.employee},null,8,["assignment","employee"])]),s("div",{class:W(["col-12 col-md-6 q-px-sm",e.employee[581]?"order-first":""])},[i(d,{employee:e.employee},null,8,["employee"]),e.employee[581]?(a(),m("div",ct,[i(g,{employee:e.employee},null,8,["employee"])])):h("",!0)],2)])):h("",!0)])]),_:1})}var Vt=k(nt,[["render",ut]]);export{Vt as default};
