import{Q as L,b as M,a as me}from"./QTabPanels.06cc4af0.js";import{Q as fe}from"./QTabs.d70a9a25.js";import{Q as ve}from"./QToolbar.494c5d41.js";import{Q as be}from"./QPage.5a0e1cca.js";import{E as we}from"./roster.c1424840.js";import{l as H,bM as G,r as j,bN as J,c as w,_ as B,aZ as A,A as g,B as Q,d as a,bi as i,cw as x,D as d,ao as U,cx as N,cz as W,bL as $e,w as ge,F as oe,aY as se,an as O,au as X,ab as E,bI as le,bO as re,y as he}from"./index.8bd7d03d.js";import{Q as ye}from"./QSelect.c330a623.js";import{u as Z}from"./use-quasar.4af32af0.js";import{u as K}from"./dataStore.270140ab.js";import{I as ee,q as ce}from"./quickbase.c9a95ac7.js";import{u as te}from"./dataStore.b8fdaaa5.js";import{dayjs as S}from"./dayjs.cdcb4373.js";import{u as ue}from"./useQuerySaver.73c5586e.js";import{R as _e}from"./rosterTable.99b40290.js";import{_ as ae}from"./projectSelector.807dd77e.js";import{Q as ne,a as De}from"./QTable.6a0684f8.js";import{Q as ie}from"./QTr.9ef1cc28.js";import{Q as de}from"./QTd.f4f753a0.js";import{Q as je}from"./QInnerLoading.fe8d9432.js";import{e as Ve}from"./export-file.eb604dd4.js";import{g as Pe}from"./quickbaseDataHelpers.0e528d04.js";import{P as Ae}from"./projectPipeline.c7aca04d.js";import"./use-panel.7de68e10.js";import"./touch.60582172.js";import"./selection.f7c019af.js";import"./QResizeObserver.743a08b5.js";import"./rtl.cf9bbe47.js";import"./QChip.cc56d764.js";import"./QItemLabel.9525a139.js";import"./QMenu.cac3fcd3.js";import"./position-engine.d9830195.js";import"./localForage.f89ac332.js";import"./_commonjsHelpers.a26ce4be.js";import"./index.7dbe61ef.js";import"./i18n.711540c5.js";import"./api.d2932112.js";import"./QList.ffe6803e.js";import"./QMarkupTable.b9f567b7.js";import"./use-fullscreen.fab45d51.js";const Ce=H({props:{},components:{RosterTable:_e,projectSelector:ae},setup(t){const o=Z(),V=G(),v=ee(),c=j(null),h=j(""),b=j(null),l=j(null),{getSelectedProject:n}=J(v),{getAssignments:C,fetchAllAssignments:y,fetchAssignments:F}=K(),{getManpowerData:R,setRosters:T}=te(),u=w(()=>V.params.id?V.params.id:null),P=w(()=>n.value?n.value[3]:null),$=w(()=>{let r;const p=S().subtract(14,"day");return u.value?r=(R({dataset:"rosters",id:u.value})||[]).sort((m,z)=>m[1].$d<z[1].$d?1:-1):r=C(P.value).sort((s,m)=>s[1].$d<m[1].$d?1:-1),r.filter(s=>!s[112]&&s.latest&&s[102]==="Active"&&S(s[1].$d).isSameOrAfter(p)&&S(s[1].$d).isSameOrBefore(S()))}),q=w(()=>{let r=[];return $.value.forEach(p=>{p[75].toLowerCase().includes(h.value.toLowerCase())&&r.push(p)}),r=b.value?r.filter(p=>S(p[1].$d).tz("America/Chicago").format("MM/DD/YYYY")===S(b.value).tz("America/Chicago").format("MM/DD/YYYY")):r,r=l.value?r.filter(p=>p[68]===l.value):r,r.sort((p,s)=>p.employee[22]>s.employee[22]?1:-1)}),k=w(()=>[...new Map($.value.map(r=>[r[68],r[68]])).values()]),I=async r=>{o.loading.show(),u.value?(r||!R({dataset:"rosters",id:u.value}))&&await Y():c.value?await F({projectId:P.value,refresh:r}):await y({refresh:r}),o.loading.hide()},Y=async()=>{const r=`{'74'.EX.'${u.value}'}AND{'21'.EX.'In Process'}AND{'102'.EX.'Active'}`,{data:p}=await ce.fetchFromProjectsApp({fields:[ue({type:"assignments",query:r})]});T({id:u.value,data:p})};return{allAssignments:$,projectFilter:c,search:h,startDateFilter:b,craftFilter:l,craftOptions:k,rows:q,loadData:I}}}),Se={class:"row items-center"},Qe={key:0,class:"col-12 col-md-3"},Re={class:"col-12 col-md-3 q-px-sm"},qe={class:"col-12 col-md-3 q-px-sm"},ke={class:"col-12 col-md-3 q-px-sm"};function Fe(t,o,V,v,c,h){const b=A("projectSelector"),l=A("roster-table");return g(),Q("div",null,[a(W,{flat:""},{default:i(()=>[a(x,null,{default:i(()=>[d("div",Se,[t.$route.params.id?U("",!0):(g(),Q("div",Qe,[a(b,{dense:""})])),d("div",Re,[a(N,{dense:"",modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=n=>t.search=n),label:"Search"},null,8,["modelValue"])]),d("div",qe,[a(N,{dense:"",modelValue:t.startDateFilter,"onUpdate:modelValue":o[1]||(o[1]=n=>t.startDateFilter=n),label:"Arrival Date",type:"date","stack-label":""},null,8,["modelValue"])]),d("div",ke,[a(ye,{dense:"",label:"Craft","transition-show":"flip-up","transition-hide":"flip-down",modelValue:t.craftFilter,"onUpdate:modelValue":o[2]||(o[2]=n=>t.craftFilter=n),options:t.craftOptions,"use-chips":""},null,8,["modelValue","options"])])])]),_:1})]),_:1}),a(l,{rows:t.rows,onRefresh:o[3]||(o[3]=n=>t.loadData(!0))},null,8,["rows"])])}var Te=B(Ce,[["render",Fe]]);const Ie=H({props:{},components:{projectSelector:ae},setup(t){const o=Z(),V=$e(),v=G(),{capitalize:c}=he,h=ee(),b=j(null),l=j(""),n=j(null),C=j(null),{getSelectedProject:y}=J(h),{getReleases:F,fetchReleases:R,fetchAllReleases:T}=K(),{getManpowerData:u,setDepartures:P}=te(),$=w(()=>v.params.id?v.params.id:null),q=w(()=>y.value?y.value[3]:null),k=[{name:1,label:"Name",align:"left",field:e=>e[66][22],format:(e,_)=>`${I(_[66])}`,sortable:!0,sortOrder:"ad"},{name:2,label:"Workday ID",align:"left",field:e=>e[66][378],format:e=>`${e}`,sortable:!0,sortOrder:"ad"},{name:3,label:"Payroll ID",align:"left",field:e=>e[66][213],format:e=>e===""?"not available":e,sortable:!0},{name:4,label:"Classification",align:"left",field:e=>e[67][20],format:e=>`${!e||e===""?"Not Assigned":e}`,sortable:!0},{name:5,label:"Job #",align:"left",field:e=>e[67][105],format:e=>`${e===""||!e?"Not Assigned":e}`,sortable:!0},{name:6,label:"Depature Date",align:"left",field:e=>e[36].$d,format:e=>`${S(e).format("MM/DD/YYYY")}`,sortable:!0}],I=e=>{const _=e[20]!==""?c(e[20].toLowerCase().trim()):"",D=e[22]!==""?c(e[22].toLowerCase().trim()):"",f=e[21]!==""?` ${c(e[21].toLowerCase().trim())}`:"",pe=e[23]!==""?` ${c(e[23])}`:"";return`${D}${pe}, ${_}${f}`};function Y(e){V.push({name:"view-release",params:{release:e[3]}})}function r(e,_,D){let f=_!==void 0?_(e,D):e;return f=f==null?"":String(f),f=f.split('"').join('""'),`"${f}"`}function p(){const e=[k.value.map(D=>r(D.label))].concat(s.value.map(D=>k.value.map(f=>r(typeof f.field=="function"?f.field(D):D[f.field===void 0?f.name:f.field],f.format,D)).join(","))).join(`\r
`);Ve(`${S().format("MM.DD.YYYY")} Releases-Export.csv`,e,"text/csv")!==!0&&o.notify({message:"Browser denied file download...",color:"negative",icon:"warning"})}const s=w(()=>{let e;return $.value?e=u({dataset:"departures",id:$.value})||[]:e=F(q.value).sort((_,D)=>_[1].$d<D[1].$d?1:-1),e}),m=async e=>{o.loading.show(),$.value?(e||!u({dataset:"departures",id:$.value}))&&await z():b.value?await R({projectId:q.value}):await T(),o.loading.hide()},z=async()=>{const e=`{'41'.EX.'${$.value}'}AND{'42'.XEX.'Complete'}AND({'36'.OAF.'today'}OR{'36'.IR.'last 30 d'}OR{'1'.IR.'last 30 d'})`,{data:_}=await ce.fetchFromHiringApp({fields:[ue({type:"releases",query:e})]});P({id:$.value,data:_})};return ge(y,()=>{m()}),m(),{projectFilterValue:q,search:l,dateFilter:n,craftFilter:C,loadData:m,getReleases:F,columns:k,viewRelease:Y,exportAllReleases:p,rows:s}}}),Ye={class:"row items-center"},Ee={key:0,class:"col-12 col-md-3"},Ne={class:"col-12 col-md-3 q-px-sm"},Le={class:"col-12 col-md-3 q-px-sm"},Me=d("div",{class:"col-12 col-md-3 q-px-sm"},null,-1),xe={class:"full-width row flex-center text-primary q-gutter-sm q-py-md"},Oe={class:"text-dark text-caption text-italic"};function Be(t,o,V,v,c,h){const b=A("projectSelector");return g(),Q("div",null,[a(W,{flat:""},{default:i(()=>[a(x,null,{default:i(()=>[d("div",Ye,[t.$route.params.id?U("",!0):(g(),Q("div",Ee,[a(b,{dense:""})])),d("div",Ne,[a(N,{dense:"",modelValue:t.search,"onUpdate:modelValue":o[0]||(o[0]=l=>t.search=l),label:"Search"},null,8,["modelValue"])]),d("div",Le,[a(N,{dense:"",modelValue:t.dateFilter,"onUpdate:modelValue":o[1]||(o[1]=l=>t.dateFilter=l),label:"Departure Date",type:"date","stack-label":""},null,8,["modelValue"])]),Me])]),_:1})]),_:1}),d("div",null,[a(De,{title:"Recent Departures","title-class":"text-h5 text-primary",columns:t.columns,rows:t.rows,"row-key":l=>l[3],class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"There are no recent departures",dense:""},{header:i(l=>[a(ie,{class:"bg-dark text-white",props:l},{default:i(()=>[a(ne,{"auto-width":""}),(g(!0),Q(oe,null,se(l.cols,n=>(g(),O(ne,{key:n.name,props:l},{default:i(()=>[X(E(n.label),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),body:i(l=>[a(ie,{props:l},{default:i(()=>[a(de,{"auto-width":""},{default:i(()=>[a(le,{class:"cursor-pointer",size:t.$q.screen.gt.sm?"sm":"xs",color:"info",round:"",dense:"",onClick:n=>t.viewRelease(l.row),name:l.expand?"visibility_off":"visibility"},null,8,["size","onClick","name"])]),_:2},1024),(g(!0),Q(oe,null,se(l.cols,n=>(g(),O(de,{key:n.name,props:l},{default:i(()=>[X(E(n.value),1)]),_:2},1032,["props"]))),128))]),_:2},1032,["props"])]),"no-data":i(({message:l})=>[d("div",xe,[a(le,{size:"2em",name:"fa-solid fa-person-circle-exclamation"}),d("span",null,E(l),1)])]),"top-right":i(()=>[d("div",Oe,"(Total: "+E(t.getReleases(t.projectFilterValue).length)+" departures)",1),a(re,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:o[2]||(o[2]=l=>t.loadData(!0))}),a(re,{dense:t.$q.screen.lt.md,class:"q-ml-sm",color:"primary",label:"Download",onClick:t.exportAllReleases,disable:t.getReleases(t.projectFilterValue).length<1},null,8,["dense","onClick","disable"])]),loading:i(()=>[a(je,{showing:"",color:"primary"})]),_:1},8,["columns","rows","row-key"])])])}var Ue=B(Ie,[["render",Be]]);const ze={name:"Pipeline",components:{ProjectPipelineTable:Ae,projectSelector:ae},setup(){const t=Z(),o=G(),V=ee(),v=j(null),c=j(""),{getSelectedProject:h}=J(V),{fetchAllDeployments:b,fetchAllInProcess:l,fetchAllPending:n,getDeployments:C,getInProcess:y,getPending:F}=K(),{getManpowerData:R,setPipelines:T}=te(),u=w(()=>o.params.id?o.params.id:null),P=w(()=>h.value?h.value[3]:null),$=w(()=>C(P.value).filter(s=>s[20]==="Complete")),q=w(()=>{const s=[];return C(P.value).forEach(m=>{m[31].toLowerCase().includes(c.value.toLowerCase())&&s.push(m)}),s}),k=w(()=>{const s=[];return F(P.value).forEach(m=>{m[25].toLowerCase().includes(c.value.toLowerCase())&&s.push(m)}),s}),I=w(()=>{const s=[];return y(P.value).forEach(m=>{m[39].toLowerCase().includes(c.value.toLowerCase())&&s.push(m)}),s}),Y=w(()=>{let s;return u.value?s=R({dataset:"pipelines",id:u.value})||[]:s=I.value.concat(k.value.concat(q.value)),s}),r=async s=>{t.loading.show(),u.value?(s||!R({dataset:"pipelines",id:u.value}))&&await p():(await b(s),await l(s),await n(s)),t.loading.hide()},p=async()=>{const s=await Pe(u.value);T({id:u.value,data:s})};return r(),{projectFilter:v,arrived:$,allPipeline:Y,search:c,loadData:r}}},Xe={class:"text-h5 text-dark"},He={class:"text-body2 text-italic q-ml-sm"},Ge=d("div",{class:"text-subtitle2 text-accent"},"The following people are currently in process or deployed for your job site(s).",-1),Je={class:"row items-center"},We={key:0,class:"col-12 col-md-3 q-px-sm"},Ze={class:"col-12 col-md-3 q-px-sm"};function Ke(t,o,V,v,c,h){const b=A("projectSelector"),l=A("project-pipeline-table");return g(),Q("div",null,[a(W,{flat:""},{default:i(()=>[a(x,{class:"q-pb-none"},{default:i(()=>[d("div",Xe,[X(" Staffing Pipeline "),d("span",He,"("+E(v.allPipeline.length)+" total)",1)]),Ge]),_:1}),a(x,null,{default:i(()=>[d("div",Je,[t.$route.params.id?U("",!0):(g(),Q("div",We,[a(b,{dense:""})])),d("div",Ze,[a(N,{dense:"",modelValue:v.search,"onUpdate:modelValue":o[0]||(o[0]=n=>v.search=n),label:"Search"},null,8,["modelValue"])])])]),_:1})]),_:1}),a(l,{rows:v.allPipeline,onRefresh:o[1]||(o[1]=n=>v.loadData(!0))},null,8,["rows"])])}var et=B(ze,[["render",Ke]]);const tt=H({name:"Employees",components:{RosterTab:we,NewArrivalsTab:Te,ReleasesTab:Ue,PipelineTab:et},setup(){return{tab:j(0)}}}),at={class:"q-pa-md"};function ot(t,o,V,v,c,h){const b=A("roster-tab"),l=A("new-arrivals-tab"),n=A("pipeline-tab"),C=A("releases-tab");return g(),O(be,{style:{"max-width":"100vw"}},{default:i(()=>[d("div",at,[a(ve,{class:"bg-info text-white shadow-2 rounded-borders"},{default:i(()=>[a(fe,{modelValue:t.tab,"onUpdate:modelValue":o[0]||(o[0]=y=>t.tab=y),"bg-color":"none","indicator-color":"accent",align:"justify",dense:""},{default:i(()=>[a(L,{name:0,label:t.$q.screen.gt.xs?"All Employees":"Employees"},null,8,["label"]),a(L,{name:1,label:"New Arrivals"}),t.$route.name==="project-manpower"?(g(),O(L,{key:0,name:3,label:"Pipeline"})):U("",!0),a(L,{name:2,label:"Departures"})]),_:1},8,["modelValue"])]),_:1}),a(me,{modelValue:t.tab,"onUpdate:modelValue":o[1]||(o[1]=y=>t.tab=y),animated:""},{default:i(()=>[a(M,{name:0},{default:i(()=>[a(b)]),_:1}),a(M,{name:1},{default:i(()=>[a(l)]),_:1}),a(M,{name:3},{default:i(()=>[a(n)]),_:1}),a(M,{name:2},{default:i(()=>[a(C)]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var Ot=B(tt,[["render",ot]]);export{Ot as default};
