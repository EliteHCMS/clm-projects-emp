import{_ as j,l as I,r as P,bN as $,c as k,w as q,aZ as D,A as Q,an as C,bi as m,D as h,d as l,cw as w,bO as x,cz as A}from"./index.bf0c7c2b.js";import{a as B}from"./QTable.a22e6d54.js";import{Q as E}from"./QPage.2ae93e6c.js";import{I as N,u as X,q as g}from"./quickbase.d58ce3ab.js";import{a as _}from"./useQuerySaver.ae1b8d62.js";import{u as z}from"./dataStore.0d3934b7.js";import{_ as F}from"./projectSelector.8afe3fcb.js";import"./QList.11fcb9c9.js";import"./QMarkupTable.e769dd43.js";import"./QSelect.cdcc5b09.js";import"./QChip.5a3b0c23.js";import"./QItemLabel.58a8a2bf.js";import"./QMenu.493f5181.js";import"./position-engine.698f4c6e.js";import"./selection.c939f5d3.js";import"./rtl.cf9bbe47.js";import"./use-fullscreen.62e48e92.js";import"./_commonjsHelpers.a26ce4be.js";import"./dayjs.58d8c02b.js";import"./index.7dbe61ef.js";import"./localForage.8eea1ffc.js";import"./api.06a5dbca.js";import"./i18n.50f8cb71.js";const O=I({name:"Inventory",components:{projectSelector:F},setup(){const i=P(0),{getInventory:r,setInventory:d}=z(),{getSelectedProject:a}=$(N()),{userProjects:f}=X(),y=[{name:0,label:"Code",align:"left",field:t=>t[11],format:t=>`${t}`,sortable:!0},{name:1,label:"Description",align:"left",field:t=>t[16],format:t=>`${t}`,sortable:!0,required:!0},{name:2,label:"Base Quantity",align:"right",field:t=>t[6],format:t=>t,sortable:!0},{name:3,label:"In Stock",align:"right",field:t=>t[7],format:t=>t,sortable:!0},{name:4,label:"In Utilization",align:"right",field:t=>t[22],format:t=>t,sortable:!0}],u=k(()=>{const t=a.value&&r(a.value[3])?r(a.value[3]).items:r();return t?Array.isArray(t)?t.sort((e,o)=>e[11]>o[11]?1:-1):Object.values(t).map(n=>n.items?n.items:[]).flat(1).sort((n,b)=>n[11]>b[11]?1:-1):[]}),c=async t=>{const{data:e}=await g.fetchFromProjectsApp({fields:[_({type:"inventoryItems",query:`{'8'.EX.'${t}'}`})]});return{items:e}},v=async t=>{const{data:e}=await g.fetchFromProjectsApp({fields:[_({type:"inventoryLogs",query:`{'6'.EX.'${t}'}AND{'14'.EX.true}`})]}),o=e[0];if(o){const{items:n}=await c(o[3]);return o.items=n,o}else return{[t]:{items:[]}}},p=async t=>{if(a.value){if(!r(a.value[3])||t){const e=await v(a.value[3]);d({id:a.value[3],data:e})}}else{const e=[];f().forEach(s=>{if(!r(s[9])||t){const S=v(s[9]);e.push(S)}}),(await Promise.allSettled(e)).map(s=>s.value).forEach(s=>{s&&d({id:s[6],data:s})})}};return p(),q(a,()=>{p(),console.log(u.value)}),{tab:i,rows:u,columns:y,loadData:p}}}),R={class:"q-pa-md"},T={class:"row items-center"};function U(i,r,d,a,f,y){const u=D("projectSelector");return Q(),C(E,{style:{"max-width":"100vw"}},{default:m(()=>[h("div",R,[l(A,{flat:""},{default:m(()=>[l(w,null,{default:m(()=>[h("div",T,[l(u,{style:{width:"250px"},dense:""})])]),_:1}),l(w,null,{default:m(()=>[l(B,{title:"Yard Inventory","title-class":"text-h5 text-primary",columns:i.columns,rows:i.rows?i.rows:[],"row-key":c=>c?c[3]:0,class:"q-pa-sm",pagination:{rowsPerPage:25},"table-header-class":"bg-dark text-white","no-data-label":"No Inventory",dense:""},{"top-right":m(()=>[l(x,{color:"secondary",flat:"","icon-right":"refresh",label:"Refresh",onClick:r[0]||(r[0]=c=>i.loadData(!0))})]),_:1},8,["columns","rows","row-key"])]),_:1})]),_:1})])]),_:1})}var pt=j(O,[["render",U]]);export{pt as default};
