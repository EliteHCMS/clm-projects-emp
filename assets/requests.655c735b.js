import{Q as y,a as L,b as v}from"./QTabPanels.e822e3db.js";import{Q as z}from"./QTabs.eebbc433.js";import{Q as H}from"./QToolbar.2a84513c.js";import{Q as G}from"./QPage.5ec04786.js";import{l as X,r as A,c as D,_ as V,b5 as b,A as u,B as p,d as a,ar as c,y as K,bU as M,aq as Q,br as n,D as I}from"./index.d4eae66d.js";import{u as J,q as j}from"./app.613d4acb.js";import{a as $,u as W}from"./useQuerySaver.d29ff9ee.js";import{dayjs as Y}from"./dayjs.623dcd01.js";import{u as _}from"./dataStore.1c488d7d.js";import{u as Z}from"./use-quasar.bcab4131.js";import{u as x}from"./dataStore.e26345ff.js";import{R as ee,a as te}from"./requestDataAlt.d9dab140.js";import{N as ae}from"./nameRequestData.3d7806d7.js";import"./use-panel.535b1c2c.js";import"./touch.3df10340.js";import"./selection.0cbecac7.js";import"./QResizeObserver.4921fc3a.js";import"./rtl.b51694b1.js";import"./_commonjsHelpers.a26ce4be.js";import"./localForage.8903a003.js";import"./api.1778fb80.js";import"./index.04bc0a32.js";import"./i18n.686f34be.js";import"./QTd.d2ccd994.js";import"./QTable.12045531.js";import"./QList.bc659d96.js";import"./QMarkupTable.483f898b.js";import"./QSelect.031fcf1a.js";import"./QChip.41616f02.js";import"./QMenu.7266e205.js";import"./position-engine.0aae880f.js";import"./use-fullscreen.22e35b6e.js";import"./QSpinnerGears.d4624378.js";import"./QTooltip.642cbb8f.js";import"./workday.11468253.js";import"./syncEmployeeWithWorkday.826834d5.js";import"./workdayAPI.6e5c59c3.js";const oe=X({props:{type:String,project:Number,dataset:String},components:{RequestDataTable:ee,NameRequestDataTable:ae,RequestDataTableAlt:te},setup(e){const t=Z(),{capitalize:l}=K,{getOpenRequest:f,getPendingRequest:d,getClosedRequest:R,getNameRequest:r,setNameRequest:i,setOpenRequest:h,setPendingRequest:g,setClosedRequest:ce,removeData:k}=x(),{userData:P}=J(),N=A(!0),{getViewedProjects:E,updateViewedProjects:T}=_(),w=D(()=>E(e.project)),m=D(()=>w.value?w.value[e.dataset]?w.value[e.dataset]:[]:[]),C=s=>{N.value=!0;let o;e.type==="open"?(m.value.length===0||s)&&(o=[$({type:"requests",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'3'}`})],q(o)):e.type==="pending"?(m.value.length===0||s)&&(o=[$({type:"requests",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'2'}`})],q(o)):e.type==="closed"?(m.value.length===0||s)&&(o=[$({type:"requestsNoQueries",query:`{'6'.EX.'${e.project}'}AND{'147'.EX.'5'}`})],q(o)):e.type==="named"&&(m.value.length===0||s)&&(o=[W({type:"names",query:`{'38'.EX.'${e.project}'}AND{'31'.XEX.'Cancelled'}AND{'31'.XEX.'Closed'}AND{'11'.XEX.true}`})],q(o))},q=async s=>{const{data:o}=e.type==="named"?await j.fetchFromHiringApp({fields:s}):await j.fetchFromProjectsApp({fields:s}),O=o.length>0?o.sort((B,U)=>B[1].$d>U[1].$d?-1:1):[];T({id:e.project,dataset:e.dataset,data:O}),N.value=!1};function F(s){return`${l(s[6].toLowerCase())} ${l(s[7].toLowerCase())}`}async function S(s){t.dialog({title:"Confirm",message:`Are you sure you want to remove ${F(s)} from request# ${s[18]}?`,cancel:!0,persistent:!0}).onOk(async()=>{try{const{data:o}=await j.upsertRecordsXML({to:"bsg4yb4wa",data:[{3:{value:s[3]},11:{value:!0},12:{value:Y().tz("America/Chicago")},13:{value:`${P[35]} ${P[37]}`}}],fieldsToReturn:[15],formatObject:15});k({type:"nameRequest",key:o[0][15][38],item:o[0][15],storageKey:"storageNameRequest"})}catch(o){t.notify({type:"negative",message:"Cannot remove name request"}),console.log(o)}})}return C(),{configureFetch:C,removeName:S,loading:N,rows:m}}}),se={key:0},re={key:1},ne={key:2},ue={key:3};function le(e,t,l,f,d,R){const r=b("request-data-table"),i=b("request-data-table-alt"),h=b("name-request-data-table");return u(),p("div",null,[e.type==="open"?(u(),p("div",se,[a(r,{loading:e.loading,requests:e.rows,status:"Open",onRefreshData:t[0]||(t[0]=g=>e.configureFetch(!0))},null,8,["loading","requests"])])):c("",!0),e.type==="pending"?(u(),p("div",re,[a(r,{loading:e.loading,requests:e.rows,status:"Pending",onRefreshData:t[1]||(t[1]=g=>e.configureFetch(!0))},null,8,["loading","requests"])])):c("",!0),e.type==="closed"?(u(),p("div",ne,[a(i,{loading:e.loading,requests:e.rows,status:"Closed",onRefreshData:t[2]||(t[2]=g=>e.configureFetch(!0))},null,8,["loading","requests"])])):c("",!0),e.type==="named"?(u(),p("div",ue,[a(h,{loading:e.loading,requests:e.rows,status:"Named",onRemoveName:e.removeName,onRefreshData:t[3]||(t[3]=g=>e.configureFetch(!0))},null,8,["loading","requests","onRemoveName"])])):c("",!0)])}var ie=V(oe,[["render",le]]);const de=X({components:{RequestPanel:ie},setup(){const e=A(0),t=M(),{getViewedProjects:l,setViewedProjects:f}=_(),d=D(()=>l(t.params.id));return(async()=>{if(!d.value){const{data:r}=await j.fetchFromProjectsApp({fields:[$({type:"projects",id:t.params.id})]});f({id:t.params.id,data:r})}})(),{tab:e,project:d}}}),me={class:"q-pa-sm"};function pe(e,t,l,f,d,R){const r=b("request-panel");return u(),Q(G,{style:{"max-width":"100vw"}},{default:n(()=>[I("div",me,[a(H,{class:"bg-info text-white shadow-2 rounded-borders"},{default:n(()=>[a(z,{align:"left",modelValue:e.tab,"onUpdate:modelValue":t[0]||(t[0]=i=>e.tab=i),dense:"","indicator-color":"accent"},{default:n(()=>[a(y,{name:0,label:"Open"}),a(y,{name:1,label:"Names"}),a(y,{name:2,label:"Pending"}),a(y,{name:3,label:"Complete"})]),_:1},8,["modelValue"])]),_:1}),e.project?(u(),Q(L,{key:0,modelValue:e.tab,"onUpdate:modelValue":t[1]||(t[1]=i=>e.tab=i),animated:""},{default:n(()=>[a(v,{name:0},{default:n(()=>[a(r,{project:e.project[3],type:"open",dataset:"openRequests"},null,8,["project"])]),_:1}),a(v,{name:1},{default:n(()=>[a(r,{project:e.project[3],type:"named",dataset:"namedRequests"},null,8,["project"])]),_:1}),a(v,{name:2},{default:n(()=>[a(r,{project:e.project[3],type:"pending",dataset:"pendingRequests"},null,8,["project"])]),_:1}),a(v,{name:3},{default:n(()=>[a(r,{project:e.project[3],type:"closed",dataset:"closedRequests"},null,8,["project"])]),_:1})]),_:1},8,["modelValue"])):c("",!0)])]),_:1})}var Ye=V(de,[["render",pe]]);export{Ye as default};
